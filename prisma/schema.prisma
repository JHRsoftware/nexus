generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  username    String   @unique @db.VarChar(50)
  password    String   @db.VarChar(255)
  accessPages String?  @map("access_pages") @db.Text
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Product {
  id           Int           @id @default(autoincrement())
  categoryId   Int           @map("category_id")
  productCode  String        @unique @map("product_code") @db.VarChar(50)
  itemName     String        @map("item_name") @db.VarChar(200)
  sellingPrice Decimal       @map("selling_price") @db.Decimal(10, 2)
  availableQty Int           @map("available_qty")
  totalCost    Decimal       @map("total_cost") @db.Decimal(10, 2)
  user         String        @db.VarChar(100)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  grnItems     GrnItem[]
  invoiceItems InvoiceItem[]
  orderItems   OrderItem[]
  category     category      @relation(fields: [categoryId], references: [id], map: "products_category_fk")

  @@index([categoryId], map: "products_category_id_idx")
  @@index([itemName], map: "products_item_name_idx")
  @@index([availableQty], map: "products_qty_idx")
  @@index([createdAt], map: "products_created_idx")
  @@map("products")
}

model Supplier {
  id            Int      @id @default(autoincrement())
  supplierName  String   @map("supplier_name") @db.VarChar(200)
  address       String   @db.Text
  contactNumber String   @map("contact_number") @db.VarChar(50)
  email         String   @db.VarChar(100)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  user          String   @db.VarChar(100)
  grns          Grn[]

  @@map("suppliers")
}

model Grn {
  id            Int       @id @default(autoincrement())
  grnDate       DateTime  @map("grn_date")
  supplierId    Int       @map("supplier_id")
  invoiceNumber String    @map("invoice_number") @db.VarChar(100)
  poNumber      String?   @map("po_number") @db.VarChar(100)
  paymentType   String    @map("payment_type") @db.VarChar(20)
  totalAmount   Decimal   @map("total_amount") @db.Decimal(12, 2)
  user          String    @db.VarChar(100)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  grnItems      GrnItem[]
  supplier      Supplier  @relation(fields: [supplierId], references: [id], map: "grns_supplier_fk")

  @@index([supplierId], map: "grns_supplier_id_idx")
  @@map("grns")
}

model GrnItem {
  id        Int      @id @default(autoincrement())
  grnId     Int      @map("grn_id")
  productId Int      @map("product_id")
  quantity  Int
  costPrice Decimal  @map("cost_price") @db.Decimal(10, 2)
  totalCost Decimal  @map("total_cost") @db.Decimal(12, 2)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  grn       Grn      @relation(fields: [grnId], references: [id], onDelete: Cascade, map: "grn_items_grn_fk")
  product   Product  @relation(fields: [productId], references: [id], map: "grn_items_product_fk")

  @@index([grnId], map: "grn_items_grn_id_idx")
  @@index([productId], map: "grn_items_product_id_idx")
  @@map("grn_items")
}

model Discount {
  id           Int       @id @default(autoincrement())
  discountName String    @map("discount_name") @db.VarChar(255)
  percentage   Decimal   @db.Decimal(5, 2)
  isActive     Boolean   @default(true) @map("is_active")
  user         String    @db.VarChar(255)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  invoices     Invoice[]
  orders       Order[]

  @@unique([discountName, isActive], name: "unique_active_discount")
  @@map("discounts")
}

model Shop {
  id                 Int              @id @default(autoincrement())
  shopName           String           @map("shop_name") @db.VarChar(255)
  ownerName          String           @map("owner_name") @db.VarChar(255)
  address            String           @db.Text
  contactNumber      String           @unique @map("contact_number") @db.VarChar(20)
  email              String?          @unique @db.VarChar(255)
  businessRegisterNo String?          @unique @map("business_register_no") @db.VarChar(100)
  image              String?          @db.VarChar(500)
  creditLimit        Decimal          @default(0.00) @map("credit_limit") @db.Decimal(12, 2)
  balanceAmount      Decimal          @default(0.00) @map("balance_amount") @db.Decimal(12, 2)
  isActive           Boolean          @default(true) @map("is_active")
  user               String           @db.VarChar(255)
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  invoices           Invoice[]
  orders             Order[]
  pendingPayments    PendingPayment[]

  @@unique([shopName, isActive], name: "unique_active_shop")
  @@index([ownerName], map: "shops_owner_name_idx")
  @@index([balanceAmount], map: "shops_balance_idx")
  @@map("shops")
}

model Invoice {
  id                    Int             @id @default(autoincrement())
  invoiceNumber         String          @unique @map("invoice_number") @db.VarChar(50)
  invoiceDate           DateTime        @map("invoice_date")
  shopId                Int             @map("shop_id")
  discountId            Int?            @map("discount_id")
  subTotal              Decimal         @map("sub_total") @db.Decimal(12, 2)
  totalDiscount         Decimal         @default(0.00) @map("total_discount") @db.Decimal(12, 2)
  cashDiscount          Decimal         @default(0.00) @map("cash_discount") @db.Decimal(12, 2)
  cashDiscountEnabled   Boolean         @default(false) @map("cash_discount_enabled")
  cashDiscountPercentage Decimal        @default(0.00) @map("cash_discount_percentage") @db.Decimal(5, 2)
  netTotal              Decimal         @map("net_total") @db.Decimal(12, 2)
  user                  String          @db.VarChar(255)
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")
  salesRepId            Int?            @map("sales_rep_id")
  invoiceType           String?         @map("invoice_type") @db.VarChar(100)
  invoiceTypePercentage Decimal?        @map("invoice_type_percentage") @db.Decimal(5, 2)
  totalCost             Decimal         @default(0.00) @map("total_cost") @db.Decimal(12, 2)
  totalProfit           Decimal         @default(0.00) @map("total_profit") @db.Decimal(12, 2)
  orderNumber           String?         @map("order_number") @db.VarChar(50)
  notes                 String?         @db.Text
  invoiceItems          InvoiceItem[]
  discount              Discount?       @relation(fields: [discountId], references: [id], map: "invoices_discount_fk")
  salesRep              SalesRep?       @relation(fields: [salesRepId], references: [id], map: "invoices_sales_rep_fk")
  shop                  Shop            @relation(fields: [shopId], references: [id], map: "invoices_shop_fk")
  pendingPayment        PendingPayment?

  @@index([discountId], map: "invoices_discount_id_idx")
  @@index([shopId], map: "invoices_shop_id_idx")
  @@index([salesRepId], map: "invoices_sales_rep_id_idx")
  @@index([orderNumber])
  @@index([invoiceDate], map: "invoices_date_idx")
  @@index([netTotal], map: "invoices_net_total_idx")
  @@map("invoices")
}

model InvoiceItem {
  id           Int      @id @default(autoincrement())
  invoiceId    Int      @map("invoice_id")
  productId    Int      @map("product_id")
  quantity     Int
  sellingPrice Decimal  @map("selling_price") @db.Decimal(10, 2)
  discount     Decimal  @default(0.00) @db.Decimal(10, 2)
  price        Decimal  @db.Decimal(12, 2)
  totalPrice   Decimal  @map("total_price") @db.Decimal(12, 2)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  itemCost     Decimal  @default(0.00) @map("item_cost") @db.Decimal(12, 2)
  itemProfit   Decimal  @default(0.00) @map("item_profit") @db.Decimal(12, 2)
  invoice      Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade, map: "invoice_items_invoice_fk")
  product      Product  @relation(fields: [productId], references: [id], map: "invoice_items_product_fk")

  @@index([invoiceId], map: "invoice_items_invoice_id_idx")
  @@index([productId], map: "invoice_items_product_id_idx")
  @@map("invoice_items")
}

model PendingPayment {
  id              Int       @id @default(autoincrement())
  invoiceId       Int       @unique @map("invoice_id")
  shopId          Int       @map("shop_id")
  netTotal        Decimal   @map("net_total") @db.Decimal(12, 2)
  paidAmount      Decimal   @default(0.00) @map("paid_amount") @db.Decimal(12, 2)
  remainingAmount Decimal   @map("remaining_amount") @db.Decimal(12, 2)
  paymentStatus   String    @default("pending") @map("payment_status") @db.VarChar(20)
  dueDate         DateTime? @map("due_date")
  user            String    @db.VarChar(255)
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  salesRepId      Int?      @map("sales_rep_id")
  invoice         Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade, map: "pending_payments_invoice_fk")
  salesRep        SalesRep? @relation(fields: [salesRepId], references: [id], map: "pending_payments_sales_rep_fk")
  shop            Shop      @relation(fields: [shopId], references: [id], map: "pending_payments_shop_fk")

  @@index([shopId], map: "pending_payments_shop_id_idx")
  @@index([salesRepId], map: "pending_payments_sales_rep_id_idx")
  @@map("pending_payments")
}

model Settings {
  id                          Int      @id @default(autoincrement())
  companyName                 String   @map("company_name") @db.VarChar(255)
  companyAddress              String   @map("company_address") @db.Text
  companyContactNumber        String   @map("company_contact_number") @db.VarChar(50)
  companyBusinessRegNo        String?  @map("company_business_reg_no") @db.VarChar(100)
  companyDescription          String?  @map("company_description") @db.Text
  companyLogo                 String?  @map("company_logo") @db.Text
  invoiceWatermark            String?  @map("invoice_watermark") @db.VarChar(100)
  invoiceTermsAndConditions   String?  @map("invoice_terms_and_conditions") @db.Text
  invoiceFooter               String?  @map("invoice_footer") @db.VarChar(500)
  invoiceDeveloperNote        String?  @map("invoice_developer_note") @db.VarChar(255)
  defaultCreditLimit          Decimal  @default(100000.00) @map("default_credit_limit") @db.Decimal(12, 2)
  totalBalanceDiscountPercent Decimal  @default(5.00) @map("total_balance_discount_percent") @db.Decimal(5, 2)
  showTotalBalanceDiscount    Boolean  @default(false) @map("show_total_balance_discount")
  dueDateOptions              String   @map("due_date_options") @db.Text
  createdBy                   Int      @map("created_by")
  updatedBy                   Int      @map("updated_by")
  createdAt                   DateTime @default(now()) @map("created_at")
  updatedAt                   DateTime @updatedAt @map("updated_at")
  isDiscountReadonly          Boolean  @default(false) @map("is_discount_readonly")
  isSellingPriceReadonly      Boolean  @default(false) @map("is_selling_price_readonly")
  showTotalDiscountFromItems  Boolean  @default(true) @map("show_total_discount_from_items")
  hideCostProfit              Boolean  @default(false) @map("hide_cost_profit")
  hideSellingPrice            Boolean  @default(false) @map("hide_selling_price")
  hideDiscount                Boolean  @default(false) @map("hide_discount")
  hideFreeProducts            Boolean  @default(false) @map("hide_free_products")
  hideCashDiscount            Boolean  @default(false) @map("hide_cash_discount")

  @@map("settings")
}

model category {
  id       Int       @id @default(autoincrement())
  category String    @db.VarChar(100)
  user     String    @db.VarChar(100)
  products Product[]
}

model SalesRep {
  id              Int              @id @default(autoincrement())
  name            String           @db.VarChar(255)
  contactNumber   String           @unique @map("contact_number") @db.VarChar(50)
  remark          String?          @db.Text
  status          String           @default("active") @db.VarChar(20)
  user            String           @db.VarChar(255)
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  invoices        Invoice[]
  orders          Order[]
  pendingPayments PendingPayment[]

  @@map("sales_reps")
}

model Order {
  id                    Int         @id @default(autoincrement())
  orderNumber           String      @unique @map("order_number") @db.VarChar(50)
  orderDate             DateTime    @map("order_date")
  shopId                Int         @map("shop_id")
  salesRepId            Int?        @map("sales_rep_id")
  discountId            Int?        @map("discount_id")
  invoiceType           String?     @map("invoice_type") @db.VarChar(100)
  invoiceTypePercentage Decimal?    @map("invoice_type_percentage") @db.Decimal(5, 2)
  subTotal              Decimal     @map("sub_total") @db.Decimal(12, 2)
  totalDiscount         Decimal     @default(0.00) @map("total_discount") @db.Decimal(12, 2)
  cashDiscount          Decimal     @default(0.00) @map("cash_discount") @db.Decimal(12, 2)
  cashDiscountEnabled   Boolean     @default(false) @map("cash_discount_enabled")
  cashDiscountPercentage Decimal    @default(0.00) @map("cash_discount_percentage") @db.Decimal(5, 2)
  netTotal              Decimal     @map("net_total") @db.Decimal(12, 2)
  totalCost             Decimal     @default(0.00) @map("total_cost") @db.Decimal(12, 2)
  totalProfit           Decimal     @default(0.00) @map("total_profit") @db.Decimal(12, 2)
  status                String      @default("draft") @db.VarChar(20)
  notes                 String?     @db.Text
  user                  String      @db.VarChar(255)
  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")
  orderItems            OrderItem[]
  discount              Discount?   @relation(fields: [discountId], references: [id], map: "orders_discount_fk")
  salesRep              SalesRep?   @relation(fields: [salesRepId], references: [id], map: "orders_sales_rep_fk")
  shop                  Shop        @relation(fields: [shopId], references: [id], map: "orders_shop_fk")

  @@index([shopId], map: "orders_shop_id_idx")
  @@index([salesRepId], map: "orders_sales_rep_id_idx")
  @@index([discountId], map: "orders_discount_id_idx")
  @@map("orders")
}

model OrderItem {
  id           Int      @id @default(autoincrement())
  orderId      Int      @map("order_id")
  productId    Int      @map("product_id")
  quantity     Int
  sellingPrice Decimal  @map("selling_price") @db.Decimal(10, 2)
  discount     Decimal  @default(0.00) @db.Decimal(10, 2)
  price        Decimal  @db.Decimal(12, 2)
  totalPrice   Decimal  @map("total_price") @db.Decimal(12, 2)
  itemCost     Decimal  @default(0.00) @map("item_cost") @db.Decimal(12, 2)
  itemProfit   Decimal  @default(0.00) @map("item_profit") @db.Decimal(12, 2)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade, map: "order_items_order_fk")
  product      Product  @relation(fields: [productId], references: [id], map: "order_items_product_fk")

  @@index([orderId], map: "order_items_order_id_idx")
  @@index([productId], map: "order_items_product_id_idx")
  @@map("order_items")
}
