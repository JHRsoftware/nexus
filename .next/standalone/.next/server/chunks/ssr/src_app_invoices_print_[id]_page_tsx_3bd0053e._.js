module.exports=[95647,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(11642);a.s(["default",0,()=>{let a=(0,d.useRouter)(),f=(0,d.useParams)(),g=f?.id,{user:h}=(0,e.useAuth)(),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)("");(0,c.useEffect)(()=>{(async()=>{if(g){n(!0);try{let a=await fetch(`/api/invoices/${g}`,{headers:{"Content-Type":"application/json"}}),b=await a.json();b.success&&b.invoice?j(b.invoice):p("Invoice not found")}catch(a){p("Failed to load invoice")}finally{n(!1)}}})()},[g]),(0,c.useEffect)(()=>{let a=async()=>{try{let a=await fetch("/api/softwareSettings",{headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(h||{})}}),b=await a.json();if(b.success&&b.settings){let a={companyName:b.settings.companyName||"",companyAddress:b.settings.companyAddress||"",companyContactNumber:b.settings.companyContactNumber||"",companyBusinessRegNo:b.settings.companyBusinessRegNo||"",companyDescription:b.settings.companyDescription||"",companyLogo:b.settings.companyLogo||"",totalBalanceDiscountPercent:b.settings.totalBalanceDiscountPercent||0};l(a)}}catch(a){l({companyName:"API Error - Company Name",companyAddress:"API Error - Company Address",companyContactNumber:"API Error - Contact Number",companyBusinessRegNo:"",companyDescription:"",companyLogo:"",totalBalanceDiscountPercent:0})}};h&&a()},[h]);let q=()=>{a.back()},r=(()=>{if(!i)return{subTotal:0,creditDiscount:0,discountAmount:0,totalDiscountFromItems:0,netBeforeCashDiscount:0,cashDiscount:0,cashDiscountPercent:0,netTotal:0,totalItems:0};let a=Number(i.subTotal||0),b=Number(i.discountAmount||0),c=Number(i.netTotal||0),d=Number(i.invoiceItems.reduce((a,b)=>a+Number(b.discount||0),0).toFixed(2)),e=0;i.discount&&i.discount.percentage?e=i.discount.percentage:i.invoiceTypePercentage&&(e=i.invoiceTypePercentage);let f=0;e>0&&(f=Number((a*e/100).toFixed(2)));let g=b>0?b:f,h=a-g,j=0,l=0;i.cashDiscountEnabled&&(j=i.cashDiscountPercentage||k?.totalBalanceDiscountPercent||0,l=Math.max(0,h-c));let m=Number(i.invoiceItems.reduce((a,b)=>a+Number(b.quantity||0),0));return{subTotal:Number(a.toFixed(2)),creditDiscount:Number(g.toFixed(2)),creditDiscountPercent:Number(e),discountAmount:Number(g.toFixed(2)),totalDiscountFromItems:Number(d),netBeforeCashDiscount:Number(h.toFixed(2)),cashDiscount:Number(l.toFixed(2)),cashDiscountPercent:Number(j),netTotal:Number(c.toFixed(2)),totalItems:Number(m)}})();return m?(0,b.jsxs)("div",{className:"loading",children:[(0,b.jsx)("div",{className:"loading-spinner"}),(0,b.jsx)("p",{children:"Loading invoice..."})]}):o||!i?(0,b.jsxs)("div",{className:"error",children:[(0,b.jsx)("h2",{children:"Error"}),(0,b.jsx)("p",{children:o||"Invoice not found"}),(0,b.jsx)("button",{onClick:q,className:"back-button",children:"Go Back"})]}):(0,b.jsxs)("div",{className:"print-container",children:[(0,b.jsxs)("div",{className:"print-controls",children:[(0,b.jsx)("button",{onClick:q,className:"back-button",children:"â† Back to Invoices"}),(0,b.jsx)("button",{onClick:()=>{document.title="",setTimeout(()=>{window.print()},100)},className:"print-button",children:"ðŸ–¨ï¸ Print Invoice"})]}),(0,b.jsxs)("div",{className:"invoice",children:[(0,b.jsxs)("div",{className:"header",children:[(0,b.jsxs)("div",{className:"company-info",children:[k?.companyLogo&&""!==k.companyLogo.trim()&&(0,b.jsx)("div",{className:"company-logo",children:(0,b.jsx)("img",{src:k.companyLogo,alt:"Company Logo",className:"logo-image",onError:a=>{a.target.style.display="none"}})}),(0,b.jsx)("h1",{className:"company-name",children:k?.companyName&&""!==k.companyName.trim()?k.companyName:"Company Name Not Set"}),(0,b.jsx)("p",{className:"company-address",children:k?.companyAddress&&""!==k.companyAddress.trim()?(0,b.jsxs)(b.Fragment,{children:[k.companyAddress.split("\n").map((a,d)=>(0,b.jsxs)(c.default.Fragment,{children:[a,d<k.companyAddress.split("\n").length-1&&(0,b.jsx)("br",{})]},d)),(0,b.jsx)("br",{}),"Phone: ",k.companyContactNumber||"Contact Number Not Set",k.companyBusinessRegNo&&""!==k.companyBusinessRegNo.trim()&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("br",{}),"Business Reg: ",k.companyBusinessRegNo]})]}):(0,b.jsxs)(b.Fragment,{children:["Company Address Not Set",(0,b.jsx)("br",{}),"Please update in Settings",(0,b.jsx)("br",{}),"Phone: Contact Number Not Set",(0,b.jsx)("br",{})]})})]}),(0,b.jsxs)("div",{className:"invoice-header",children:[(0,b.jsx)("h2",{className:"invoice-title",children:"INVOICE"}),(0,b.jsxs)("div",{className:"invoice-info",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Invoice #:"})," ",i.invoiceNumber]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",new Date(i.invoiceDate).toLocaleDateString("en-GB")]}),i.dueDate&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Due Date:"})," ",new Date(i.dueDate).toLocaleDateString("en-GB")]}),i.discount&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Invoice Type:"})," ",i.discount.discountName," (",i.discount.percentage,"% discount)"]}),i.dueDate&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Payment Terms:"})," Net ",Math.ceil((new Date(i.dueDate).getTime()-new Date(i.invoiceDate).getTime())/864e5)," days"]})]})]})]}),(0,b.jsxs)("div",{className:"billing-info",children:[(0,b.jsxs)("div",{className:"bill-to",children:[(0,b.jsx)("h3",{children:"Bill To:"}),(0,b.jsxs)("div",{className:"customer-info",children:[(0,b.jsx)("p",{children:(0,b.jsx)("strong",{children:i.shop.shopName})}),(0,b.jsx)("p",{children:i.shop.ownerName}),(0,b.jsxs)("p",{children:["Phone: ",i.shop.contactNumber]}),i.shop.address&&(0,b.jsx)("p",{children:i.shop.address})]})]}),i.salesRep&&(0,b.jsxs)("div",{className:"sales-rep",children:[(0,b.jsx)("h3",{children:"Sales Representative:"}),(0,b.jsx)("p",{children:(0,b.jsx)("strong",{children:i.salesRep.name})}),(0,b.jsxs)("p",{children:["Phone: ",i.salesRep.contactNumber]})]})]}),(0,b.jsx)("div",{className:"items-section",children:(0,b.jsxs)("table",{className:"items-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Item Code"}),(0,b.jsx)("th",{children:"Description"}),(0,b.jsx)("th",{children:"Qty"}),(0,b.jsx)("th",{children:"Unit Price"}),(0,b.jsx)("th",{children:"Discount"}),(0,b.jsx)("th",{children:"Total"})]})}),(0,b.jsx)("tbody",{children:i.invoiceItems.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:a.productCode}),(0,b.jsx)("td",{children:a.productName}),(0,b.jsx)("td",{className:"center",children:a.quantity}),(0,b.jsxs)("td",{className:"right",children:["LKR ",a.sellingPrice.toLocaleString()]}),(0,b.jsxs)("td",{className:"right",children:["LKR ",a.discount.toLocaleString()]}),(0,b.jsxs)("td",{className:"right",children:["LKR ",a.totalPrice.toLocaleString()]})]},a.id||c))})]})}),(0,b.jsx)("div",{className:"totals-section",children:(0,b.jsxs)("div",{className:"totals-grid",children:[(0,b.jsxs)("div",{className:"total-row",children:[(0,b.jsxs)("span",{children:["Sub Total - Credit Discount (",i.discount?r.creditDiscountPercent:0,"%):"]}),(0,b.jsxs)("span",{children:["LKR ",r.subTotal.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"total-row",children:[(0,b.jsxs)("span",{children:["Discount Amount (",i.discount?r.creditDiscountPercent:0,"%):"]}),(0,b.jsx)("span",{children:r.discountAmount>0?`- LKR ${r.discountAmount.toLocaleString()}`:"- LKR 0"})]}),(0,b.jsxs)("div",{className:"total-row",children:[(0,b.jsx)("span",{children:"Total Discount from Items:"}),(0,b.jsxs)("span",{children:["LKR ",r.totalDiscountFromItems.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"total-row",children:[(0,b.jsxs)("span",{children:["Cash Discount (",r.cashDiscountPercent,"%):"]}),(0,b.jsx)("span",{children:r.cashDiscount>0?`- LKR ${r.cashDiscount.toLocaleString()}`:"LKR 0"})]}),(0,b.jsxs)("div",{className:"total-row net-total",children:[(0,b.jsx)("span",{children:"Net Total:"}),(0,b.jsxs)("span",{children:["LKR ",r.netTotal.toLocaleString()]})]})]})}),i.notes&&(0,b.jsxs)("div",{className:"notes-section",children:[(0,b.jsx)("h3",{children:"Notes:"}),(0,b.jsx)("p",{children:i.notes})]}),(0,b.jsxs)("div",{className:"footer",children:[(0,b.jsx)("div",{className:"thank-you",children:(0,b.jsx)("h3",{children:"Thank you for your business!"})}),k?.companyDescription&&""!==k.companyDescription.trim()&&(0,b.jsx)("div",{className:"company-description",children:(0,b.jsx)("p",{children:k.companyDescription})})]}),(0,b.jsx)("div",{className:"print-info",children:(0,b.jsxs)("p",{children:["Printed on: ",new Date().toLocaleString()]})})]})]})}])}];

//# sourceMappingURL=src_app_invoices_print_%5Bid%5D_page_tsx_3bd0053e._.js.map