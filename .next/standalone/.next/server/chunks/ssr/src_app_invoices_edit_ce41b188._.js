module.exports=[76580,a=>{a.v({actions:"edit-invoice-module__TriEPG__actions",addProductSection:"edit-invoice-module__TriEPG__addProductSection",amountDue:"edit-invoice-module__TriEPG__amountDue",amountPaid:"edit-invoice-module__TriEPG__amountPaid",balanceClear:"edit-invoice-module__TriEPG__balanceClear",balanceDue:"edit-invoice-module__TriEPG__balanceDue",cancelButton:"edit-invoice-module__TriEPG__cancelButton",cancelCreditLimitBtn:"edit-invoice-module__TriEPG__cancelCreditLimitBtn",cashDiscountLabel:"edit-invoice-module__TriEPG__cashDiscountLabel",checkbox:"edit-invoice-module__TriEPG__checkbox",checkboxLabel:"edit-invoice-module__TriEPG__checkboxLabel",clearSelection:"edit-invoice-module__TriEPG__clearSelection",comingSoon:"edit-invoice-module__TriEPG__comingSoon",completed:"edit-invoice-module__TriEPG__completed",container:"edit-invoice-module__TriEPG__container",creditInfoSection:"edit-invoice-module__TriEPG__creditInfoSection",creditLimitActions:"edit-invoice-module__TriEPG__creditLimitActions",creditLimitEdit:"edit-invoice-module__TriEPG__creditLimitEdit",creditLimitInput:"edit-invoice-module__TriEPG__creditLimitInput",creditLimitSection:"edit-invoice-module__TriEPG__creditLimitSection",creditWarning:"edit-invoice-module__TriEPG__creditWarning",dark:"edit-invoice-module__TriEPG__dark",discountInput:"edit-invoice-module__TriEPG__discountInput",dropdown:"edit-invoice-module__TriEPG__dropdown",dropdownItem:"edit-invoice-module__TriEPG__dropdownItem",editCreditLimitBtn:"edit-invoice-module__TriEPG__editCreditLimitBtn",editSection:"edit-invoice-module__TriEPG__editSection",editTitle:"edit-invoice-module__TriEPG__editTitle",error:"edit-invoice-module__TriEPG__error",fadeIn:"edit-invoice-module__TriEPG__fadeIn",field:"edit-invoice-module__TriEPG__field",form:"edit-invoice-module__TriEPG__form",header:"edit-invoice-module__TriEPG__header",input:"edit-invoice-module__TriEPG__input",invoiceDetails:"edit-invoice-module__TriEPG__invoiceDetails",invoiceInfo:"edit-invoice-module__TriEPG__invoiceInfo",invoiceNumber:"edit-invoice-module__TriEPG__invoiceNumber",invoiceShop:"edit-invoice-module__TriEPG__invoiceShop",invoiceTypeNotesRow:"edit-invoice-module__TriEPG__invoiceTypeNotesRow",itemRow:"edit-invoice-module__TriEPG__itemRow",itemRowNoDiscount:"edit-invoice-module__TriEPG__itemRowNoDiscount",itemsHeader:"edit-invoice-module__TriEPG__itemsHeader",itemsHeaderNoDiscount:"edit-invoice-module__TriEPG__itemsHeaderNoDiscount",itemsSection:"edit-invoice-module__TriEPG__itemsSection",itemsTable:"edit-invoice-module__TriEPG__itemsTable",label:"edit-invoice-module__TriEPG__label",loading:"edit-invoice-module__TriEPG__loading",minimumStockNote:"edit-invoice-module__TriEPG__minimumStockNote",netTotal:"edit-invoice-module__TriEPG__netTotal",netTotalDisplay:"edit-invoice-module__TriEPG__netTotalDisplay",noItemsMessage:"edit-invoice-module__TriEPG__noItemsMessage",noItemsRow:"edit-invoice-module__TriEPG__noItemsRow",notesInput:"edit-invoice-module__TriEPG__notesInput",overdueDetails:"edit-invoice-module__TriEPG__overdueDetails",overdueItem:"edit-invoice-module__TriEPG__overdueItem",overdueMore:"edit-invoice-module__TriEPG__overdueMore",overdueWarning:"edit-invoice-module__TriEPG__overdueWarning",partial:"edit-invoice-module__TriEPG__partial",paymentAmount:"edit-invoice-module__TriEPG__paymentAmount",paymentDueDate:"edit-invoice-module__TriEPG__paymentDueDate",paymentInfoCard:"edit-invoice-module__TriEPG__paymentInfoCard",paymentInfoGrid:"edit-invoice-module__TriEPG__paymentInfoGrid",paymentInfoLabel:"edit-invoice-module__TriEPG__paymentInfoLabel",paymentInfoSection:"edit-invoice-module__TriEPG__paymentInfoSection",paymentInfoTitle:"edit-invoice-module__TriEPG__paymentInfoTitle",paymentStatus:"edit-invoice-module__TriEPG__paymentStatus",paymentWarning:"edit-invoice-module__TriEPG__paymentWarning",pending:"edit-invoice-module__TriEPG__pending",permissionNote:"edit-invoice-module__TriEPG__permissionNote",price:"edit-invoice-module__TriEPG__price",priceInput:"edit-invoice-module__TriEPG__priceInput",product:"edit-invoice-module__TriEPG__product",productCode:"edit-invoice-module__TriEPG__productCode",productDetails:"edit-invoice-module__TriEPG__productDetails",productInfo:"edit-invoice-module__TriEPG__productInfo",productName:"edit-invoice-module__TriEPG__productName",productUnavailable:"edit-invoice-module__TriEPG__productUnavailable",profitRow:"edit-invoice-module__TriEPG__profitRow",pulse:"edit-invoice-module__TriEPG__pulse",quantityInput:"edit-invoice-module__TriEPG__quantityInput",removeButton:"edit-invoice-module__TriEPG__removeButton",repContact:"edit-invoice-module__TriEPG__repContact",repName:"edit-invoice-module__TriEPG__repName",row:"edit-invoice-module__TriEPG__row",saveCredtiLimitBtn:"edit-invoice-module__TriEPG__saveCredtiLimitBtn",searchContainer:"edit-invoice-module__TriEPG__searchContainer",searchSection:"edit-invoice-module__TriEPG__searchSection",searchTitle:"edit-invoice-module__TriEPG__searchTitle",sectionTitle:"edit-invoice-module__TriEPG__sectionTitle",select:"edit-invoice-module__TriEPG__select",selectedShopDetails:"edit-invoice-module__TriEPG__selectedShopDetails",shopDetailCard:"edit-invoice-module__TriEPG__shopDetailCard",shopDetailLabel:"edit-invoice-module__TriEPG__shopDetailLabel",shopDetailRow:"edit-invoice-module__TriEPG__shopDetailRow",shopDetailValue:"edit-invoice-module__TriEPG__shopDetailValue",shopInfo:"edit-invoice-module__TriEPG__shopInfo",shopName:"edit-invoice-module__TriEPG__shopName",shopOwner:"edit-invoice-module__TriEPG__shopOwner",slideIn:"edit-invoice-module__TriEPG__slideIn",submitButton:"edit-invoice-module__TriEPG__submitButton",submitSection:"edit-invoice-module__TriEPG__submitSection",success:"edit-invoice-module__TriEPG__success",textarea:"edit-invoice-module__TriEPG__textarea",title:"edit-invoice-module__TriEPG__title",totalDisplay:"edit-invoice-module__TriEPG__totalDisplay",totalPrice:"edit-invoice-module__TriEPG__totalPrice",totalRow:"edit-invoice-module__TriEPG__totalRow",totalsGrid:"edit-invoice-module__TriEPG__totalsGrid",totalsSection:"edit-invoice-module__TriEPG__totalsSection",unauthorized:"edit-invoice-module__TriEPG__unauthorized",unavailableTag:"edit-invoice-module__TriEPG__unavailableTag"})},18481,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(89531),f=a.i(11642),g=a.i(1075),h=a.i(76580);let i=()=>{let a=(0,d.useSearchParams)();(0,d.useRouter)();let{isAuthorized:i,isLoading:j}=(0,e.usePageProtection)("invoices-edit"),{user:k,isLoading:l,hasAccess:m}=(0,f.useAuth)(),[n,o]=(0,c.useState)({isSellingPriceReadonly:!1,isDiscountReadonly:!1,showTotalDiscountFromItems:!0,showTotalBalanceDiscount:!1,totalBalanceDiscountPercent:5,hideCostProfit:!1}),p=a=>{let b=new Date(a),c=b.getDate().toString().padStart(2,"0"),d=(b.getMonth()+1).toString().padStart(2,"0"),e=b.getFullYear();return`${c}/${d}/${e}`},q=a=>{let[b,c,d]=a.split("/");return b&&c&&d?`${d}-${c.padStart(2,"0")}-${b.padStart(2,"0")}`:""},[r,s]=(0,c.useState)(new Date().toISOString().split("T")[0]),[t,u]=(0,c.useState)(p(new Date().toISOString().split("T")[0])),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(0),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)([]),[ab,ac]=(0,c.useState)([]),[ad,ae]=(0,c.useState)([]),[af,ag]=(0,c.useState)([]),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(!1),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(""),[at,au]=(0,c.useState)(""),[av,aw]=(0,c.useState)(null),[ax,ay]=(0,c.useState)(null),[az,aA]=(0,c.useState)(!1),[aB,aC]=(0,c.useState)(!1),[aD,aE]=(0,c.useState)(""),[aF,aG]=(0,c.useState)(!1),[aH,aI]=(0,c.useState)([]),[aJ,aK]=(0,c.useState)(!1),aL=()=>{let a=localStorage.getItem("currentUser")||sessionStorage.getItem("currentUser"),b={"Content-Type":"application/json"};return a&&(b["x-user-data"]=a),b},aM=()=>!!(z&&z.discountName.toLowerCase().includes("credit")),aN=a=>{if(!a||10!==a.length)return!1;let[b,c,d]=a.split("/");if(!b||!c||!d)return!1;let e=parseInt(b),f=parseInt(c),g=parseInt(d);if(e<1||e>31||f<1||f>12||g<1900||g>2100)return!1;let h=new Date(g,f-1,e);return h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e},aO=async()=>{try{let a=await fetch("/api/softwareSettings",{headers:aL()});if(a.ok){let b=await a.json();if(b.success&&b.settings&&b.settings.dueDateOptions){M(b.settings.dueDateOptions);let a=b.settings.dueDateOptions.find(a=>a.isDefault);a&&O(a)}}}catch(a){}},aP=async()=>{try{let a=await fetch("/api/discounts"),b=await a.json();b.success&&ac(b.discounts.filter(a=>a.percentage>0))}catch(a){}},aQ=(0,c.useCallback)(async a=>{if(a.length<2)return void $([]);try{let b=await fetch(`/api/invoices/search?search=${encodeURIComponent(a)}&limit=10`,{headers:aL()}),c=await b.json();c.success&&$(c.invoices||[])}catch(a){}},[]),aR=(0,c.useCallback)(async a=>{if(a.length<2)return void aa([]);try{let b=await fetch(`/api/shops?search=${encodeURIComponent(a)}&limit=10&activeOnly=true`),c=await b.json();c.success&&aa(c.shops||[])}catch(a){}},[]),aS=(0,c.useCallback)(async a=>{if(a.length<2)return void ae([]);try{let b=await fetch(`/api/products/search?search=${encodeURIComponent(a)}&limit=10`),c=await b.json();c.success&&ae(c.products||[])}catch(a){}},[]),aT=(0,c.useCallback)(async a=>{try{let b=await fetch(`/api/sales-rep?search=${encodeURIComponent(a)}&activeOnly=true`),c=await b.json();if(c.success){let a=c.salesReps?.filter(a=>"active"===a.status)||[];ag(a)}}catch(a){}},[]);(0,c.useEffect)(()=>{let a=setTimeout(()=>{R&&aQ(R)},300);return()=>clearTimeout(a)},[R,aQ]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{T&&aR(T)},300);return()=>clearTimeout(a)},[T,aR]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{V&&aS(V)},300);return()=>clearTimeout(a)},[V,aS]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{X&&aT(X)},300);return()=>clearTimeout(a)},[X,aT]),(0,c.useEffect)(()=>{let b=a.get("invoiceId");b&&!isNaN(parseInt(b))&&a1(parseInt(b))},[a]),(0,c.useEffect)(()=>{aO(),aP()},[]),(0,c.useEffect)(()=>{if(aM()&&r&&N){let a=new Date(r);a.setDate(a.getDate()+N.days);let b=a.toISOString().split("T")[0];I(b),K(p(b))}else I(""),K("")},[r,z,N]);let aU=(a,b,c)=>{G(d=>d.map(d=>{if(d.id===a){let a=Number(c);if("quantity"===b){let b=d.availableQty-1;a<=0?(a=1,as(`Quantity must be at least 1 for ${d.productName}`)):a>b?(as(`Cannot save invoice! Quantity ${a} exceeds available for sale (${b}) for ${d.productName}. Must maintain minimum stock of 1. Maximum allowed: ${b}`),a=Math.max(1,b)):as("")}let e={...d,[b]:a};return e.price=Number(e.quantity)*Number(e.sellingPrice),e.totalPrice=e.price-Number(e.discount),e}return d}))},aV=D>0?D:n.totalBalanceDiscountPercent,aW=c.default.useMemo(()=>{let a=F.reduce((a,b)=>a+Number(b.totalPrice),0),b=F.reduce((a,b)=>a+Number(b.discount),0),c=z?Number(a)*(parseFloat(z.percentage.toString())/100):0,d=D>0?D:n.totalBalanceDiscountPercent,e=B?Number(a)*(d/100):0,f=Number(a)-Number(c)-Number(e),g=0,h=0;return F.forEach(a=>{let b=(a.costPrice||0)*a.quantity;g+=b;let c=Number(a.totalPrice),e=z?c*(parseFloat(z.percentage.toString())/100):0,f=B?d/100*c:0;h+=c-e-f-b}),{subTotal:Number(a),totalDiscount:Number(b),invoiceTypeDiscount:Number(c),cashDiscount:Number(e),netTotal:Number(f),totalCost:Number(g),totalProfit:Number(h)}},[F,B,D,n.totalBalanceDiscountPercent,z]),aX=async a=>{if(a.preventDefault(),!v)return void as("Please select a shop");if(!x)return void as("Please select a sales representative");if(0===F.length)return void as("Please add at least one product");if(aM()&&aJ){let a=aH.reduce((a,b)=>a+Number(b.remainingAmount),0);as(`âŒ Cannot update credit invoice! This shop has ${aH.length} overdue payment(s) totaling LKR ${a.toLocaleString()}. Please settle all overdue payments before updating credit invoices.`);return}let b=[];for(let a of F)a.quantity>a.availableQty&&b.push(`${a.productName}: Requested ${a.quantity}, Available ${a.availableQty}`),a.quantity<=0&&b.push(`${a.productName}: Invalid quantity ${a.quantity}`);if(b.length>0)return void as(`Cannot update invoice! Stock validation failed:
${b.join("\n")}
Please adjust quantities before saving.`);if(aM()&&!a_()){let a=(v.creditLimit||0)-(v.balanceAmount||0);as(`Credit limit exceeded! Available credit: LKR ${a.toLocaleString()}. Invoice total: LKR ${aW.netTotal.toLocaleString()}`);return}aq(!0),as(""),au("");try{let a={id:av?.id,invoiceDate:r,shopId:v.id,salesRepId:x.id,discountId:z?.id||null,invoiceType:z?.discountName||null,invoiceTypePercentage:z?.percentage||null,cashDiscountEnabled:B,...z&&z.discountName.toLowerCase().includes("credit")&&H&&{dueDate:H},notes:P||null,items:F.map(a=>({productId:a.productId,quantity:a.quantity,sellingPrice:a.sellingPrice,discount:a.discount}))},b=await fetch("/api/invoices",{method:"PUT",headers:aL(),body:JSON.stringify(a)}),c=await b.json();c.success?(ax&&ax.netTotal!==aW.netTotal&&await aZ(ax.id,aW.netTotal),au("Invoice updated successfully!"),await a1(av.id)):as(c.error||"Failed to update invoice")}catch(a){as("Network error. Please try again.")}finally{aq(!1)}},aY=async a=>{aA(!0);try{let b=await fetch(`/api/payments?invoiceId=${a}`,{headers:aL()}),c=await b.json();c.success&&c.payments&&c.payments.length>0?ay(c.payments[0]):ay(null)}catch(a){ay(null)}finally{aA(!1)}},aZ=async(a,b)=>{try{let c=await fetch("/api/payments/update-total",{method:"PUT",headers:aL(),body:JSON.stringify({id:a,newNetTotal:b})});(await c.json()).success}catch(a){}},a$=async()=>{if(!v||!aD)return;let a=parseFloat(aD);if(a<0)return void as("Credit limit cannot be negative");aG(!0),as("");try{let b=await fetch("/api/shops/update-credit-limit",{method:"PUT",headers:aL(),body:JSON.stringify({shopId:v.id,creditLimit:a})}),c=await b.json();c.success?(w(b=>b?{...b,creditLimit:a}:null),au(`Credit limit updated successfully to LKR ${a.toLocaleString()}`),aC(!1),aE("")):as(c.error||"Failed to update credit limit")}catch(a){as("Network error. Please try again.")}finally{aG(!1)}},a_=()=>{if(!v||!aM())return!0;let a=(v.creditLimit||0)-(v.balanceAmount||0);return aW.netTotal<=a},a0=async a=>{try{let b=await fetch(`/api/payments?shopId=${a}&status=due`),c=await b.json();if(c.success&&c.payments){let a=c.payments.map(a=>{let b=new Date(a.dueDate),c=new Date,d=Math.floor((c.getTime()-b.getTime())/864e5);return{id:a.id,invoiceNumber:a.invoice.invoiceNumber,dueDate:a.dueDate,remainingAmount:a.remainingAmount,daysPastDue:d}}).filter(a=>a.daysPastDue>0);if(aI(a),aK(a.length>0),a.length>0){let b=a.reduce((a,b)=>a+Number(b.remainingAmount),0);au(`âš ï¸ This shop has ${a.length} overdue payment(s) totaling LKR ${b.toLocaleString()}. Creating new credit invoices may be restricted.`)}}else aI([]),aK(!1)}catch(a){}},a1=async a=>{aq(!0),as(""),au("");try{let b=await fetch(`/api/invoices/${a}`,{headers:aL()}),c=await b.json();if(c.success&&c.invoice){let b=c.invoice;if(s(b.invoiceDate),u(p(b.invoiceDate)),w(b.shop),y(b.salesRep||null),A(b.discount||null),Q(b.notes||""),b.shop&&b.shop.id&&await a0(b.shop.id),C(b.cashDiscountEnabled||!1),E(b.cashDiscountPercentage||0),G(b.invoiceItems||[]),b.dueDate){let a=new Date(b.dueDate).toISOString().split("T")[0];I(a)}else I("");aw(b),await aY(a),au(`Invoice ${b.invoiceNumber} loaded successfully!`)}else as(c.error||"Failed to load invoice details")}catch(a){as("Network error. Please try again.")}finally{aq(!1)}};return((0,c.useEffect)(()=>{let a=async()=>{try{if(k){let a=await fetch("/api/softwareSettings",{headers:aL()}),b=await a.json();if(b.success&&b.settings){let a={isSellingPriceReadonly:1===b.settings.isSellingPriceReadonly||!0===b.settings.isSellingPriceReadonly,isDiscountReadonly:1===b.settings.isDiscountReadonly||!0===b.settings.isDiscountReadonly,showTotalDiscountFromItems:1!==b.settings.showTotalDiscountFromItems&&!0!==b.settings.showTotalDiscountFromItems,showTotalBalanceDiscount:1!==b.settings.showTotalBalanceDiscount&&!0!==b.settings.showTotalBalanceDiscount,totalBalanceDiscountPercent:b.settings.totalBalanceDiscountPercent||5,hideCostProfit:1===b.settings.hideCostProfit||!0===b.settings.hideCostProfit};o(a)}}}catch(a){}};!j&&i&&a()},[k,j,i]),j||l)?(0,b.jsx)("div",{className:h.default.loading,children:"Loading..."}):i?(0,b.jsxs)("div",{className:h.default.container,children:[(0,b.jsx)("div",{className:h.default.header,children:(0,b.jsx)("h1",{className:h.default.title,children:"Edit Invoice"})}),(0,b.jsxs)("div",{className:h.default.searchSection,children:[(0,b.jsx)("h2",{className:h.default.searchTitle,children:"Search Invoice to Edit"}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Search by Invoice Number or Shop Name:"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:R,onChange:a=>{S(a.target.value),ai(!0)},onFocus:()=>ai(!0),placeholder:"Type invoice number or shop name...",className:h.default.input,disabled:ap}),ah&&Z.length>0&&(0,b.jsx)("div",{className:h.default.dropdown,children:Z.map(a=>(0,b.jsx)("div",{className:h.default.dropdownItem,onClick:()=>{a1(a.id),S(`${a.invoiceNumber} - ${a.shopName}`),ai(!1)},children:(0,b.jsxs)("div",{className:h.default.invoiceInfo,children:[(0,b.jsxs)("div",{className:h.default.invoiceNumber,children:["#",a.invoiceNumber]}),(0,b.jsxs)("div",{className:h.default.invoiceShop,children:[a.shopName," (",a.ownerName,")"]}),(0,b.jsxs)("div",{className:h.default.invoiceDetails,children:["Date: ",new Date(a.invoiceDate).toLocaleDateString()," | Total: LKR ",a.netTotal.toLocaleString()]})]})},a.id))})]})]})]}),ar&&(0,b.jsx)("p",{className:h.default.error,children:ar}),at&&(0,b.jsx)("p",{className:h.default.success,children:at}),av&&ax&&(0,b.jsxs)("div",{className:h.default.paymentInfoSection,children:[(0,b.jsx)("h2",{className:h.default.paymentInfoTitle,children:"ðŸ“‹ Pending Payment Information"}),(0,b.jsxs)("div",{className:h.default.paymentInfoGrid,children:[(0,b.jsxs)("div",{className:h.default.paymentInfoCard,children:[(0,b.jsx)("div",{className:h.default.paymentInfoLabel,children:"Payment Status:"}),(0,b.jsx)("div",{className:`${h.default.paymentStatus} ${h.default[ax.paymentStatus]}`,children:ax.paymentStatus.toUpperCase()})]}),(0,b.jsxs)("div",{className:h.default.paymentInfoCard,children:[(0,b.jsx)("div",{className:h.default.paymentInfoLabel,children:"Net Total:"}),(0,b.jsxs)("div",{className:h.default.paymentAmount,children:["LKR ",ax.netTotal.toLocaleString()]})]}),(0,b.jsxs)("div",{className:h.default.paymentInfoCard,children:[(0,b.jsx)("div",{className:h.default.paymentInfoLabel,children:"Paid Amount:"}),(0,b.jsxs)("div",{className:h.default.paymentAmount,children:["LKR ",ax.paidAmount.toLocaleString()]})]}),(0,b.jsxs)("div",{className:h.default.paymentInfoCard,children:[(0,b.jsx)("div",{className:h.default.paymentInfoLabel,children:"Remaining Amount:"}),(0,b.jsxs)("div",{className:`${h.default.paymentAmount} ${ax.remainingAmount>0?h.default.amountDue:h.default.amountPaid}`,children:["LKR ",ax.remainingAmount.toLocaleString()]})]}),ax.dueDate&&(0,b.jsxs)("div",{className:h.default.paymentInfoCard,children:[(0,b.jsx)("div",{className:h.default.paymentInfoLabel,children:"Due Date:"}),(0,b.jsx)("div",{className:h.default.paymentDueDate,children:new Date(ax.dueDate).toLocaleDateString()})]})]}),(0,b.jsxs)("div",{className:h.default.paymentWarning,children:[(0,b.jsx)("strong",{children:"âš ï¸ Note:"})," Editing this invoice will automatically update the pending payment data. If you change the invoice total, the remaining payment amount will be recalculated."]})]}),av&&(0,b.jsxs)("div",{className:h.default.editSection,children:[(0,b.jsxs)("h2",{className:h.default.editTitle,children:["Editing Invoice #",av.invoiceNumber]}),(0,b.jsxs)("form",{onSubmit:aX,className:h.default.form,children:[(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Invoice Date: *"}),(0,b.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:t,onChange:a=>{let b=a.target.value;u(b);let c=b.replace(/[^\d]/g,"");if(c.length>=3&&c.length<=4?c=c.replace(/(\d{2})(\d{1,2})/,"$1/$2"):c.length>=5&&(c=c.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),c!==b&&c.length<=10&&u(c),aN(c)){let a=q(c);a&&s(a)}},onBlur:a=>{if(!aN(a.target.value)){let a=new Date().toISOString().split("T")[0];s(a),u(p(a))}},className:h.default.input,disabled:ap,required:!0,maxLength:10})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Select Sales Rep: *"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:x?`${x.name} (${x.contactNumber})`:X,onChange:a=>{x||(Y(a.target.value),ao(!0))},onFocus:()=>ao(!0),placeholder:"Type to search sales representatives...",className:h.default.input,disabled:ap,required:!0}),x&&(0,b.jsx)("button",{type:"button",onClick:()=>{y(null),Y(""),ao(!1)},className:h.default.clearSelection,disabled:ap,children:"Ã—"}),an&&af.length>0&&(0,b.jsx)("div",{className:h.default.dropdown,children:af.map(a=>(0,b.jsxs)("div",{className:h.default.dropdownItem,onClick:()=>{y(a),Y(""),ao(!1)},children:[(0,b.jsx)("div",{className:h.default.repName,children:a.name}),(0,b.jsx)("div",{className:h.default.repContact,children:a.contactNumber})]},a.id))})]})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Select Shop: *"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:v?`${v.shopName} (${v.ownerName})`:T,onChange:a=>{if(!v){let b=a.target.value;U(b),ak(b.length>0)}},onFocus:()=>ak(!0),onBlur:()=>{setTimeout(()=>ak(!1),150)},placeholder:"Type to search shops...",className:h.default.input,disabled:ap,required:!0}),v&&(0,b.jsx)("button",{type:"button",onClick:()=>{w(null),U(""),ak(!1)},className:h.default.clearSelection,children:"Ã—"}),aj&&_.length>0&&!v&&(0,b.jsx)("div",{className:h.default.dropdown,children:_.map(a=>(0,b.jsx)("div",{className:h.default.dropdownItem,onClick:()=>{w(a),U(""),ak(!1)},children:(0,b.jsxs)("div",{className:h.default.shopInfo,children:[(0,b.jsx)("div",{className:h.default.shopName,children:a.shopName}),(0,b.jsxs)("div",{className:h.default.shopOwner,children:["Owner: ",a.ownerName," | Contact: ",a.contactNumber]}),(0,b.jsxs)("div",{className:h.default.shopOwner,children:["Credit Limit: LKR ",a.creditLimit.toLocaleString()," | Balance: LKR ",a.balanceAmount.toLocaleString()]})]})},a.id))})]})]}),v&&(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Selected Shop Details:"}),(0,b.jsx)("div",{className:h.default.selectedShopDetails,children:(0,b.jsxs)("div",{className:h.default.shopDetailCard,children:[(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Shop Name:"}),(0,b.jsx)("span",{className:h.default.shopDetailValue,children:v.shopName})]}),(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Owner:"}),(0,b.jsx)("span",{className:h.default.shopDetailValue,children:v.ownerName})]}),(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Contact:"}),(0,b.jsx)("span",{className:h.default.shopDetailValue,children:v.contactNumber})]}),(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Credit Limit:"}),(0,b.jsx)("div",{className:h.default.creditLimitSection,children:aB?(0,b.jsxs)("div",{className:h.default.creditLimitEdit,children:[(0,b.jsx)("input",{type:"number",value:aD,onChange:a=>aE(a.target.value),placeholder:"Enter new credit limit",className:h.default.creditLimitInput,disabled:aF,min:"0",step:"0.01"}),(0,b.jsxs)("div",{className:h.default.creditLimitActions,children:[(0,b.jsx)("button",{type:"button",onClick:a$,className:h.default.saveCredtiLimitBtn,disabled:aF,children:aF?"Saving...":"ðŸ’¾ Save"}),(0,b.jsx)("button",{type:"button",onClick:()=>{aC(!1),aE(""),as("")},className:h.default.cancelCreditLimitBtn,disabled:aF,children:"âŒ Cancel"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("span",{className:h.default.shopDetailValue,children:["LKR ",v.creditLimit.toLocaleString()]}),m("shops")&&(0,b.jsx)("button",{type:"button",onClick:()=>{m("shops")?v&&(aE(v.creditLimit.toString()),aC(!0)):as("You do not have permission to edit credit limits")},className:h.default.editCreditLimitBtn,disabled:ap,children:"âœï¸ Edit"}),!m("shops")&&(0,b.jsx)("span",{className:h.default.permissionNote,children:"(Edit requires Shop permissions)"})]})})]}),(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Balance:"}),(0,b.jsxs)("span",{className:`${h.default.shopDetailValue} ${v.balanceAmount>0?h.default.balanceDue:h.default.balanceClear}`,children:["LKR ",v.balanceAmount.toLocaleString()]})]}),aM()&&(0,b.jsxs)("div",{className:h.default.creditInfoSection,children:[(0,b.jsxs)("div",{className:h.default.shopDetailRow,children:[(0,b.jsx)("span",{className:h.default.shopDetailLabel,children:"Available Credit:"}),(0,b.jsxs)("span",{className:`${h.default.shopDetailValue} ${(v.creditLimit||0)-(v.balanceAmount||0)<=0?h.default.balanceDue:h.default.balanceClear}`,children:["LKR ",((v.creditLimit||0)-(v.balanceAmount||0)).toLocaleString()]})]}),!a_()&&(0,b.jsxs)("div",{className:h.default.creditWarning,children:[(0,b.jsx)("strong",{children:"âš ï¸ Credit Limit Warning:"})," Invoice total (LKR ",aW.netTotal.toLocaleString(),") exceeds available credit (LKR ",((v.creditLimit||0)-(v.balanceAmount||0)).toLocaleString(),"). Update cannot proceed."]}),aJ&&(0,b.jsxs)("div",{className:h.default.overdueWarning,children:[(0,b.jsx)("strong",{children:"ðŸš¨ Overdue Payments Alert:"})," This shop has ",aH.length," overdue payment(s) totaling LKR ",aH.reduce((a,b)=>a+Number(b.remainingAmount),0).toLocaleString(),". Credit invoice updates are restricted.",(0,b.jsxs)("div",{className:h.default.overdueDetails,children:[aH.slice(0,3).map((a,c)=>(0,b.jsxs)("div",{className:h.default.overdueItem,children:["#",a.invoiceNumber,": LKR ",a.remainingAmount.toLocaleString(),"(",a.daysPastDue," days overdue)"]},a.id)),aH.length>3&&(0,b.jsxs)("div",{className:h.default.overdueMore,children:["... and ",aH.length-3," more"]})]})]})]})]})})]}),(0,b.jsxs)("div",{className:h.default.invoiceTypeNotesRow,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Invoice Type: *"}),(0,b.jsxs)("select",{value:z?.id||"",onChange:a=>{let b=a.target.value;A(ab.find(a=>a.id.toString()===b)||null)},className:h.default.input,disabled:ap,required:!0,children:[(0,b.jsx)("option",{value:"",disabled:!0,children:"Select Invoice Type"}),ab.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.discountName," Discount (",a.percentage,"%)"]},a.id))]})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Notes:"}),(0,b.jsx)("textarea",{value:P,onChange:a=>Q(a.target.value),placeholder:"Enter any additional notes for this invoice...",className:h.default.notesInput,disabled:ap,rows:1})]}),aM()&&(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Payment Terms:"}),(0,b.jsxs)("select",{value:N?`${N.label}-${N.days}`:"",onChange:a=>{let[b,c]=a.target.value.split("-"),d=parseInt(c),e=L.find(a=>a.label===b&&a.days===d);e&&O(e)},className:h.default.select,disabled:ap,children:[(0,b.jsx)("option",{value:"",children:"Select Payment Terms"}),L.map((a,c)=>(0,b.jsxs)("option",{value:`${a.label}-${a.days}`,children:[a.label," (",a.days," days) ",a.isDefault?"- Default":""]},c))]})]})]})]}),aM()&&H&&(0,b.jsx)("div",{className:h.default.row,children:(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Payment Due Date:"}),(0,b.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:J,onChange:a=>{let b=a.target.value;K(b);let c=b.replace(/[^\d]/g,"");c.length>=3&&c.length<=4?c=c.replace(/(\d{2})(\d{1,2})/,"$1/$2"):c.length>=5&&(c=c.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),c!==b&&c.length<=10&&K(c);let d=q(c);d&&I(d)},className:h.default.input,disabled:ap})]})}),(0,b.jsxs)("div",{className:h.default.itemsSection,children:[(0,b.jsx)("h3",{className:h.default.sectionTitle,children:"Invoice Items"}),(0,b.jsx)("div",{className:h.default.addProductSection,children:(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Add Product:"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:V,onChange:a=>{let b=a.target.value;W(b),am(b.length>0)},onFocus:()=>am(!0),onBlur:()=>{setTimeout(()=>am(!1),150)},placeholder:"Type to search products...",className:h.default.input,disabled:ap}),al&&ad.length>0&&(0,b.jsx)("div",{className:h.default.dropdown,children:ad.map(a=>{let c=Math.max(0,a.availableQty-1),d=c>0;return(0,b.jsx)("div",{className:`${h.default.dropdownItem} ${!d?h.default.productUnavailable:""}`,onClick:()=>d?(a=>{let b=F.find(b=>b.productId===a.id);if(b){let c=b.availableQty-1;b.quantity<c?aU(b.id,"quantity",b.quantity+1):as(`Cannot add more ${a.itemName}. Must maintain minimum stock of 1. Available for sale: ${c}`)}else{if(a.availableQty-1<1){as(`Cannot add ${a.itemName}. Must maintain minimum stock of 1. Current stock: ${a.availableQty}`),W(""),ae([]),am(!1);return}let b={id:`item_${Date.now()}`,productId:a.id,productCode:a.productCode,productName:a.itemName,quantity:1,sellingPrice:a.sellingPrice,discount:0,price:a.sellingPrice,totalPrice:a.sellingPrice,availableQty:a.availableQty,costPrice:a.costPrice||0};G(a=>[...a,b])}W(""),ae([]),am(!1)})(a):null,style:{cursor:d?"pointer":"not-allowed"},children:(0,b.jsxs)("div",{className:h.default.productInfo,children:[(0,b.jsxs)("div",{className:h.default.productName,children:[a.itemName," (",a.productCode,")",!d&&(0,b.jsx)("span",{className:h.default.unavailableTag,children:" - UNAVAILABLE"})]}),(0,b.jsxs)("div",{className:h.default.productDetails,children:["Price: LKR ",a.sellingPrice," | Available for Sale: ",c," | Total Stock: ",a.availableQty," | Category: ",a.category,!d&&(0,b.jsxs)("div",{className:h.default.minimumStockNote,children:["(Must maintain minimum stock of ",1,")"]})]})]})},a.id)})})]})]})}),(0,b.jsxs)("div",{className:h.default.itemsTable,children:[(0,b.jsxs)("div",{className:`${h.default.itemsHeader} ${!n.showTotalDiscountFromItems?h.default.itemsHeaderNoDiscount:""}`,children:[(0,b.jsx)("div",{children:"Product"}),(0,b.jsx)("div",{children:"Quantity"}),(0,b.jsx)("div",{children:"Selling Price"}),n.showTotalDiscountFromItems&&(0,b.jsx)("div",{children:"Discount"}),(0,b.jsx)("div",{children:"Price"}),!n.hideCostProfit&&(0,b.jsx)("div",{children:"Cost"}),!n.hideCostProfit&&(0,b.jsx)("div",{children:"Profit"}),(0,b.jsx)("div",{children:"Total Price"}),(0,b.jsx)("div",{children:"Action"})]}),0===F.length?(0,b.jsx)("div",{className:h.default.noItemsRow,children:(0,b.jsx)("div",{className:h.default.noItemsMessage,children:"No items added yet. Search and add products above."})}):F.map(a=>{let c,d;return(0,b.jsxs)("div",{className:`${h.default.itemRow} ${!n.showTotalDiscountFromItems?h.default.itemRowNoDiscount:""}`,children:[(0,b.jsxs)("div",{className:h.default.product,children:[(0,b.jsx)("div",{className:h.default.productName,children:a.productName}),(0,b.jsxs)("div",{className:h.default.productCode,children:["(",a.productCode,")"]})]}),(0,b.jsx)("div",{className:h.default.quantity,children:(0,b.jsx)("input",{type:"number",min:"1",max:Math.max(1,a.availableQty-1),value:a.quantity,onWheel:g.handleNumberInputWheel,onChange:b=>aU(a.id,"quantity",parseInt(b.target.value)||1),className:h.default.quantityInput})}),(0,b.jsx)("div",{className:h.default.sellingPrice,children:(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.sellingPrice,onChange:b=>aU(a.id,"sellingPrice",parseFloat(b.target.value)||0),onWheel:g.handleNumberInputWheel,className:h.default.priceInput,readOnly:n.isSellingPriceReadonly,title:n.isSellingPriceReadonly?"Selling price is read-only (configured in settings)":""})}),n.showTotalDiscountFromItems&&(0,b.jsx)("div",{className:h.default.discount,children:(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.discount,onChange:b=>aU(a.id,"discount",parseFloat(b.target.value)||0),onWheel:g.handleNumberInputWheel,className:h.default.discountInput,placeholder:"0.00",readOnly:n.isDiscountReadonly,title:n.isDiscountReadonly?"Discount is read-only (configured in settings)":""})}),(0,b.jsxs)("div",{className:h.default.price,children:["LKR ",a.price.toLocaleString()]}),!n.hideCostProfit&&(0,b.jsxs)("div",{className:h.default.cost,children:["LKR ",(a.costPrice*a.quantity).toLocaleString()]}),!n.hideCostProfit&&(0,b.jsxs)("div",{className:h.default.profit,children:["LKR ",(c=z?a.totalPrice*(parseFloat(z.percentage.toString())/100):0,d=B?a.totalPrice*(aV/100):0,(a.totalPrice-c-d-a.costPrice*a.quantity).toLocaleString())]}),(0,b.jsxs)("div",{className:h.default.totalPrice,children:["LKR ",a.totalPrice.toLocaleString()]}),(0,b.jsx)("div",{className:h.default.actions,children:(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void G(a=>a.filter(a=>a.id!==b))},className:h.default.removeButton,disabled:ap,children:"ðŸ—‘ï¸"})})]},a.id)})]})]}),(0,b.jsx)("div",{className:h.default.totalsSection,children:(0,b.jsxs)("div",{className:h.default.totalsGrid,children:[(0,b.jsxs)("div",{className:h.default.totalRow,children:[(0,b.jsxs)("span",{children:["Sub Total",z?` - ${z.discountName} Discount (${z.percentage}%)`:"",":"]}),(0,b.jsxs)("span",{children:["LKR ",aW.subTotal.toLocaleString()]})]}),z&&(0,b.jsxs)("div",{className:h.default.totalRow,children:[(0,b.jsxs)("span",{children:["Discount Amount (",z.percentage,"%):"]}),(0,b.jsxs)("span",{children:["- LKR ",aW.invoiceTypeDiscount.toLocaleString()]})]}),n.showTotalDiscountFromItems&&(0,b.jsxs)("div",{className:h.default.totalRow,children:[(0,b.jsx)("span",{children:"Total Discount from Items:"}),(0,b.jsxs)("span",{children:["LKR ",aW.totalDiscount.toLocaleString()]})]}),n.showTotalBalanceDiscount&&(0,b.jsxs)("div",{className:h.default.totalRow,children:[(0,b.jsxs)("label",{className:h.default.cashDiscountLabel,children:[(0,b.jsx)("input",{type:"checkbox",checked:B,onChange:a=>C(a.target.checked),className:h.default.checkbox}),(0,b.jsxs)("span",{children:["Cash Discount (",aV,"%):"]})]}),(0,b.jsx)("span",{children:B&&aW.cashDiscount>0?`- LKR ${aW.cashDiscount.toLocaleString()}`:`LKR ${aW.cashDiscount.toLocaleString()}`})]}),(0,b.jsxs)("div",{className:`${h.default.totalRow} ${h.default.netTotal}`,children:[(0,b.jsx)("span",{children:"Net Total:"}),(0,b.jsxs)("span",{children:["LKR ",aW.netTotal.toLocaleString()]})]}),!n.hideCostProfit&&(0,b.jsxs)("div",{className:h.default.totalRow,children:[(0,b.jsx)("span",{children:"Total Cost:"}),(0,b.jsxs)("span",{children:["LKR ",aW.totalCost.toLocaleString()]})]}),!n.hideCostProfit&&(0,b.jsxs)("div",{className:`${h.default.totalRow} ${h.default.profitRow}`,children:[(0,b.jsx)("span",{children:"Total Profit:"}),(0,b.jsxs)("span",{style:{color:aW.totalProfit>=0?"#28a745":"#dc3545",fontWeight:"bold"},children:["LKR ",aW.totalProfit.toLocaleString()]})]})]})}),(0,b.jsxs)("div",{className:h.default.submitSection,children:[(0,b.jsx)("button",{type:"submit",disabled:ap||0===F.length||aM()&&aJ||aM()&&!a_(),className:h.default.submitButton,children:ap?"Updating Invoice...":"Update Invoice"}),(0,b.jsx)("button",{type:"button",onClick:()=>aw(null),className:h.default.cancelButton,disabled:ap,children:"Cancel Edit"})]})]})]})]}):(0,b.jsx)("div",{className:h.default.unauthorized,children:"You are not authorized to access this page."})};a.s(["default",0,()=>(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{children:"Loading invoice editor..."}),children:(0,b.jsx)(i,{})})])}];

//# sourceMappingURL=src_app_invoices_edit_ce41b188._.js.map