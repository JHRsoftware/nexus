module.exports=[8076,a=>{a.v({accessDenied:"add-module__VkmDya__accessDenied",actions:"add-module__VkmDya__actions",activate:"add-module__VkmDya__activate",active:"add-module__VkmDya__active",balanceAmount:"add-module__VkmDya__balanceAmount",clearButton:"add-module__VkmDya__clearButton",contact:"add-module__VkmDya__contact",container:"add-module__VkmDya__container",creditLimit:"add-module__VkmDya__creditLimit",deactivate:"add-module__VkmDya__deactivate",deleteButton:"add-module__VkmDya__deleteButton",editButton:"add-module__VkmDya__editButton",ellipsis:"add-module__VkmDya__ellipsis",error:"add-module__VkmDya__error",field:"add-module__VkmDya__field",form:"add-module__VkmDya__form",header:"add-module__VkmDya__header",inactive:"add-module__VkmDya__inactive",input:"add-module__VkmDya__input",label:"add-module__VkmDya__label",loadButton:"add-module__VkmDya__loadButton",loading:"add-module__VkmDya__loading",noShops:"add-module__VkmDya__noShops",noShopsIcon:"add-module__VkmDya__noShopsIcon",ownerName:"add-module__VkmDya__ownerName",pageBtn:"add-module__VkmDya__pageBtn",pageNumbers:"add-module__VkmDya__pageNumbers",pagination:"add-module__VkmDya__pagination",paginationInfo:"add-module__VkmDya__paginationInfo",row:"add-module__VkmDya__row",searchButton:"add-module__VkmDya__searchButton",searchForm:"add-module__VkmDya__searchForm",searchInput:"add-module__VkmDya__searchInput",searchSection:"add-module__VkmDya__searchSection",shopName:"add-module__VkmDya__shopName",shopsContent:"add-module__VkmDya__shopsContent",shopsHeader:"add-module__VkmDya__shopsHeader",shopsList:"add-module__VkmDya__shopsList",shopsTable:"add-module__VkmDya__shopsTable",slideIn:"add-module__VkmDya__slideIn",status:"add-module__VkmDya__status",submitButton:"add-module__VkmDya__submitButton",submitSection:"add-module__VkmDya__submitSection",subtitle:"add-module__VkmDya__subtitle",success:"add-module__VkmDya__success",tableBody:"add-module__VkmDya__tableBody",tableHeader:"add-module__VkmDya__tableHeader",tableRow:"add-module__VkmDya__tableRow",textarea:"add-module__VkmDya__textarea",title:"add-module__VkmDya__title",toggleButton:"add-module__VkmDya__toggleButton",user:"add-module__VkmDya__user"})},91313,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(89531),e=a.i(9453),f=a.i(11642),g=a.i(1075),h=a.i(8076);a.s(["default",0,()=>{let{isAuthorized:a,isLoading:i}=(0,d.usePageProtection)("shops"),{isDarkMode:j}=(0,e.useTheme)(),{user:k}=(0,f.useAuth)(),[l,m]=(0,c.useState)({shopName:"",ownerName:"",address:"",contactNumber:"",email:"",businessRegisterNo:"",image:"",creditLimit:"",balanceAmount:"0",isActive:!1}),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(5e4),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(1),[H,I]=(0,c.useState)({currentPage:1,totalPages:1,totalCount:0,hasNext:!1,hasPrev:!1}),J=()=>({"Content-Type":"application/json","x-user-data":JSON.stringify(k||{})});(0,c.useEffect)(()=>{if(!l.creditLimit&&a&&k){let a=!0;return(async()=>{try{let b=await fetch("/api/softwareSettings",{headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(k||{})}}),c=await b.json();if(a&&c.success&&c.settings&&c.settings.defaultCreditLimit){let a=c.settings.defaultCreditLimit;w(a),m(b=>({...b,creditLimit:a.toString()}))}else w(5e4),m(a=>({...a,creditLimit:"50000"}))}catch(b){a&&(w(5e4),m(a=>({...a,creditLimit:"50000"})))}})(),()=>{a=!1}}},[l.creditLimit,a,k]);let K=(0,c.useCallback)(async(a=1,b="",c=!1)=>{o(!0),s("");try{let d=new URLSearchParams({page:a.toString(),limit:"5",search:b.trim()}),e=await fetch(`/api/shops?${d}`,{headers:J()}),f=await e.json();f.success?(A(f.shops),I(f.pagination),G(a),C(!0),0===f.shops.length&&b&&s(`No shops found matching "${b}"`)):(s(f.error||"Failed to load shops"),c&&(A([]),C(!1)))}catch(a){s("An error occurred while loading shops"),c&&(A([]),C(!1))}finally{o(!1)}},[]);(0,c.useEffect)(()=>{if(B){let a=setTimeout(()=>{K(1,D.trim(),!0)},300);return()=>clearTimeout(a)}},[D,K,B]);let L=async a=>{if(a.preventDefault(),!l.shopName||!l.ownerName||!l.address||!l.contactNumber)return void s("Please fill in all required fields");if(l.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email.trim()))return void s("Please enter a valid email address");let b=parseFloat(l.creditLimit);if(isNaN(b)||b<0)return void s("Credit limit must be a valid positive number");if(isNaN(parseFloat(l.balanceAmount)))return void s("Balance amount must be a valid number");o(!0),s(""),q("");try{let a=t?"PUT":"POST",b={...t&&{id:x},shopName:l.shopName.trim(),ownerName:l.ownerName.trim(),address:l.address.trim(),contactNumber:l.contactNumber.trim(),email:l.email.trim()||null,businessRegisterNo:l.businessRegisterNo.trim()||null,image:l.image.trim()||null,creditLimit:parseFloat(l.creditLimit),balanceAmount:parseFloat(l.balanceAmount),isActive:l.isActive},c=await fetch("/api/shops",{method:a,headers:J(),body:JSON.stringify(b)}),d=await c.json();d.success?(q(d.message),m({shopName:"",ownerName:"",address:"",contactNumber:"",email:"",businessRegisterNo:"",image:"",creditLimit:v.toString(),balanceAmount:"0",isActive:!1}),t&&(u(!1),y(null)),B&&K(F,D),setTimeout(()=>q(""),3e3)):s(d.error||"Operation failed")}catch(a){s("An error occurred while processing your request")}finally{o(!1)}},M=async(a,b,c)=>{if(window.confirm(`Are you sure you want to ${c?"deactivate":"activate"} the shop "${b}"?`)){o(!0);try{let b=await fetch(`/api/shops?id=${a}&action=toggle`,{method:"DELETE"}),c=await b.json();c.success?(q(c.message),B&&K(F,D),setTimeout(()=>q(""),3e3)):s(c.error||"Failed to update shop status")}catch(a){s("An error occurred while updating shop status")}finally{o(!1)}}},N=async(a,b)=>{if(window.confirm(`âš ï¸ PERMANENT DELETE WARNING!

Are you sure you want to PERMANENTLY delete "${b}"?

This action CANNOT be undone and will remove the shop from the database completely.`)&&window.confirm(`Final confirmation: Permanently delete "${b}"?

Click OK to proceed with permanent deletion.`)){o(!0);try{let c=await fetch(`/api/shops?id=${a}&action=permanent`,{method:"DELETE"}),d=await c.json();d.success?(q(`Shop "${b}" permanently deleted successfully!`),B&&K(F,D),setTimeout(()=>q(""),3e3)):s(d.error||"Failed to permanently delete shop")}catch(a){s("An error occurred while permanently deleting shop")}finally{o(!1)}}},O=()=>{E(""),K(1,"",!0)},P=a=>{a>=1&&a<=H.totalPages&&!n&&K(a,D,!1)};return i?(0,b.jsx)("div",{className:h.default.loading,children:"Checking permissions..."}):a?(0,b.jsxs)("div",{className:`${h.default.container} ${j?"dark":"light"}`,children:[(0,b.jsxs)("div",{className:h.default.header,children:[(0,b.jsx)("h1",{className:h.default.title,children:t?"Edit Shop":"Shop Management"}),t&&(0,b.jsx)("button",{type:"button",onClick:()=>{m({shopName:"",ownerName:"",address:"",contactNumber:"",email:"",businessRegisterNo:"",image:"",creditLimit:v.toString(),balanceAmount:"0",isActive:!1}),u(!1),y(null),s(""),q("")},className:h.default.clearButton,children:"Cancel Edit"})]}),(0,b.jsxs)("form",{onSubmit:L,className:h.default.form,children:[(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Shop Name: *"}),(0,b.jsx)("input",{type:"text",value:l.shopName,onChange:a=>m(b=>({...b,shopName:a.target.value})),className:h.default.input,placeholder:"Enter shop name",disabled:n,required:!0})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Owner Name: *"}),(0,b.jsx)("input",{type:"text",value:l.ownerName,onChange:a=>m(b=>({...b,ownerName:a.target.value})),className:h.default.input,placeholder:"Enter owner name",disabled:n,required:!0})]})]}),(0,b.jsx)("div",{className:h.default.row,children:(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Address: *"}),(0,b.jsx)("textarea",{value:l.address,onChange:a=>m(b=>({...b,address:a.target.value})),className:`${h.default.input} ${h.default.textarea}`,placeholder:"Enter complete address",disabled:n,rows:3,required:!0})]})}),(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Contact Number: *"}),(0,b.jsx)("input",{type:"tel",value:l.contactNumber,onChange:a=>m(b=>({...b,contactNumber:a.target.value})),className:h.default.input,placeholder:"Enter contact number",disabled:n,required:!0})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Email:"}),(0,b.jsx)("input",{type:"email",value:l.email,onChange:a=>m(b=>({...b,email:a.target.value})),className:h.default.input,placeholder:"Enter email address",disabled:n})]})]}),(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Business Register No:"}),(0,b.jsx)("input",{type:"text",value:l.businessRegisterNo,onChange:a=>m(b=>({...b,businessRegisterNo:a.target.value})),className:h.default.input,placeholder:"Enter business register number",disabled:n})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Credit Limit:"}),(0,b.jsx)("input",{type:"number",step:"0.01",min:"0",value:l.creditLimit,onChange:a=>m(b=>({...b,creditLimit:a.target.value})),onWheel:g.handleNumberInputWheel,className:h.default.input,placeholder:"Enter credit limit",disabled:n})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Balance Amount:"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:l.balanceAmount,onChange:a=>m(b=>({...b,balanceAmount:a.target.value})),onWheel:g.handleNumberInputWheel,className:h.default.input,placeholder:"Enter balance amount",disabled:n,readOnly:!0})]})]}),(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Image URL:"}),(0,b.jsx)("input",{type:"url",value:l.image,onChange:a=>m(b=>({...b,image:a.target.value})),className:h.default.input,placeholder:"Enter image URL",disabled:n})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Status:"}),(0,b.jsxs)("select",{value:l.isActive?"active":"inactive",onChange:a=>m(b=>({...b,isActive:"active"===a.target.value})),className:h.default.input,disabled:n,children:[(0,b.jsx)("option",{value:"inactive",children:"Inactive"}),(0,b.jsx)("option",{value:"active",children:"Active"})]})]})]}),r&&(0,b.jsx)("div",{className:h.default.error,children:r}),p&&(0,b.jsx)("div",{className:h.default.success,children:p}),(0,b.jsx)("div",{className:h.default.submitSection,children:(0,b.jsx)("button",{type:"submit",className:h.default.submitButton,disabled:n,children:n?"Processing...":t?"Update Shop":"Create Shop"})})]}),(0,b.jsxs)("div",{className:h.default.shopsList,children:[(0,b.jsxs)("div",{className:h.default.shopsHeader,children:[(0,b.jsx)("h2",{className:h.default.subtitle,children:"Existing Shops"}),(0,b.jsxs)("div",{className:h.default.searchSection,children:[(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault()},className:h.default.searchForm,children:[(0,b.jsx)("input",{type:"text",value:D,onChange:a=>E(a.target.value),placeholder:"Search by shop name, owner, contact...",className:h.default.searchInput}),(0,b.jsx)("button",{type:"submit",className:h.default.searchButton,disabled:n,children:"Search"})]}),(0,b.jsx)("button",{onClick:O,className:h.default.loadButton,disabled:n,children:n?"Loading...":"Load All"})]})]}),(0,b.jsxs)("div",{className:h.default.shopsContent,children:[B?0===z.length?(0,b.jsxs)("div",{className:h.default.noShops,children:[(0,b.jsx)("div",{className:h.default.noShopsIcon,children:"ðŸ”"}),(0,b.jsx)("h3",{children:"No Shops Found"}),(0,b.jsx)("p",{children:D?`No shops match "${D}". Try a different search term.`:"No shops have been registered yet. Create your first shop using the form above."}),D&&(0,b.jsx)("button",{onClick:O,className:h.default.loadButton,style:{marginTop:"1rem"},children:"View All Shops"})]}):(0,b.jsxs)("div",{className:h.default.shopsTable,children:[(0,b.jsxs)("div",{className:h.default.tableHeader,children:[(0,b.jsx)("div",{children:"Shop Name"}),(0,b.jsx)("div",{children:"Owner"}),(0,b.jsx)("div",{children:"Contact"}),(0,b.jsx)("div",{children:"Credit Limit"}),(0,b.jsx)("div",{children:"Balance Amount"}),(0,b.jsx)("div",{children:"Status"}),(0,b.jsx)("div",{children:"Created By"}),(0,b.jsx)("div",{children:"Actions"})]}),(0,b.jsx)("div",{className:h.default.tableBody,children:z.map(a=>(0,b.jsxs)("div",{className:h.default.tableRow,children:[(0,b.jsx)("div",{className:h.default.shopName,children:a.shopName}),(0,b.jsx)("div",{className:h.default.ownerName,children:a.ownerName}),(0,b.jsx)("div",{className:h.default.contact,children:a.contactNumber}),(0,b.jsxs)("div",{className:h.default.creditLimit,children:["LKR ",Number(a.creditLimit).toLocaleString()]}),(0,b.jsxs)("div",{className:h.default.balanceAmount,children:["LKR ",Number(a.balanceAmount).toLocaleString()]}),(0,b.jsx)("div",{children:(0,b.jsx)("span",{className:`${h.default.status} ${a.isActive?h.default.active:h.default.inactive}`,children:a.isActive?"Active":"Inactive"})}),(0,b.jsx)("div",{className:h.default.user,children:a.user}),(0,b.jsxs)("div",{className:h.default.actions,children:[(0,b.jsx)("button",{onClick:()=>{m({shopName:a.shopName,ownerName:a.ownerName,address:a.address,contactNumber:a.contactNumber,email:a.email||"",businessRegisterNo:a.businessRegisterNo||"",image:a.image||"",creditLimit:a.creditLimit.toString(),balanceAmount:a.balanceAmount.toString(),isActive:a.isActive}),u(!0),y(a.id),s(""),q(""),window.scrollTo({top:0,behavior:"smooth"})},className:h.default.editButton,disabled:n,children:"Edit"}),(0,b.jsx)("button",{onClick:()=>M(a.id,a.shopName,a.isActive),className:`${h.default.toggleButton} ${a.isActive?h.default.deactivate:h.default.activate}`,disabled:n,children:a.isActive?"Deactivate":"Activate"}),(0,b.jsx)("button",{onClick:()=>N(a.id,a.shopName),className:h.default.deleteButton,disabled:n,children:"Delete"})]})]},a.id))})]}):(0,b.jsxs)("div",{className:h.default.noShops,children:[(0,b.jsx)("div",{className:h.default.noShopsIcon,children:"ðŸª"}),(0,b.jsx)("h3",{children:"Shop Directory"}),(0,b.jsxs)("p",{children:["Click ",(0,b.jsx)("strong",{children:'"Load All"'})," to view all registered shops"]}),(0,b.jsx)("p",{children:"Or use the search box to find specific shops"})]}),z.length>0&&(0,b.jsx)("div",{className:h.default.pagination,children:H.totalPages>1&&(0,b.jsxs)("div",{className:h.default.pageNumbers,children:[(0,b.jsx)("button",{onClick:()=>P(F-1),disabled:!H.hasPrev||n,className:h.default.pageBtn,children:"â† Previous"}),(()=>{let a=[],c=H.totalPages;if(c<=7)for(let b=1;b<=c;b++)a.push(b);else{a.push(1),F>3&&a.push("...");let b=Math.max(2,F-1),d=Math.min(c-1,F+1);for(let c=b;c<=d;c++)a.includes(c)||a.push(c);F<c-2&&a.push("..."),a.includes(c)||a.push(c)}return a.map((a,c)=>"..."===a?(0,b.jsx)("span",{className:h.default.ellipsis,children:"..."},`ellipsis-${c}`):(0,b.jsx)("button",{onClick:()=>P(a),className:`${h.default.pageBtn} ${a===F?h.default.active:""}`,disabled:n,children:a},a))})(),(0,b.jsx)("button",{onClick:()=>P(F+1),disabled:!H.hasNext||n,className:h.default.pageBtn,children:"Next â†’"})]})})]})]})]}):(0,b.jsx)("div",{className:h.default.accessDenied,children:"Access denied to shop management"})}])}];

//# sourceMappingURL=src_app_shops_add_c7b629d8._.js.map