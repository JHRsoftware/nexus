module.exports=[13257,a=>{a.v({accessDenied:"invoice-module__niiNsW__accessDenied",actions:"invoice-module__niiNsW__actions",activePage:"invoice-module__niiNsW__activePage",availableCredit:"invoice-module__niiNsW__availableCredit",cashDiscountLabel:"invoice-module__niiNsW__cashDiscountLabel",checkbox:"invoice-module__niiNsW__checkbox",clearButton:"invoice-module__niiNsW__clearButton",clearSelection:"invoice-module__niiNsW__clearSelection",container:"invoice-module__niiNsW__container",creditExceeded:"invoice-module__niiNsW__creditExceeded",dark:"invoice-module__niiNsW__dark",detailLabel:"invoice-module__niiNsW__detailLabel",detailValue:"invoice-module__niiNsW__detailValue",discount:"invoice-module__niiNsW__discount",discountInput:"invoice-module__niiNsW__discountInput",dropdown:"invoice-module__niiNsW__dropdown",dropdownItem:"invoice-module__niiNsW__dropdownItem",dropdownOpen:"invoice-module__niiNsW__dropdownOpen",ellipsis:"invoice-module__niiNsW__ellipsis",error:"invoice-module__niiNsW__error",fadeIn:"invoice-module__niiNsW__fadeIn",field:"invoice-module__niiNsW__field",form:"invoice-module__niiNsW__form",header:"invoice-module__niiNsW__header",input:"invoice-module__niiNsW__input",invoiceNumber:"invoice-module__niiNsW__invoiceNumber",invoiceTypeNotesRow:"invoice-module__niiNsW__invoiceTypeNotesRow",invoicesControls:"invoice-module__niiNsW__invoicesControls",invoicesHeader:"invoice-module__niiNsW__invoicesHeader",invoicesList:"invoice-module__niiNsW__invoicesList",invoicesTable:"invoice-module__niiNsW__invoicesTable",itemRow:"invoice-module__niiNsW__itemRow",itemsBody:"invoice-module__niiNsW__itemsBody",itemsHeader:"invoice-module__niiNsW__itemsHeader",itemsSection:"invoice-module__niiNsW__itemsSection",itemsTable:"invoice-module__niiNsW__itemsTable",label:"invoice-module__niiNsW__label",labelRow:"invoice-module__niiNsW__labelRow",loadButton:"invoice-module__niiNsW__loadButton",loading:"invoice-module__niiNsW__loading",netTotal:"invoice-module__niiNsW__netTotal",noInvoices:"invoice-module__niiNsW__noInvoices",noOrdersMessage:"invoice-module__niiNsW__noOrdersMessage",notes:"invoice-module__niiNsW__notes",notesInput:"invoice-module__niiNsW__notesInput",orderDate:"invoice-module__niiNsW__orderDate",orderInfo:"invoice-module__niiNsW__orderInfo",orderNotes:"invoice-module__niiNsW__orderNotes",orderTotal:"invoice-module__niiNsW__orderTotal",overdueAmount:"invoice-module__niiNsW__overdueAmount",overdueDays:"invoice-module__niiNsW__overdueDays",overdueInvoice:"invoice-module__niiNsW__overdueInvoice",overduePaymentItem:"invoice-module__niiNsW__overduePaymentItem",overduePaymentsList:"invoice-module__niiNsW__overduePaymentsList",overdueTotal:"invoice-module__niiNsW__overdueTotal",overdueTotalSection:"invoice-module__niiNsW__overdueTotalSection",overdueWarningCard:"invoice-module__niiNsW__overdueWarningCard",overdueWarningMessage:"invoice-module__niiNsW__overdueWarningMessage",overdueWarningSection:"invoice-module__niiNsW__overdueWarningSection",overdueWarningTitle:"invoice-module__niiNsW__overdueWarningTitle",pageButton:"invoice-module__niiNsW__pageButton",pagination:"invoice-module__niiNsW__pagination",paginationButtons:"invoice-module__niiNsW__paginationButtons",paginationInfo:"invoice-module__niiNsW__paginationInfo",price:"invoice-module__niiNsW__price",priceInput:"invoice-module__niiNsW__priceInput",printButton:"invoice-module__niiNsW__printButton",printInvoiceButton:"invoice-module__niiNsW__printInvoiceButton",printLastInvoiceButton:"invoice-module__niiNsW__printLastInvoiceButton",productCode:"invoice-module__niiNsW__productCode",productDetails:"invoice-module__niiNsW__productDetails",productInfo:"invoice-module__niiNsW__productInfo",productName:"invoice-module__niiNsW__productName",productSearchRow:"invoice-module__niiNsW__productSearchRow",productSearchSection:"invoice-module__niiNsW__productSearchSection",productTitle:"invoice-module__niiNsW__productTitle",profitRow:"invoice-module__niiNsW__profitRow",pulse:"invoice-module__niiNsW__pulse",pulseWarning:"invoice-module__niiNsW__pulseWarning",quantity:"invoice-module__niiNsW__quantity",quantityError:"invoice-module__niiNsW__quantityError",quantityInput:"invoice-module__niiNsW__quantityInput",removeButton:"invoice-module__niiNsW__removeButton",repContact:"invoice-module__niiNsW__repContact",repName:"invoice-module__niiNsW__repName",row:"invoice-module__niiNsW__row",searchButton:"invoice-module__niiNsW__searchButton",searchContainer:"invoice-module__niiNsW__searchContainer",searchInput:"invoice-module__niiNsW__searchInput",sectionTitle:"invoice-module__niiNsW__sectionTitle",select:"invoice-module__niiNsW__select",sellingPrice:"invoice-module__niiNsW__sellingPrice",shopDetailItem:"invoice-module__niiNsW__shopDetailItem",shopDetailsCard:"invoice-module__niiNsW__shopDetailsCard",shopDetailsGrid:"invoice-module__niiNsW__shopDetailsGrid",shopDetailsSection:"invoice-module__niiNsW__shopDetailsSection",shopDetailsTitle:"invoice-module__niiNsW__shopDetailsTitle",shopInfo:"invoice-module__niiNsW__shopInfo",shopName:"invoice-module__niiNsW__shopName",shopOwner:"invoice-module__niiNsW__shopOwner",showOrdersButton:"invoice-module__niiNsW__showOrdersButton",slideIn:"invoice-module__niiNsW__slideIn",submitButton:"invoice-module__niiNsW__submitButton",submitSection:"invoice-module__niiNsW__submitSection",subtitle:"invoice-module__niiNsW__subtitle",success:"invoice-module__niiNsW__success",tableBody:"invoice-module__niiNsW__tableBody",tableHeader:"invoice-module__niiNsW__tableHeader",tableRow:"invoice-module__niiNsW__tableRow",textarea:"invoice-module__niiNsW__textarea",title:"invoice-module__niiNsW__title",totalPrice:"invoice-module__niiNsW__totalPrice",totalRow:"invoice-module__niiNsW__totalRow",totalsGrid:"invoice-module__niiNsW__totalsGrid",totalsSection:"invoice-module__niiNsW__totalsSection",viewButton:"invoice-module__niiNsW__viewButton",viewModeLabel:"invoice-module__niiNsW__viewModeLabel"})},62985,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(89531),f=a.i(9453),g=a.i(11642),h=a.i(1075),i=a.i(13257);a.s(["default",0,()=>{(0,d.useRouter)();let{isAuthorized:a,isLoading:j}=(0,e.usePageProtection)("invoices"),{isDarkMode:k}=(0,f.useTheme)(),{user:l}=(0,g.useAuth)(),m=a=>{if(!a)return"";let b=new Date(a),c=b.getDate().toString().padStart(2,"0"),d=(b.getMonth()+1).toString().padStart(2,"0"),e=b.getFullYear();return`${c}/${d}/${e}`},n=a=>{if(!a)return"";let[b,c,d]=a.split("/");return b&&c&&d&&b.length<=2&&c.length<=2&&4===d.length?`${d}-${c.padStart(2,"0")}-${b.padStart(2,"0")}`:""},o=a=>{let[b,c,d]=a.split("/");if(!b||!c||!d)return!1;let e=parseInt(b),f=parseInt(c),g=parseInt(d);if(isNaN(e)||isNaN(f)||isNaN(g))return!1;let h=new Date(g,f-1,e);return h.getDate()===e&&h.getMonth()+1===f&&h.getFullYear()===g},[p,q]=(0,c.useState)(new Date().toISOString().split("T")[0]),[r,s]=(0,c.useState)(m(new Date().toISOString().split("T")[0])),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)([]),[V,W]=(0,c.useState)([]),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)([]),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(""),[al,am]=(0,c.useState)([]),[an,ao]=(0,c.useState)(null),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)([]),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(""),[az,aA]=(0,c.useState)(""),[aB,aC]=(0,c.useState)(!1),[aD,aE]=(0,c.useState)(null),[aF,aG]=(0,c.useState)([]),[aH,aI]=(0,c.useState)(!1),[aJ,aK]=(0,c.useState)([]),[aL,aM]=(0,c.useState)(1),[aN,aO]=(0,c.useState)({currentPage:1,totalPages:1,totalCount:0,hasNext:!1,hasPrev:!1}),[aP,aQ]=(0,c.useState)(""),[aR,aS]=(0,c.useState)(!1),[aT,aU]=(0,c.useState)(null),[aV,aW]=(0,c.useState)(null),[aX,aY]=(0,c.useState)({isSellingPriceReadonly:!1,isDiscountReadonly:!1,showTotalDiscountFromItems:!0,showTotalBalanceDiscount:!1,totalBalanceDiscountPercent:5,hideCostProfit:!1}),aZ=()=>({"Content-Type":"application/json","x-user-data":JSON.stringify(l||{})});(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/discounts"),b=await a.json();b.success&&S(b.discounts.filter(a=>a.percentage>0))}catch(a){}})()},[]),(0,c.useEffect)(()=>{(async()=>{try{if(l){let a=await fetch("/api/softwareSettings",{headers:aZ()}),b=await a.json();if(b.success&&b.settings){let a={isSellingPriceReadonly:1===b.settings.isSellingPriceReadonly||!0===b.settings.isSellingPriceReadonly,isDiscountReadonly:1===b.settings.isDiscountReadonly||!0===b.settings.isDiscountReadonly,showTotalDiscountFromItems:1!==b.settings.showTotalDiscountFromItems&&!0!==b.settings.showTotalDiscountFromItems,showTotalBalanceDiscount:1!==b.settings.showTotalBalanceDiscount&&!0!==b.settings.showTotalBalanceDiscount,totalBalanceDiscountPercent:b.settings.totalBalanceDiscountPercent||5,hideCostProfit:1===b.settings.hideCostProfit||!0===b.settings.hideCostProfit};aY(a)}}}catch(a){}})()},[l]),(0,c.useEffect)(()=>{let a=async()=>{try{if(l){let a=await fetch("/api/softwareSettings",{headers:aZ()});if(a.ok){let b=await a.json();if(b.success&&b.settings&&b.settings.dueDateOptions){E(b.settings.dueDateOptions);let a=b.settings.dueDateOptions.find(a=>a.isDefault);a&&G(a)}}}}catch(a){}};l&&a()},[l]),(0,c.useEffect)(()=>{},[at,aR]);let a$=(0,c.useCallback)(async a=>{if(a.length<2)return void Q([]);try{let b=await fetch(`/api/shops?search=${encodeURIComponent(a)}&limit=10&activeOnly=true`),c=await b.json();c.success&&Q(c.shops||[])}catch(a){}},[]),a_=(0,c.useCallback)(async a=>{if(a.length<2)return void U([]);try{let b=await fetch(`/api/products/search?search=${encodeURIComponent(a)}&limit=10`),c=await b.json();c.success&&U(c.products||[])}catch(a){}},[]),a0=(0,c.useCallback)(async a=>{if(a.length<2)return void ag([]);try{let b=await fetch(`/api/products/search?search=${encodeURIComponent(a)}&limit=10`),c=await b.json();c.success&&ag(c.products||[])}catch(a){}},[]),a1=(0,c.useCallback)(async a=>{try{let b=await fetch(`/api/sales-rep?search=${encodeURIComponent(a)}&activeOnly=true`),c=await b.json();if(c.success){let a=c.salesReps?.filter(a=>"active"===a.status)||[];W(a)}}catch(a){}},[]);(0,c.useCallback)(async a=>{try{let b=await fetch(`/api/orders/search?search=${encodeURIComponent(a)}&status=pending`);if(b.ok){let a=await b.json();a.success&&Array.isArray(a.orders)?am(a.orders):am([])}}catch(a){am([])}},[]);let a2=async()=>{try{let a=await fetch("/api/orders/search?search=&status=pending&limit=100");if(a.ok){let b=await a.json();b.success&&Array.isArray(b.orders)?(am(b.orders),as(!0),aq(!0)):(am([]),alert("No pending orders found"))}}catch(a){alert("Failed to load orders. Please try again.")}};(0,c.useEffect)(()=>{let a=setTimeout(()=>{J&&a$(J)},300);return()=>clearTimeout(a)},[J,a$]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{L&&a_(L)},300);return()=>clearTimeout(a)},[L,a_]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{N&&a1(N)},300);return()=>clearTimeout(a)},[N,a1]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{ad&&a0(ad)},300);return()=>clearTimeout(a)},[ad,a0]);let a3=async a=>{try{let b=await fetch(`/api/orders/${a.id}`);if(!b.ok)throw Error("Failed to fetch order details");let c=await b.json(),d=c.success?c.order:null;if(!d||!d.orderItems)return void alert("Unable to load order details. Please try again.");if(d.status?.toLowerCase()!=="pending")return void alert("Only pending orders can be converted to invoices. This order status is: "+(d.status||"Unknown"));ao(d),d.shop&&(u(d.shop),K(d.shop.shopName)),d.salesRep&&(Y(d.salesRep),O(d.salesRep.name)),d.discount&&w(d.discount),d.cashDiscountEnabled&&y(d.cashDiscountEnabled),d.notes&&I(d.notes);let e=d.orderItems.map(a=>({id:`${Date.now()}_${Math.random()}`,productId:a.product.id,productCode:a.product.productCode,productName:a.product.itemName,quantity:a.quantity,sellingPrice:Number(a.sellingPrice),discount:Number(a.discount||0),price:Number(a.price),totalPrice:Number(a.totalPrice),availableQty:a.product.availableQty,costPrice:Number(a.product.totalCost||0)}));au(e),aq(!1),ak(`Order #${d.id} - ${d.shop?.shopName||"N/A"}`)}catch(a){alert("Failed to load order details. Please try again.")}},a4=(a,b,c)=>{au(d=>d.map(d=>{if(d.id===a){let a=Number(c);"quantity"===b&&(a<=0?(a=1,aA(`Quantity must be at least 1 for ${d.productName}`)):a>d.availableQty?(aA(`Cannot save invoice! Quantity ${a} exceeds available stock (${d.availableQty}) for ${d.productName}. Maximum allowed: ${d.availableQty}`),a=d.availableQty):aA(""));let e={...d,[b]:a};return e.price=Number(e.quantity)*Number(e.sellingPrice),e.totalPrice=e.price-Number(e.discount),e}return d}))},a5=c.default.useMemo(()=>{let a=at.reduce((a,b)=>a+Number(b.totalPrice),0),b=at.reduce((a,b)=>a+Number(b.discount),0),c=v?Number(a)*(parseFloat(v.percentage.toString())/100):0,d=x?Number(a)*(aX.totalBalanceDiscountPercent/100):0,e=Number(a)-Number(c)-Number(d),f=0,g=0;return at.forEach(a=>{let b=(a.costPrice||0)*a.quantity;f+=b;let c=Number(a.totalPrice),d=v?c*(parseFloat(v.percentage.toString())/100):0,e=x?c*(aX.totalBalanceDiscountPercent/100):0;g+=c-d-e-b}),{subTotal:Number(a),totalDiscount:Number(b),invoiceTypeDiscount:Number(c),cashDiscount:Number(d),netTotal:Number(e),totalCost:Number(f),totalProfit:Number(g)}},[at,x,v,aX.totalBalanceDiscountPercent]);(0,c.useEffect)(()=>{if(a6()&&p&&F){let a=new Date(new Date(p));a.setDate(a.getDate()+F.days);let b=a.toISOString().split("T")[0];A(b),C(m(b))}else A(""),C("")},[p,v,F]);let a6=()=>v?.discountName?.toLowerCase().includes("credit")||!1,a7=async a=>{try{let b=await fetch(`/api/payments?shopId=${a}&status=due&limit=100`),c=await b.json();if(c.success){let a=c.payments.map(a=>{let b=new Date(a.dueDate),c=new Date;c.setHours(0,0,0,0),b.setHours(0,0,0,0);let d=Math.ceil((c.getTime()-b.getTime())/864e5);return{id:a.id,invoiceNumber:a.invoice.invoiceNumber,dueDate:a.dueDate,remainingAmount:Number(a.remainingAmount)||0,daysPastDue:Math.max(0,d)}});if(aG(a),aI(a.length>0),a.length>0){let b=a.reduce((a,b)=>a+Number(b.remainingAmount),0);aA(`âš ï¸ This shop has ${a.length} overdue payment(s) totaling LKR ${b.toLocaleString()}. Please settle overdue payments before creating new credit invoices.`)}}}catch(a){}},a8=()=>at.some(a=>a.quantity<=0||a.quantity>a.availableQty),a9=async a=>{if(a.preventDefault(),!t)return void aA("Please select a shop");if(!X)return void aA("Please select a sales representative");if(!v)return void aA("Please select an invoice type");if(0===at.length)return void aA("Please add at least one product");if(a6()&&aH){let a=aF.reduce((a,b)=>a+Number(b.remainingAmount),0);aA(`âŒ Cannot create credit invoice! This shop has ${aF.length} overdue payment(s) totaling LKR ${a.toLocaleString()}. Please settle all overdue payments before creating new credit invoices.`);return}let b=[];for(let a of at)a.quantity>a.availableQty&&b.push(`${a.productName}: Requested ${a.quantity}, Available ${a.availableQty}`),a.quantity<=0&&b.push(`${a.productName}: Invalid quantity ${a.quantity}`);if(b.length>0)return void aA(`Cannot save invoice! Stock validation failed:
${b.join("\n")}
Please adjust quantities before saving.`);if(a6()&&!(()=>{if(!t||!a6())return!0;let a=(t.creditLimit||0)-(t.balanceAmount||0);return a5.netTotal<=a})()){let a=(t.creditLimit||0)-(t.balanceAmount||0);aA(`Credit limit exceeded! Available credit: LKR ${a.toLocaleString()}. Invoice total: LKR ${a5.netTotal.toLocaleString()}`);return}aw(!0),aA(""),ay("");try{let a={...aB&&{id:aD?.id},invoiceDate:p,shopId:t.id,salesRepId:X.id,discountId:v?.id||null,invoiceType:v?.discountName||null,invoiceTypePercentage:v?.percentage||null,cashDiscountEnabled:x,...a6()&&z&&{dueDate:z},...an&&{orderNumber:an.orderNumber},notes:H||null,items:at.map(a=>({productId:a.productId,quantity:a.quantity,sellingPrice:a.sellingPrice,discount:a.discount}))},b=await fetch("/api/invoices",{method:aB?"PUT":"POST",headers:aZ(),body:JSON.stringify(a)}),c=await b.json();if(c.success){ay(c.message);let a=c.invoice?.id;a&&!aB&&aW(a),setTimeout(()=>{aB||ba(),ay("")},2e3),a&&!aB&&setTimeout(()=>{window.confirm("Invoice created successfully! Would you like to print it now?")&&window.open(`/invoices/print/${a}`,"_blank")},2500)}else aA(c.error||"Operation failed")}catch(a){aA("An error occurred while processing the invoice")}finally{aw(!1)}},ba=()=>{let a=new Date().toISOString().split("T")[0];q(a),s(m(a)),u(null),Y(null),w(null),y(!1),A(""),C(""),I(""),au([]),K(""),O(""),M(""),ae(""),$(!1),ac(!1),aa(!1),ai(!1),ag([]),aC(!1),aE(null),aA(""),ay(""),aG([]),aI(!1)},bb=(0,c.useCallback)(async(a=1,b="")=>{aw(!0);try{let c=new URLSearchParams({page:a.toString(),limit:"5",search:b.trim()}),d=await fetch(`/api/invoices?${c}`,{headers:aZ()}),e=await d.json();e.success?(aK(e.invoices),aO(e.pagination),aM(a)):(aA(e.error||"Failed to load invoices"),aK([]))}catch(a){aA("An error occurred while loading invoices"),aK([])}finally{aw(!1)}},[]),bc=async a=>{try{let b=await fetch(`/api/invoices/${a.id}`,{headers:aZ()}),c=await b.json();if(c.success&&c.invoice){let a=c.invoice;aS(!0),aU(a),q(new Date(a.invoiceDate).toISOString().split("T")[0]),s(new Date(a.invoiceDate).toLocaleDateString("en-GB")),u(a.shop),K(a.shop.shopName),a.salesRep&&(Y(a.salesRep),O(a.salesRep.name)),a.discount&&w(a.discount),y(a.cashDiscountEnabled||!1),I(a.notes||""),a.dueDate&&(A(new Date(a.dueDate).toISOString().split("T")[0]),C(new Date(a.dueDate).toLocaleDateString("en-GB")));let b=(a.invoiceItems||[]).map(a=>({id:`view-${a.productId}-${Date.now()}-${Math.random()}`,productId:a.productId,productCode:a.productCode||"",productName:a.productName||"",quantity:Number(a.quantity||0),sellingPrice:Number(a.sellingPrice||0),discount:Number(a.discount||0),price:Number(a.price||0),totalPrice:Number(a.totalPrice||0),availableQty:Number(a.availableQty||0),costPrice:Number(a.costPrice||0)}));au(b),window.scrollTo({top:0,behavior:"smooth"})}else alert("Failed to load invoice details")}catch(a){alert("An error occurred while loading invoice details")}},bd=a=>{aQ(a),bb(1,a)},be=a=>{a>=1&&a<=aN.totalPages&&!av&&bb(a,aP)};return j?(0,b.jsx)("div",{className:i.default.loading,children:"Checking permissions..."}):a?(0,b.jsxs)("div",{className:`${i.default.container} ${k?"dark":"light"}`,children:[(0,b.jsxs)("div",{className:i.default.header,children:[(0,b.jsx)("h1",{className:i.default.title,children:aR?`View Invoice - ${aT?.invoiceNumber}`:aB?"Edit Invoice":"Create Invoice"}),(0,b.jsx)("p",{className:i.default.subtitle,children:aR?"Viewing invoice details (read-only mode)":aB?"Edit invoice details":"Create and manage invoices for your business"}),(aB||aR)&&(0,b.jsx)("button",{type:"button",onClick:aR?()=>{aS(!1),aU(null),ba()}:ba,className:i.default.clearButton,children:aR?"Back to Create":"Cancel Edit"})]}),(0,b.jsxs)("form",{onSubmit:a9,className:i.default.form,children:[(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsxs)("div",{className:i.default.labelRow,children:[(0,b.jsx)("label",{className:i.default.label,children:"Load from Order (Optional):"}),(0,b.jsx)("button",{type:"button",onClick:a2,className:i.default.showOrdersButton,disabled:av,children:"Show Orders"})]}),(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:an?`Order #${an.id} - ${an.shop?.shopName||"N/A"}`:aj,onChange:a=>{if(!an&&ar){let b=a.target.value;ak(b),b.trim()?am(al.filter(a=>a.orderNumber.toLowerCase().includes(b.toLowerCase())||a.shop?.shopName?.toLowerCase().includes(b.toLowerCase())||a.notes?.toLowerCase().includes(b.toLowerCase()))):a2(),aq(!0)}},onFocus:()=>{ar&&aq(!0)},onBlur:()=>{setTimeout(()=>aq(!1),150)},placeholder:ar?"Search loaded orders...":"Click 'Show Orders' to load orders first",className:i.default.input,disabled:av||!ar}),an&&(0,b.jsx)("button",{type:"button",onClick:()=>{ao(null),ak(""),aq(!1),as(!1),am([])},className:i.default.clearButton,disabled:av,children:"Clear Order"}),ap&&ar&&al.length>0&&(0,b.jsx)("div",{className:i.default.dropdown,children:al.map(a=>(0,b.jsx)("div",{className:i.default.dropdownItem,onClick:()=>a3(a),children:(0,b.jsxs)("div",{className:i.default.orderInfo,children:[(0,b.jsxs)("strong",{children:["Order #",a.id]}),(0,b.jsx)("span",{className:i.default.shopName,children:a.shop?.shopName||"N/A"}),(0,b.jsx)("span",{className:i.default.orderDate,children:new Date(a.orderDate).toLocaleDateString()}),(0,b.jsxs)("span",{className:i.default.orderTotal,children:["Rs. ",Number(a.netTotal||0).toFixed(2)]}),a.notes&&(0,b.jsx)("span",{className:i.default.orderNotes,children:a.notes})]})},a.id))}),ap&&ar&&0===al.length&&(0,b.jsx)("div",{className:i.default.dropdown,children:(0,b.jsxs)("div",{className:i.default.noOrdersMessage,children:["No pending orders found",aj?` matching "${aj}"`:""]})})]})]}),(0,b.jsxs)("div",{className:i.default.row,children:[(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Invoice Date: *"}),(0,b.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:r,onChange:a=>{let b=a.target.value;s(b);let c=b.replace(/[^\d]/g,"");if(c.length>=3&&c.length<=4?c=c.replace(/(\d{2})(\d{1,2})/,"$1/$2"):c.length>=5&&(c=c.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),c!==b&&c.length<=10&&s(c),o(c)){let a=n(c);a&&q(a)}},onBlur:a=>{if(!o(a.target.value)){let a=new Date().toISOString().split("T")[0];q(a),s(m(a))}},className:i.default.input,disabled:av,required:!0,maxLength:10})]}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Select Sales Rep: *"}),(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:X?`${X.name} (${X.contactNumber})`:N,onChange:a=>{if(!X){let b=a.target.value;O(b),ac(b.length>0)}},onFocus:()=>ac(!0),onBlur:()=>{setTimeout(()=>ac(!1),150)},placeholder:"Type to search sales representatives...",className:i.default.input,disabled:av,required:!0}),X&&(0,b.jsx)("button",{type:"button",onClick:()=>{Y(null),O(""),ac(!1)},className:i.default.clearSelection,disabled:av,children:"Ã—"}),ab&&V.length>0&&(0,b.jsx)("div",{className:i.default.dropdown,children:V.map(a=>(0,b.jsxs)("div",{className:i.default.dropdownItem,onClick:()=>{Y(a),O(""),ac(!1)},children:[(0,b.jsx)("div",{className:i.default.repName,children:a.name}),(0,b.jsx)("div",{className:i.default.repContact,children:a.contactNumber})]},a.id))})]})]}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Select Shop/Customer: *"}),(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:t?`${t.shopName} (${t.ownerName})`:J,onChange:a=>{if(!t){let b=a.target.value;K(b),$(b.length>0)}},onFocus:()=>$(!0),onBlur:()=>{setTimeout(()=>$(!1),150)},placeholder:"Search shop by name or owner...",className:i.default.input,disabled:av,required:!0}),t&&(0,b.jsx)("button",{type:"button",onClick:()=>{u(null),K(""),$(!1)},className:i.default.clearSelection,children:"Ã—"}),Z&&P.length>0&&!t&&(0,b.jsx)("div",{className:i.default.dropdown,children:P.map(a=>(0,b.jsx)("div",{onClick:async()=>{u(a),K(""),$(!1),aA(""),aG([]),aI(!1),await a7(a.id)},className:i.default.dropdownItem,children:(0,b.jsxs)("div",{className:i.default.shopInfo,children:[(0,b.jsx)("div",{className:i.default.shopName,children:a.shopName}),(0,b.jsxs)("div",{className:i.default.shopOwner,children:[a.ownerName," â€¢ ",a.contactNumber]})]})},a.id))})]})]})]}),t&&(0,b.jsx)("div",{className:i.default.shopDetailsSection,children:(0,b.jsxs)("div",{className:i.default.shopDetailsCard,children:[(0,b.jsx)("h3",{className:i.default.shopDetailsTitle,children:"Shop Information"}),(0,b.jsxs)("div",{className:i.default.shopDetailsGrid,children:[(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Shop Name:"}),(0,b.jsx)("span",{className:i.default.detailValue,children:t.shopName})]}),(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Owner:"}),(0,b.jsx)("span",{className:i.default.detailValue,children:t.ownerName})]}),(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Contact:"}),(0,b.jsx)("span",{className:i.default.detailValue,children:t.contactNumber})]}),(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Credit Limit:"}),(0,b.jsxs)("span",{className:i.default.detailValue,children:["LKR ",t.creditLimit?.toLocaleString()||"0"]})]}),(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Current Balance:"}),(0,b.jsxs)("span",{className:i.default.detailValue,children:["LKR ",t.balanceAmount?.toLocaleString()||"0"]})]}),(0,b.jsxs)("div",{className:i.default.shopDetailItem,children:[(0,b.jsx)("span",{className:i.default.detailLabel,children:"Available Credit:"}),(0,b.jsxs)("span",{className:`${i.default.detailValue} ${(t.creditLimit||0)-(t.balanceAmount||0)<=0?i.default.creditExceeded:i.default.availableCredit}`,children:["LKR ",((t.creditLimit||0)-(t.balanceAmount||0)).toLocaleString()]})]})]})]})}),t&&aH&&(0,b.jsx)("div",{className:i.default.overdueWarningSection,children:(0,b.jsxs)("div",{className:i.default.overdueWarningCard,children:[(0,b.jsx)("h3",{className:i.default.overdueWarningTitle,children:"âš ï¸ Overdue Payments Alert"}),(0,b.jsxs)("p",{className:i.default.overdueWarningMessage,children:["This shop has ",aF.length," overdue payment(s). Credit invoices cannot be created until all overdue payments are settled."]}),(0,b.jsx)("div",{className:i.default.overduePaymentsList,children:aF.map(a=>(0,b.jsxs)("div",{className:i.default.overduePaymentItem,children:[(0,b.jsxs)("div",{className:i.default.overdueInvoice,children:["Invoice: ",a.invoiceNumber]}),(0,b.jsxs)("div",{className:i.default.overdueDays,children:[a.daysPastDue," days overdue"]}),(0,b.jsxs)("div",{className:i.default.overdueAmount,children:["LKR ",Number(a.remainingAmount).toLocaleString()]})]},a.id))}),(0,b.jsx)("div",{className:i.default.overdueTotalSection,children:(0,b.jsxs)("strong",{className:i.default.overdueTotal,children:["Total Overdue: LKR ",aF.reduce((a,b)=>a+Number(b.remainingAmount),0).toLocaleString()]})})]})}),(0,b.jsxs)("div",{className:i.default.invoiceTypeNotesRow,children:[(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Invoice Type: *"}),(0,b.jsxs)("select",{value:v?.id||"",onChange:a=>{let b=a.target.value;w(R.find(a=>a.id.toString()===b)||null)},className:i.default.input,disabled:av,required:!0,children:[(0,b.jsx)("option",{value:"",disabled:!0,children:"Select Invoice Type"}),R.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.discountName," Discount (",a.percentage,"%)"]},a.id))]})]}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Notes:"}),(0,b.jsx)("textarea",{value:H,onChange:a=>I(a.target.value),placeholder:"Enter any additional notes for this invoice...",className:i.default.notesInput,disabled:av,rows:1})]}),a6()&&(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Payment Terms:"}),(0,b.jsxs)("select",{value:F?`${F.label}-${F.days}`:"",onChange:a=>{let[b,c]=a.target.value.split("-"),d=parseInt(c),e=D.find(a=>a.label===b&&a.days===d);e&&G(e)},className:i.default.select,disabled:av,children:[(0,b.jsx)("option",{value:"",children:"Select Payment Terms"}),D.map((a,c)=>(0,b.jsxs)("option",{value:`${a.label}-${a.days}`,children:[a.label," (",a.days," days) ",a.isDefault?"- Default":""]},c))]})]})]}),a6()&&z&&(0,b.jsx)("div",{className:i.default.row,children:(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Payment Due Date:"}),(0,b.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:B,onChange:a=>{let b=a.target.value;C(b);let c=b.replace(/[^\d]/g,"");if(c.length>=3&&c.length<=4?c=c.replace(/(\d{2})(\d{1,2})/,"$1/$2"):c.length>=5&&(c=c.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),c!==b&&c.length<=10&&C(c),o(c)){let a=n(c);a&&A(a)}},onBlur:a=>{!o(a.target.value)&&z&&C(m(z))},className:i.default.input,disabled:av,maxLength:10}),(0,b.jsxs)("small",{style:{color:"#666",fontSize:"0.85em",marginTop:"4px",display:"block"},children:["ðŸ’¡ Calculated from: Invoice Date + ",F?.days||0," days"]})]})}),(0,b.jsxs)("div",{className:i.default.productSearchRow,children:[(0,b.jsxs)("div",{className:i.default.productSearchSection,children:[(0,b.jsx)("label",{className:i.default.label,children:"Add Products:"}),(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:L,onChange:a=>{let b=a.target.value;M(b),aa(b.length>0)},onFocus:()=>aa(!0),onBlur:()=>{setTimeout(()=>aa(!1),150)},placeholder:"Search products by code or name...",className:i.default.input,disabled:av}),_&&T.length>0&&(0,b.jsx)("div",{className:i.default.dropdown,children:T.map(a=>(0,b.jsx)("div",{onClick:()=>(a=>{let b=at.find(b=>b.productId===a.id);if(b){let c=Number(b.quantity)+1,d=a.availableQty-1;if(c>d)return void aA(`Cannot add more ${a.itemName}. Must maintain minimum stock of 1. Maximum for sale: ${d}`);au(b=>b.map(b=>{if(b.productId===a.id){let a=c*Number(b.sellingPrice),d=a-Number(b.discount);return{...b,quantity:c,price:a,totalPrice:d}}return b}))}else{if(a.availableQty-1<1)return void aA(`Cannot add ${a.itemName}. Must maintain minimum stock of 1. Current stock: ${a.availableQty}`);let b=Number(a.sellingPrice),c=+b,d={id:`item-${Date.now()}-${a.id}`,productId:a.id,productCode:a.productCode,productName:a.itemName,quantity:1,sellingPrice:b,discount:0,price:c,totalPrice:c-0,availableQty:a.availableQty,costPrice:a.costPrice||0};au(a=>[...a,d])}M(""),U([]),aa(!1)})(a),className:i.default.dropdownItem,children:(0,b.jsxs)("div",{className:i.default.productInfo,children:[(0,b.jsxs)("div",{className:i.default.productName,children:[(0,b.jsx)("span",{className:i.default.productCode,children:a.productCode}),(0,b.jsx)("span",{className:i.default.productTitle,children:a.itemName})]}),(0,b.jsxs)("div",{className:i.default.productDetails,children:[(0,b.jsxs)("span",{children:["Price: LKR ",a.sellingPrice.toLocaleString()]}),(0,b.jsxs)("span",{children:["Available: ",a.availableQty]}),(0,b.jsxs)("span",{children:["Category: ",a.category]})]})]})},a.id))})]})]}),(0,b.jsxs)("div",{className:i.default.productSearchSection,children:[(0,b.jsx)("label",{className:i.default.label,children:"Add Free Products:"}),(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:ad,onChange:a=>{let b=a.target.value;ae(b),ai(b.length>0)},onFocus:()=>ai(!0),onBlur:()=>{setTimeout(()=>ai(!1),150)},placeholder:"Search products to add as free items (price = 0)...",className:i.default.input,disabled:av}),ah&&af.length>0&&(0,b.jsx)("div",{className:i.default.dropdown,children:af.map(a=>(0,b.jsx)("div",{onClick:()=>(a=>{if(a.availableQty-1<1)return void aA(`Cannot add ${a.itemName}. Must maintain minimum stock of 1. Current stock: ${a.availableQty}`);let b={id:`free-item-${Date.now()}-${a.id}-${Math.random()}`,productId:a.id,productCode:a.productCode,productName:`${a.itemName} (FREE)`,quantity:1,sellingPrice:0,discount:0,price:0,totalPrice:0,availableQty:a.availableQty,costPrice:a.costPrice||0};au(a=>[...a,b]),ae(""),ag([]),ai(!1)})(a),className:i.default.dropdownItem,children:(0,b.jsxs)("div",{className:i.default.productInfo,children:[(0,b.jsxs)("div",{className:i.default.productName,children:[(0,b.jsx)("span",{className:i.default.productCode,children:a.productCode}),(0,b.jsxs)("span",{className:i.default.productTitle,children:[a.itemName," (FREE)"]})]}),(0,b.jsxs)("div",{className:i.default.productDetails,children:[(0,b.jsxs)("span",{children:["Original Price: LKR ",a.sellingPrice.toLocaleString()]}),(0,b.jsx)("span",{children:"Free Price: LKR 0"}),(0,b.jsxs)("span",{children:["Available: ",a.availableQty]}),(0,b.jsxs)("span",{children:["Category: ",a.category]})]})]})},`free-${a.id}`))})]})]})]}),at.length>0&&(0,b.jsxs)("div",{className:i.default.itemsSection,children:[(0,b.jsx)("h3",{className:i.default.sectionTitle,children:"Invoice Items"}),(0,b.jsxs)("div",{className:i.default.itemsTable,children:[(0,b.jsxs)("div",{className:`${i.default.itemsHeader} ${!aX.showTotalDiscountFromItems?i.default.itemsHeaderNoDiscount:""}`,children:[(0,b.jsx)("div",{children:"Product Code"}),(0,b.jsx)("div",{children:"Product Name"}),(0,b.jsx)("div",{children:"Qty"}),(0,b.jsx)("div",{children:"Selling Price"}),aX.showTotalDiscountFromItems&&(0,b.jsx)("div",{children:"Discount"}),(0,b.jsx)("div",{children:"Price"}),!aX.hideCostProfit&&(0,b.jsx)("div",{children:"Cost"}),!aX.hideCostProfit&&(0,b.jsx)("div",{children:"Profit"}),(0,b.jsx)("div",{children:"Total Price"}),(0,b.jsx)("div",{children:"Actions"})]}),(0,b.jsx)("div",{className:i.default.itemsBody,children:at.sort((a,b)=>0===a.sellingPrice&&0!==b.sellingPrice?1:0!==a.sellingPrice&&0===b.sellingPrice?-1:0).map(a=>{let c,d;return(0,b.jsxs)("div",{className:`${i.default.itemRow} ${!aX.showTotalDiscountFromItems?i.default.itemRowNoDiscount:""}`,children:[(0,b.jsx)("div",{className:i.default.productCode,children:a.productCode}),(0,b.jsx)("div",{className:i.default.productName,children:a.productName}),(0,b.jsx)("div",{className:i.default.quantity,children:(0,b.jsx)("input",{type:"number",min:"1",max:a.availableQty,step:"1",value:a.quantity,onChange:b=>a4(a.id,"quantity",parseFloat(b.target.value)||1),onWheel:h.handleNumberInputWheel,className:`${i.default.quantityInput} ${a.quantity>a.availableQty?i.default.quantityError:""}`,title:`Available stock: ${a.availableQty}`,readOnly:aR})}),(0,b.jsx)("div",{className:i.default.sellingPrice,children:(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.sellingPrice,onChange:b=>a4(a.id,"sellingPrice",parseFloat(b.target.value)||0),onWheel:h.handleNumberInputWheel,className:i.default.priceInput,readOnly:aR||aX.isSellingPriceReadonly||0===a.sellingPrice,title:aR?"View mode - cannot edit":0===a.sellingPrice?"Free item - selling price cannot be changed":aX.isSellingPriceReadonly?"Selling price is read-only (configured in settings)":""})}),aX.showTotalDiscountFromItems&&(0,b.jsx)("div",{className:i.default.discount,children:(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.discount,onChange:b=>a4(a.id,"discount",parseFloat(b.target.value)||0),onWheel:h.handleNumberInputWheel,className:i.default.discountInput,placeholder:"0.00",readOnly:aR||aX.isDiscountReadonly||0===a.sellingPrice,title:aR?"View mode - cannot edit":0===a.sellingPrice?"Free item - no additional discount can be applied":aX.isDiscountReadonly?"Discount is read-only (configured in settings)":""})}),(0,b.jsxs)("div",{className:i.default.price,children:["LKR ",a.price.toLocaleString()]}),!aX.hideCostProfit&&(0,b.jsxs)("div",{className:i.default.cost,children:["LKR ",(a.costPrice*a.quantity).toLocaleString()]}),!aX.hideCostProfit&&(0,b.jsxs)("div",{className:i.default.profit,children:["LKR ",(c=v?a.totalPrice*(parseFloat(v.percentage.toString())/100):0,d=x?a.totalPrice*(aX.totalBalanceDiscountPercent/100):0,(a.totalPrice-c-d-a.costPrice*a.quantity).toLocaleString())]}),(0,b.jsxs)("div",{className:i.default.totalPrice,children:["LKR ",a.totalPrice.toLocaleString()]}),(0,b.jsxs)("div",{className:i.default.actions,children:[!aR&&(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void au(a=>a.filter(a=>a.id!==b))},className:i.default.removeButton,children:"Remove"}),aR&&(0,b.jsx)("span",{className:i.default.viewModeLabel,children:"View Only"})]})]},a.id)})})]}),(0,b.jsx)("div",{className:i.default.totalsSection,children:(0,b.jsxs)("div",{className:i.default.totalsGrid,children:[(0,b.jsxs)("div",{className:i.default.totalRow,children:[(0,b.jsxs)("span",{children:["Sub Total",v?` - ${v.discountName} Discount (${v.percentage}%)`:"",":"]}),(0,b.jsxs)("span",{children:["LKR ",a5.subTotal.toLocaleString()]})]}),v&&(0,b.jsxs)("div",{className:i.default.totalRow,children:[(0,b.jsxs)("span",{children:["Discount Amount (",v.percentage,"%):"]}),(0,b.jsxs)("span",{children:["- LKR ",a5.invoiceTypeDiscount.toLocaleString()]})]}),aX.showTotalDiscountFromItems&&(0,b.jsxs)("div",{className:i.default.totalRow,children:[(0,b.jsx)("span",{children:"Total Discount from Items:"}),(0,b.jsxs)("span",{children:["LKR ",a5.totalDiscount.toLocaleString()]})]}),aX.showTotalBalanceDiscount&&(0,b.jsxs)("div",{className:i.default.totalRow,children:[(0,b.jsxs)("label",{className:i.default.cashDiscountLabel,children:[(0,b.jsx)("input",{type:"checkbox",checked:x,onChange:a=>y(a.target.checked),className:i.default.checkbox}),(0,b.jsxs)("span",{children:["Cash Discount (",aX.totalBalanceDiscountPercent,"%):"]})]}),(0,b.jsx)("span",{children:x&&a5.cashDiscount>0?`- LKR ${a5.cashDiscount.toLocaleString()}`:"LKR 0"})]}),(0,b.jsxs)("div",{className:`${i.default.totalRow} ${i.default.netTotal}`,children:[(0,b.jsx)("span",{children:"Net Total:"}),(0,b.jsxs)("span",{children:["LKR ",a5.netTotal.toLocaleString()]})]}),!aX.hideCostProfit&&(0,b.jsxs)("div",{className:i.default.totalRow,children:[(0,b.jsx)("span",{children:"Total Cost:"}),(0,b.jsxs)("span",{children:["LKR ",a5.totalCost.toLocaleString()]})]}),!aX.hideCostProfit&&(0,b.jsxs)("div",{className:`${i.default.totalRow} ${i.default.profitRow}`,children:[(0,b.jsx)("span",{children:"Total Profit:"}),(0,b.jsxs)("span",{style:{color:a5.totalProfit>=0?"#28a745":"#dc3545",fontWeight:"bold"},children:["LKR ",a5.totalProfit.toLocaleString()]})]})]})})]}),az&&(0,b.jsx)("div",{className:i.default.error,children:az}),ax&&(0,b.jsx)("div",{className:i.default.success,children:ax}),(0,b.jsxs)("div",{className:i.default.submitSection,children:[!aR&&(0,b.jsx)("button",{type:"submit",className:i.default.submitButton,disabled:av||!t||!v||0===at.length||a8()||a6()&&aH,title:a8()?"Cannot save: Some items exceed available stock":a6()&&aH?"Cannot create credit invoice: Shop has overdue payments":"",children:av?"Processing...":a8()?"Check Stock Quantities":aB?"Update Invoice":"Create Invoice"}),!aR&&aV&&(0,b.jsx)("button",{type:"button",onClick:()=>window.open(`/invoices/print/${aV}`,"_blank"),className:i.default.printLastInvoiceButton,disabled:av,title:"Print the last created invoice",children:"ðŸ–¨ï¸ Print Last Invoice"}),aR&&aT&&(0,b.jsx)("button",{type:"button",onClick:()=>window.open(`/invoices/print/${aT.id}`,"_blank"),className:i.default.printInvoiceButton,disabled:av,children:"ðŸ–¨ï¸ Print This Invoice"})]})]}),(0,b.jsxs)("div",{className:i.default.invoicesList,children:[(0,b.jsxs)("div",{className:i.default.invoicesHeader,children:[(0,b.jsx)("h2",{className:i.default.subtitle,children:"Recent Invoices"}),(0,b.jsxs)("div",{className:i.default.invoicesControls,children:[(0,b.jsxs)("div",{className:i.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",placeholder:"Search by invoice number or shop name...",value:aP,onChange:a=>aQ(a.target.value),onKeyPress:a=>{"Enter"===a.key&&bd(aP)},className:i.default.searchInput}),(0,b.jsx)("button",{onClick:()=>bd(aP),className:i.default.searchButton,disabled:av,children:"ðŸ”"})]}),(0,b.jsx)("button",{onClick:()=>bb(1,aP),className:i.default.loadButton,disabled:av,children:av?"Loading...":"Load Latest 5 Invoices"})]})]}),aJ.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:i.default.invoicesTable,children:[(0,b.jsxs)("div",{className:i.default.tableHeader,children:[(0,b.jsx)("div",{children:"Invoice #"}),(0,b.jsx)("div",{children:"Date"}),(0,b.jsx)("div",{children:"Shop"}),(0,b.jsx)("div",{children:"Items"}),(0,b.jsx)("div",{children:"Net Total"}),(0,b.jsx)("div",{children:"Notes"}),(0,b.jsx)("div",{children:"Actions"})]}),(0,b.jsx)("div",{className:i.default.tableBody,children:aJ.map(a=>(0,b.jsxs)("div",{className:i.default.tableRow,children:[(0,b.jsx)("div",{className:i.default.invoiceNumber,children:a.invoiceNumber}),(0,b.jsx)("div",{children:new Date(a.invoiceDate).toLocaleDateString()}),(0,b.jsx)("div",{children:a.shop.shopName}),(0,b.jsxs)("div",{children:[a.invoiceItems.length," items"]}),(0,b.jsxs)("div",{children:["LKR ",Number(a.netTotal).toLocaleString()]}),(0,b.jsx)("div",{className:i.default.notes,title:a.notes||"No notes",children:a.notes?a.notes.length>30?`${a.notes.substring(0,30)}...`:a.notes:"-"}),(0,b.jsxs)("div",{className:i.default.actions,children:[(0,b.jsx)("button",{className:i.default.viewButton,onClick:()=>bc(a),disabled:av,children:"View"}),(0,b.jsx)("button",{className:i.default.printButton,onClick:()=>window.open(`/invoices/print/${a.id}`,"_blank"),disabled:av,title:"Print Invoice",children:"Print"})]})]},a.id))})]}),aN.totalPages>1&&(0,b.jsxs)("div",{className:i.default.pagination,children:[(0,b.jsx)("div",{className:i.default.paginationInfo,children:(0,b.jsxs)("span",{children:["Page ",aN.currentPage," of ",aN.totalPages,"(",aN.totalCount," total invoices)",aP&&(0,b.jsxs)("span",{children:[' | Filtered by: "',aP,'"']})]})}),(0,b.jsxs)("div",{className:i.default.paginationButtons,children:[(0,b.jsx)("button",{onClick:()=>be(aL-1),disabled:!aN.hasPrev||av,className:i.default.pageButton,children:"â† Previous"}),(()=>{let a=[],c=aN.totalPages;if(c<=5)for(let b=1;b<=c;b++)a.push(b);else{a.push(1),aL>3&&a.push("...");let b=Math.max(2,aL-1),d=Math.min(c-1,aL+1);for(let c=b;c<=d;c++)a.includes(c)||a.push(c);aL<c-2&&a.push("..."),a.includes(c)||a.push(c)}return a.map((a,c)=>"..."===a?(0,b.jsx)("span",{className:i.default.ellipsis,children:"..."},`ellipsis-${c}`):(0,b.jsx)("button",{onClick:()=>be(a),className:`${i.default.pageButton} ${a===aL?i.default.activePage:""}`,disabled:av,children:a},a))})(),(0,b.jsx)("button",{onClick:()=>be(aL+1),disabled:!aN.hasNext||av,className:i.default.pageButton,children:"Next â†’"})]})]})]}),0===aJ.length&&!av&&(0,b.jsxs)("div",{className:i.default.noInvoices,children:[(0,b.jsxs)("p",{children:["No invoices found",aP?` matching "${aP}"`:"","."]}),(0,b.jsx)("p",{children:'Click "Load Latest 5 Invoices" to fetch recent invoices.'})]})]})]}):(0,b.jsx)("div",{className:i.default.accessDenied,children:"Access denied to invoice management"})}])}];

//# sourceMappingURL=src_app_invoices_create_e842e5be._.js.map