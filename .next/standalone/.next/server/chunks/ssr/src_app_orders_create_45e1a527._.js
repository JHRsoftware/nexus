module.exports=[37946,a=>{a.v({actionSection:"order-module__97544G__actionSection",addedProducts:"order-module__97544G__addedProducts",backButton:"order-module__97544G__backButton",container:"order-module__97544G__container",creditLimitContainer:"order-module__97544G__creditLimitContainer",creditLimitGrid:"order-module__97544G__creditLimitGrid",creditLimitItem:"order-module__97544G__creditLimitItem",creditLimitLabel:"order-module__97544G__creditLimitLabel",creditLimitTitle:"order-module__97544G__creditLimitTitle",creditLimitValue:"order-module__97544G__creditLimitValue",draftButton:"order-module__97544G__draftButton",error:"order-module__97544G__error",field:"order-module__97544G__field",formGrid:"order-module__97544G__formGrid",header:"order-module__97544G__header",headerTop:"order-module__97544G__headerTop",input:"order-module__97544G__input",inputGroup:"order-module__97544G__inputGroup",inputLabel:"order-module__97544G__inputLabel",label:"order-module__97544G__label",loading:"order-module__97544G__loading",message:"order-module__97544G__message",negativeCredit:"order-module__97544G__negativeCredit",orderForm:"order-module__97544G__orderForm",overdueAmount:"order-module__97544G__overdueAmount",overdueDays:"order-module__97544G__overdueDays",overdueDueDate:"order-module__97544G__overdueDueDate",overdueInvoiceNumber:"order-module__97544G__overdueInvoiceNumber",overduePaymentItem:"order-module__97544G__overduePaymentItem",overduePaymentsList:"order-module__97544G__overduePaymentsList",overdueTotal:"order-module__97544G__overdueTotal",overdueWarning:"order-module__97544G__overdueWarning",overdueWarningText:"order-module__97544G__overdueWarningText",overdueWarningTitle:"order-module__97544G__overdueWarningTitle",positiveCredit:"order-module__97544G__positiveCredit",productCode:"order-module__97544G__productCode",productHeader:"order-module__97544G__productHeader",productInfo:"order-module__97544G__productInfo",productInput:"order-module__97544G__productInput",productInputs:"order-module__97544G__productInputs",productItem:"order-module__97544G__productItem",productName:"order-module__97544G__productName",productSearch:"order-module__97544G__productSearch",productStock:"order-module__97544G__productStock",productTotals:"order-module__97544G__productTotals",productsSection:"order-module__97544G__productsSection",pulseWarning:"order-module__97544G__pulseWarning",removeButton:"order-module__97544G__removeButton",resultDetails:"order-module__97544G__resultDetails",resultName:"order-module__97544G__resultName",searchContainer:"order-module__97544G__searchContainer",searchIcon:"order-module__97544G__searchIcon",searchInput:"order-module__97544G__searchInput",searchResult:"order-module__97544G__searchResult",searchResults:"order-module__97544G__searchResults",section:"order-module__97544G__section",sectionTitle:"order-module__97544G__sectionTitle",select:"order-module__97544G__select",submitButton:"order-module__97544G__submitButton",subtitle:"order-module__97544G__subtitle",success:"order-module__97544G__success",summaryGrid:"order-module__97544G__summaryGrid",summaryLabel:"order-module__97544G__summaryLabel",summaryRow:"order-module__97544G__summaryRow",summarySection:"order-module__97544G__summarySection",summaryValue:"order-module__97544G__summaryValue",textarea:"order-module__97544G__textarea",title:"order-module__97544G__title",toggleField:"order-module__97544G__toggleField",toggleInput:"order-module__97544G__toggleInput",toggleLabel:"order-module__97544G__toggleLabel",totalLabel:"order-module__97544G__totalLabel",totalPrice:"order-module__97544G__totalPrice",totalRow:"order-module__97544G__totalRow",totalValue:"order-module__97544G__totalValue"})},47694,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(89531),f=a.i(9453),g=a.i(11642),h=a.i(1075),i=a.i(37946);let j=()=>{let a,j,k,l,m,n,o,p,q,r=(0,d.useRouter)(),s=(0,d.useSearchParams)(),t=s?.get("editId"),u=!!t,{isAuthorized:v,isLoading:w}=(0,e.usePageProtection)("orders"),{isDarkMode:x}=(0,f.useTheme)(),{user:y}=(0,g.useAuth)(),[z,A]=(0,c.useState)(u),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(new Date().toISOString().split("T")[0]),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)([]),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)([]),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(""),[aj,ak]=(0,c.useState)([]),[al,am]=(0,c.useState)(!1),[an,ao]=(0,c.useState)([]),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)([]),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(""),[az,aA]=(0,c.useState)(""),[aB,aC]=(0,c.useState)(5),[aD,aE]=(0,c.useState)({hideSellingPrice:!1,hideDiscount:!1,hideFreeProducts:!1,hideCashDiscount:!1}),aF=()=>({"Content-Type":"application/json","x-user-data":JSON.stringify(y||{})});(0,c.useEffect)(()=>{v&&(aG(),aH(),u&&t&&aI())},[v,u,t]),(0,c.useEffect)(()=>{let a=a=>{let b=a.target;V&&!b.closest(".shop-search-container")&&W(!1),_&&!b.closest(".salesrep-search-container")&&aa(!1),af&&!b.closest(".product-search-container")&&ag(!1),al&&!b.closest(".freeproduct-search-container")&&am(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[V,_,af,al]);let aG=async()=>{try{let a=await fetch("/api/discounts"),b=await a.json();b.success&&ao(b.discounts.filter(a=>a.percentage>0))}catch(a){}},aH=async()=>{try{let a=await fetch("/api/softwareSettings",{headers:aF()}),b=await a.json();b.success&&b.settings&&(aC(b.settings.totalBalanceDiscountPercent||5),aE({hideSellingPrice:b.settings.hideSellingPrice||!1,hideDiscount:b.settings.hideDiscount||!1,hideFreeProducts:b.settings.hideFreeProducts||!1,hideCashDiscount:b.settings.hideCashDiscount||!1}))}catch(a){}},aI=async()=>{try{A(!0);let a=await fetch(`/api/orders/${t}`),b=await a.json();if(!b.success)return void aA(b.error||"Failed to load order");let c=b.order;if("pending"!==c.status.toLowerCase()){aA("Only pending orders can be edited"),setTimeout(()=>r.push("/orders"),2e3);return}C(c),E(new Date(c.orderDate).toISOString().split("T")[0]),G(c.shop),S(c.shop.shopName),c.salesRep&&(I(c.salesRep),Y(c.salesRep.name)),c.discount&&K(c.discount),O(c.notes||"");let d=c.orderItems.map((a,b)=>({id:`item-${a.id}-${b}`,productId:a.product.id,productCode:a.product.productCode,productName:0===a.sellingPrice?`${a.product.itemName} (FREE)`:a.product.itemName,quantity:Number(a.quantity)||0,sellingPrice:Number(a.sellingPrice)||0,discount:Number(a.discount)||0,availableQty:(a.product.availableQty||0)+(a.quantity||0),costPrice:a.product.availableQty>0?Number(a.product.totalCost)/a.product.availableQty:0}));Q(d)}catch(a){aA("Failed to load order")}finally{A(!1)}},aJ=(0,c.useCallback)(async a=>{if(a.length<2)return void U([]);try{let b=await fetch(`/api/shops?search=${encodeURIComponent(a)}&limit=10&activeOnly=true`),c=await b.json();c.success&&U(c.shops||[])}catch(a){}},[]),aK=(0,c.useCallback)(async a=>{if(a.length<2)return void $([]);try{let b=await fetch(`/api/sales-rep?search=${encodeURIComponent(a)}&activeOnly=true`),c=await b.json();c.success&&$(c.salesReps||[])}catch(a){}},[]),aL=(0,c.useCallback)(async a=>{if(a.length<2)return void ae([]);try{let b=await fetch(`/api/products/search?search=${encodeURIComponent(a)}&limit=10`),c=await b.json();c.success&&ae(c.products||[])}catch(a){}},[]),aM=(0,c.useCallback)(async a=>{if(a.length<2)return void ak([]);try{let b=await fetch(`/api/products/search?search=${encodeURIComponent(a)}&limit=10`),c=await b.json();c.success&&ak(c.products||[])}catch(a){}},[]);(0,c.useEffect)(()=>{let a=setTimeout(()=>{R&&(aJ(R),W(!0))},300);return()=>clearTimeout(a)},[R,aJ]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{X&&(aK(X),aa(!0))},300);return()=>clearTimeout(a)},[X,aK]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{ab&&(aL(ab),ag(!0))},300);return()=>clearTimeout(a)},[ab,aL]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{ah&&(aM(ah),am(!0))},300);return()=>clearTimeout(a)},[ah,aM]),(0,c.useEffect)(()=>{aP()},[P,F,J,L]);let aN=async a=>{G(a),S(a.shopName),W(!1),as([]),au(!1),await aQ(a.id)},aO=a=>{if(!F)return{isValid:!1,message:"Please select a shop first"};if(!J||"credit"!==J.discountName.toLowerCase())return{isValid:!0};let b=(F.creditLimit||0)-(F.balanceAmount||0);return a>b?{isValid:!1,message:`Order total (Rs ${a.toLocaleString()}) exceeds available credit (Rs ${b.toLocaleString()})`}:{isValid:!0}},aP=()=>{if(!F||0===P.length||!J||"credit"!==J.discountName.toLowerCase())return void aq(!1);let a=P.reduce((a,b)=>a+(b.quantity*b.sellingPrice-b.discount),0),b=a;if(J){let c=a*J.percentage/100;b=a-c}if(L){let a=b*aB/100;b-=a}aq(!aO(b).isValid)},aQ=async a=>{try{let b=await fetch(`/api/payments?shopId=${a}&status=due&limit=100`),c=await b.json();if(c.success){let a=c.payments.map(a=>{let b=new Date(a.dueDate),c=new Date;c.setHours(0,0,0,0),b.setHours(0,0,0,0);let d=Math.ceil((c.getTime()-b.getTime())/864e5);return{id:a.id,invoiceNumber:a.invoice.invoiceNumber,dueDate:a.dueDate,remainingAmount:Number(a.remainingAmount)||0,daysPastDue:Math.max(0,d)}});if(as(a),au(a.length>0),a.length>0){let b=a.reduce((a,b)=>a+Number(b.remainingAmount),0);aA(`âš ï¸ This shop has ${a.length} overdue payment(s) totaling Rs ${b.toLocaleString()}. Please settle overdue payments before creating new orders.`)}else az.includes("overdue payment")&&aA("")}}catch(a){}},aR=(a,b,c)=>{let d=P.map(d=>{if(d.id===a){let a={...d,[b]:c};return"quantity"===b&&c>d.availableQty?(aA(`Insufficient stock for ${d.productName}. Available: ${d.availableQty}`),d):a}return d}),e=d.reduce((a,b)=>a+(b.quantity*b.sellingPrice-b.discount),0),f=e;if(J){let a=e*J.percentage/100;f=e-a}if(L){let a=f*aB/100;f-=a}if(d.some((a,b)=>{let c=P[b];return!c||a.quantity!==c.quantity||a.sellingPrice!==c.sellingPrice||a.discount!==c.discount})){let a=aO(f);if(!a.isValid)return void aA(a.message||"Credit limit exceeded")}Q(d),aA("")},aS=(a=0,j=0,k=0,l=0,P.forEach(b=>{let c=b.sellingPrice*b.quantity,d=b.discount*b.quantity,e=b.costPrice*b.quantity;a+=c,j+=d,k+=e,l+=c-d-e}),m=0,J&&(m=a*(Number(J.percentage)/100)),n=0,L&&(n=aB/100*(a-m-j)),o=a-m-j-n,p=l-m-n,{subTotal:a,totalDiscount:j,invoiceTypeDiscount:m,cashDiscount:n,netTotal:o,totalCost:k,totalProfit:p}),aT=async()=>{let a=[];D||a.push("Order Date"),F||a.push("Shop"),H||a.push("Sales Representative"),J||a.push("Discount Type"),0===P.filter(a=>a.sellingPrice>0).length&&a.push("At least one regular product");let b=P.filter(a=>a.quantity<=0||a.quantity>a.availableQty);if(a.length>0||b.length>0){let c="";a.length>0&&(c+=`Missing required fields: ${a.join(", ")}`),b.length>0&&(c&&(c+=". "),c+=`Invalid quantities for: ${b.map(a=>a.productName).join(", ")}`),aA(c);return}aw(!0),aA(""),ay("");try{let a={orderDate:D,shopId:F.id,salesRepId:H?.id,discountId:J?.id,invoiceTypePercentage:J?Number(J.percentage):0,cashDiscountEnabled:L,notes:N,status:"PENDING",orderItems:P.map(a=>({productId:a.productId,quantity:a.quantity,sellingPrice:a.sellingPrice,discount:a.discount}))},b=u?`/api/orders/${t}`:"/api/orders",c=u?"PUT":"POST",d=await fetch(b,{method:c,headers:aF(),body:JSON.stringify(a)}),e=await d.json();e.success?(ay(u?"Order updated successfully!":"Order saved successfully!"),setTimeout(()=>{r.push("/orders")},2e3)):aA(e.error||`Failed to ${u?"update":"save"} order`)}catch(a){aA(`An error occurred while ${u?"updating":"saving"} the order`)}finally{aw(!1)}};return w?(0,b.jsx)("div",{className:i.default.loading,children:"Checking permissions..."}):z&&u?(0,b.jsx)("div",{className:i.default.loading,children:"Loading order data..."}):v?(0,b.jsxs)("div",{className:`${i.default.container} ${x?"dark":"light"}`,children:[(0,b.jsxs)("div",{className:i.default.header,children:[(0,b.jsx)("div",{className:i.default.headerTop,children:(0,b.jsx)("button",{type:"button",onClick:()=>r.push("/orders"),className:i.default.backButton,children:"â† Back"})}),(0,b.jsxs)("h1",{className:i.default.title,children:["ðŸ“‹ ",u?`Edit Order ${B?.orderNumber||""}`:"Create New Order"]}),(0,b.jsx)("p",{className:i.default.subtitle,children:u?"Edit existing order details":"Create orders that can be converted to invoices later"})]}),(0,b.jsxs)("form",{className:i.default.orderForm,onSubmit:a=>a.preventDefault(),children:[(0,b.jsxs)("div",{className:i.default.section,children:[(0,b.jsx)("h2",{className:i.default.sectionTitle,children:"ðŸ“… Order Information"}),(0,b.jsxs)("div",{className:i.default.formGrid,children:[(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Order Date *"}),(0,b.jsx)("input",{type:"date",value:D,onChange:a=>E(a.target.value),className:i.default.input,required:!0})]}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Discount Type *"}),(0,b.jsxs)("select",{value:J?.id||"",onChange:a=>{K(an.find(b=>b.id===parseInt(a.target.value))||null)},className:i.default.select,required:!0,children:[(0,b.jsx)("option",{value:"",children:"Select Discount Type"}),an.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.discountName," (",a.percentage,"%)"]},a.id))]})]})]}),(0,b.jsxs)("div",{className:i.default.formGrid,children:[(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Shop *"}),(0,b.jsxs)("div",{className:`${i.default.searchContainer} shop-search-container`,children:[(0,b.jsx)("input",{type:"text",placeholder:"Search shops...",value:R,onChange:a=>S(a.target.value),onFocus:()=>W(!0),className:i.default.searchInput,required:!0}),(0,b.jsx)("span",{className:i.default.searchIcon,children:"ðŸ”"}),V&&T.length>0&&(0,b.jsx)("div",{className:i.default.searchResults,children:T.map(a=>(0,b.jsxs)("div",{className:i.default.searchResult,onClick:()=>aN(a),children:[(0,b.jsx)("div",{className:i.default.resultName,children:a.shopName}),(0,b.jsxs)("div",{className:i.default.resultDetails,children:[a.ownerName," â€¢ ",a.contactNumber]})]},a.id))})]})]}),F&&(0,b.jsx)("div",{className:i.default.field,children:(0,b.jsxs)("div",{className:i.default.creditLimitContainer,children:[(0,b.jsx)("h3",{className:i.default.creditLimitTitle,children:"ðŸ’³ Credit Information"}),(0,b.jsxs)("div",{className:i.default.creditLimitGrid,children:[(0,b.jsxs)("div",{className:i.default.creditLimitItem,children:[(0,b.jsx)("span",{className:i.default.creditLimitLabel,children:"Credit Limit:"}),(0,b.jsxs)("span",{className:i.default.creditLimitValue,children:["Rs ",F.creditLimit?.toLocaleString()||"0"]})]}),(0,b.jsxs)("div",{className:i.default.creditLimitItem,children:[(0,b.jsx)("span",{className:i.default.creditLimitLabel,children:"Current Balance:"}),(0,b.jsxs)("span",{className:i.default.creditLimitValue,children:["Rs ",F.balanceAmount?.toLocaleString()||"0"]})]}),(0,b.jsxs)("div",{className:i.default.creditLimitItem,children:[(0,b.jsx)("span",{className:i.default.creditLimitLabel,children:"Available Credit:"}),(0,b.jsxs)("span",{className:`${i.default.creditLimitValue} ${(F.creditLimit||0)-(F.balanceAmount||0)>0?i.default.positiveCredit:i.default.negativeCredit}`,children:["Rs ",((F.creditLimit||0)-(F.balanceAmount||0)).toLocaleString()]})]})]})]})}),F&&at&&(0,b.jsx)("div",{className:i.default.field,children:(0,b.jsxs)("div",{className:i.default.overdueWarning,children:[(0,b.jsx)("h3",{className:i.default.overdueWarningTitle,children:"âš ï¸ Overdue Payments Alert"}),(0,b.jsxs)("p",{className:i.default.overdueWarningText,children:["This shop has ",ar.length," overdue payment(s). No orders can be created until all overdue payments are settled."]}),(0,b.jsx)("div",{className:i.default.overduePaymentsList,children:ar.map(a=>(0,b.jsxs)("div",{className:i.default.overduePaymentItem,children:[(0,b.jsxs)("span",{className:i.default.overdueInvoiceNumber,children:["Invoice: ",a.invoiceNumber]}),(0,b.jsxs)("span",{className:i.default.overdueDueDate,children:["Due: ",new Date(a.dueDate).toLocaleDateString()]}),(0,b.jsxs)("span",{className:i.default.overdueAmount,children:["Rs ",a.remainingAmount.toLocaleString()]}),(0,b.jsxs)("span",{className:i.default.overdueDays,children:[a.daysPastDue," days overdue"]})]},a.id))}),(0,b.jsxs)("div",{className:i.default.overdueTotal,children:["Total Overdue: Rs ",ar.reduce((a,b)=>a+Number(b.remainingAmount),0).toLocaleString()]})]})}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Sales Representative *"}),(0,b.jsxs)("div",{className:`${i.default.searchContainer} salesrep-search-container`,children:[(0,b.jsx)("input",{type:"text",placeholder:"Search sales reps...",value:X,onChange:a=>Y(a.target.value),onFocus:()=>aa(!0),className:i.default.searchInput,required:!0}),(0,b.jsx)("span",{className:i.default.searchIcon,children:"ðŸ‘¤"}),_&&Z.length>0&&(0,b.jsx)("div",{className:i.default.searchResults,children:Z.map(a=>(0,b.jsxs)("div",{className:i.default.searchResult,onClick:()=>{I(a),Y(a.name),aa(!1)},children:[(0,b.jsx)("div",{className:i.default.resultName,children:a.name}),(0,b.jsx)("div",{className:i.default.resultDetails,children:a.contactNumber})]},a.id))})]})]})]}),(0,b.jsxs)("div",{className:i.default.field,children:[(0,b.jsx)("label",{className:i.default.label,children:"Notes"}),(0,b.jsx)("textarea",{value:N,onChange:a=>O(a.target.value),placeholder:"Optional order notes...",className:i.default.textarea})]}),!aD.hideCashDiscount&&(0,b.jsx)("div",{className:i.default.toggleField,children:(0,b.jsxs)("label",{className:i.default.toggleLabel,children:[(0,b.jsx)("input",{type:"checkbox",checked:L,onChange:a=>M(a.target.checked),className:i.default.toggleInput}),(0,b.jsxs)("span",{children:["Enable Cash Discount (",aB,"%)"]})]})})]}),(0,b.jsxs)("div",{className:i.default.section,children:[(0,b.jsx)("h2",{className:i.default.sectionTitle,children:"ðŸ“¦ Order Items"}),(0,b.jsxs)("div",{className:i.default.productSearch,children:[(0,b.jsx)("label",{className:i.default.label,children:"Add Products"}),(0,b.jsxs)("div",{className:`${i.default.searchContainer} product-search-container`,children:[(0,b.jsx)("input",{type:"text",placeholder:"Search products to add...",value:ab,onChange:a=>ac(a.target.value),onFocus:()=>ag(!0),className:i.default.searchInput}),(0,b.jsx)("span",{className:i.default.searchIcon,children:"ðŸ“¦"}),af&&ad.length>0&&(0,b.jsx)("div",{className:i.default.searchResults,children:ad.map(a=>(0,b.jsxs)("div",{className:i.default.searchResult,onClick:()=>(a=>{if(P.find(b=>b.productId===a.id))return void aA("Product already added to order");let b={id:`item-${Date.now()}`,productId:a.id,productCode:a.productCode,productName:a.itemName,quantity:1,sellingPrice:Number(a.sellingPrice),discount:0,availableQty:a.availableQty,costPrice:a.availableQty>0?Number(a.totalCost)/a.availableQty:0},c=P.reduce((a,b)=>a+(b.quantity*b.sellingPrice-b.discount),0)+(b.quantity*b.sellingPrice-b.discount),d=c;if(J){let a=c*J.percentage/100;d=c-a}if(L){let a=d*aB/100;d-=a}let e=aO(d);e.isValid?(Q(a=>[...a,b]),ac(""),ag(!1),aA("")):aA(e.message||"Credit limit exceeded")})(a),children:[(0,b.jsx)("div",{className:i.default.resultName,children:a.itemName}),(0,b.jsxs)("div",{className:i.default.resultDetails,children:[a.productCode," â€¢ Stock: ",a.availableQty," â€¢ LKR ",Number(a.sellingPrice).toLocaleString()]})]},a.id))})]})]}),!aD.hideFreeProducts&&(0,b.jsxs)("div",{className:i.default.productSearch,children:[(0,b.jsx)("label",{className:i.default.label,children:"Add Free Products"}),(0,b.jsxs)("div",{className:`${i.default.searchContainer} freeproduct-search-container`,children:[(0,b.jsx)("input",{type:"text",placeholder:"Search products to add as free items (price = 0)...",value:ah,onChange:a=>ai(a.target.value),onFocus:()=>am(!0),className:i.default.searchInput}),(0,b.jsx)("span",{className:i.default.searchIcon,children:"ðŸ†“"}),al&&aj.length>0&&(0,b.jsx)("div",{className:i.default.searchResults,children:aj.map(a=>(0,b.jsxs)("div",{className:i.default.searchResult,onClick:()=>{let b;return b={id:`free-item-${Date.now()}-${a.id}-${Math.random()}`,productId:a.id,productCode:a.productCode,productName:`${a.itemName} (FREE)`,quantity:1,sellingPrice:0,discount:0,availableQty:a.availableQty,costPrice:a.availableQty>0?Number(a.totalCost)/a.availableQty:0},void(Q(a=>[...a,b]),ai(""),ak([]),am(!1),aA(""))},children:[(0,b.jsxs)("div",{className:i.default.resultName,children:[a.itemName," (FREE)"]}),(0,b.jsxs)("div",{className:i.default.resultDetails,children:[a.productCode," â€¢ Stock: ",a.availableQty," â€¢ Original: LKR ",Number(a.sellingPrice).toLocaleString()," â€¢ Free: LKR 0"]})]},`free-${a.id}`))})]})]}),(0,b.jsxs)("div",{className:i.default.addedProducts,children:[P.sort((a,b)=>0===a.sellingPrice&&0!==b.sellingPrice?1:0!==a.sellingPrice&&0===b.sellingPrice?-1:0).map(a=>(0,b.jsxs)("div",{className:i.default.productItem,children:[(0,b.jsxs)("div",{className:i.default.productHeader,children:[(0,b.jsxs)("div",{className:i.default.productInfo,children:[(0,b.jsx)("div",{className:i.default.productName,children:a.productName}),(0,b.jsxs)("div",{className:i.default.productCode,children:["Code: ",a.productCode]}),(0,b.jsxs)("div",{className:i.default.productStock,children:["Available: ",a.availableQty]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void Q(a=>a.filter(a=>a.id!==b))},className:i.default.removeButton,children:"ðŸ—‘ï¸"})]}),(0,b.jsxs)("div",{className:i.default.productInputs,children:[(0,b.jsxs)("div",{className:i.default.inputGroup,children:[(0,b.jsx)("label",{className:i.default.inputLabel,children:"Quantity"}),(0,b.jsx)("input",{type:"number",min:"1",max:a.availableQty,value:a.quantity,onWheel:h.handleNumberInputWheel,onChange:b=>aR(a.id,"quantity",parseInt(b.target.value)||1),className:i.default.productInput})]}),(0,b.jsxs)("div",{className:i.default.inputGroup,children:[(0,b.jsx)("label",{className:i.default.inputLabel,children:"Selling Price"}),(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.sellingPrice,onChange:b=>aR(a.id,"sellingPrice",parseFloat(b.target.value)||0),onWheel:h.handleNumberInputWheel,className:i.default.productInput,readOnly:0===a.sellingPrice||aD.hideSellingPrice,title:0===a.sellingPrice?"Free item - selling price cannot be changed":aD.hideSellingPrice?"Selling price is read-only (configured in settings)":""})]}),(0,b.jsxs)("div",{className:i.default.inputGroup,children:[(0,b.jsx)("label",{className:i.default.inputLabel,children:"Discount"}),(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.discount,onChange:b=>aR(a.id,"discount",parseFloat(b.target.value)||0),onWheel:h.handleNumberInputWheel,className:i.default.productInput,readOnly:0===a.sellingPrice||aD.hideDiscount,title:0===a.sellingPrice?"Free item - no additional discount can be applied":aD.hideDiscount?"Discount is read-only (configured in settings)":""})]}),(0,b.jsxs)("div",{className:i.default.inputGroup,children:[(0,b.jsx)("label",{className:i.default.inputLabel,children:"Price"}),(0,b.jsxs)("div",{className:i.default.productInput,style:{display:"flex",alignItems:"center"},children:["LKR ",((a.sellingPrice-a.discount)*a.quantity).toLocaleString()]})]}),(0,b.jsxs)("div",{className:i.default.inputGroup,children:[(0,b.jsx)("label",{className:i.default.inputLabel,children:"Total"}),(0,b.jsxs)("div",{className:i.default.productInput,style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:["LKR ",(a.sellingPrice*a.quantity).toLocaleString()]})]})]})]},a.id)),0===P.length&&(0,b.jsx)("div",{className:i.default.loading,children:"No products added yet. Search and add products above."})]})]}),P.length>0&&(0,b.jsxs)("div",{className:i.default.summarySection,children:[(0,b.jsx)("h2",{className:i.default.sectionTitle,children:"ðŸ’° Order Summary"}),(0,b.jsxs)("div",{className:i.default.summaryGrid,children:[(0,b.jsxs)("div",{className:i.default.summaryRow,children:[(0,b.jsx)("span",{className:i.default.summaryLabel,children:"Sub Total:"}),(0,b.jsxs)("span",{className:i.default.summaryValue,children:["LKR ",aS.subTotal.toLocaleString()]})]}),J&&(0,b.jsxs)("div",{className:i.default.summaryRow,children:[(0,b.jsxs)("span",{className:i.default.summaryLabel,children:[J.discountName," (",J.percentage,"%):"]}),(0,b.jsxs)("span",{className:i.default.summaryValue,children:["- LKR ",aS.invoiceTypeDiscount.toLocaleString()]})]}),aS.totalDiscount>0&&(0,b.jsxs)("div",{className:i.default.summaryRow,children:[(0,b.jsx)("span",{className:i.default.summaryLabel,children:"Item Discounts:"}),(0,b.jsxs)("span",{className:i.default.summaryValue,children:["- LKR ",aS.totalDiscount.toLocaleString()]})]}),L&&!aD.hideCashDiscount&&(0,b.jsxs)("div",{className:i.default.summaryRow,children:[(0,b.jsxs)("span",{className:i.default.summaryLabel,children:["Cash Discount (",aB,"%):"]}),(0,b.jsxs)("span",{className:i.default.summaryValue,children:["- LKR ",aS.cashDiscount.toLocaleString()]})]}),(0,b.jsxs)("div",{className:i.default.summaryRow,children:[(0,b.jsx)("span",{className:i.default.summaryLabel,children:"Net Total:"}),(0,b.jsxs)("span",{className:i.default.summaryValue,children:["LKR ",aS.netTotal.toLocaleString()]})]})]})]}),az&&(0,b.jsx)("div",{className:`${i.default.message} ${i.default.error}`,children:az}),ax&&(0,b.jsx)("div",{className:`${i.default.message} ${i.default.success}`,children:ax}),(0,b.jsxs)("div",{className:i.default.actionSection,children:[(0,b.jsx)("button",{type:"button",onClick:aT,disabled:(q=P.filter(a=>a.sellingPrice>0),!(D&&F&&H&&J&&q.length>0&&P.every(a=>a.quantity>0&&a.quantity<=a.availableQty))||av||ap||at),className:i.default.submitButton,children:av?u?"ï¿½ Updating...":"ï¿½ðŸ’¾ Saving...":u?"ðŸ“ Update Order":"ðŸ’¾ Save Order"}),ap&&(0,b.jsxs)("div",{className:`${i.default.message} ${i.default.error}`,children:["âš ï¸ Cannot ",u?"update":"save"," order: Available credit limit exceeded for credit payment"]}),at&&(0,b.jsxs)("div",{className:`${i.default.message} ${i.default.error}`,children:["âš ï¸ Cannot ",u?"update":"save"," order: Shop has overdue payments that must be settled first"]})]})]})]}):(0,b.jsx)("div",{className:i.default.loading,children:"Access denied to order management"})};a.s(["default",0,()=>(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{children:"Loading..."}),children:(0,b.jsx)(j,{})})])}];

//# sourceMappingURL=src_app_orders_create_45e1a527._.js.map