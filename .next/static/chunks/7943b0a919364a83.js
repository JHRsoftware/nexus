(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88742,e=>{e.v({accessDenied:"invoice-module__niiNsW__accessDenied",actions:"invoice-module__niiNsW__actions",activePage:"invoice-module__niiNsW__activePage",availableCredit:"invoice-module__niiNsW__availableCredit",cashDiscountLabel:"invoice-module__niiNsW__cashDiscountLabel",checkbox:"invoice-module__niiNsW__checkbox",clearButton:"invoice-module__niiNsW__clearButton",clearSelection:"invoice-module__niiNsW__clearSelection",container:"invoice-module__niiNsW__container",creditExceeded:"invoice-module__niiNsW__creditExceeded",dark:"invoice-module__niiNsW__dark",detailLabel:"invoice-module__niiNsW__detailLabel",detailValue:"invoice-module__niiNsW__detailValue",discount:"invoice-module__niiNsW__discount",discountInput:"invoice-module__niiNsW__discountInput",dropdown:"invoice-module__niiNsW__dropdown",dropdownItem:"invoice-module__niiNsW__dropdownItem",dropdownOpen:"invoice-module__niiNsW__dropdownOpen",ellipsis:"invoice-module__niiNsW__ellipsis",error:"invoice-module__niiNsW__error",fadeIn:"invoice-module__niiNsW__fadeIn",field:"invoice-module__niiNsW__field",form:"invoice-module__niiNsW__form",header:"invoice-module__niiNsW__header",input:"invoice-module__niiNsW__input",invoiceNumber:"invoice-module__niiNsW__invoiceNumber",invoiceTypeNotesRow:"invoice-module__niiNsW__invoiceTypeNotesRow",invoicesControls:"invoice-module__niiNsW__invoicesControls",invoicesHeader:"invoice-module__niiNsW__invoicesHeader",invoicesList:"invoice-module__niiNsW__invoicesList",invoicesTable:"invoice-module__niiNsW__invoicesTable",itemRow:"invoice-module__niiNsW__itemRow",itemsBody:"invoice-module__niiNsW__itemsBody",itemsHeader:"invoice-module__niiNsW__itemsHeader",itemsSection:"invoice-module__niiNsW__itemsSection",itemsTable:"invoice-module__niiNsW__itemsTable",label:"invoice-module__niiNsW__label",labelRow:"invoice-module__niiNsW__labelRow",loadButton:"invoice-module__niiNsW__loadButton",loading:"invoice-module__niiNsW__loading",netTotal:"invoice-module__niiNsW__netTotal",noInvoices:"invoice-module__niiNsW__noInvoices",noOrdersMessage:"invoice-module__niiNsW__noOrdersMessage",notes:"invoice-module__niiNsW__notes",notesInput:"invoice-module__niiNsW__notesInput",orderDate:"invoice-module__niiNsW__orderDate",orderInfo:"invoice-module__niiNsW__orderInfo",orderNotes:"invoice-module__niiNsW__orderNotes",orderTotal:"invoice-module__niiNsW__orderTotal",overdueAmount:"invoice-module__niiNsW__overdueAmount",overdueDays:"invoice-module__niiNsW__overdueDays",overdueInvoice:"invoice-module__niiNsW__overdueInvoice",overduePaymentItem:"invoice-module__niiNsW__overduePaymentItem",overduePaymentsList:"invoice-module__niiNsW__overduePaymentsList",overdueTotal:"invoice-module__niiNsW__overdueTotal",overdueTotalSection:"invoice-module__niiNsW__overdueTotalSection",overdueWarningCard:"invoice-module__niiNsW__overdueWarningCard",overdueWarningMessage:"invoice-module__niiNsW__overdueWarningMessage",overdueWarningSection:"invoice-module__niiNsW__overdueWarningSection",overdueWarningTitle:"invoice-module__niiNsW__overdueWarningTitle",pageButton:"invoice-module__niiNsW__pageButton",pagination:"invoice-module__niiNsW__pagination",paginationButtons:"invoice-module__niiNsW__paginationButtons",paginationInfo:"invoice-module__niiNsW__paginationInfo",price:"invoice-module__niiNsW__price",priceInput:"invoice-module__niiNsW__priceInput",printButton:"invoice-module__niiNsW__printButton",printInvoiceButton:"invoice-module__niiNsW__printInvoiceButton",printLastInvoiceButton:"invoice-module__niiNsW__printLastInvoiceButton",productCode:"invoice-module__niiNsW__productCode",productDetails:"invoice-module__niiNsW__productDetails",productInfo:"invoice-module__niiNsW__productInfo",productName:"invoice-module__niiNsW__productName",productSearchRow:"invoice-module__niiNsW__productSearchRow",productSearchSection:"invoice-module__niiNsW__productSearchSection",productTitle:"invoice-module__niiNsW__productTitle",profitRow:"invoice-module__niiNsW__profitRow",pulse:"invoice-module__niiNsW__pulse",pulseWarning:"invoice-module__niiNsW__pulseWarning",quantity:"invoice-module__niiNsW__quantity",quantityError:"invoice-module__niiNsW__quantityError",quantityInput:"invoice-module__niiNsW__quantityInput",removeButton:"invoice-module__niiNsW__removeButton",repContact:"invoice-module__niiNsW__repContact",repName:"invoice-module__niiNsW__repName",row:"invoice-module__niiNsW__row",searchButton:"invoice-module__niiNsW__searchButton",searchContainer:"invoice-module__niiNsW__searchContainer",searchInput:"invoice-module__niiNsW__searchInput",sectionTitle:"invoice-module__niiNsW__sectionTitle",select:"invoice-module__niiNsW__select",sellingPrice:"invoice-module__niiNsW__sellingPrice",shopDetailItem:"invoice-module__niiNsW__shopDetailItem",shopDetailsCard:"invoice-module__niiNsW__shopDetailsCard",shopDetailsGrid:"invoice-module__niiNsW__shopDetailsGrid",shopDetailsSection:"invoice-module__niiNsW__shopDetailsSection",shopDetailsTitle:"invoice-module__niiNsW__shopDetailsTitle",shopInfo:"invoice-module__niiNsW__shopInfo",shopName:"invoice-module__niiNsW__shopName",shopOwner:"invoice-module__niiNsW__shopOwner",showOrdersButton:"invoice-module__niiNsW__showOrdersButton",slideIn:"invoice-module__niiNsW__slideIn",submitButton:"invoice-module__niiNsW__submitButton",submitSection:"invoice-module__niiNsW__submitSection",subtitle:"invoice-module__niiNsW__subtitle",success:"invoice-module__niiNsW__success",tableBody:"invoice-module__niiNsW__tableBody",tableHeader:"invoice-module__niiNsW__tableHeader",tableRow:"invoice-module__niiNsW__tableRow",textarea:"invoice-module__niiNsW__textarea",title:"invoice-module__niiNsW__title",totalPrice:"invoice-module__niiNsW__totalPrice",totalRow:"invoice-module__niiNsW__totalRow",totalsGrid:"invoice-module__niiNsW__totalsGrid",totalsSection:"invoice-module__niiNsW__totalsSection",viewButton:"invoice-module__niiNsW__viewButton",viewModeLabel:"invoice-module__niiNsW__viewModeLabel"})},3077,e=>{"use strict";var t=e.i(43476),i=e.i(71645),a=e.i(18566),s=e.i(11870),l=e.i(75144),n=e.i(57951),o=e.i(89088),d=e.i(88742);e.s(["default",0,()=>{(0,a.useRouter)();let{isAuthorized:e,isLoading:c}=(0,s.usePageProtection)("invoices"),{isDarkMode:r}=(0,l.useTheme)(),{user:u}=(0,n.useAuth)(),m=e=>{if(!e)return"";let t=new Date(e),i=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return`${i}/${a}/${s}`},h=e=>{if(!e)return"";let[t,i,a]=e.split("/");return t&&i&&a&&t.length<=2&&i.length<=2&&4===a.length?`${a}-${i.padStart(2,"0")}-${t.padStart(2,"0")}`:""},v=e=>{let[t,i,a]=e.split("/");if(!t||!i||!a)return!1;let s=parseInt(t),l=parseInt(i),n=parseInt(a);if(isNaN(s)||isNaN(l)||isNaN(n))return!1;let o=new Date(n,l-1,s);return o.getDate()===s&&o.getMonth()+1===l&&o.getFullYear()===n},[p,_]=(0,i.useState)(new Date().toISOString().split("T")[0]),[N,f]=(0,i.useState)(m(new Date().toISOString().split("T")[0])),[g,x]=(0,i.useState)(null),[b,j]=(0,i.useState)(null),[y,w]=(0,i.useState)(!1),[S,C]=(0,i.useState)(""),[P,D]=(0,i.useState)(""),[W,I]=(0,i.useState)([]),[T,$]=(0,i.useState)(null),[L,R]=(0,i.useState)(""),[B,k]=(0,i.useState)(""),[O,q]=(0,i.useState)(""),[A,F]=(0,i.useState)(""),[E,Q]=(0,i.useState)([]),[K,M]=(0,i.useState)([]),[V,H]=(0,i.useState)([]),[U,Y]=(0,i.useState)([]),[G,J]=(0,i.useState)(null),[z,X]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)(!1),[et,ei]=(0,i.useState)(!1),[ea,es]=(0,i.useState)(""),[el,en]=(0,i.useState)([]),[eo,ed]=(0,i.useState)(!1),[ec,er]=(0,i.useState)(""),[eu,em]=(0,i.useState)([]),[eh,ev]=(0,i.useState)(null),[ep,e_]=(0,i.useState)(!1),[eN,ef]=(0,i.useState)(!1),[eg,ex]=(0,i.useState)([]),[eb,ej]=(0,i.useState)(!1),[ey,ew]=(0,i.useState)(""),[eS,eC]=(0,i.useState)(""),[eP,eD]=(0,i.useState)(!1),[eW,eI]=(0,i.useState)(null),[eT,e$]=(0,i.useState)([]),[eL,eR]=(0,i.useState)(!1),[eB,ek]=(0,i.useState)([]),[eO,eq]=(0,i.useState)(1),[eA,eF]=(0,i.useState)({currentPage:1,totalPages:1,totalCount:0,hasNext:!1,hasPrev:!1}),[eE,eQ]=(0,i.useState)(""),[eK,eM]=(0,i.useState)(!1),[eV,eH]=(0,i.useState)(null),[eU,eY]=(0,i.useState)(null),[eG,eJ]=(0,i.useState)({isSellingPriceReadonly:!1,isDiscountReadonly:!1,showTotalDiscountFromItems:!0,showTotalBalanceDiscount:!1,totalBalanceDiscountPercent:5,hideCostProfit:!1}),ez=()=>({"Content-Type":"application/json","x-user-data":JSON.stringify(u||{})});(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/discounts"),t=await e.json();t.success&&M(t.discounts.filter(e=>e.percentage>0))}catch(e){}})()},[]),(0,i.useEffect)(()=>{(async()=>{try{if(u){let e=await fetch("/api/softwareSettings",{headers:ez()}),t=await e.json();if(t.success&&t.settings){let e={isSellingPriceReadonly:1===t.settings.isSellingPriceReadonly||!0===t.settings.isSellingPriceReadonly,isDiscountReadonly:1===t.settings.isDiscountReadonly||!0===t.settings.isDiscountReadonly,showTotalDiscountFromItems:1!==t.settings.showTotalDiscountFromItems&&!0!==t.settings.showTotalDiscountFromItems,showTotalBalanceDiscount:1!==t.settings.showTotalBalanceDiscount&&!0!==t.settings.showTotalBalanceDiscount,totalBalanceDiscountPercent:t.settings.totalBalanceDiscountPercent||5,hideCostProfit:1===t.settings.hideCostProfit||!0===t.settings.hideCostProfit};eJ(e)}}}catch(e){}})()},[u]),(0,i.useEffect)(()=>{let e=async()=>{try{if(u){let e=await fetch("/api/softwareSettings",{headers:ez()});if(e.ok){let t=await e.json();if(t.success&&t.settings&&t.settings.dueDateOptions){I(t.settings.dueDateOptions);let e=t.settings.dueDateOptions.find(e=>e.isDefault);e&&$(e)}}}}catch(e){}};u&&e()},[u]),(0,i.useEffect)(()=>{},[eg,eK]);let eX=(0,i.useCallback)(async e=>{if(e.length<2)return void Q([]);try{let t=await fetch(`/api/shops?search=${encodeURIComponent(e)}&limit=10&activeOnly=true`),i=await t.json();i.success&&Q(i.shops||[])}catch(e){}},[]),eZ=(0,i.useCallback)(async e=>{if(e.length<2)return void H([]);try{let t=await fetch(`/api/products/search?search=${encodeURIComponent(e)}&limit=10`),i=await t.json();i.success&&H(i.products||[])}catch(e){}},[]),e0=(0,i.useCallback)(async e=>{if(e.length<2)return void en([]);try{let t=await fetch(`/api/products/search?search=${encodeURIComponent(e)}&limit=10`),i=await t.json();i.success&&en(i.products||[])}catch(e){}},[]),e1=(0,i.useCallback)(async e=>{try{let t=await fetch(`/api/sales-rep?search=${encodeURIComponent(e)}&activeOnly=true`),i=await t.json();if(i.success){let e=i.salesReps?.filter(e=>"active"===e.status)||[];Y(e)}}catch(e){}},[]);(0,i.useCallback)(async e=>{try{let t=await fetch(`/api/orders/search?search=${encodeURIComponent(e)}&status=pending`);if(t.ok){let e=await t.json();e.success&&Array.isArray(e.orders)?em(e.orders):em([])}}catch(e){em([])}},[]);let e2=async()=>{try{let e=await fetch("/api/orders/search?search=&status=pending&limit=100");if(e.ok){let t=await e.json();t.success&&Array.isArray(t.orders)?(em(t.orders),ef(!0),e_(!0)):(em([]),alert("No pending orders found"))}}catch(e){alert("Failed to load orders. Please try again.")}};(0,i.useEffect)(()=>{let e=setTimeout(()=>{B&&eX(B)},300);return()=>clearTimeout(e)},[B,eX]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{O&&eZ(O)},300);return()=>clearTimeout(e)},[O,eZ]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{A&&e1(A)},300);return()=>clearTimeout(e)},[A,e1]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{ea&&e0(ea)},300);return()=>clearTimeout(e)},[ea,e0]);let e5=async e=>{try{let t=await fetch(`/api/orders/${e.id}`);if(!t.ok)throw Error("Failed to fetch order details");let i=await t.json(),a=i.success?i.order:null;if(!a||!a.orderItems)return void alert("Unable to load order details. Please try again.");if(a.status?.toLowerCase()!=="pending")return void alert("Only pending orders can be converted to invoices. This order status is: "+(a.status||"Unknown"));ev(a),a.shop&&(x(a.shop),k(a.shop.shopName)),a.salesRep&&(J(a.salesRep),F(a.salesRep.name)),a.discount&&j(a.discount),a.cashDiscountEnabled&&w(a.cashDiscountEnabled),a.notes&&R(a.notes);let s=a.orderItems.map(e=>({id:`${Date.now()}_${Math.random()}`,productId:e.product.id,productCode:e.product.productCode,productName:e.product.itemName,quantity:e.quantity,sellingPrice:Number(e.sellingPrice),discount:Number(e.discount||0),price:Number(e.price),totalPrice:Number(e.totalPrice),availableQty:e.product.availableQty,costPrice:Number(e.product.totalCost||0)}));ex(s),e_(!1),er(`Order #${a.id} - ${a.shop?.shopName||"N/A"}`)}catch(e){alert("Failed to load order details. Please try again.")}},e3=(e,t,i)=>{ex(a=>a.map(a=>{if(a.id===e){let e=Number(i);"quantity"===t&&(e<=0?(e=1,eC(`Quantity must be at least 1 for ${a.productName}`)):e>a.availableQty?(eC(`Cannot save invoice! Quantity ${e} exceeds available stock (${a.availableQty}) for ${a.productName}. Maximum allowed: ${a.availableQty}`),e=a.availableQty):eC(""));let s={...a,[t]:e};return s.price=Number(s.quantity)*Number(s.sellingPrice),s.totalPrice=s.price-Number(s.discount),s}return a}))},e4=i.default.useMemo(()=>{let e=eg.reduce((e,t)=>e+Number(t.totalPrice),0),t=eg.reduce((e,t)=>e+Number(t.discount),0),i=b?Number(e)*(parseFloat(b.percentage.toString())/100):0,a=y?Number(e)*(eG.totalBalanceDiscountPercent/100):0,s=Number(e)-Number(i)-Number(a),l=0,n=0;return eg.forEach(e=>{let t=(e.costPrice||0)*e.quantity;l+=t;let i=Number(e.totalPrice),a=b?i*(parseFloat(b.percentage.toString())/100):0,s=y?i*(eG.totalBalanceDiscountPercent/100):0;n+=i-a-s-t}),{subTotal:Number(e),totalDiscount:Number(t),invoiceTypeDiscount:Number(i),cashDiscount:Number(a),netTotal:Number(s),totalCost:Number(l),totalProfit:Number(n)}},[eg,y,b,eG.totalBalanceDiscountPercent]);(0,i.useEffect)(()=>{if(e8()&&p&&T){let e=new Date(new Date(p));e.setDate(e.getDate()+T.days);let t=e.toISOString().split("T")[0];C(t),D(m(t))}else C(""),D("")},[p,b,T]);let e8=()=>b?.discountName?.toLowerCase().includes("credit")||!1,e7=async e=>{try{let t=await fetch(`/api/payments?shopId=${e}&status=due&limit=100`),i=await t.json();if(i.success){let e=i.payments.map(e=>{let t=new Date(e.dueDate),i=new Date;i.setHours(0,0,0,0),t.setHours(0,0,0,0);let a=Math.ceil((i.getTime()-t.getTime())/864e5);return{id:e.id,invoiceNumber:e.invoice.invoiceNumber,dueDate:e.dueDate,remainingAmount:Number(e.remainingAmount)||0,daysPastDue:Math.max(0,a)}});if(e$(e),eR(e.length>0),e.length>0){let t=e.reduce((e,t)=>e+Number(t.remainingAmount),0);eC(`âš ï¸ This shop has ${e.length} overdue payment(s) totaling LKR ${t.toLocaleString()}. Please settle overdue payments before creating new credit invoices.`)}}}catch(e){}},e6=()=>eg.some(e=>e.quantity<=0||e.quantity>e.availableQty),e9=async e=>{if(e.preventDefault(),!g)return void eC("Please select a shop");if(!G)return void eC("Please select a sales representative");if(!b)return void eC("Please select an invoice type");if(0===eg.length)return void eC("Please add at least one product");if(e8()&&eL){let e=eT.reduce((e,t)=>e+Number(t.remainingAmount),0);eC(`âŒ Cannot create credit invoice! This shop has ${eT.length} overdue payment(s) totaling LKR ${e.toLocaleString()}. Please settle all overdue payments before creating new credit invoices.`);return}let t=[];for(let e of eg)e.quantity>e.availableQty&&t.push(`${e.productName}: Requested ${e.quantity}, Available ${e.availableQty}`),e.quantity<=0&&t.push(`${e.productName}: Invalid quantity ${e.quantity}`);if(t.length>0)return void eC(`Cannot save invoice! Stock validation failed:
${t.join("\n")}
Please adjust quantities before saving.`);if(e8()&&!(()=>{if(!g||!e8())return!0;let e=(g.creditLimit||0)-(g.balanceAmount||0);return e4.netTotal<=e})()){let e=(g.creditLimit||0)-(g.balanceAmount||0);eC(`Credit limit exceeded! Available credit: LKR ${e.toLocaleString()}. Invoice total: LKR ${e4.netTotal.toLocaleString()}`);return}ej(!0),eC(""),ew("");try{let e={...eP&&{id:eW?.id},invoiceDate:p,shopId:g.id,salesRepId:G.id,discountId:b?.id||null,invoiceType:b?.discountName||null,invoiceTypePercentage:b?.percentage||null,cashDiscountEnabled:y,...e8()&&S&&{dueDate:S},...eh&&{orderNumber:eh.orderNumber},notes:L||null,items:eg.map(e=>({productId:e.productId,quantity:e.quantity,sellingPrice:e.sellingPrice,discount:e.discount}))},t=await fetch("/api/invoices",{method:eP?"PUT":"POST",headers:ez(),body:JSON.stringify(e)}),i=await t.json();if(i.success){ew(i.message);let e=i.invoice?.id;e&&!eP&&eY(e),setTimeout(()=>{eP||te(),ew("")},2e3),e&&!eP&&setTimeout(()=>{window.confirm("Invoice created successfully! Would you like to print it now?")&&window.open(`/invoices/print/${e}`,"_blank")},2500)}else eC(i.error||"Operation failed")}catch(e){eC("An error occurred while processing the invoice")}finally{ej(!1)}},te=()=>{let e=new Date().toISOString().split("T")[0];_(e),f(m(e)),x(null),J(null),j(null),w(!1),C(""),D(""),R(""),ex([]),k(""),F(""),q(""),es(""),X(!1),ei(!1),ee(!1),ed(!1),en([]),eD(!1),eI(null),eC(""),ew(""),e$([]),eR(!1)},tt=(0,i.useCallback)(async(e=1,t="")=>{ej(!0);try{let i=new URLSearchParams({page:e.toString(),limit:"5",search:t.trim()}),a=await fetch(`/api/invoices?${i}`,{headers:ez()}),s=await a.json();s.success?(ek(s.invoices),eF(s.pagination),eq(e)):(eC(s.error||"Failed to load invoices"),ek([]))}catch(e){eC("An error occurred while loading invoices"),ek([])}finally{ej(!1)}},[]),ti=async e=>{try{let t=await fetch(`/api/invoices/${e.id}`,{headers:ez()}),i=await t.json();if(i.success&&i.invoice){let e=i.invoice;eM(!0),eH(e),_(new Date(e.invoiceDate).toISOString().split("T")[0]),f(new Date(e.invoiceDate).toLocaleDateString("en-GB")),x(e.shop),k(e.shop.shopName),e.salesRep&&(J(e.salesRep),F(e.salesRep.name)),e.discount&&j(e.discount),w(e.cashDiscountEnabled||!1),R(e.notes||""),e.dueDate&&(C(new Date(e.dueDate).toISOString().split("T")[0]),D(new Date(e.dueDate).toLocaleDateString("en-GB")));let t=(e.invoiceItems||[]).map(e=>({id:`view-${e.productId}-${Date.now()}-${Math.random()}`,productId:e.productId,productCode:e.productCode||"",productName:e.productName||"",quantity:Number(e.quantity||0),sellingPrice:Number(e.sellingPrice||0),discount:Number(e.discount||0),price:Number(e.price||0),totalPrice:Number(e.totalPrice||0),availableQty:Number(e.availableQty||0),costPrice:Number(e.costPrice||0)}));ex(t),window.scrollTo({top:0,behavior:"smooth"})}else alert("Failed to load invoice details")}catch(e){alert("An error occurred while loading invoice details")}},ta=e=>{eQ(e),tt(1,e)},ts=e=>{e>=1&&e<=eA.totalPages&&!eb&&tt(e,eE)};return c?(0,t.jsx)("div",{className:d.default.loading,children:"Checking permissions..."}):e?(0,t.jsxs)("div",{className:`${d.default.container} ${r?"dark":"light"}`,children:[(0,t.jsxs)("div",{className:d.default.header,children:[(0,t.jsx)("h1",{className:d.default.title,children:eK?`View Invoice - ${eV?.invoiceNumber}`:eP?"Edit Invoice":"Create Invoice"}),(0,t.jsx)("p",{className:d.default.subtitle,children:eK?"Viewing invoice details (read-only mode)":eP?"Edit invoice details":"Create and manage invoices for your business"}),(eP||eK)&&(0,t.jsx)("button",{type:"button",onClick:eK?()=>{eM(!1),eH(null),te()}:te,className:d.default.clearButton,children:eK?"Back to Create":"Cancel Edit"})]}),(0,t.jsxs)("form",{onSubmit:e9,className:d.default.form,children:[(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsxs)("div",{className:d.default.labelRow,children:[(0,t.jsx)("label",{className:d.default.label,children:"Load from Order (Optional):"}),(0,t.jsx)("button",{type:"button",onClick:e2,className:d.default.showOrdersButton,disabled:eb,children:"Show Orders"})]}),(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",value:eh?`Order #${eh.id} - ${eh.shop?.shopName||"N/A"}`:ec,onChange:e=>{if(!eh&&eN){let t=e.target.value;er(t),t.trim()?em(eu.filter(e=>e.orderNumber.toLowerCase().includes(t.toLowerCase())||e.shop?.shopName?.toLowerCase().includes(t.toLowerCase())||e.notes?.toLowerCase().includes(t.toLowerCase()))):e2(),e_(!0)}},onFocus:()=>{eN&&e_(!0)},onBlur:()=>{setTimeout(()=>e_(!1),150)},placeholder:eN?"Search loaded orders...":"Click 'Show Orders' to load orders first",className:d.default.input,disabled:eb||!eN}),eh&&(0,t.jsx)("button",{type:"button",onClick:()=>{ev(null),er(""),e_(!1),ef(!1),em([])},className:d.default.clearButton,disabled:eb,children:"Clear Order"}),ep&&eN&&eu.length>0&&(0,t.jsx)("div",{className:d.default.dropdown,children:eu.map(e=>(0,t.jsx)("div",{className:d.default.dropdownItem,onClick:()=>e5(e),children:(0,t.jsxs)("div",{className:d.default.orderInfo,children:[(0,t.jsxs)("strong",{children:["Order #",e.id]}),(0,t.jsx)("span",{className:d.default.shopName,children:e.shop?.shopName||"N/A"}),(0,t.jsx)("span",{className:d.default.orderDate,children:new Date(e.orderDate).toLocaleDateString()}),(0,t.jsxs)("span",{className:d.default.orderTotal,children:["Rs. ",Number(e.netTotal||0).toFixed(2)]}),e.notes&&(0,t.jsx)("span",{className:d.default.orderNotes,children:e.notes})]})},e.id))}),ep&&eN&&0===eu.length&&(0,t.jsx)("div",{className:d.default.dropdown,children:(0,t.jsxs)("div",{className:d.default.noOrdersMessage,children:["No pending orders found",ec?` matching "${ec}"`:""]})})]})]}),(0,t.jsxs)("div",{className:d.default.row,children:[(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Invoice Date: *"}),(0,t.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:N,onChange:e=>{let t=e.target.value;f(t);let i=t.replace(/[^\d]/g,"");if(i.length>=3&&i.length<=4?i=i.replace(/(\d{2})(\d{1,2})/,"$1/$2"):i.length>=5&&(i=i.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),i!==t&&i.length<=10&&f(i),v(i)){let e=h(i);e&&_(e)}},onBlur:e=>{if(!v(e.target.value)){let e=new Date().toISOString().split("T")[0];_(e),f(m(e))}},className:d.default.input,disabled:eb,required:!0,maxLength:10})]}),(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Select Sales Rep: *"}),(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",value:G?`${G.name} (${G.contactNumber})`:A,onChange:e=>{if(!G){let t=e.target.value;F(t),ei(t.length>0)}},onFocus:()=>ei(!0),onBlur:()=>{setTimeout(()=>ei(!1),150)},placeholder:"Type to search sales representatives...",className:d.default.input,disabled:eb,required:!0}),G&&(0,t.jsx)("button",{type:"button",onClick:()=>{J(null),F(""),ei(!1)},className:d.default.clearSelection,disabled:eb,children:"Ã—"}),et&&U.length>0&&(0,t.jsx)("div",{className:d.default.dropdown,children:U.map(e=>(0,t.jsxs)("div",{className:d.default.dropdownItem,onClick:()=>{J(e),F(""),ei(!1)},children:[(0,t.jsx)("div",{className:d.default.repName,children:e.name}),(0,t.jsx)("div",{className:d.default.repContact,children:e.contactNumber})]},e.id))})]})]}),(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Select Shop/Customer: *"}),(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",value:g?`${g.shopName} (${g.ownerName})`:B,onChange:e=>{if(!g){let t=e.target.value;k(t),X(t.length>0)}},onFocus:()=>X(!0),onBlur:()=>{setTimeout(()=>X(!1),150)},placeholder:"Search shop by name or owner...",className:d.default.input,disabled:eb,required:!0}),g&&(0,t.jsx)("button",{type:"button",onClick:()=>{x(null),k(""),X(!1)},className:d.default.clearSelection,children:"Ã—"}),z&&E.length>0&&!g&&(0,t.jsx)("div",{className:d.default.dropdown,children:E.map(e=>(0,t.jsx)("div",{onClick:async()=>{x(e),k(""),X(!1),eC(""),e$([]),eR(!1),await e7(e.id)},className:d.default.dropdownItem,children:(0,t.jsxs)("div",{className:d.default.shopInfo,children:[(0,t.jsx)("div",{className:d.default.shopName,children:e.shopName}),(0,t.jsxs)("div",{className:d.default.shopOwner,children:[e.ownerName," â€¢ ",e.contactNumber]})]})},e.id))})]})]})]}),g&&(0,t.jsx)("div",{className:d.default.shopDetailsSection,children:(0,t.jsxs)("div",{className:d.default.shopDetailsCard,children:[(0,t.jsx)("h3",{className:d.default.shopDetailsTitle,children:"Shop Information"}),(0,t.jsxs)("div",{className:d.default.shopDetailsGrid,children:[(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Shop Name:"}),(0,t.jsx)("span",{className:d.default.detailValue,children:g.shopName})]}),(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Owner:"}),(0,t.jsx)("span",{className:d.default.detailValue,children:g.ownerName})]}),(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Contact:"}),(0,t.jsx)("span",{className:d.default.detailValue,children:g.contactNumber})]}),(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Credit Limit:"}),(0,t.jsxs)("span",{className:d.default.detailValue,children:["LKR ",g.creditLimit?.toLocaleString()||"0"]})]}),(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Current Balance:"}),(0,t.jsxs)("span",{className:d.default.detailValue,children:["LKR ",g.balanceAmount?.toLocaleString()||"0"]})]}),(0,t.jsxs)("div",{className:d.default.shopDetailItem,children:[(0,t.jsx)("span",{className:d.default.detailLabel,children:"Available Credit:"}),(0,t.jsxs)("span",{className:`${d.default.detailValue} ${(g.creditLimit||0)-(g.balanceAmount||0)<=0?d.default.creditExceeded:d.default.availableCredit}`,children:["LKR ",((g.creditLimit||0)-(g.balanceAmount||0)).toLocaleString()]})]})]})]})}),g&&eL&&(0,t.jsx)("div",{className:d.default.overdueWarningSection,children:(0,t.jsxs)("div",{className:d.default.overdueWarningCard,children:[(0,t.jsx)("h3",{className:d.default.overdueWarningTitle,children:"âš ï¸ Overdue Payments Alert"}),(0,t.jsxs)("p",{className:d.default.overdueWarningMessage,children:["This shop has ",eT.length," overdue payment(s). Credit invoices cannot be created until all overdue payments are settled."]}),(0,t.jsx)("div",{className:d.default.overduePaymentsList,children:eT.map(e=>(0,t.jsxs)("div",{className:d.default.overduePaymentItem,children:[(0,t.jsxs)("div",{className:d.default.overdueInvoice,children:["Invoice: ",e.invoiceNumber]}),(0,t.jsxs)("div",{className:d.default.overdueDays,children:[e.daysPastDue," days overdue"]}),(0,t.jsxs)("div",{className:d.default.overdueAmount,children:["LKR ",Number(e.remainingAmount).toLocaleString()]})]},e.id))}),(0,t.jsx)("div",{className:d.default.overdueTotalSection,children:(0,t.jsxs)("strong",{className:d.default.overdueTotal,children:["Total Overdue: LKR ",eT.reduce((e,t)=>e+Number(t.remainingAmount),0).toLocaleString()]})})]})}),(0,t.jsxs)("div",{className:d.default.invoiceTypeNotesRow,children:[(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Invoice Type: *"}),(0,t.jsxs)("select",{value:b?.id||"",onChange:e=>{let t=e.target.value;j(K.find(e=>e.id.toString()===t)||null)},className:d.default.input,disabled:eb,required:!0,children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Select Invoice Type"}),K.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.discountName," Discount (",e.percentage,"%)"]},e.id))]})]}),(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Notes:"}),(0,t.jsx)("textarea",{value:L,onChange:e=>R(e.target.value),placeholder:"Enter any additional notes for this invoice...",className:d.default.notesInput,disabled:eb,rows:1})]}),e8()&&(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Payment Terms:"}),(0,t.jsxs)("select",{value:T?`${T.label}-${T.days}`:"",onChange:e=>{let[t,i]=e.target.value.split("-"),a=parseInt(i),s=W.find(e=>e.label===t&&e.days===a);s&&$(s)},className:d.default.select,disabled:eb,children:[(0,t.jsx)("option",{value:"",children:"Select Payment Terms"}),W.map((e,i)=>(0,t.jsxs)("option",{value:`${e.label}-${e.days}`,children:[e.label," (",e.days," days) ",e.isDefault?"- Default":""]},i))]})]})]}),e8()&&S&&(0,t.jsx)("div",{className:d.default.row,children:(0,t.jsxs)("div",{className:d.default.field,children:[(0,t.jsx)("label",{className:d.default.label,children:"Payment Due Date:"}),(0,t.jsx)("input",{type:"text",placeholder:"DD/MM/YYYY",value:P,onChange:e=>{let t=e.target.value;D(t);let i=t.replace(/[^\d]/g,"");if(i.length>=3&&i.length<=4?i=i.replace(/(\d{2})(\d{1,2})/,"$1/$2"):i.length>=5&&(i=i.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3")),i!==t&&i.length<=10&&D(i),v(i)){let e=h(i);e&&C(e)}},onBlur:e=>{!v(e.target.value)&&S&&D(m(S))},className:d.default.input,disabled:eb,maxLength:10}),(0,t.jsxs)("small",{style:{color:"#666",fontSize:"0.85em",marginTop:"4px",display:"block"},children:["ðŸ’¡ Calculated from: Invoice Date + ",T?.days||0," days"]})]})}),(0,t.jsxs)("div",{className:d.default.productSearchRow,children:[(0,t.jsxs)("div",{className:d.default.productSearchSection,children:[(0,t.jsx)("label",{className:d.default.label,children:"Add Products:"}),(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",value:O,onChange:e=>{let t=e.target.value;q(t),ee(t.length>0)},onFocus:()=>ee(!0),onBlur:()=>{setTimeout(()=>ee(!1),150)},placeholder:"Search products by code or name...",className:d.default.input,disabled:eb}),Z&&V.length>0&&(0,t.jsx)("div",{className:d.default.dropdown,children:V.map(e=>(0,t.jsx)("div",{onClick:()=>(e=>{let t=eg.find(t=>t.productId===e.id);if(t){let i=Number(t.quantity)+1,a=e.availableQty-1;if(i>a)return void eC(`Cannot add more ${e.itemName}. Must maintain minimum stock of 1. Maximum for sale: ${a}`);ex(t=>t.map(t=>{if(t.productId===e.id){let e=i*Number(t.sellingPrice),a=e-Number(t.discount);return{...t,quantity:i,price:e,totalPrice:a}}return t}))}else{if(e.availableQty-1<1)return void eC(`Cannot add ${e.itemName}. Must maintain minimum stock of 1. Current stock: ${e.availableQty}`);let t=Number(e.sellingPrice),i=+t,a={id:`item-${Date.now()}-${e.id}`,productId:e.id,productCode:e.productCode,productName:e.itemName,quantity:1,sellingPrice:t,discount:0,price:i,totalPrice:i-0,availableQty:e.availableQty,costPrice:e.costPrice||0};ex(e=>[...e,a])}q(""),H([]),ee(!1)})(e),className:d.default.dropdownItem,children:(0,t.jsxs)("div",{className:d.default.productInfo,children:[(0,t.jsxs)("div",{className:d.default.productName,children:[(0,t.jsx)("span",{className:d.default.productCode,children:e.productCode}),(0,t.jsx)("span",{className:d.default.productTitle,children:e.itemName})]}),(0,t.jsxs)("div",{className:d.default.productDetails,children:[(0,t.jsxs)("span",{children:["Price: LKR ",e.sellingPrice.toLocaleString()]}),(0,t.jsxs)("span",{children:["Available: ",e.availableQty]}),(0,t.jsxs)("span",{children:["Category: ",e.category]})]})]})},e.id))})]})]}),(0,t.jsxs)("div",{className:d.default.productSearchSection,children:[(0,t.jsx)("label",{className:d.default.label,children:"Add Free Products:"}),(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",value:ea,onChange:e=>{let t=e.target.value;es(t),ed(t.length>0)},onFocus:()=>ed(!0),onBlur:()=>{setTimeout(()=>ed(!1),150)},placeholder:"Search products to add as free items (price = 0)...",className:d.default.input,disabled:eb}),eo&&el.length>0&&(0,t.jsx)("div",{className:d.default.dropdown,children:el.map(e=>(0,t.jsx)("div",{onClick:()=>(e=>{if(e.availableQty-1<1)return void eC(`Cannot add ${e.itemName}. Must maintain minimum stock of 1. Current stock: ${e.availableQty}`);let t={id:`free-item-${Date.now()}-${e.id}-${Math.random()}`,productId:e.id,productCode:e.productCode,productName:`${e.itemName} (FREE)`,quantity:1,sellingPrice:0,discount:0,price:0,totalPrice:0,availableQty:e.availableQty,costPrice:e.costPrice||0};ex(e=>[...e,t]),es(""),en([]),ed(!1)})(e),className:d.default.dropdownItem,children:(0,t.jsxs)("div",{className:d.default.productInfo,children:[(0,t.jsxs)("div",{className:d.default.productName,children:[(0,t.jsx)("span",{className:d.default.productCode,children:e.productCode}),(0,t.jsxs)("span",{className:d.default.productTitle,children:[e.itemName," (FREE)"]})]}),(0,t.jsxs)("div",{className:d.default.productDetails,children:[(0,t.jsxs)("span",{children:["Original Price: LKR ",e.sellingPrice.toLocaleString()]}),(0,t.jsx)("span",{children:"Free Price: LKR 0"}),(0,t.jsxs)("span",{children:["Available: ",e.availableQty]}),(0,t.jsxs)("span",{children:["Category: ",e.category]})]})]})},`free-${e.id}`))})]})]})]}),eg.length>0&&(0,t.jsxs)("div",{className:d.default.itemsSection,children:[(0,t.jsx)("h3",{className:d.default.sectionTitle,children:"Invoice Items"}),(0,t.jsxs)("div",{className:d.default.itemsTable,children:[(0,t.jsxs)("div",{className:`${d.default.itemsHeader} ${!eG.showTotalDiscountFromItems?d.default.itemsHeaderNoDiscount:""}`,children:[(0,t.jsx)("div",{children:"Product Code"}),(0,t.jsx)("div",{children:"Product Name"}),(0,t.jsx)("div",{children:"Qty"}),(0,t.jsx)("div",{children:"Selling Price"}),eG.showTotalDiscountFromItems&&(0,t.jsx)("div",{children:"Discount"}),(0,t.jsx)("div",{children:"Price"}),!eG.hideCostProfit&&(0,t.jsx)("div",{children:"Cost"}),!eG.hideCostProfit&&(0,t.jsx)("div",{children:"Profit"}),(0,t.jsx)("div",{children:"Total Price"}),(0,t.jsx)("div",{children:"Actions"})]}),(0,t.jsx)("div",{className:d.default.itemsBody,children:eg.sort((e,t)=>0===e.sellingPrice&&0!==t.sellingPrice?1:0!==e.sellingPrice&&0===t.sellingPrice?-1:0).map(e=>{let i,a;return(0,t.jsxs)("div",{className:`${d.default.itemRow} ${!eG.showTotalDiscountFromItems?d.default.itemRowNoDiscount:""}`,children:[(0,t.jsx)("div",{className:d.default.productCode,children:e.productCode}),(0,t.jsx)("div",{className:d.default.productName,children:e.productName}),(0,t.jsx)("div",{className:d.default.quantity,children:(0,t.jsx)("input",{type:"number",min:"1",max:e.availableQty,step:"1",value:e.quantity,onChange:t=>e3(e.id,"quantity",parseFloat(t.target.value)||1),onWheel:o.handleNumberInputWheel,className:`${d.default.quantityInput} ${e.quantity>e.availableQty?d.default.quantityError:""}`,title:`Available stock: ${e.availableQty}`,readOnly:eK})}),(0,t.jsx)("div",{className:d.default.sellingPrice,children:(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.sellingPrice,onChange:t=>e3(e.id,"sellingPrice",parseFloat(t.target.value)||0),onWheel:o.handleNumberInputWheel,className:d.default.priceInput,readOnly:eK||eG.isSellingPriceReadonly||0===e.sellingPrice,title:eK?"View mode - cannot edit":0===e.sellingPrice?"Free item - selling price cannot be changed":eG.isSellingPriceReadonly?"Selling price is read-only (configured in settings)":""})}),eG.showTotalDiscountFromItems&&(0,t.jsx)("div",{className:d.default.discount,children:(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.discount,onChange:t=>e3(e.id,"discount",parseFloat(t.target.value)||0),onWheel:o.handleNumberInputWheel,className:d.default.discountInput,placeholder:"0.00",readOnly:eK||eG.isDiscountReadonly||0===e.sellingPrice,title:eK?"View mode - cannot edit":0===e.sellingPrice?"Free item - no additional discount can be applied":eG.isDiscountReadonly?"Discount is read-only (configured in settings)":""})}),(0,t.jsxs)("div",{className:d.default.price,children:["LKR ",e.price.toLocaleString()]}),!eG.hideCostProfit&&(0,t.jsxs)("div",{className:d.default.cost,children:["LKR ",(e.costPrice*e.quantity).toLocaleString()]}),!eG.hideCostProfit&&(0,t.jsxs)("div",{className:d.default.profit,children:["LKR ",(i=b?e.totalPrice*(parseFloat(b.percentage.toString())/100):0,a=y?e.totalPrice*(eG.totalBalanceDiscountPercent/100):0,(e.totalPrice-i-a-e.costPrice*e.quantity).toLocaleString())]}),(0,t.jsxs)("div",{className:d.default.totalPrice,children:["LKR ",e.totalPrice.toLocaleString()]}),(0,t.jsxs)("div",{className:d.default.actions,children:[!eK&&(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void ex(e=>e.filter(e=>e.id!==t))},className:d.default.removeButton,children:"Remove"}),eK&&(0,t.jsx)("span",{className:d.default.viewModeLabel,children:"View Only"})]})]},e.id)})})]}),(0,t.jsx)("div",{className:d.default.totalsSection,children:(0,t.jsxs)("div",{className:d.default.totalsGrid,children:[(0,t.jsxs)("div",{className:d.default.totalRow,children:[(0,t.jsxs)("span",{children:["Sub Total",b?` - ${b.discountName} Discount (${b.percentage}%)`:"",":"]}),(0,t.jsxs)("span",{children:["LKR ",e4.subTotal.toLocaleString()]})]}),b&&(0,t.jsxs)("div",{className:d.default.totalRow,children:[(0,t.jsxs)("span",{children:["Discount Amount (",b.percentage,"%):"]}),(0,t.jsxs)("span",{children:["- LKR ",e4.invoiceTypeDiscount.toLocaleString()]})]}),eG.showTotalDiscountFromItems&&(0,t.jsxs)("div",{className:d.default.totalRow,children:[(0,t.jsx)("span",{children:"Total Discount from Items:"}),(0,t.jsxs)("span",{children:["LKR ",e4.totalDiscount.toLocaleString()]})]}),eG.showTotalBalanceDiscount&&(0,t.jsxs)("div",{className:d.default.totalRow,children:[(0,t.jsxs)("label",{className:d.default.cashDiscountLabel,children:[(0,t.jsx)("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked),className:d.default.checkbox}),(0,t.jsxs)("span",{children:["Cash Discount (",eG.totalBalanceDiscountPercent,"%):"]})]}),(0,t.jsx)("span",{children:y&&e4.cashDiscount>0?`- LKR ${e4.cashDiscount.toLocaleString()}`:"LKR 0"})]}),(0,t.jsxs)("div",{className:`${d.default.totalRow} ${d.default.netTotal}`,children:[(0,t.jsx)("span",{children:"Net Total:"}),(0,t.jsxs)("span",{children:["LKR ",e4.netTotal.toLocaleString()]})]}),!eG.hideCostProfit&&(0,t.jsxs)("div",{className:d.default.totalRow,children:[(0,t.jsx)("span",{children:"Total Cost:"}),(0,t.jsxs)("span",{children:["LKR ",e4.totalCost.toLocaleString()]})]}),!eG.hideCostProfit&&(0,t.jsxs)("div",{className:`${d.default.totalRow} ${d.default.profitRow}`,children:[(0,t.jsx)("span",{children:"Total Profit:"}),(0,t.jsxs)("span",{style:{color:e4.totalProfit>=0?"#28a745":"#dc3545",fontWeight:"bold"},children:["LKR ",e4.totalProfit.toLocaleString()]})]})]})})]}),eS&&(0,t.jsx)("div",{className:d.default.error,children:eS}),ey&&(0,t.jsx)("div",{className:d.default.success,children:ey}),(0,t.jsxs)("div",{className:d.default.submitSection,children:[!eK&&(0,t.jsx)("button",{type:"submit",className:d.default.submitButton,disabled:eb||!g||!b||0===eg.length||e6()||e8()&&eL,title:e6()?"Cannot save: Some items exceed available stock":e8()&&eL?"Cannot create credit invoice: Shop has overdue payments":"",children:eb?"Processing...":e6()?"Check Stock Quantities":eP?"Update Invoice":"Create Invoice"}),!eK&&eU&&(0,t.jsx)("button",{type:"button",onClick:()=>window.open(`/invoices/print/${eU}`,"_blank"),className:d.default.printLastInvoiceButton,disabled:eb,title:"Print the last created invoice",children:"ðŸ–¨ï¸ Print Last Invoice"}),eK&&eV&&(0,t.jsx)("button",{type:"button",onClick:()=>window.open(`/invoices/print/${eV.id}`,"_blank"),className:d.default.printInvoiceButton,disabled:eb,children:"ðŸ–¨ï¸ Print This Invoice"})]})]}),(0,t.jsxs)("div",{className:d.default.invoicesList,children:[(0,t.jsxs)("div",{className:d.default.invoicesHeader,children:[(0,t.jsx)("h2",{className:d.default.subtitle,children:"Recent Invoices"}),(0,t.jsxs)("div",{className:d.default.invoicesControls,children:[(0,t.jsxs)("div",{className:d.default.searchContainer,children:[(0,t.jsx)("input",{type:"text",placeholder:"Search by invoice number or shop name...",value:eE,onChange:e=>eQ(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ta(eE)},className:d.default.searchInput}),(0,t.jsx)("button",{onClick:()=>ta(eE),className:d.default.searchButton,disabled:eb,children:"ðŸ”"})]}),(0,t.jsx)("button",{onClick:()=>tt(1,eE),className:d.default.loadButton,disabled:eb,children:eb?"Loading...":"Load Latest 5 Invoices"})]})]}),eB.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:d.default.invoicesTable,children:[(0,t.jsxs)("div",{className:d.default.tableHeader,children:[(0,t.jsx)("div",{children:"Invoice #"}),(0,t.jsx)("div",{children:"Date"}),(0,t.jsx)("div",{children:"Shop"}),(0,t.jsx)("div",{children:"Items"}),(0,t.jsx)("div",{children:"Net Total"}),(0,t.jsx)("div",{children:"Notes"}),(0,t.jsx)("div",{children:"Actions"})]}),(0,t.jsx)("div",{className:d.default.tableBody,children:eB.map(e=>(0,t.jsxs)("div",{className:d.default.tableRow,children:[(0,t.jsx)("div",{className:d.default.invoiceNumber,children:e.invoiceNumber}),(0,t.jsx)("div",{children:new Date(e.invoiceDate).toLocaleDateString()}),(0,t.jsx)("div",{children:e.shop.shopName}),(0,t.jsxs)("div",{children:[e.invoiceItems.length," items"]}),(0,t.jsxs)("div",{children:["LKR ",Number(e.netTotal).toLocaleString()]}),(0,t.jsx)("div",{className:d.default.notes,title:e.notes||"No notes",children:e.notes?e.notes.length>30?`${e.notes.substring(0,30)}...`:e.notes:"-"}),(0,t.jsxs)("div",{className:d.default.actions,children:[(0,t.jsx)("button",{className:d.default.viewButton,onClick:()=>ti(e),disabled:eb,children:"View"}),(0,t.jsx)("button",{className:d.default.printButton,onClick:()=>window.open(`/invoices/print/${e.id}`,"_blank"),disabled:eb,title:"Print Invoice",children:"Print"})]})]},e.id))})]}),eA.totalPages>1&&(0,t.jsxs)("div",{className:d.default.pagination,children:[(0,t.jsx)("div",{className:d.default.paginationInfo,children:(0,t.jsxs)("span",{children:["Page ",eA.currentPage," of ",eA.totalPages,"(",eA.totalCount," total invoices)",eE&&(0,t.jsxs)("span",{children:[' | Filtered by: "',eE,'"']})]})}),(0,t.jsxs)("div",{className:d.default.paginationButtons,children:[(0,t.jsx)("button",{onClick:()=>ts(eO-1),disabled:!eA.hasPrev||eb,className:d.default.pageButton,children:"â† Previous"}),(()=>{let e=[],i=eA.totalPages;if(i<=5)for(let t=1;t<=i;t++)e.push(t);else{e.push(1),eO>3&&e.push("...");let t=Math.max(2,eO-1),a=Math.min(i-1,eO+1);for(let i=t;i<=a;i++)e.includes(i)||e.push(i);eO<i-2&&e.push("..."),e.includes(i)||e.push(i)}return e.map((e,i)=>"..."===e?(0,t.jsx)("span",{className:d.default.ellipsis,children:"..."},`ellipsis-${i}`):(0,t.jsx)("button",{onClick:()=>ts(e),className:`${d.default.pageButton} ${e===eO?d.default.activePage:""}`,disabled:eb,children:e},e))})(),(0,t.jsx)("button",{onClick:()=>ts(eO+1),disabled:!eA.hasNext||eb,className:d.default.pageButton,children:"Next â†’"})]})]})]}),0===eB.length&&!eb&&(0,t.jsxs)("div",{className:d.default.noInvoices,children:[(0,t.jsxs)("p",{children:["No invoices found",eE?` matching "${eE}"`:"","."]}),(0,t.jsx)("p",{children:'Click "Load Latest 5 Invoices" to fetch recent invoices.'})]})]})]}):(0,t.jsx)("div",{className:d.default.accessDenied,children:"Access denied to invoice management"})}])}]);