(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11426,e=>{"use strict";var s=e.i(43476),n=e.i(71645),t=e.i(18566),c=e.i(57951);e.s(["default",0,()=>{let e=(0,t.useRouter)(),i=(0,t.useParams)(),o=i?.id,{user:a}=(0,c.useAuth)(),[r,l]=(0,n.useState)(null),[d,m]=(0,n.useState)(null),[h,u]=(0,n.useState)(!0),[p,x]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{if(o){u(!0);try{let e=await fetch(`/api/invoices/${o}`,{headers:{"Content-Type":"application/json"}}),s=await e.json();s.success&&s.invoice?l(s.invoice):x("Invoice not found")}catch(e){x("Failed to load invoice")}finally{u(!1)}}})()},[o]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/softwareSettings",{headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(a||{})}}),s=await e.json();if(s.success&&s.settings){let e={companyName:s.settings.companyName||"",companyAddress:s.settings.companyAddress||"",companyContactNumber:s.settings.companyContactNumber||"",companyBusinessRegNo:s.settings.companyBusinessRegNo||"",companyDescription:s.settings.companyDescription||"",companyLogo:s.settings.companyLogo||"",totalBalanceDiscountPercent:s.settings.totalBalanceDiscountPercent||0};m(e)}}catch(e){m({companyName:"API Error - Company Name",companyAddress:"API Error - Company Address",companyContactNumber:"API Error - Contact Number",companyBusinessRegNo:"",companyDescription:"",companyLogo:"",totalBalanceDiscountPercent:0})}};a&&e()},[a]);let j=()=>{e.back()},N=(()=>{if(!r)return{subTotal:0,creditDiscount:0,discountAmount:0,totalDiscountFromItems:0,netBeforeCashDiscount:0,cashDiscount:0,cashDiscountPercent:0,netTotal:0,totalItems:0};let e=Number(r.subTotal||0),s=Number(r.discountAmount||0),n=Number(r.netTotal||0),t=Number(r.invoiceItems.reduce((e,s)=>e+Number(s.discount||0),0).toFixed(2)),c=0;r.discount&&r.discount.percentage?c=r.discount.percentage:r.invoiceTypePercentage&&(c=r.invoiceTypePercentage);let i=0;c>0&&(i=Number((e*c/100).toFixed(2)));let o=s>0?s:i,a=e-o,l=0,m=0;r.cashDiscountEnabled&&(l=r.cashDiscountPercentage||d?.totalBalanceDiscountPercent||0,m=Math.max(0,a-n));let h=Number(r.invoiceItems.reduce((e,s)=>e+Number(s.quantity||0),0));return{subTotal:Number(e.toFixed(2)),creditDiscount:Number(o.toFixed(2)),creditDiscountPercent:Number(c),discountAmount:Number(o.toFixed(2)),totalDiscountFromItems:Number(t),netBeforeCashDiscount:Number(a.toFixed(2)),cashDiscount:Number(m.toFixed(2)),cashDiscountPercent:Number(l),netTotal:Number(n.toFixed(2)),totalItems:Number(h)}})();return h?(0,s.jsxs)("div",{className:"loading",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{children:"Loading invoice..."})]}):p||!r?(0,s.jsxs)("div",{className:"error",children:[(0,s.jsx)("h2",{children:"Error"}),(0,s.jsx)("p",{children:p||"Invoice not found"}),(0,s.jsx)("button",{onClick:j,className:"back-button",children:"Go Back"})]}):(0,s.jsxs)("div",{className:"print-container",children:[(0,s.jsxs)("div",{className:"print-controls",children:[(0,s.jsx)("button",{onClick:j,className:"back-button",children:"â† Back to Invoices"}),(0,s.jsx)("button",{onClick:()=>{document.title="",setTimeout(()=>{window.print()},100)},className:"print-button",children:"ðŸ–¨ï¸ Print Invoice"})]}),(0,s.jsxs)("div",{className:"invoice",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsxs)("div",{className:"company-info",children:[d?.companyLogo&&""!==d.companyLogo.trim()&&(0,s.jsx)("div",{className:"company-logo",children:(0,s.jsx)("img",{src:d.companyLogo,alt:"Company Logo",className:"logo-image",onError:e=>{e.target.style.display="none"}})}),(0,s.jsx)("h1",{className:"company-name",children:d?.companyName&&""!==d.companyName.trim()?d.companyName:"Company Name Not Set"}),(0,s.jsx)("p",{className:"company-address",children:d?.companyAddress&&""!==d.companyAddress.trim()?(0,s.jsxs)(s.Fragment,{children:[d.companyAddress.split("\n").map((e,t)=>(0,s.jsxs)(n.default.Fragment,{children:[e,t<d.companyAddress.split("\n").length-1&&(0,s.jsx)("br",{})]},t)),(0,s.jsx)("br",{}),"Phone: ",d.companyContactNumber||"Contact Number Not Set",d.companyBusinessRegNo&&""!==d.companyBusinessRegNo.trim()&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),"Business Reg: ",d.companyBusinessRegNo]})]}):(0,s.jsxs)(s.Fragment,{children:["Company Address Not Set",(0,s.jsx)("br",{}),"Please update in Settings",(0,s.jsx)("br",{}),"Phone: Contact Number Not Set",(0,s.jsx)("br",{})]})})]}),(0,s.jsxs)("div",{className:"invoice-header",children:[(0,s.jsx)("h2",{className:"invoice-title",children:"INVOICE"}),(0,s.jsxs)("div",{className:"invoice-info",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Invoice #:"})," ",r.invoiceNumber]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date:"})," ",new Date(r.invoiceDate).toLocaleDateString("en-GB")]}),r.dueDate&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Due Date:"})," ",new Date(r.dueDate).toLocaleDateString("en-GB")]}),r.discount&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Invoice Type:"})," ",r.discount.discountName," (",r.discount.percentage,"% discount)"]}),r.dueDate&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Payment Terms:"})," Net ",Math.ceil((new Date(r.dueDate).getTime()-new Date(r.invoiceDate).getTime())/864e5)," days"]})]})]})]}),(0,s.jsxs)("div",{className:"billing-info",children:[(0,s.jsxs)("div",{className:"bill-to",children:[(0,s.jsx)("h3",{children:"Bill To:"}),(0,s.jsxs)("div",{className:"customer-info",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:r.shop.shopName})}),(0,s.jsx)("p",{children:r.shop.ownerName}),(0,s.jsxs)("p",{children:["Phone: ",r.shop.contactNumber]}),r.shop.address&&(0,s.jsx)("p",{children:r.shop.address})]})]}),r.salesRep&&(0,s.jsxs)("div",{className:"sales-rep",children:[(0,s.jsx)("h3",{children:"Sales Representative:"}),(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:r.salesRep.name})}),(0,s.jsxs)("p",{children:["Phone: ",r.salesRep.contactNumber]})]})]}),(0,s.jsx)("div",{className:"items-section",children:(0,s.jsxs)("table",{className:"items-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Item Code"}),(0,s.jsx)("th",{children:"Description"}),(0,s.jsx)("th",{children:"Qty"}),(0,s.jsx)("th",{children:"Unit Price"}),(0,s.jsx)("th",{children:"Discount"}),(0,s.jsx)("th",{children:"Total"})]})}),(0,s.jsx)("tbody",{children:r.invoiceItems.map((e,n)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.productCode}),(0,s.jsx)("td",{children:e.productName}),(0,s.jsx)("td",{className:"center",children:e.quantity}),(0,s.jsxs)("td",{className:"right",children:["LKR ",e.sellingPrice.toLocaleString()]}),(0,s.jsxs)("td",{className:"right",children:["LKR ",e.discount.toLocaleString()]}),(0,s.jsxs)("td",{className:"right",children:["LKR ",e.totalPrice.toLocaleString()]})]},e.id||n))})]})}),(0,s.jsx)("div",{className:"totals-section",children:(0,s.jsxs)("div",{className:"totals-grid",children:[(0,s.jsxs)("div",{className:"total-row",children:[(0,s.jsxs)("span",{children:["Sub Total - Credit Discount (",r.discount?N.creditDiscountPercent:0,"%):"]}),(0,s.jsxs)("span",{children:["LKR ",N.subTotal.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"total-row",children:[(0,s.jsxs)("span",{children:["Discount Amount (",r.discount?N.creditDiscountPercent:0,"%):"]}),(0,s.jsx)("span",{children:N.discountAmount>0?`- LKR ${N.discountAmount.toLocaleString()}`:"- LKR 0"})]}),(0,s.jsxs)("div",{className:"total-row",children:[(0,s.jsx)("span",{children:"Total Discount from Items:"}),(0,s.jsxs)("span",{children:["LKR ",N.totalDiscountFromItems.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"total-row",children:[(0,s.jsxs)("span",{children:["Cash Discount (",N.cashDiscountPercent,"%):"]}),(0,s.jsx)("span",{children:N.cashDiscount>0?`- LKR ${N.cashDiscount.toLocaleString()}`:"LKR 0"})]}),(0,s.jsxs)("div",{className:"total-row net-total",children:[(0,s.jsx)("span",{children:"Net Total:"}),(0,s.jsxs)("span",{children:["LKR ",N.netTotal.toLocaleString()]})]})]})}),r.notes&&(0,s.jsxs)("div",{className:"notes-section",children:[(0,s.jsx)("h3",{children:"Notes:"}),(0,s.jsx)("p",{children:r.notes})]}),(0,s.jsxs)("div",{className:"footer",children:[(0,s.jsx)("div",{className:"thank-you",children:(0,s.jsx)("h3",{children:"Thank you for your business!"})}),d?.companyDescription&&""!==d.companyDescription.trim()&&(0,s.jsx)("div",{className:"company-description",children:(0,s.jsx)("p",{children:d.companyDescription})})]}),(0,s.jsx)("div",{className:"print-info",children:(0,s.jsxs)("p",{children:["Printed on: ",new Date().toLocaleString()]})})]})]})}])}]);