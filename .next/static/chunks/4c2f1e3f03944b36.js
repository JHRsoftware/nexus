(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23338,e=>{e.v({actionSection:"order-module__97544G__actionSection",addedProducts:"order-module__97544G__addedProducts",backButton:"order-module__97544G__backButton",container:"order-module__97544G__container",creditLimitContainer:"order-module__97544G__creditLimitContainer",creditLimitGrid:"order-module__97544G__creditLimitGrid",creditLimitItem:"order-module__97544G__creditLimitItem",creditLimitLabel:"order-module__97544G__creditLimitLabel",creditLimitTitle:"order-module__97544G__creditLimitTitle",creditLimitValue:"order-module__97544G__creditLimitValue",draftButton:"order-module__97544G__draftButton",error:"order-module__97544G__error",field:"order-module__97544G__field",formGrid:"order-module__97544G__formGrid",header:"order-module__97544G__header",headerTop:"order-module__97544G__headerTop",input:"order-module__97544G__input",inputGroup:"order-module__97544G__inputGroup",inputLabel:"order-module__97544G__inputLabel",label:"order-module__97544G__label",loading:"order-module__97544G__loading",message:"order-module__97544G__message",negativeCredit:"order-module__97544G__negativeCredit",orderForm:"order-module__97544G__orderForm",overdueAmount:"order-module__97544G__overdueAmount",overdueDays:"order-module__97544G__overdueDays",overdueDueDate:"order-module__97544G__overdueDueDate",overdueInvoiceNumber:"order-module__97544G__overdueInvoiceNumber",overduePaymentItem:"order-module__97544G__overduePaymentItem",overduePaymentsList:"order-module__97544G__overduePaymentsList",overdueTotal:"order-module__97544G__overdueTotal",overdueWarning:"order-module__97544G__overdueWarning",overdueWarningText:"order-module__97544G__overdueWarningText",overdueWarningTitle:"order-module__97544G__overdueWarningTitle",positiveCredit:"order-module__97544G__positiveCredit",productCode:"order-module__97544G__productCode",productHeader:"order-module__97544G__productHeader",productInfo:"order-module__97544G__productInfo",productInput:"order-module__97544G__productInput",productInputs:"order-module__97544G__productInputs",productItem:"order-module__97544G__productItem",productName:"order-module__97544G__productName",productSearch:"order-module__97544G__productSearch",productStock:"order-module__97544G__productStock",productTotals:"order-module__97544G__productTotals",productsSection:"order-module__97544G__productsSection",pulseWarning:"order-module__97544G__pulseWarning",removeButton:"order-module__97544G__removeButton",resultDetails:"order-module__97544G__resultDetails",resultName:"order-module__97544G__resultName",searchContainer:"order-module__97544G__searchContainer",searchIcon:"order-module__97544G__searchIcon",searchInput:"order-module__97544G__searchInput",searchResult:"order-module__97544G__searchResult",searchResults:"order-module__97544G__searchResults",section:"order-module__97544G__section",sectionTitle:"order-module__97544G__sectionTitle",select:"order-module__97544G__select",submitButton:"order-module__97544G__submitButton",subtitle:"order-module__97544G__subtitle",success:"order-module__97544G__success",summaryGrid:"order-module__97544G__summaryGrid",summaryLabel:"order-module__97544G__summaryLabel",summaryRow:"order-module__97544G__summaryRow",summarySection:"order-module__97544G__summarySection",summaryValue:"order-module__97544G__summaryValue",textarea:"order-module__97544G__textarea",title:"order-module__97544G__title",toggleField:"order-module__97544G__toggleField",toggleInput:"order-module__97544G__toggleInput",toggleLabel:"order-module__97544G__toggleLabel",totalLabel:"order-module__97544G__totalLabel",totalPrice:"order-module__97544G__totalPrice",totalRow:"order-module__97544G__totalRow",totalValue:"order-module__97544G__totalValue"})},50702,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),l=e.i(11870),r=e.i(75144),d=e.i(57951),i=e.i(89088),u=e.i(23338);let c=()=>{let e,c,o,n,m,h,p,_,f,v=(0,s.useRouter)(),g=(0,s.useSearchParams)(),N=g?.get("editId"),x=!!N,{isAuthorized:j,isLoading:y}=(0,l.usePageProtection)("orders"),{isDarkMode:b}=(0,r.useTheme)(),{user:S}=(0,d.useAuth)(),[G,L]=(0,a.useState)(x),[C,I]=(0,a.useState)(null),[P,D]=(0,a.useState)(new Date().toISOString().split("T")[0]),[T,R]=(0,a.useState)(null),[w,$]=(0,a.useState)(null),[q,O]=(0,a.useState)(null),[k,F]=(0,a.useState)(!1),[A,Q]=(0,a.useState)(""),[V,E]=(0,a.useState)([]),[W,B]=(0,a.useState)(""),[K,U]=(0,a.useState)([]),[H,M]=(0,a.useState)(!1),[J,z]=(0,a.useState)(""),[X,Y]=(0,a.useState)([]),[Z,ee]=(0,a.useState)(!1),[et,ea]=(0,a.useState)(""),[es,el]=(0,a.useState)([]),[er,ed]=(0,a.useState)(!1),[ei,eu]=(0,a.useState)(""),[ec,eo]=(0,a.useState)([]),[en,em]=(0,a.useState)(!1),[eh,ep]=(0,a.useState)([]),[e_,ef]=(0,a.useState)(!1),[ev,eg]=(0,a.useState)([]),[eN,ex]=(0,a.useState)(!1),[ej,ey]=(0,a.useState)(!1),[eb,eS]=(0,a.useState)(""),[eG,eL]=(0,a.useState)(""),[eC,eI]=(0,a.useState)(5),[eP,eD]=(0,a.useState)({hideSellingPrice:!1,hideDiscount:!1,hideFreeProducts:!1,hideCashDiscount:!1}),eT=()=>({"Content-Type":"application/json","x-user-data":JSON.stringify(S||{})});(0,a.useEffect)(()=>{j&&(eR(),ew(),x&&N&&e$())},[j,x,N]),(0,a.useEffect)(()=>{let e=e=>{let t=e.target;H&&!t.closest(".shop-search-container")&&M(!1),Z&&!t.closest(".salesrep-search-container")&&ee(!1),er&&!t.closest(".product-search-container")&&ed(!1),en&&!t.closest(".freeproduct-search-container")&&em(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[H,Z,er,en]);let eR=async()=>{try{let e=await fetch("/api/discounts"),t=await e.json();t.success&&ep(t.discounts.filter(e=>e.percentage>0))}catch(e){}},ew=async()=>{try{let e=await fetch("/api/softwareSettings",{headers:eT()}),t=await e.json();t.success&&t.settings&&(eI(t.settings.totalBalanceDiscountPercent||5),eD({hideSellingPrice:t.settings.hideSellingPrice||!1,hideDiscount:t.settings.hideDiscount||!1,hideFreeProducts:t.settings.hideFreeProducts||!1,hideCashDiscount:t.settings.hideCashDiscount||!1}))}catch(e){}},e$=async()=>{try{L(!0);let e=await fetch(`/api/orders/${N}`),t=await e.json();if(!t.success)return void eL(t.error||"Failed to load order");let a=t.order;if("pending"!==a.status.toLowerCase()){eL("Only pending orders can be edited"),setTimeout(()=>v.push("/orders"),2e3);return}I(a),D(new Date(a.orderDate).toISOString().split("T")[0]),R(a.shop),B(a.shop.shopName),a.salesRep&&($(a.salesRep),z(a.salesRep.name)),a.discount&&O(a.discount),Q(a.notes||"");let s=a.orderItems.map((e,t)=>({id:`item-${e.id}-${t}`,productId:e.product.id,productCode:e.product.productCode,productName:0===e.sellingPrice?`${e.product.itemName} (FREE)`:e.product.itemName,quantity:Number(e.quantity)||0,sellingPrice:Number(e.sellingPrice)||0,discount:Number(e.discount)||0,availableQty:(e.product.availableQty||0)+(e.quantity||0),costPrice:e.product.availableQty>0?Number(e.product.totalCost)/e.product.availableQty:0}));E(s)}catch(e){eL("Failed to load order")}finally{L(!1)}},eq=(0,a.useCallback)(async e=>{if(e.length<2)return void U([]);try{let t=await fetch(`/api/shops?search=${encodeURIComponent(e)}&limit=10&activeOnly=true`),a=await t.json();a.success&&U(a.shops||[])}catch(e){}},[]),eO=(0,a.useCallback)(async e=>{if(e.length<2)return void Y([]);try{let t=await fetch(`/api/sales-rep?search=${encodeURIComponent(e)}&activeOnly=true`),a=await t.json();a.success&&Y(a.salesReps||[])}catch(e){}},[]),ek=(0,a.useCallback)(async e=>{if(e.length<2)return void el([]);try{let t=await fetch(`/api/products/search?search=${encodeURIComponent(e)}&limit=10`),a=await t.json();a.success&&el(a.products||[])}catch(e){}},[]),eF=(0,a.useCallback)(async e=>{if(e.length<2)return void eo([]);try{let t=await fetch(`/api/products/search?search=${encodeURIComponent(e)}&limit=10`),a=await t.json();a.success&&eo(a.products||[])}catch(e){}},[]);(0,a.useEffect)(()=>{let e=setTimeout(()=>{W&&(eq(W),M(!0))},300);return()=>clearTimeout(e)},[W,eq]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{J&&(eO(J),ee(!0))},300);return()=>clearTimeout(e)},[J,eO]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{et&&(ek(et),ed(!0))},300);return()=>clearTimeout(e)},[et,ek]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{ei&&(eF(ei),em(!0))},300);return()=>clearTimeout(e)},[ei,eF]),(0,a.useEffect)(()=>{eV()},[V,T,q,k]);let eA=async e=>{R(e),B(e.shopName),M(!1),eg([]),ex(!1),await eE(e.id)},eQ=e=>{if(!T)return{isValid:!1,message:"Please select a shop first"};if(!q||"credit"!==q.discountName.toLowerCase())return{isValid:!0};let t=(T.creditLimit||0)-(T.balanceAmount||0);return e>t?{isValid:!1,message:`Order total (Rs ${e.toLocaleString()}) exceeds available credit (Rs ${t.toLocaleString()})`}:{isValid:!0}},eV=()=>{if(!T||0===V.length||!q||"credit"!==q.discountName.toLowerCase())return void ef(!1);let e=V.reduce((e,t)=>e+(t.quantity*t.sellingPrice-t.discount),0),t=e;if(q){let a=e*q.percentage/100;t=e-a}if(k){let e=t*eC/100;t-=e}ef(!eQ(t).isValid)},eE=async e=>{try{let t=await fetch(`/api/payments?shopId=${e}&status=due&limit=100`),a=await t.json();if(a.success){let e=a.payments.map(e=>{let t=new Date(e.dueDate),a=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);let s=Math.ceil((a.getTime()-t.getTime())/864e5);return{id:e.id,invoiceNumber:e.invoice.invoiceNumber,dueDate:e.dueDate,remainingAmount:Number(e.remainingAmount)||0,daysPastDue:Math.max(0,s)}});if(eg(e),ex(e.length>0),e.length>0){let t=e.reduce((e,t)=>e+Number(t.remainingAmount),0);eL(`âš ï¸ This shop has ${e.length} overdue payment(s) totaling Rs ${t.toLocaleString()}. Please settle overdue payments before creating new orders.`)}else eG.includes("overdue payment")&&eL("")}}catch(e){}},eW=(e,t,a)=>{let s=V.map(s=>{if(s.id===e){let e={...s,[t]:a};return"quantity"===t&&a>s.availableQty?(eL(`Insufficient stock for ${s.productName}. Available: ${s.availableQty}`),s):e}return s}),l=s.reduce((e,t)=>e+(t.quantity*t.sellingPrice-t.discount),0),r=l;if(q){let e=l*q.percentage/100;r=l-e}if(k){let e=r*eC/100;r-=e}if(s.some((e,t)=>{let a=V[t];return!a||e.quantity!==a.quantity||e.sellingPrice!==a.sellingPrice||e.discount!==a.discount})){let e=eQ(r);if(!e.isValid)return void eL(e.message||"Credit limit exceeded")}E(s),eL("")},eB=(e=0,c=0,o=0,n=0,V.forEach(t=>{let a=t.sellingPrice*t.quantity,s=t.discount*t.quantity,l=t.costPrice*t.quantity;e+=a,c+=s,o+=l,n+=a-s-l}),m=0,q&&(m=e*(Number(q.percentage)/100)),h=0,k&&(h=eC/100*(e-m-c)),p=e-m-c-h,_=n-m-h,{subTotal:e,totalDiscount:c,invoiceTypeDiscount:m,cashDiscount:h,netTotal:p,totalCost:o,totalProfit:_}),eK=async()=>{let e=[];P||e.push("Order Date"),T||e.push("Shop"),w||e.push("Sales Representative"),q||e.push("Discount Type"),0===V.filter(e=>e.sellingPrice>0).length&&e.push("At least one regular product");let t=V.filter(e=>e.quantity<=0||e.quantity>e.availableQty);if(e.length>0||t.length>0){let a="";e.length>0&&(a+=`Missing required fields: ${e.join(", ")}`),t.length>0&&(a&&(a+=". "),a+=`Invalid quantities for: ${t.map(e=>e.productName).join(", ")}`),eL(a);return}ey(!0),eL(""),eS("");try{let e={orderDate:P,shopId:T.id,salesRepId:w?.id,discountId:q?.id,invoiceTypePercentage:q?Number(q.percentage):0,cashDiscountEnabled:k,notes:A,status:"PENDING",orderItems:V.map(e=>({productId:e.productId,quantity:e.quantity,sellingPrice:e.sellingPrice,discount:e.discount}))},t=x?`/api/orders/${N}`:"/api/orders",a=x?"PUT":"POST",s=await fetch(t,{method:a,headers:eT(),body:JSON.stringify(e)}),l=await s.json();l.success?(eS(x?"Order updated successfully!":"Order saved successfully!"),setTimeout(()=>{v.push("/orders")},2e3)):eL(l.error||`Failed to ${x?"update":"save"} order`)}catch(e){eL(`An error occurred while ${x?"updating":"saving"} the order`)}finally{ey(!1)}};return y?(0,t.jsx)("div",{className:u.default.loading,children:"Checking permissions..."}):G&&x?(0,t.jsx)("div",{className:u.default.loading,children:"Loading order data..."}):j?(0,t.jsxs)("div",{className:`${u.default.container} ${b?"dark":"light"}`,children:[(0,t.jsxs)("div",{className:u.default.header,children:[(0,t.jsx)("div",{className:u.default.headerTop,children:(0,t.jsx)("button",{type:"button",onClick:()=>v.push("/orders"),className:u.default.backButton,children:"â† Back"})}),(0,t.jsxs)("h1",{className:u.default.title,children:["ðŸ“‹ ",x?`Edit Order ${C?.orderNumber||""}`:"Create New Order"]}),(0,t.jsx)("p",{className:u.default.subtitle,children:x?"Edit existing order details":"Create orders that can be converted to invoices later"})]}),(0,t.jsxs)("form",{className:u.default.orderForm,onSubmit:e=>e.preventDefault(),children:[(0,t.jsxs)("div",{className:u.default.section,children:[(0,t.jsx)("h2",{className:u.default.sectionTitle,children:"ðŸ“… Order Information"}),(0,t.jsxs)("div",{className:u.default.formGrid,children:[(0,t.jsxs)("div",{className:u.default.field,children:[(0,t.jsx)("label",{className:u.default.label,children:"Order Date *"}),(0,t.jsx)("input",{type:"date",value:P,onChange:e=>D(e.target.value),className:u.default.input,required:!0})]}),(0,t.jsxs)("div",{className:u.default.field,children:[(0,t.jsx)("label",{className:u.default.label,children:"Discount Type *"}),(0,t.jsxs)("select",{value:q?.id||"",onChange:e=>{O(eh.find(t=>t.id===parseInt(e.target.value))||null)},className:u.default.select,required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Discount Type"}),eh.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.discountName," (",e.percentage,"%)"]},e.id))]})]})]}),(0,t.jsxs)("div",{className:u.default.formGrid,children:[(0,t.jsxs)("div",{className:u.default.field,children:[(0,t.jsx)("label",{className:u.default.label,children:"Shop *"}),(0,t.jsxs)("div",{className:`${u.default.searchContainer} shop-search-container`,children:[(0,t.jsx)("input",{type:"text",placeholder:"Search shops...",value:W,onChange:e=>B(e.target.value),onFocus:()=>M(!0),className:u.default.searchInput,required:!0}),(0,t.jsx)("span",{className:u.default.searchIcon,children:"ðŸ”"}),H&&K.length>0&&(0,t.jsx)("div",{className:u.default.searchResults,children:K.map(e=>(0,t.jsxs)("div",{className:u.default.searchResult,onClick:()=>eA(e),children:[(0,t.jsx)("div",{className:u.default.resultName,children:e.shopName}),(0,t.jsxs)("div",{className:u.default.resultDetails,children:[e.ownerName," â€¢ ",e.contactNumber]})]},e.id))})]})]}),T&&(0,t.jsx)("div",{className:u.default.field,children:(0,t.jsxs)("div",{className:u.default.creditLimitContainer,children:[(0,t.jsx)("h3",{className:u.default.creditLimitTitle,children:"ðŸ’³ Credit Information"}),(0,t.jsxs)("div",{className:u.default.creditLimitGrid,children:[(0,t.jsxs)("div",{className:u.default.creditLimitItem,children:[(0,t.jsx)("span",{className:u.default.creditLimitLabel,children:"Credit Limit:"}),(0,t.jsxs)("span",{className:u.default.creditLimitValue,children:["Rs ",T.creditLimit?.toLocaleString()||"0"]})]}),(0,t.jsxs)("div",{className:u.default.creditLimitItem,children:[(0,t.jsx)("span",{className:u.default.creditLimitLabel,children:"Current Balance:"}),(0,t.jsxs)("span",{className:u.default.creditLimitValue,children:["Rs ",T.balanceAmount?.toLocaleString()||"0"]})]}),(0,t.jsxs)("div",{className:u.default.creditLimitItem,children:[(0,t.jsx)("span",{className:u.default.creditLimitLabel,children:"Available Credit:"}),(0,t.jsxs)("span",{className:`${u.default.creditLimitValue} ${(T.creditLimit||0)-(T.balanceAmount||0)>0?u.default.positiveCredit:u.default.negativeCredit}`,children:["Rs ",((T.creditLimit||0)-(T.balanceAmount||0)).toLocaleString()]})]})]})]})}),T&&eN&&(0,t.jsx)("div",{className:u.default.field,children:(0,t.jsxs)("div",{className:u.default.overdueWarning,children:[(0,t.jsx)("h3",{className:u.default.overdueWarningTitle,children:"âš ï¸ Overdue Payments Alert"}),(0,t.jsxs)("p",{className:u.default.overdueWarningText,children:["This shop has ",ev.length," overdue payment(s). No orders can be created until all overdue payments are settled."]}),(0,t.jsx)("div",{className:u.default.overduePaymentsList,children:ev.map(e=>(0,t.jsxs)("div",{className:u.default.overduePaymentItem,children:[(0,t.jsxs)("span",{className:u.default.overdueInvoiceNumber,children:["Invoice: ",e.invoiceNumber]}),(0,t.jsxs)("span",{className:u.default.overdueDueDate,children:["Due: ",new Date(e.dueDate).toLocaleDateString()]}),(0,t.jsxs)("span",{className:u.default.overdueAmount,children:["Rs ",e.remainingAmount.toLocaleString()]}),(0,t.jsxs)("span",{className:u.default.overdueDays,children:[e.daysPastDue," days overdue"]})]},e.id))}),(0,t.jsxs)("div",{className:u.default.overdueTotal,children:["Total Overdue: Rs ",ev.reduce((e,t)=>e+Number(t.remainingAmount),0).toLocaleString()]})]})}),(0,t.jsxs)("div",{className:u.default.field,children:[(0,t.jsx)("label",{className:u.default.label,children:"Sales Representative *"}),(0,t.jsxs)("div",{className:`${u.default.searchContainer} salesrep-search-container`,children:[(0,t.jsx)("input",{type:"text",placeholder:"Search sales reps...",value:J,onChange:e=>z(e.target.value),onFocus:()=>ee(!0),className:u.default.searchInput,required:!0}),(0,t.jsx)("span",{className:u.default.searchIcon,children:"ðŸ‘¤"}),Z&&X.length>0&&(0,t.jsx)("div",{className:u.default.searchResults,children:X.map(e=>(0,t.jsxs)("div",{className:u.default.searchResult,onClick:()=>{$(e),z(e.name),ee(!1)},children:[(0,t.jsx)("div",{className:u.default.resultName,children:e.name}),(0,t.jsx)("div",{className:u.default.resultDetails,children:e.contactNumber})]},e.id))})]})]})]}),(0,t.jsxs)("div",{className:u.default.field,children:[(0,t.jsx)("label",{className:u.default.label,children:"Notes"}),(0,t.jsx)("textarea",{value:A,onChange:e=>Q(e.target.value),placeholder:"Optional order notes...",className:u.default.textarea})]}),!eP.hideCashDiscount&&(0,t.jsx)("div",{className:u.default.toggleField,children:(0,t.jsxs)("label",{className:u.default.toggleLabel,children:[(0,t.jsx)("input",{type:"checkbox",checked:k,onChange:e=>F(e.target.checked),className:u.default.toggleInput}),(0,t.jsxs)("span",{children:["Enable Cash Discount (",eC,"%)"]})]})})]}),(0,t.jsxs)("div",{className:u.default.section,children:[(0,t.jsx)("h2",{className:u.default.sectionTitle,children:"ðŸ“¦ Order Items"}),(0,t.jsxs)("div",{className:u.default.productSearch,children:[(0,t.jsx)("label",{className:u.default.label,children:"Add Products"}),(0,t.jsxs)("div",{className:`${u.default.searchContainer} product-search-container`,children:[(0,t.jsx)("input",{type:"text",placeholder:"Search products to add...",value:et,onChange:e=>ea(e.target.value),onFocus:()=>ed(!0),className:u.default.searchInput}),(0,t.jsx)("span",{className:u.default.searchIcon,children:"ðŸ“¦"}),er&&es.length>0&&(0,t.jsx)("div",{className:u.default.searchResults,children:es.map(e=>(0,t.jsxs)("div",{className:u.default.searchResult,onClick:()=>(e=>{if(V.find(t=>t.productId===e.id))return void eL("Product already added to order");let t={id:`item-${Date.now()}`,productId:e.id,productCode:e.productCode,productName:e.itemName,quantity:1,sellingPrice:Number(e.sellingPrice),discount:0,availableQty:e.availableQty,costPrice:e.availableQty>0?Number(e.totalCost)/e.availableQty:0},a=V.reduce((e,t)=>e+(t.quantity*t.sellingPrice-t.discount),0)+(t.quantity*t.sellingPrice-t.discount),s=a;if(q){let e=a*q.percentage/100;s=a-e}if(k){let e=s*eC/100;s-=e}let l=eQ(s);l.isValid?(E(e=>[...e,t]),ea(""),ed(!1),eL("")):eL(l.message||"Credit limit exceeded")})(e),children:[(0,t.jsx)("div",{className:u.default.resultName,children:e.itemName}),(0,t.jsxs)("div",{className:u.default.resultDetails,children:[e.productCode," â€¢ Stock: ",e.availableQty," â€¢ LKR ",Number(e.sellingPrice).toLocaleString()]})]},e.id))})]})]}),!eP.hideFreeProducts&&(0,t.jsxs)("div",{className:u.default.productSearch,children:[(0,t.jsx)("label",{className:u.default.label,children:"Add Free Products"}),(0,t.jsxs)("div",{className:`${u.default.searchContainer} freeproduct-search-container`,children:[(0,t.jsx)("input",{type:"text",placeholder:"Search products to add as free items (price = 0)...",value:ei,onChange:e=>eu(e.target.value),onFocus:()=>em(!0),className:u.default.searchInput}),(0,t.jsx)("span",{className:u.default.searchIcon,children:"ðŸ†“"}),en&&ec.length>0&&(0,t.jsx)("div",{className:u.default.searchResults,children:ec.map(e=>(0,t.jsxs)("div",{className:u.default.searchResult,onClick:()=>{let t;return t={id:`free-item-${Date.now()}-${e.id}-${Math.random()}`,productId:e.id,productCode:e.productCode,productName:`${e.itemName} (FREE)`,quantity:1,sellingPrice:0,discount:0,availableQty:e.availableQty,costPrice:e.availableQty>0?Number(e.totalCost)/e.availableQty:0},void(E(e=>[...e,t]),eu(""),eo([]),em(!1),eL(""))},children:[(0,t.jsxs)("div",{className:u.default.resultName,children:[e.itemName," (FREE)"]}),(0,t.jsxs)("div",{className:u.default.resultDetails,children:[e.productCode," â€¢ Stock: ",e.availableQty," â€¢ Original: LKR ",Number(e.sellingPrice).toLocaleString()," â€¢ Free: LKR 0"]})]},`free-${e.id}`))})]})]}),(0,t.jsxs)("div",{className:u.default.addedProducts,children:[V.sort((e,t)=>0===e.sellingPrice&&0!==t.sellingPrice?1:0!==e.sellingPrice&&0===t.sellingPrice?-1:0).map(e=>(0,t.jsxs)("div",{className:u.default.productItem,children:[(0,t.jsxs)("div",{className:u.default.productHeader,children:[(0,t.jsxs)("div",{className:u.default.productInfo,children:[(0,t.jsx)("div",{className:u.default.productName,children:e.productName}),(0,t.jsxs)("div",{className:u.default.productCode,children:["Code: ",e.productCode]}),(0,t.jsxs)("div",{className:u.default.productStock,children:["Available: ",e.availableQty]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void E(e=>e.filter(e=>e.id!==t))},className:u.default.removeButton,children:"ðŸ—‘ï¸"})]}),(0,t.jsxs)("div",{className:u.default.productInputs,children:[(0,t.jsxs)("div",{className:u.default.inputGroup,children:[(0,t.jsx)("label",{className:u.default.inputLabel,children:"Quantity"}),(0,t.jsx)("input",{type:"number",min:"1",max:e.availableQty,value:e.quantity,onWheel:i.handleNumberInputWheel,onChange:t=>eW(e.id,"quantity",parseInt(t.target.value)||1),className:u.default.productInput})]}),(0,t.jsxs)("div",{className:u.default.inputGroup,children:[(0,t.jsx)("label",{className:u.default.inputLabel,children:"Selling Price"}),(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.sellingPrice,onChange:t=>eW(e.id,"sellingPrice",parseFloat(t.target.value)||0),onWheel:i.handleNumberInputWheel,className:u.default.productInput,readOnly:0===e.sellingPrice||eP.hideSellingPrice,title:0===e.sellingPrice?"Free item - selling price cannot be changed":eP.hideSellingPrice?"Selling price is read-only (configured in settings)":""})]}),(0,t.jsxs)("div",{className:u.default.inputGroup,children:[(0,t.jsx)("label",{className:u.default.inputLabel,children:"Discount"}),(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.discount,onChange:t=>eW(e.id,"discount",parseFloat(t.target.value)||0),onWheel:i.handleNumberInputWheel,className:u.default.productInput,readOnly:0===e.sellingPrice||eP.hideDiscount,title:0===e.sellingPrice?"Free item - no additional discount can be applied":eP.hideDiscount?"Discount is read-only (configured in settings)":""})]}),(0,t.jsxs)("div",{className:u.default.inputGroup,children:[(0,t.jsx)("label",{className:u.default.inputLabel,children:"Price"}),(0,t.jsxs)("div",{className:u.default.productInput,style:{display:"flex",alignItems:"center"},children:["LKR ",((e.sellingPrice-e.discount)*e.quantity).toLocaleString()]})]}),(0,t.jsxs)("div",{className:u.default.inputGroup,children:[(0,t.jsx)("label",{className:u.default.inputLabel,children:"Total"}),(0,t.jsxs)("div",{className:u.default.productInput,style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:["LKR ",(e.sellingPrice*e.quantity).toLocaleString()]})]})]})]},e.id)),0===V.length&&(0,t.jsx)("div",{className:u.default.loading,children:"No products added yet. Search and add products above."})]})]}),V.length>0&&(0,t.jsxs)("div",{className:u.default.summarySection,children:[(0,t.jsx)("h2",{className:u.default.sectionTitle,children:"ðŸ’° Order Summary"}),(0,t.jsxs)("div",{className:u.default.summaryGrid,children:[(0,t.jsxs)("div",{className:u.default.summaryRow,children:[(0,t.jsx)("span",{className:u.default.summaryLabel,children:"Sub Total:"}),(0,t.jsxs)("span",{className:u.default.summaryValue,children:["LKR ",eB.subTotal.toLocaleString()]})]}),q&&(0,t.jsxs)("div",{className:u.default.summaryRow,children:[(0,t.jsxs)("span",{className:u.default.summaryLabel,children:[q.discountName," (",q.percentage,"%):"]}),(0,t.jsxs)("span",{className:u.default.summaryValue,children:["- LKR ",eB.invoiceTypeDiscount.toLocaleString()]})]}),eB.totalDiscount>0&&(0,t.jsxs)("div",{className:u.default.summaryRow,children:[(0,t.jsx)("span",{className:u.default.summaryLabel,children:"Item Discounts:"}),(0,t.jsxs)("span",{className:u.default.summaryValue,children:["- LKR ",eB.totalDiscount.toLocaleString()]})]}),k&&!eP.hideCashDiscount&&(0,t.jsxs)("div",{className:u.default.summaryRow,children:[(0,t.jsxs)("span",{className:u.default.summaryLabel,children:["Cash Discount (",eC,"%):"]}),(0,t.jsxs)("span",{className:u.default.summaryValue,children:["- LKR ",eB.cashDiscount.toLocaleString()]})]}),(0,t.jsxs)("div",{className:u.default.summaryRow,children:[(0,t.jsx)("span",{className:u.default.summaryLabel,children:"Net Total:"}),(0,t.jsxs)("span",{className:u.default.summaryValue,children:["LKR ",eB.netTotal.toLocaleString()]})]})]})]}),eG&&(0,t.jsx)("div",{className:`${u.default.message} ${u.default.error}`,children:eG}),eb&&(0,t.jsx)("div",{className:`${u.default.message} ${u.default.success}`,children:eb}),(0,t.jsxs)("div",{className:u.default.actionSection,children:[(0,t.jsx)("button",{type:"button",onClick:eK,disabled:(f=V.filter(e=>e.sellingPrice>0),!(P&&T&&w&&q&&f.length>0&&V.every(e=>e.quantity>0&&e.quantity<=e.availableQty))||ej||e_||eN),className:u.default.submitButton,children:ej?x?"ï¿½ Updating...":"ï¿½ðŸ’¾ Saving...":x?"ðŸ“ Update Order":"ðŸ’¾ Save Order"}),e_&&(0,t.jsxs)("div",{className:`${u.default.message} ${u.default.error}`,children:["âš ï¸ Cannot ",x?"update":"save"," order: Available credit limit exceeded for credit payment"]}),eN&&(0,t.jsxs)("div",{className:`${u.default.message} ${u.default.error}`,children:["âš ï¸ Cannot ",x?"update":"save"," order: Shop has overdue payments that must be settled first"]})]})]})]}):(0,t.jsx)("div",{className:u.default.loading,children:"Access denied to order management"})};e.s(["default",0,()=>(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{children:"Loading..."}),children:(0,t.jsx)(c,{})})])}]);