{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20NextJs%20Project%20Samitha/my-nextjs-app%20-%20Postgres/src/lib/database.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\n// Global database connection with optimization\r\ndeclare global {\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\n// Connection pool configuration\r\nconst createPrismaClient = () => {\r\n  return new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n    datasources: {\r\n      db: {\r\n        url: process.env.DATABASE_URL,\r\n      },\r\n    },\r\n  });\r\n};\r\n\r\n// Singleton pattern for database connection\r\nexport const prisma = globalThis.prisma || createPrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n  globalThis.prisma = prisma;\r\n}\r\n\r\n// Connection health check\r\nexport const checkDatabaseConnection = async (): Promise<boolean> => {\r\n  try {\r\n    // PostgreSQL-specific health check\r\n    await prisma.$queryRaw`SELECT 1 as health_check`;\r\n    return true;\r\n  } catch (error) {\r\n    console.error('PostgreSQL database connection failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Graceful shutdown\r\nexport const closeDatabaseConnection = async (): Promise<void> => {\r\n  await prisma.$disconnect();\r\n};\r\n\r\n// Query optimization helpers\r\nexport const withTransaction = async <T>(\r\n  fn: (tx: any) => Promise<T>\r\n): Promise<T> => {\r\n  return prisma.$transaction(fn, {\r\n    maxWait: 5000, // 5 seconds\r\n    timeout: 10000, // 10 seconds\r\n  });\r\n};\r\n\r\n// Bulk operations helper\r\nexport const batchOperation = async <T>(\r\n  items: T[],\r\n  operation: (item: T) => Promise<any>,\r\n  batchSize: number = 100\r\n): Promise<any[]> => {\r\n  const results = [];\r\n  \r\n  for (let i = 0; i < items.length; i += batchSize) {\r\n    const batch = items.slice(i, i + batchSize);\r\n    const batchResults = await Promise.all(batch.map(operation));\r\n    results.push(...batchResults);\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\nexport default prisma;"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAOA,gCAAgC;AAChC,MAAM,qBAAqB;IACzB,OAAO,IAAI,+JAAY,CAAC;QACtB,KAAK,uCAAyC;YAAC;YAAS;YAAS;SAAO,GAAG;QAC3E,aAAa;YACX,IAAI;gBACF,KAAK,QAAQ,GAAG,CAAC,YAAY;YAC/B;QACF;IACF;AACF;AAGO,MAAM,SAAS,WAAW,MAAM,IAAI;AAE3C,wCAA2C;IACzC,WAAW,MAAM,GAAG;AACtB;AAGO,MAAM,0BAA0B;IACrC,IAAI;QACF,mCAAmC;QACnC,MAAM,OAAO,SAAS,CAAC,wBAAwB,CAAC;QAChD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0CAA0C;QACxD,OAAO;IACT;AACF;AAGO,MAAM,0BAA0B;IACrC,MAAM,OAAO,WAAW;AAC1B;AAGO,MAAM,kBAAkB,OAC7B;IAEA,OAAO,OAAO,YAAY,CAAC,IAAI;QAC7B,SAAS;QACT,SAAS;IACX;AACF;AAGO,MAAM,iBAAiB,OAC5B,OACA,WACA,YAAoB,GAAG;IAEvB,MAAM,UAAU,EAAE;IAElB,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,KAAK,UAAW;QAChD,MAAM,QAAQ,MAAM,KAAK,CAAC,GAAG,IAAI;QACjC,MAAM,eAAe,MAAM,QAAQ,GAAG,CAAC,MAAM,GAAG,CAAC;QACjD,QAAQ,IAAI,IAAI;IAClB;IAEA,OAAO;AACT;uCAEe","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20NextJs%20Project%20Samitha/my-nextjs-app%20-%20Postgres/src/app/api/users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/database';\r\n\r\n// GET all users with caching\r\nexport async function GET() {\r\n  try {\r\n    const users = await prisma.user.findMany({\r\n      orderBy: {\r\n        createdAt: 'desc'\r\n      },\r\n      // Only select needed fields for performance\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        username: true,\r\n        password: true,\r\n        accessPages: true,\r\n        isActive: true,\r\n        createdAt: true,\r\n        updatedAt: true\r\n      }\r\n    });\r\n    \r\n    // Convert accessPages from JSON string to array for each user\r\n    const usersWithParsedAccessPages = users.map(user => ({\r\n      ...user,\r\n      accessPages: user.accessPages ? JSON.parse(user.accessPages as string) : []\r\n    }));\r\n    \r\n    const response = NextResponse.json(usersWithParsedAccessPages);\r\n    \r\n    // Add caching headers for better performance\r\n    response.headers.set('Cache-Control', 'public, s-maxage=60, stale-while-revalidate=300');\r\n    \r\n    return response;\r\n  } catch (error) {\r\n    console.error('Error fetching users:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch users' },\r\n      { status: 500 }\r\n    );\r\n  } finally {\r\n    // Don't disconnect in production due to connection pooling\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      await prisma.$disconnect();\r\n    }\r\n  }\r\n}\r\n\r\n// POST create new user\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { name, username, password, accessPages } = body;\r\n\r\n    // Validate required fields\r\n    if (!name || !username || !password) {\r\n      return NextResponse.json(\r\n        { error: 'Name, username, and password are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate accessPages is an array\r\n    if (!accessPages || !Array.isArray(accessPages) || accessPages.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'At least one access page must be selected' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if username already exists\r\n    const existingUser = await prisma.user.findUnique({\r\n      where: { username }\r\n    });\r\n\r\n    if (existingUser) {\r\n      return NextResponse.json(\r\n        { error: 'Username already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Create new user in database - convert accessPages array to JSON string\r\n    const newUser = await prisma.user.create({\r\n      data: {\r\n        name: name.trim(),\r\n        username: username.trim(),\r\n        password, // In production, hash this password\r\n        accessPages: JSON.stringify(accessPages),\r\n        isActive: true\r\n      }\r\n    });\r\n\r\n    // Return user with parsed accessPages for consistency\r\n    const userResponse = {\r\n      ...newUser,\r\n      accessPages: JSON.parse((newUser.accessPages as string) || '[]')\r\n    };\r\n\r\n    return NextResponse.json(userResponse, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating user:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create user' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,kIAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC,SAAS;gBACP,WAAW;YACb;YACA,4CAA4C;YAC5C,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,aAAa;gBACb,UAAU;gBACV,WAAW;gBACX,WAAW;YACb;QACF;QAEA,8DAA8D;QAC9D,MAAM,6BAA6B,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACpD,GAAG,IAAI;gBACP,aAAa,KAAK,WAAW,GAAG,KAAK,KAAK,CAAC,KAAK,WAAW,IAAc,EAAE;YAC7E,CAAC;QAED,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;QAEnC,6CAA6C;QAC7C,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;QAEtC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB,SAAU;QACR,2DAA2D;QAC3D,wCAA2C;YACzC,MAAM,kIAAM,CAAC,WAAW;QAC1B;IACF;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG;QAElD,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,UAAU;YACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,IAAI,CAAC,eAAe,CAAC,MAAM,OAAO,CAAC,gBAAgB,YAAY,MAAM,KAAK,GAAG;YAC3E,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,eAAe,MAAM,kIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE;YAAS;QACpB;QAEA,IAAI,cAAc;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,yEAAyE;QACzE,MAAM,UAAU,MAAM,kIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACvC,MAAM;gBACJ,MAAM,KAAK,IAAI;gBACf,UAAU,SAAS,IAAI;gBACvB;gBACA,aAAa,KAAK,SAAS,CAAC;gBAC5B,UAAU;YACZ;QACF;QAEA,sDAAsD;QACtD,MAAM,eAAe;YACnB,GAAG,OAAO;YACV,aAAa,KAAK,KAAK,CAAC,AAAC,QAAQ,WAAW,IAAe;QAC7D;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,cAAc;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}