{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20NextJs%20Project%20Samitha/my-nextjs-app%20-%20Postgres/src/lib/database.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\n// Global database connection with optimization\r\ndeclare global {\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\n// Connection pool configuration\r\nconst createPrismaClient = () => {\r\n  return new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n    datasources: {\r\n      db: {\r\n        url: process.env.DATABASE_URL,\r\n      },\r\n    },\r\n  });\r\n};\r\n\r\n// Singleton pattern for database connection\r\nexport const prisma = globalThis.prisma || createPrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n  globalThis.prisma = prisma;\r\n}\r\n\r\n// Connection health check\r\nexport const checkDatabaseConnection = async (): Promise<boolean> => {\r\n  try {\r\n    // PostgreSQL-specific health check\r\n    await prisma.$queryRaw`SELECT 1 as health_check`;\r\n    return true;\r\n  } catch (error) {\r\n    console.error('PostgreSQL database connection failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Graceful shutdown\r\nexport const closeDatabaseConnection = async (): Promise<void> => {\r\n  await prisma.$disconnect();\r\n};\r\n\r\n// Query optimization helpers\r\nexport const withTransaction = async <T>(\r\n  fn: (tx: any) => Promise<T>\r\n): Promise<T> => {\r\n  return prisma.$transaction(fn, {\r\n    maxWait: 5000, // 5 seconds\r\n    timeout: 10000, // 10 seconds\r\n  });\r\n};\r\n\r\n// Bulk operations helper\r\nexport const batchOperation = async <T>(\r\n  items: T[],\r\n  operation: (item: T) => Promise<any>,\r\n  batchSize: number = 100\r\n): Promise<any[]> => {\r\n  const results = [];\r\n  \r\n  for (let i = 0; i < items.length; i += batchSize) {\r\n    const batch = items.slice(i, i + batchSize);\r\n    const batchResults = await Promise.all(batch.map(operation));\r\n    results.push(...batchResults);\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\nexport default prisma;"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAOA,gCAAgC;AAChC,MAAM,qBAAqB;IACzB,OAAO,IAAI,+JAAY,CAAC;QACtB,KAAK,uCAAyC;YAAC;YAAS;YAAS;SAAO,GAAG;QAC3E,aAAa;YACX,IAAI;gBACF,KAAK,QAAQ,GAAG,CAAC,YAAY;YAC/B;QACF;IACF;AACF;AAGO,MAAM,SAAS,WAAW,MAAM,IAAI;AAE3C,wCAA2C;IACzC,WAAW,MAAM,GAAG;AACtB;AAGO,MAAM,0BAA0B;IACrC,IAAI;QACF,mCAAmC;QACnC,MAAM,OAAO,SAAS,CAAC,wBAAwB,CAAC;QAChD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0CAA0C;QACxD,OAAO;IACT;AACF;AAGO,MAAM,0BAA0B;IACrC,MAAM,OAAO,WAAW;AAC1B;AAGO,MAAM,kBAAkB,OAC7B;IAEA,OAAO,OAAO,YAAY,CAAC,IAAI;QAC7B,SAAS;QACT,SAAS;IACX;AACF;AAGO,MAAM,iBAAiB,OAC5B,OACA,WACA,YAAoB,GAAG;IAEvB,MAAM,UAAU,EAAE;IAElB,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,KAAK,UAAW;QAChD,MAAM,QAAQ,MAAM,KAAK,CAAC,GAAG,IAAI;QACjC,MAAM,eAAe,MAAM,QAAQ,GAAG,CAAC,MAAM,GAAG,CAAC;QACjD,QAAQ,IAAI,IAAI;IAClB;IAEA,OAAO;AACT;uCAEe","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20NextJs%20Project%20Samitha/my-nextjs-app%20-%20Postgres/src/app/api/users/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/database';\r\n\r\n// GET single user\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: parseInt(id) }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { error: 'User not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Convert accessPages from JSON string to array\r\n    const userWithParsedAccessPages = {\r\n      ...user,\r\n      accessPages: user.accessPages ? JSON.parse(user.accessPages as string) : []\r\n    };\r\n\r\n    return NextResponse.json(userWithParsedAccessPages);\r\n  } catch (error) {\r\n    console.error('Error fetching user:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch user' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PUT update user\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    const body = await request.json();\r\n    const { name, username, password, accessPages, isActive } = body;\r\n\r\n    // Prepare update data\r\n    const updateData: any = {};\r\n    \r\n    if (name !== undefined) updateData.name = name.trim();\r\n    if (username !== undefined) updateData.username = username.trim();\r\n    if (password !== undefined) updateData.password = password;\r\n    if (isActive !== undefined) updateData.isActive = isActive;\r\n    \r\n    // Convert accessPages array to JSON string if provided\r\n    if (accessPages !== undefined) {\r\n      if (!Array.isArray(accessPages)) {\r\n        return NextResponse.json(\r\n          { error: 'accessPages must be an array' },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.accessPages = JSON.stringify(accessPages);\r\n    }\r\n\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: parseInt(id) },\r\n      data: updateData\r\n    });\r\n\r\n    // Return user with parsed accessPages for consistency\r\n    const userResponse = {\r\n      ...updatedUser,\r\n      accessPages: updatedUser.accessPages ? JSON.parse(updatedUser.accessPages as string) : []\r\n    };\r\n\r\n    return NextResponse.json(userResponse);\r\n  } catch (error) {\r\n    console.error('Error updating user:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update user' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// DELETE user\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    \r\n    await prisma.user.delete({\r\n      where: { id: parseInt(id) }\r\n    });\r\n\r\n    return NextResponse.json({ message: 'User deleted successfully' });\r\n  } catch (error) {\r\n    console.error('Error deleting user:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete user' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,kIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI,SAAS;YAAI;QAC5B;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,gDAAgD;QAChD,MAAM,4BAA4B;YAChC,GAAG,IAAI;YACP,aAAa,KAAK,WAAW,GAAG,KAAK,KAAK,CAAC,KAAK,WAAW,IAAc,EAAE;QAC7E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAE,GAAG;QAE5D,sBAAsB;QACtB,MAAM,aAAkB,CAAC;QAEzB,IAAI,SAAS,WAAW,WAAW,IAAI,GAAG,KAAK,IAAI;QACnD,IAAI,aAAa,WAAW,WAAW,QAAQ,GAAG,SAAS,IAAI;QAC/D,IAAI,aAAa,WAAW,WAAW,QAAQ,GAAG;QAClD,IAAI,aAAa,WAAW,WAAW,QAAQ,GAAG;QAElD,uDAAuD;QACvD,IAAI,gBAAgB,WAAW;YAC7B,IAAI,CAAC,MAAM,OAAO,CAAC,cAAc;gBAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA+B,GACxC;oBAAE,QAAQ;gBAAI;YAElB;YACA,WAAW,WAAW,GAAG,KAAK,SAAS,CAAC;QAC1C;QAEA,MAAM,cAAc,MAAM,kIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YAC3C,OAAO;gBAAE,IAAI,SAAS;YAAI;YAC1B,MAAM;QACR;QAEA,sDAAsD;QACtD,MAAM,eAAe;YACnB,GAAG,WAAW;YACd,aAAa,YAAY,WAAW,GAAG,KAAK,KAAK,CAAC,YAAY,WAAW,IAAc,EAAE;QAC3F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,kIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACvB,OAAO;gBAAE,IAAI,SAAS;YAAI;QAC5B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA4B;IAClE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}