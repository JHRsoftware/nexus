module.exports=[9906,a=>{a.v({active:"add-module__gyZfRq__active",addButton:"add-module__gyZfRq__addButton",clearButton:"add-module__gyZfRq__clearButton",clearSupplierButton:"add-module__gyZfRq__clearSupplierButton",container:"add-module__gyZfRq__container",dropdown:"add-module__gyZfRq__dropdown",dropdownItem:"add-module__gyZfRq__dropdownItem",editButton:"add-module__gyZfRq__editButton",error:"add-module__gyZfRq__error",field:"add-module__gyZfRq__field",form:"add-module__gyZfRq__form",grnActions:"add-module__gyZfRq__grnActions",grnAmount:"add-module__gyZfRq__grnAmount",grnDetails:"add-module__gyZfRq__grnDetails",grnHeader:"add-module__gyZfRq__grnHeader",grnInfo:"add-module__gyZfRq__grnInfo",grnItem:"add-module__gyZfRq__grnItem",grnItems:"add-module__gyZfRq__grnItems",grnsContent:"add-module__gyZfRq__grnsContent",grnsHeader:"add-module__gyZfRq__grnsHeader",grnsList:"add-module__gyZfRq__grnsList",header:"add-module__gyZfRq__header",input:"add-module__gyZfRq__input",inputWrapper:"add-module__gyZfRq__inputWrapper",itemsTable:"add-module__gyZfRq__itemsTable",label:"add-module__gyZfRq__label",loadButton:"add-module__gyZfRq__loadButton",noGrns:"add-module__gyZfRq__noGrns",pageBtn:"add-module__gyZfRq__pageBtn",pageNumbers:"add-module__gyZfRq__pageNumbers",pagination:"add-module__gyZfRq__pagination",paginationInfo:"add-module__gyZfRq__paginationInfo",productInfo:"add-module__gyZfRq__productInfo",productSearch:"add-module__gyZfRq__productSearch",readOnlyInput:"add-module__gyZfRq__readOnlyInput",removeButton:"add-module__gyZfRq__removeButton",row:"add-module__gyZfRq__row",searchContainer:"add-module__gyZfRq__searchContainer",section:"add-module__gyZfRq__section",sectionTitle:"add-module__gyZfRq__sectionTitle",select:"add-module__gyZfRq__select",selectedInput:"add-module__gyZfRq__selectedInput",slideIn:"add-module__gyZfRq__slideIn",smallInput:"add-module__gyZfRq__smallInput",submitButton:"add-module__gyZfRq__submitButton",submitSection:"add-module__gyZfRq__submitSection",subtitle:"add-module__gyZfRq__subtitle",success:"add-module__gyZfRq__success",supplierInfo:"add-module__gyZfRq__supplierInfo",tableFooter:"add-module__gyZfRq__tableFooter",tableHeader:"add-module__gyZfRq__tableHeader",tableRow:"add-module__gyZfRq__tableRow",title:"add-module__gyZfRq__title",totalAmount:"add-module__gyZfRq__totalAmount",totalCost:"add-module__gyZfRq__totalCost"})},28018,a=>{"use strict";var b=a.i(87924),c=a.i(11642),d=a.i(9453),e=a.i(89531),f=a.i(1075),g=a.i(72131),h=a.i(9906);function i(){let{isAuthorized:a,isLoading:i}=(0,e.usePageProtection)("grn"),{user:j}=(0,c.useAuth)(),{isDarkMode:k}=(0,d.useTheme)(),[l,m]=(0,g.useState)(""),[n,o]=(0,g.useState)(""),[p,q]=(0,g.useState)(!1),[r,s]=(0,g.useState)({grnDate:new Date().toISOString().split("T")[0],supplierId:"",invoiceNumber:"",poNumber:"",paymentType:"cash"}),[t,u]=(0,g.useState)(null),[v,w]=(0,g.useState)(""),[x,y]=(0,g.useState)([]),[z,A]=(0,g.useState)(!1),[B,C]=(0,g.useState)(""),[D,E]=(0,g.useState)([]),[F,G]=(0,g.useState)(!1),[H,I]=(0,g.useState)([]),[J,K]=(0,g.useState)({productId:0,quantity:1,costPrice:0}),[L,M]=(0,g.useState)([]),[N,O]=(0,g.useState)(!1),[P,Q]=(0,g.useState)(1),[R,S]=(0,g.useState)({currentPage:1,totalPages:1,totalCount:0,hasNext:!1,hasPrev:!1}),[T,U]=(0,g.useState)(!1),[V,W]=(0,g.useState)(null),[X,Y]=(0,g.useState)(null),Z=async a=>{if(a.length<2)return void y([]);try{let b=await fetch(`/api/suppliers/search?q=${encodeURIComponent(a)}`),c=await b.json();b.ok&&y(c.suppliers||[])}catch(a){}},$=async a=>{if(a.length<2)return void E([]);try{let b=await fetch(`/api/products/search?q=${encodeURIComponent(a)}`),c=await b.json();b.ok&&E(c.products||[])}catch(a){}};(0,g.useEffect)(()=>{let a=setTimeout(()=>{v&&!t?(Z(v),A(!0)):v&&t&&v!==t.supplierName?(u(null),s(a=>({...a,supplierId:""})),Z(v),A(!0)):(y([]),A(!1))},300);return()=>clearTimeout(a)},[v,t]),(0,g.useEffect)(()=>{let a=setTimeout(()=>{B?($(B),G(!0)):(E([]),G(!1))},300);return()=>clearTimeout(a)},[B]);let _=async a=>{if(H.find(b=>b.productId===a.id))return void o("Product already added to GRN. You can update quantity in the table below.");if(!J.quantity||J.quantity<=0)return void o("Invalid quantity. Please enter a number greater than 0.");if(!J.costPrice||J.costPrice<=0)return void o("Invalid cost price. Please enter a number greater than 0.");if(T&&V&&j){q(!0);try{let b=await fetch("/api/grn/add-item",{method:"POST",headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(j)},body:JSON.stringify({grnId:V,productId:a.id,quantity:J.quantity,costPrice:J.costPrice})}),c=await b.json();if(!c.success){o(c.error||"Failed to add item to GRN"),q(!1);return}let{result:d}=c;m(`Item added successfully! GRN total updated to Rs. ${parseFloat(d.newTotalAmount).toFixed(2)}. ${d.totalItemsCount} item(s) in GRN.`);let e={productId:a.id,productCode:a.productCode,itemName:a.itemName,quantity:J.quantity,costPrice:J.costPrice,totalCost:J.quantity*J.costPrice};I(a=>[...a,e]),C(""),G(!1),E([]),K({productId:0,quantity:1,costPrice:0}),o(""),N&&ac(P),setTimeout(()=>m(""),5e3)}catch(a){o("An error occurred while adding item to GRN")}finally{q(!1)}}else{let b={productId:a.id,productCode:a.productCode,itemName:a.itemName,quantity:J.quantity,costPrice:J.costPrice,totalCost:J.quantity*J.costPrice};I(a=>[...a,b]),C(""),G(!1),E([]),K({productId:0,quantity:1,costPrice:0}),o(""),m("Product added to GRN successfully!"),setTimeout(()=>m(""),3e3)}},aa=async a=>{let b=H.find(b=>b.productId===a);if(!b)return void o("Item not found");if(window.confirm(`Are you sure you want to remove this item?

Product: ${b.itemName}
Quantity: ${b.quantity}
Cost Price: Rs. ${parseFloat(b.costPrice.toString()).toFixed(2)}
Total Cost: Rs. ${parseFloat(b.totalCost.toString()).toFixed(2)}

This action cannot be undone.`)){if(Y(a),T&&V&&j)try{let b=await fetch(`/api/grn/remove-item?grnId=${V}&productId=${a}`,{method:"DELETE",headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(j)}}),c=await b.json();if(!c.success){o(c.error||"Failed to remove item from GRN"),Y(null);return}let{result:d}=c;m(`Item removed successfully! GRN total updated to Rs. ${parseFloat(d.newTotalAmount).toFixed(2)}. ${d.remainingItemsCount} item(s) remaining in GRN.`),setTimeout(()=>m(""),5e3),I(b=>b.filter(b=>b.productId!==a)),Y(null),N&&ac(P);return}catch(a){o("An error occurred while removing GRN item"),Y(null);return}I(b=>b.filter(b=>b.productId!==a)),Y(null),T||(m("Item removed successfully!"),setTimeout(()=>m(""),3e3))}},ab=(a,b,c)=>{I(d=>d.map(d=>{if(d.productId===a){let a={...d,[b]:c};return a.totalCost=a.quantity*a.costPrice,a}return d}))},ac=async(a=1,b="")=>{try{q(!0),o("");let c=new URLSearchParams({page:a.toString(),limit:"10",...b&&{search:b}}),d=await fetch(`/api/grn?${c}`),e=await d.json();d.ok&&e.grns?(M(e.grns),S(e.pagination),Q(a),O(!0),m(`GRNs loaded successfully! (Page ${a} of ${e.pagination.totalPages})`)):o(e.error||"Failed to load GRNs")}catch(a){o("An error occurred while loading GRNs")}finally{q(!1)}},ad=()=>{U(!1),W(null),Y(null),s({grnDate:new Date().toISOString().split("T")[0],supplierId:"",invoiceNumber:"",poNumber:"",paymentType:"cash"}),u(null),w(""),I([]),K({productId:0,quantity:1,costPrice:0}),o(""),m("Form cleared. You can now create a new GRN.")},ae=async a=>{if(a.preventDefault(),!j)return void o("Please log in to "+(T?"update":"create")+" GRN");if(!t)return void o("Please select a supplier");if(0===H.length)return void o("Please add at least one product");q(!0),o(""),m("");try{let a=T?`/api/grn/${V}`:"/api/grn",b=T?"PUT":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json","x-user-data":JSON.stringify(j)},body:JSON.stringify({...r,items:H})}),d=await c.json();d.success?(m(T?"GRN updated successfully!":"GRN created successfully!"),T?ad():(s({grnDate:new Date().toISOString().split("T")[0],supplierId:"",invoiceNumber:"",poNumber:"",paymentType:"cash"}),u(null),w(""),I([])),N&&ac(P)):o(d.error||"Failed to "+(T?"update":"create")+" GRN")}catch(a){o("An error occurred while "+(T?"updating":"creating")+" GRN")}finally{q(!1)}};return i||!a?null:j?(0,b.jsxs)("div",{className:`${h.default.container} ${k?"dark":"light"}`,children:[(0,b.jsxs)("div",{className:h.default.header,children:[(0,b.jsx)("h1",{className:h.default.title,children:T?`Edit GRN #${V}`:"Create New GRN"}),T&&(0,b.jsx)("button",{type:"button",onClick:ad,className:h.default.clearButton,children:"Clear & Create New"})]}),(0,b.jsxs)("form",{onSubmit:ae,className:h.default.form,children:[(0,b.jsxs)("div",{className:h.default.section,children:[(0,b.jsx)("h2",{className:h.default.sectionTitle,children:"GRN Details"}),(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"GRN Date:"}),(0,b.jsx)("input",{type:"date",value:r.grnDate,onChange:a=>s(b=>({...b,grnDate:a.target.value})),className:h.default.input,required:!0})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Invoice Number:"}),(0,b.jsx)("input",{type:"text",value:r.invoiceNumber,onChange:a=>s(b=>({...b,invoiceNumber:a.target.value})),className:h.default.input,placeholder:"Enter invoice number",required:!0})]})]}),(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"PO Number:"}),(0,b.jsx)("input",{type:"text",value:r.poNumber,onChange:a=>s(b=>({...b,poNumber:a.target.value})),className:h.default.input,placeholder:"Enter PO number (optional)"})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Payment Type:"}),(0,b.jsxs)("select",{value:r.paymentType,onChange:a=>s(b=>({...b,paymentType:a.target.value})),className:h.default.select,required:!0,children:[(0,b.jsx)("option",{value:"cash",children:"Cash"}),(0,b.jsx)("option",{value:"credit",children:"Credit"}),(0,b.jsx)("option",{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Supplier:"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsxs)("div",{className:h.default.inputWrapper,children:[(0,b.jsx)("input",{type:"text",value:v,onChange:a=>w(a.target.value),onBlur:()=>{setTimeout(()=>{A(!1)},200)},onFocus:()=>{x.length>0&&!t&&A(!0)},className:`${h.default.input} ${t?h.default.selectedInput:""}`,placeholder:"Search supplier by name, contact, or email...",required:!0}),t&&(0,b.jsx)("button",{type:"button",onClick:()=>{u(null),w(""),s(a=>({...a,supplierId:""})),A(!1),y([])},className:h.default.clearSupplierButton,title:"Clear selected supplier",children:"Ã—"})]}),z&&x.length>0&&(0,b.jsx)("div",{className:h.default.dropdown,children:x.map(a=>(0,b.jsx)("div",{className:h.default.dropdownItem,onClick:()=>{u(a),w(a.supplierName),s(b=>({...b,supplierId:a.id.toString()})),A(!1),y([]),setTimeout(()=>{let a=document.activeElement;a&&a.blur&&a.blur()},100)},children:(0,b.jsxs)("div",{className:h.default.supplierInfo,children:[(0,b.jsx)("strong",{children:a.supplierName}),(0,b.jsx)("span",{children:a.contactNumber}),(0,b.jsx)("small",{children:a.email})]})},a.id))})]})]})]}),(0,b.jsxs)("div",{className:h.default.section,children:[(0,b.jsx)("h2",{className:h.default.sectionTitle,children:"Add Products"}),(0,b.jsx)("div",{className:h.default.productSearch,children:(0,b.jsxs)("div",{className:h.default.row,children:[(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Search Product:"}),(0,b.jsxs)("div",{className:h.default.searchContainer,children:[(0,b.jsx)("input",{type:"text",value:B,onChange:a=>C(a.target.value),className:h.default.input,placeholder:"Search product by code or name..."}),F&&D.length>0&&(0,b.jsx)("div",{className:h.default.dropdown,children:D.map(a=>(0,b.jsx)("div",{className:h.default.dropdownItem,onClick:()=>{K(b=>({...b,productId:a.id})),C(`${a.productCode} - ${a.itemName}`),G(!1),o("")},children:(0,b.jsxs)("div",{className:h.default.productInfo,children:[(0,b.jsx)("strong",{children:a.productCode}),(0,b.jsx)("span",{children:a.itemName}),(0,b.jsxs)("small",{children:["Category: ",a.category," | Available: ",a.availableQty]})]})},a.id))})]})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Quantity:"}),(0,b.jsx)("input",{type:"number",value:J.quantity,onChange:a=>K(b=>({...b,quantity:parseInt(a.target.value)||1})),onWheel:f.handleNumberInputWheel,className:h.default.input,min:"1",required:!0})]}),(0,b.jsxs)("div",{className:h.default.field,children:[(0,b.jsx)("label",{className:h.default.label,children:"Cost Price:"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:J.costPrice,onChange:a=>K(b=>({...b,costPrice:parseFloat(a.target.value)||0})),onWheel:f.handleNumberInputWheel,className:h.default.input,min:"0",required:!0})]}),(0,b.jsx)("div",{className:h.default.field,children:(0,b.jsx)("button",{type:"button",onClick:()=>{if(o(""),m(""),!J.productId||0===J.productId)return void o("Please select a product from the dropdown");if(!J.quantity||J.quantity<=0)return void o("Please enter a valid quantity (greater than 0)");if(!J.costPrice||J.costPrice<=0)return void o("Please enter a valid cost price (greater than 0)");let a=D.find(a=>a.id===J.productId)||(B?{id:J.productId,productCode:B.split(" - ")[0],itemName:B.split(" - ")[1]||B,category:"",sellingPrice:0,availableQty:0}:null);a?_(a):o("Selected product not found. Please search and select again.")},className:h.default.addButton,disabled:!J.productId||J.quantity<=0||J.costPrice<=0,children:"Add Product"})})]})})]}),H.length>0&&(0,b.jsxs)("div",{className:h.default.section,children:[(0,b.jsx)("h2",{className:h.default.sectionTitle,children:"GRN Items"}),(0,b.jsxs)("div",{className:h.default.itemsTable,children:[(0,b.jsxs)("div",{className:h.default.tableHeader,children:[(0,b.jsx)("div",{children:"Product Code"}),(0,b.jsx)("div",{children:"Product Name"}),(0,b.jsx)("div",{children:"Quantity"}),(0,b.jsx)("div",{children:"Cost Price"}),(0,b.jsx)("div",{children:"Total Cost"}),(0,b.jsx)("div",{children:"Actions"})]}),H.map(a=>(0,b.jsxs)("div",{className:h.default.tableRow,children:[(0,b.jsx)("div",{children:a.productCode}),(0,b.jsx)("div",{children:a.itemName}),(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"number",value:a.quantity,onChange:T?void 0:b=>ab(a.productId,"quantity",parseInt(b.target.value)||1),onWheel:f.handleNumberInputWheel,className:`${h.default.smallInput} ${T?h.default.readOnlyInput:""}`,min:"1",readOnly:T,disabled:T})}),(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"number",step:"0.01",value:a.costPrice,onChange:T?void 0:b=>ab(a.productId,"costPrice",parseFloat(b.target.value)||0),onWheel:f.handleNumberInputWheel,className:`${h.default.smallInput} ${T?h.default.readOnlyInput:""}`,min:"0",readOnly:T,disabled:T})}),(0,b.jsxs)("div",{className:h.default.totalCost,children:["Rs. ",a.totalCost.toFixed(2)]}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"button",onClick:()=>aa(a.productId),className:h.default.removeButton,disabled:X===a.productId||p,children:X===a.productId?"Removing...":"Remove"})})]},a.productId)),(0,b.jsx)("div",{className:h.default.tableFooter,children:(0,b.jsx)("div",{className:h.default.totalAmount,children:(0,b.jsxs)("strong",{children:["Total Amount: Rs. ",H.reduce((a,b)=>a+b.totalCost,0).toFixed(2)]})})})]})]}),(0,b.jsx)("div",{className:h.default.submitSection,children:(0,b.jsx)("button",{type:"submit",className:h.default.submitButton,disabled:p||!t||0===H.length,children:p?T?"Updating GRN...":"Creating GRN...":T?"Update GRN":"Create GRN"})}),l&&(0,b.jsx)("p",{className:h.default.success,children:l}),n&&(0,b.jsx)("p",{className:h.default.error,children:n})]}),(0,b.jsxs)("div",{className:h.default.grnsList,children:[(0,b.jsxs)("div",{className:h.default.grnsHeader,children:[(0,b.jsx)("h2",{className:h.default.subtitle,children:"Existing GRNs"}),(0,b.jsx)("button",{onClick:()=>ac(1),className:h.default.loadButton,disabled:p,children:p?"Loading...":"Load GRNs"})]}),N&&(0,b.jsxs)("div",{className:h.default.grnsContent,children:[0===L.length?(0,b.jsx)("p",{className:h.default.noGrns,children:"No GRNs found."}):(0,b.jsx)("div",{className:h.default.grnItems,children:L.map(a=>(0,b.jsxs)("div",{className:h.default.grnItem,children:[(0,b.jsxs)("div",{className:h.default.grnHeader,children:[(0,b.jsxs)("div",{className:h.default.grnInfo,children:[(0,b.jsxs)("strong",{children:["GRN #",a.id]}),(0,b.jsxs)("span",{children:["Date: ",new Date(a.grnDate).toLocaleDateString()]}),(0,b.jsxs)("span",{children:["Invoice: ",a.invoiceNumber]})]}),(0,b.jsxs)("div",{className:h.default.grnActions,children:[(0,b.jsxs)("div",{className:h.default.grnAmount,children:["Rs. ",parseFloat(a.totalAmount.toString()).toFixed(2)]}),(0,b.jsx)("button",{type:"button",onClick:()=>(a=>{try{o(""),m(""),U(!0),W(a.id),s({grnDate:a.grnDate.split("T")[0],supplierId:a.supplier.id.toString(),invoiceNumber:a.invoiceNumber,poNumber:a.poNumber||"",paymentType:a.paymentType}),u({id:a.supplier.id,supplierName:a.supplier.supplierName,contactNumber:a.supplier.contactNumber,email:a.supplier.email||"",address:a.supplier.address||""}),w(a.supplier.supplierName);let b=a.grnItems.map(a=>({productId:a.product.id,productCode:a.product.productCode,itemName:a.product.itemName,quantity:a.quantity,costPrice:a.costPrice,totalCost:a.quantity*a.costPrice}));I(b),m(`GRN #${a.id} loaded for editing. You can now modify and update.`),window.scrollTo({top:0,behavior:"smooth"})}catch(a){o("Failed to load GRN for editing")}})(a),className:h.default.editButton,disabled:p,children:"Edit"})]})]}),(0,b.jsxs)("div",{className:h.default.grnDetails,children:[(0,b.jsxs)("div",{children:["Supplier: ",a.supplier.supplierName]}),(0,b.jsxs)("div",{children:["Payment: ",a.paymentType.toUpperCase()]}),(0,b.jsxs)("div",{children:["Items: ",a.grnItems.length]}),(0,b.jsxs)("div",{children:["User: ",a.user]})]})]},a.id))}),R.totalPages>1&&(0,b.jsxs)("div",{className:h.default.pagination,children:[(0,b.jsx)("button",{onClick:()=>ac(P-1),disabled:!R.hasPrev||p,className:h.default.pageBtn,children:"Previous"}),(0,b.jsx)("div",{className:h.default.pageNumbers,children:Array.from({length:Math.min(5,R.totalPages)},(a,c)=>{let d=Math.max(1,P-2)+c;return d<=R.totalPages?(0,b.jsx)("button",{onClick:()=>ac(d),disabled:p,className:`${h.default.pageBtn} ${d===P?h.default.active:""}`,children:d},d):null})}),(0,b.jsx)("button",{onClick:()=>ac(P+1),disabled:!R.hasNext||p,className:h.default.pageBtn,children:"Next"})]}),(0,b.jsx)("div",{className:h.default.paginationInfo,children:(0,b.jsxs)("p",{children:["Showing page ",R.currentPage," of ",R.totalPages,"(",R.totalCount," total GRNs)"]})})]})]})]}):(0,b.jsx)("div",{className:h.default.container,children:(0,b.jsx)("p",{className:h.default.error,children:"Please log in to access GRN management."})})}a.s(["default",()=>i])}];

//# sourceMappingURL=src_app_grn_add_d0d96160._.js.map