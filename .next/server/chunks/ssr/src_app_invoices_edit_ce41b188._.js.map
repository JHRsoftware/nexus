{"version":3,"sources":["turbopack:///[project]/src/app/invoices/edit/edit-invoice.module.css [app-ssr] (css module)","turbopack:///[project]/src/app/invoices/edit/page.tsx"],"sourcesContent":["__turbopack_context__.v({\n  \"actions\": \"edit-invoice-module__TriEPG__actions\",\n  \"addProductSection\": \"edit-invoice-module__TriEPG__addProductSection\",\n  \"amountDue\": \"edit-invoice-module__TriEPG__amountDue\",\n  \"amountPaid\": \"edit-invoice-module__TriEPG__amountPaid\",\n  \"balanceClear\": \"edit-invoice-module__TriEPG__balanceClear\",\n  \"balanceDue\": \"edit-invoice-module__TriEPG__balanceDue\",\n  \"cancelButton\": \"edit-invoice-module__TriEPG__cancelButton\",\n  \"cancelCreditLimitBtn\": \"edit-invoice-module__TriEPG__cancelCreditLimitBtn\",\n  \"cashDiscountLabel\": \"edit-invoice-module__TriEPG__cashDiscountLabel\",\n  \"checkbox\": \"edit-invoice-module__TriEPG__checkbox\",\n  \"checkboxLabel\": \"edit-invoice-module__TriEPG__checkboxLabel\",\n  \"clearSelection\": \"edit-invoice-module__TriEPG__clearSelection\",\n  \"comingSoon\": \"edit-invoice-module__TriEPG__comingSoon\",\n  \"completed\": \"edit-invoice-module__TriEPG__completed\",\n  \"container\": \"edit-invoice-module__TriEPG__container\",\n  \"creditInfoSection\": \"edit-invoice-module__TriEPG__creditInfoSection\",\n  \"creditLimitActions\": \"edit-invoice-module__TriEPG__creditLimitActions\",\n  \"creditLimitEdit\": \"edit-invoice-module__TriEPG__creditLimitEdit\",\n  \"creditLimitInput\": \"edit-invoice-module__TriEPG__creditLimitInput\",\n  \"creditLimitSection\": \"edit-invoice-module__TriEPG__creditLimitSection\",\n  \"creditWarning\": \"edit-invoice-module__TriEPG__creditWarning\",\n  \"dark\": \"edit-invoice-module__TriEPG__dark\",\n  \"discountInput\": \"edit-invoice-module__TriEPG__discountInput\",\n  \"dropdown\": \"edit-invoice-module__TriEPG__dropdown\",\n  \"dropdownItem\": \"edit-invoice-module__TriEPG__dropdownItem\",\n  \"editCreditLimitBtn\": \"edit-invoice-module__TriEPG__editCreditLimitBtn\",\n  \"editSection\": \"edit-invoice-module__TriEPG__editSection\",\n  \"editTitle\": \"edit-invoice-module__TriEPG__editTitle\",\n  \"error\": \"edit-invoice-module__TriEPG__error\",\n  \"fadeIn\": \"edit-invoice-module__TriEPG__fadeIn\",\n  \"field\": \"edit-invoice-module__TriEPG__field\",\n  \"form\": \"edit-invoice-module__TriEPG__form\",\n  \"header\": \"edit-invoice-module__TriEPG__header\",\n  \"input\": \"edit-invoice-module__TriEPG__input\",\n  \"invoiceDetails\": \"edit-invoice-module__TriEPG__invoiceDetails\",\n  \"invoiceInfo\": \"edit-invoice-module__TriEPG__invoiceInfo\",\n  \"invoiceNumber\": \"edit-invoice-module__TriEPG__invoiceNumber\",\n  \"invoiceShop\": \"edit-invoice-module__TriEPG__invoiceShop\",\n  \"invoiceTypeNotesRow\": \"edit-invoice-module__TriEPG__invoiceTypeNotesRow\",\n  \"itemRow\": \"edit-invoice-module__TriEPG__itemRow\",\n  \"itemRowNoDiscount\": \"edit-invoice-module__TriEPG__itemRowNoDiscount\",\n  \"itemsHeader\": \"edit-invoice-module__TriEPG__itemsHeader\",\n  \"itemsHeaderNoDiscount\": \"edit-invoice-module__TriEPG__itemsHeaderNoDiscount\",\n  \"itemsSection\": \"edit-invoice-module__TriEPG__itemsSection\",\n  \"itemsTable\": \"edit-invoice-module__TriEPG__itemsTable\",\n  \"label\": \"edit-invoice-module__TriEPG__label\",\n  \"loading\": \"edit-invoice-module__TriEPG__loading\",\n  \"minimumStockNote\": \"edit-invoice-module__TriEPG__minimumStockNote\",\n  \"netTotal\": \"edit-invoice-module__TriEPG__netTotal\",\n  \"netTotalDisplay\": \"edit-invoice-module__TriEPG__netTotalDisplay\",\n  \"noItemsMessage\": \"edit-invoice-module__TriEPG__noItemsMessage\",\n  \"noItemsRow\": \"edit-invoice-module__TriEPG__noItemsRow\",\n  \"notesInput\": \"edit-invoice-module__TriEPG__notesInput\",\n  \"overdueDetails\": \"edit-invoice-module__TriEPG__overdueDetails\",\n  \"overdueItem\": \"edit-invoice-module__TriEPG__overdueItem\",\n  \"overdueMore\": \"edit-invoice-module__TriEPG__overdueMore\",\n  \"overdueWarning\": \"edit-invoice-module__TriEPG__overdueWarning\",\n  \"partial\": \"edit-invoice-module__TriEPG__partial\",\n  \"paymentAmount\": \"edit-invoice-module__TriEPG__paymentAmount\",\n  \"paymentDueDate\": \"edit-invoice-module__TriEPG__paymentDueDate\",\n  \"paymentInfoCard\": \"edit-invoice-module__TriEPG__paymentInfoCard\",\n  \"paymentInfoGrid\": \"edit-invoice-module__TriEPG__paymentInfoGrid\",\n  \"paymentInfoLabel\": \"edit-invoice-module__TriEPG__paymentInfoLabel\",\n  \"paymentInfoSection\": \"edit-invoice-module__TriEPG__paymentInfoSection\",\n  \"paymentInfoTitle\": \"edit-invoice-module__TriEPG__paymentInfoTitle\",\n  \"paymentStatus\": \"edit-invoice-module__TriEPG__paymentStatus\",\n  \"paymentWarning\": \"edit-invoice-module__TriEPG__paymentWarning\",\n  \"pending\": \"edit-invoice-module__TriEPG__pending\",\n  \"permissionNote\": \"edit-invoice-module__TriEPG__permissionNote\",\n  \"price\": \"edit-invoice-module__TriEPG__price\",\n  \"priceInput\": \"edit-invoice-module__TriEPG__priceInput\",\n  \"product\": \"edit-invoice-module__TriEPG__product\",\n  \"productCode\": \"edit-invoice-module__TriEPG__productCode\",\n  \"productDetails\": \"edit-invoice-module__TriEPG__productDetails\",\n  \"productInfo\": \"edit-invoice-module__TriEPG__productInfo\",\n  \"productName\": \"edit-invoice-module__TriEPG__productName\",\n  \"productUnavailable\": \"edit-invoice-module__TriEPG__productUnavailable\",\n  \"profitRow\": \"edit-invoice-module__TriEPG__profitRow\",\n  \"pulse\": \"edit-invoice-module__TriEPG__pulse\",\n  \"quantityInput\": \"edit-invoice-module__TriEPG__quantityInput\",\n  \"removeButton\": \"edit-invoice-module__TriEPG__removeButton\",\n  \"repContact\": \"edit-invoice-module__TriEPG__repContact\",\n  \"repName\": \"edit-invoice-module__TriEPG__repName\",\n  \"row\": \"edit-invoice-module__TriEPG__row\",\n  \"saveCredtiLimitBtn\": \"edit-invoice-module__TriEPG__saveCredtiLimitBtn\",\n  \"searchContainer\": \"edit-invoice-module__TriEPG__searchContainer\",\n  \"searchSection\": \"edit-invoice-module__TriEPG__searchSection\",\n  \"searchTitle\": \"edit-invoice-module__TriEPG__searchTitle\",\n  \"sectionTitle\": \"edit-invoice-module__TriEPG__sectionTitle\",\n  \"select\": \"edit-invoice-module__TriEPG__select\",\n  \"selectedShopDetails\": \"edit-invoice-module__TriEPG__selectedShopDetails\",\n  \"shopDetailCard\": \"edit-invoice-module__TriEPG__shopDetailCard\",\n  \"shopDetailLabel\": \"edit-invoice-module__TriEPG__shopDetailLabel\",\n  \"shopDetailRow\": \"edit-invoice-module__TriEPG__shopDetailRow\",\n  \"shopDetailValue\": \"edit-invoice-module__TriEPG__shopDetailValue\",\n  \"shopInfo\": \"edit-invoice-module__TriEPG__shopInfo\",\n  \"shopName\": \"edit-invoice-module__TriEPG__shopName\",\n  \"shopOwner\": \"edit-invoice-module__TriEPG__shopOwner\",\n  \"slideIn\": \"edit-invoice-module__TriEPG__slideIn\",\n  \"submitButton\": \"edit-invoice-module__TriEPG__submitButton\",\n  \"submitSection\": \"edit-invoice-module__TriEPG__submitSection\",\n  \"success\": \"edit-invoice-module__TriEPG__success\",\n  \"textarea\": \"edit-invoice-module__TriEPG__textarea\",\n  \"title\": \"edit-invoice-module__TriEPG__title\",\n  \"totalDisplay\": \"edit-invoice-module__TriEPG__totalDisplay\",\n  \"totalPrice\": \"edit-invoice-module__TriEPG__totalPrice\",\n  \"totalRow\": \"edit-invoice-module__TriEPG__totalRow\",\n  \"totalsGrid\": \"edit-invoice-module__TriEPG__totalsGrid\",\n  \"totalsSection\": \"edit-invoice-module__TriEPG__totalsSection\",\n  \"unauthorized\": \"edit-invoice-module__TriEPG__unauthorized\",\n  \"unavailableTag\": \"edit-invoice-module__TriEPG__unavailableTag\",\n});\n","'use client';\r\n\r\nimport React, { useState, useEffect, useCallback, useMemo, Suspense } from 'react';\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { usePageProtection } from '@/components/ProtectedRoute';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { handleNumberInputWheel } from '@/lib/numberInputUtils';\r\nimport styles from './edit-invoice.module.css';\r\n\r\ninterface Shop {\r\n  id: number;\r\n  shopName: string;\r\n  ownerName: string;\r\n  contactNumber: string;\r\n  creditLimit: number;\r\n  balanceAmount: number;\r\n}\r\n\r\ninterface Discount {\r\n  id: number;\r\n  discountName: string;\r\n  percentage: number;\r\n}\r\n\r\ninterface Product {\r\n  id: number;\r\n  productCode: string;\r\n  itemName: string;\r\n  sellingPrice: number;\r\n  availableQty: number;\r\n  category: string;\r\n  costPrice?: number;\r\n}\r\n\r\ninterface SalesRep {\r\n  id: number;\r\n  name: string;\r\n  contactNumber: string;\r\n  status: string;\r\n}\r\n\r\ninterface InvoiceItem {\r\n  id: string;\r\n  productId: number;\r\n  productCode: string;\r\n  productName: string;\r\n  quantity: number;\r\n  sellingPrice: number;\r\n  discount: number;\r\n  price: number;\r\n  totalPrice: number;\r\n  availableQty: number;\r\n  costPrice: number;\r\n  itemCost?: number;\r\n  itemProfit?: number;\r\n}\r\n\r\ninterface Invoice {\r\n  id: number;\r\n  invoiceNumber: string;\r\n  invoiceDate: string;\r\n  shop: Shop;\r\n  salesRep?: SalesRep;\r\n  discount?: Discount;\r\n  subTotal: number;\r\n  totalDiscount: number;\r\n  cashDiscount: number;\r\n  cashDiscountEnabled: boolean;\r\n  cashDiscountPercentage?: number;\r\n  netTotal: number;\r\n  totalCost?: number;\r\n  totalProfit?: number;\r\n  notes?: string;\r\n  invoiceItems: any[];\r\n}\r\n\r\ninterface PendingPayment {\r\n  id: number;\r\n  invoiceId: number;\r\n  shopId: number;\r\n  netTotal: number;\r\n  paidAmount: number;\r\n  remainingAmount: number;\r\n  paymentStatus: string;\r\n  dueDate: string | null;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\ninterface OverduePayment {\r\n  id: number;\r\n  invoiceNumber: string;\r\n  dueDate: string;\r\n  remainingAmount: number;\r\n  daysPastDue: number;\r\n}\r\n\r\ninterface InvoiceSearchResult {\r\n  id: number;\r\n  invoiceNumber: string;\r\n  invoiceDate: string;\r\n  shopName: string;\r\n  ownerName: string;\r\n  netTotal: number;\r\n}\r\n\r\nconst EditInvoicePage: React.FC = () => {\r\n  // URL search parameters and navigation\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  \r\n  // Page protection\r\n  const { isAuthorized, isLoading: authLoading } = usePageProtection('invoices-edit');\r\n  const { user, isLoading, hasAccess } = useAuth();\r\n\r\n  // Invoice settings state\r\n  const [invoiceSettings, setInvoiceSettings] = useState({\r\n    isSellingPriceReadonly: false,\r\n    isDiscountReadonly: false,\r\n    showTotalDiscountFromItems: true,\r\n    showTotalBalanceDiscount: false,\r\n    totalBalanceDiscountPercent: 5,\r\n    hideCostProfit: false\r\n  });\r\n\r\n  // Date formatting functions\r\n  const formatDateForDisplay = (isoDate: string) => {\r\n    const date = new Date(isoDate);\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const year = date.getFullYear();\r\n    return `${day}/${month}/${year}`;\r\n  };\r\n\r\n  const formatDateForInput = (displayDate: string) => {\r\n    const [day, month, year] = displayDate.split('/');\r\n    if (!day || !month || !year) return '';\r\n    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\r\n  };\r\n\r\n  // Form state\r\n  const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);\r\n  const [invoiceDateDisplay, setInvoiceDateDisplay] = useState(formatDateForDisplay(new Date().toISOString().split('T')[0]));\r\n  const [selectedShop, setSelectedShop] = useState<Shop | null>(null);\r\n  const [selectedSalesRep, setSelectedSalesRep] = useState<SalesRep | null>(null);\r\n  const [selectedDiscount, setSelectedDiscount] = useState<Discount | null>(null);\r\n  const [cashDiscountEnabled, setCashDiscountEnabled] = useState(false);\r\n  const [cashDiscountPercentage, setCashDiscountPercentage] = useState<number>(0);\r\n  const [invoiceItems, setInvoiceItems] = useState<InvoiceItem[]>([]);\r\n  const [dueDate, setDueDate] = useState('');\r\n  const [dueDateDisplay, setDueDateDisplay] = useState('');\r\n  const [dueDateOptions, setDueDateOptions] = useState<{label: string, days: number, isDefault: boolean}[]>([]);\r\n  const [selectedDueDateOption, setSelectedDueDateOption] = useState<{label: string, days: number, isDefault: boolean} | null>(null);\r\n  const [notes, setNotes] = useState('');\r\n  \r\n  // Search states\r\n  const [invoiceSearchTerm, setInvoiceSearchTerm] = useState('');\r\n  const [shopSearchTerm, setShopSearchTerm] = useState('');\r\n  const [productSearchTerm, setProductSearchTerm] = useState('');\r\n  const [salesRepSearchTerm, setSalesRepSearchTerm] = useState('');\r\n  \r\n  // Data states\r\n  const [invoiceSearchResults, setInvoiceSearchResults] = useState<InvoiceSearchResult[]>([]);\r\n  const [shops, setShops] = useState<Shop[]>([]);\r\n  const [discounts, setDiscounts] = useState<Discount[]>([]);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [salesReps, setSalesReps] = useState<SalesRep[]>([]);\r\n  \r\n  // Dropdown visibility states\r\n  const [showInvoiceDropdown, setShowInvoiceDropdown] = useState(false);\r\n  const [showShopDropdown, setShowShopDropdown] = useState(false);\r\n  const [showProductDropdown, setShowProductDropdown] = useState(false);\r\n  const [showSalesRepDropdown, setShowSalesRepDropdown] = useState(false);\r\n  \r\n  // Loading and status states\r\n  const [isLoadingForm, setIsLoadingForm] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [message, setMessage] = useState('');\r\n  const [selectedInvoice, setSelectedInvoice] = useState<Invoice | null>(null);\r\n  const [pendingPaymentData, setPendingPaymentData] = useState<PendingPayment | null>(null);\r\n  const [isLoadingPayment, setIsLoadingPayment] = useState(false);\r\n  \r\n  // Credit limit management states\r\n  const [isEditingCreditLimit, setIsEditingCreditLimit] = useState(false);\r\n  const [newCreditLimit, setNewCreditLimit] = useState('');\r\n  const [isUpdatingCreditLimit, setIsUpdatingCreditLimit] = useState(false);\r\n  \r\n  // Overdue payment checking\r\n  const [overduePayments, setOverduePayments] = useState<OverduePayment[]>([]);\r\n  const [hasOverduePayments, setHasOverduePayments] = useState(false);\r\n\r\n  // Minimum stock requirement - always keep at least 1 in stock\r\n  const MINIMUM_STOCK_REQUIRED = 1;\r\n\r\n  // User headers helper\r\n  const getUserHeaders = () => {\r\n    const currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');\r\n    const headers: HeadersInit = { 'Content-Type': 'application/json' };\r\n    \r\n    if (currentUser) {\r\n      headers['x-user-data'] = currentUser;\r\n    }\r\n    \r\n    return headers;\r\n  };\r\n\r\n  // Check if current discount is credit invoice\r\n  const isCreditInvoice = () => {\r\n    return Boolean(selectedDiscount && selectedDiscount.discountName.toLowerCase().includes('credit'));\r\n  };\r\n\r\n  // Handle due date option change\r\n  const handleDueDateOptionChange = (option: {label: string, days: number, isDefault: boolean}) => {\r\n    setSelectedDueDateOption(option);\r\n  };\r\n\r\n  // Validate date format\r\n  const isValidDate = (dateString: string): boolean => {\r\n    if (!dateString || dateString.length !== 10) return false;\r\n    const [day, month, year] = dateString.split('/');\r\n    if (!day || !month || !year) return false;\r\n    const dayNum = parseInt(day);\r\n    const monthNum = parseInt(month);\r\n    const yearNum = parseInt(year);\r\n    \r\n    if (dayNum < 1 || dayNum > 31) return false;\r\n    if (monthNum < 1 || monthNum > 12) return false;\r\n    if (yearNum < 1900 || yearNum > 2100) return false;\r\n    \r\n    const date = new Date(yearNum, monthNum - 1, dayNum);\r\n    return date.getFullYear() === yearNum && \r\n           date.getMonth() === monthNum - 1 && \r\n           date.getDate() === dayNum;\r\n  };\r\n\r\n  // Load due date options from settings\r\n  const loadDueDateOptions = async () => {\r\n    try {\r\n      const response = await fetch('/api/softwareSettings', {\r\n        headers: getUserHeaders()\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success && data.settings && data.settings.dueDateOptions) {\r\n          setDueDateOptions(data.settings.dueDateOptions);\r\n          \r\n          // Set default option\r\n          const defaultOption = data.settings.dueDateOptions.find((opt: any) => opt.isDefault);\r\n          if (defaultOption) {\r\n            setSelectedDueDateOption(defaultOption);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading due date options:', error);\r\n    }\r\n  };\r\n\r\n  // Load discounts\r\n  const loadDiscounts = async () => {\r\n    try {\r\n      const response = await fetch('/api/discounts');\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setDiscounts(data.discounts.filter((d: Discount) => d.percentage > 0));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading discounts:', error);\r\n    }\r\n  };\r\n\r\n  // Search invoices\r\n  const searchInvoices = useCallback(async (search: string) => {\r\n    if (search.length < 2) {\r\n      setInvoiceSearchResults([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/invoices/search?search=${encodeURIComponent(search)}&limit=10`, {\r\n        headers: getUserHeaders()\r\n      });\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setInvoiceSearchResults(data.invoices || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching invoices:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Search shops\r\n  const searchShops = useCallback(async (search: string) => {\r\n    if (search.length < 2) {\r\n      setShops([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/shops?search=${encodeURIComponent(search)}&limit=10&activeOnly=true`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setShops(data.shops || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching shops:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Search products\r\n  const searchProducts = useCallback(async (search: string) => {\r\n    if (search.length < 2) {\r\n      setProducts([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/products/search?search=${encodeURIComponent(search)}&limit=10`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setProducts(data.products || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching products:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Search sales reps\r\n  const searchSalesReps = useCallback(async (search: string) => {\r\n    try {\r\n      const response = await fetch(`/api/sales-rep?search=${encodeURIComponent(search)}&activeOnly=true`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        const activeSalesReps = data.salesReps?.filter((rep: SalesRep) => rep.status === 'active') || [];\r\n        setSalesReps(activeSalesReps);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching sales reps:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Debounced search effects\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (invoiceSearchTerm) {\r\n        searchInvoices(invoiceSearchTerm);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [invoiceSearchTerm, searchInvoices]);\r\n\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (shopSearchTerm) {\r\n        searchShops(shopSearchTerm);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [shopSearchTerm, searchShops]);\r\n\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (productSearchTerm) {\r\n        searchProducts(productSearchTerm);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [productSearchTerm, searchProducts]);\r\n\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (salesRepSearchTerm) {\r\n        searchSalesReps(salesRepSearchTerm);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [salesRepSearchTerm, searchSalesReps]);\r\n\r\n  // Auto-load invoice if invoiceId parameter is provided in URL\r\n  useEffect(() => {\r\n    const invoiceId = searchParams.get('invoiceId');\r\n    if (invoiceId && !isNaN(parseInt(invoiceId))) {\r\n      const numericInvoiceId = parseInt(invoiceId);\r\n      console.log('Auto-loading invoice from URL parameter:', numericInvoiceId);\r\n      loadInvoiceDetails(numericInvoiceId);\r\n    }\r\n  }, [searchParams]);\r\n\r\n  // Load due date options and discounts on component mount\r\n  useEffect(() => {\r\n    loadDueDateOptions();\r\n    loadDiscounts();\r\n  }, []);\r\n\r\n  // Calculate due date when invoice date or payment terms change\r\n  useEffect(() => {\r\n    if (isCreditInvoice() && invoiceDate && selectedDueDateOption) {\r\n      const calculatedDueDate = new Date(invoiceDate);\r\n      calculatedDueDate.setDate(calculatedDueDate.getDate() + selectedDueDateOption.days);\r\n      const dueDateISO = calculatedDueDate.toISOString().split('T')[0];\r\n      setDueDate(dueDateISO);\r\n      setDueDateDisplay(formatDateForDisplay(dueDateISO));\r\n    } else {\r\n      setDueDate('');\r\n      setDueDateDisplay('');\r\n    }\r\n  }, [invoiceDate, selectedDiscount, selectedDueDateOption]);\r\n\r\n  // Add product to invoice\r\n  const addProductToInvoice = (product: Product) => {\r\n    const existingItem = invoiceItems.find(item => item.productId === product.id);\r\n    \r\n    if (existingItem) {\r\n      // Check if we can increase quantity while maintaining minimum stock\r\n      const maxAllowedQty = existingItem.availableQty - MINIMUM_STOCK_REQUIRED;\r\n      if (existingItem.quantity < maxAllowedQty) {\r\n        updateInvoiceItem(existingItem.id, 'quantity', existingItem.quantity + 1);\r\n      } else {\r\n        setError(`Cannot add more ${product.itemName}. Must maintain minimum stock of ${MINIMUM_STOCK_REQUIRED}. Available for sale: ${maxAllowedQty}`);\r\n      }\r\n    } else {\r\n      // Check if product has enough stock to add (must leave at least 1 in stock)\r\n      const availableForSale = product.availableQty - MINIMUM_STOCK_REQUIRED;\r\n      \r\n      if (availableForSale < 1) {\r\n        setError(`Cannot add ${product.itemName}. Must maintain minimum stock of ${MINIMUM_STOCK_REQUIRED}. Current stock: ${product.availableQty}`);\r\n        setProductSearchTerm('');\r\n        setProducts([]);\r\n        setShowProductDropdown(false);\r\n        return;\r\n      }\r\n      \r\n      // Add new item\r\n      const newItem: InvoiceItem = {\r\n        id: `item_${Date.now()}`,\r\n        productId: product.id,\r\n        productCode: product.productCode,\r\n        productName: product.itemName,\r\n        quantity: 1,\r\n        sellingPrice: product.sellingPrice,\r\n        discount: 0,\r\n        price: product.sellingPrice,\r\n        totalPrice: product.sellingPrice,\r\n        availableQty: product.availableQty,\r\n        costPrice: product.costPrice || 0\r\n      };\r\n      \r\n      setInvoiceItems(items => [...items, newItem]);\r\n    }\r\n    \r\n    setProductSearchTerm('');\r\n    setProducts([]);\r\n    setShowProductDropdown(false);\r\n  };\r\n\r\n  // Update invoice item with stock validation\r\n  const updateInvoiceItem = (itemId: string, field: string, value: number) => {\r\n    setInvoiceItems(items => \r\n      items.map(item => {\r\n        if (item.id === itemId) {\r\n          let validatedValue = Number(value);\r\n          \r\n          // If updating quantity, validate against available stock with minimum stock requirement\r\n          if (field === 'quantity') {\r\n            const maxAllowedQty = item.availableQty - MINIMUM_STOCK_REQUIRED;\r\n            \r\n            if (validatedValue <= 0) {\r\n              validatedValue = 1; // Minimum quantity is 1\r\n              setError(`Quantity must be at least 1 for ${item.productName}`);\r\n            } else if (validatedValue > maxAllowedQty) {\r\n              setError(`Cannot save invoice! Quantity ${validatedValue} exceeds available for sale (${maxAllowedQty}) for ${item.productName}. Must maintain minimum stock of ${MINIMUM_STOCK_REQUIRED}. Maximum allowed: ${maxAllowedQty}`);\r\n              validatedValue = Math.max(1, maxAllowedQty); // Set to maximum allowed or 1, whichever is higher\r\n            } else {\r\n              // Clear error if quantity is valid\r\n              setError('');\r\n            }\r\n          }\r\n          \r\n          const updatedItem = { ...item, [field]: validatedValue };\r\n          \r\n          // Recalculate price and total - ensure all values are numbers\r\n          updatedItem.price = Number(updatedItem.quantity) * Number(updatedItem.sellingPrice);\r\n          updatedItem.totalPrice = updatedItem.price - Number(updatedItem.discount);\r\n          \r\n          return updatedItem;\r\n        }\r\n        return item;\r\n      })\r\n    );\r\n  };\r\n\r\n  // Remove invoice item\r\n  const removeInvoiceItem = (itemId: string) => {\r\n    setInvoiceItems(items => items.filter(item => item.id !== itemId));\r\n  };\r\n\r\n  // Calculate effective cash discount percentage (use stored if available, otherwise settings)\r\n  const effectiveCashDiscountPercent = cashDiscountPercentage > 0 ? cashDiscountPercentage : invoiceSettings.totalBalanceDiscountPercent;\r\n\r\n  // Calculate totals with useMemo for real-time updates\r\n  const totals = React.useMemo(() => {\r\n    // Sub Total = sum of all Total Price values in the table - ensure numbers\r\n    const subTotal = invoiceItems.reduce((sum, item) => sum + Number(item.totalPrice), 0);\r\n    const totalDiscount = invoiceItems.reduce((sum, item) => sum + Number(item.discount), 0);\r\n    \r\n    // Invoice Type discount (Credit/Cash discount percentage)\r\n    const invoiceTypeDiscount = selectedDiscount ? Number(subTotal) * (parseFloat(selectedDiscount.percentage.toString()) / 100) : 0;\r\n    \r\n    // Cash discount is applied on the Sub Total (after item discounts)\r\n    // Use stored percentage if available, otherwise fall back to settings\r\n    const effectiveCashDiscountPercent = cashDiscountPercentage > 0 ? cashDiscountPercentage : invoiceSettings.totalBalanceDiscountPercent;\r\n    const cashDiscount = cashDiscountEnabled ? Number(subTotal) * (effectiveCashDiscountPercent / 100) : 0;\r\n    \r\n    // Net Total = Sub Total - Invoice Type Discount - Cash Discount\r\n    const netTotal = Number(subTotal) - Number(invoiceTypeDiscount) - Number(cashDiscount);\r\n\r\n    // Calculate total cost and profit for the invoice\r\n    let totalCost = 0;\r\n    let totalProfit = 0;\r\n\r\n    invoiceItems.forEach(item => {\r\n      // Item cost = costPrice * quantity\r\n      const itemCost = (item.costPrice || 0) * item.quantity;\r\n      totalCost += itemCost;\r\n\r\n      // Item profit calculation with all deductions\r\n      const itemTotalPrice = Number(item.totalPrice);\r\n      const itemInvoiceTypeDeduction = selectedDiscount ? (itemTotalPrice * (parseFloat(selectedDiscount.percentage.toString()) / 100)) : 0;\r\n      const itemCashDiscountDeduction = cashDiscountEnabled ? (itemTotalPrice * (effectiveCashDiscountPercent / 100)) : 0;\r\n      const itemAdjustedPrice = itemTotalPrice - itemInvoiceTypeDeduction - itemCashDiscountDeduction;\r\n      const itemProfit = itemAdjustedPrice - itemCost;\r\n      \r\n      totalProfit += itemProfit;\r\n    });\r\n\r\n    return {\r\n      subTotal: Number(subTotal),\r\n      totalDiscount: Number(totalDiscount),\r\n      invoiceTypeDiscount: Number(invoiceTypeDiscount),\r\n      cashDiscount: Number(cashDiscount),\r\n      netTotal: Number(netTotal),\r\n      totalCost: Number(totalCost),\r\n      totalProfit: Number(totalProfit)\r\n    };\r\n  }, [invoiceItems, cashDiscountEnabled, cashDiscountPercentage, invoiceSettings.totalBalanceDiscountPercent, selectedDiscount]);\r\n\r\n  // Handle form submission\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!selectedShop) {\r\n      setError('Please select a shop');\r\n      return;\r\n    }\r\n\r\n    if (!selectedSalesRep) {\r\n      setError('Please select a sales representative');\r\n      return;\r\n    }\r\n\r\n    if (invoiceItems.length === 0) {\r\n      setError('Please add at least one product');\r\n      return;\r\n    }\r\n\r\n    // Check for overdue payments if updating a credit invoice\r\n    if (isCreditInvoice() && hasOverduePayments) {\r\n      const totalOverdue = overduePayments.reduce((sum, p) => sum + Number(p.remainingAmount), 0);\r\n      setError(\r\n        `‚ùå Cannot update credit invoice! This shop has ${overduePayments.length} overdue payment(s) totaling LKR ${totalOverdue.toLocaleString()}. ` +\r\n        `Please settle all overdue payments before updating credit invoices.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Validate stock availability for all items\r\n    const stockErrors = [];\r\n    for (const item of invoiceItems) {\r\n      if (item.quantity > item.availableQty) {\r\n        stockErrors.push(`${item.productName}: Requested ${item.quantity}, Available ${item.availableQty}`);\r\n      }\r\n      if (item.quantity <= 0) {\r\n        stockErrors.push(`${item.productName}: Invalid quantity ${item.quantity}`);\r\n      }\r\n    }\r\n\r\n    if (stockErrors.length > 0) {\r\n      setError(`Cannot update invoice! Stock validation failed:\\n${stockErrors.join('\\n')}\\nPlease adjust quantities before saving.`);\r\n      return;\r\n    }\r\n\r\n    // Validate credit limit for credit invoices\r\n    if (isCreditInvoice() && !validateCreditLimit()) {\r\n      const availableCredit = (selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0);\r\n      setError(`Credit limit exceeded! Available credit: LKR ${availableCredit.toLocaleString()}. Invoice total: LKR ${totals.netTotal.toLocaleString()}`);\r\n      return;\r\n    }\r\n\r\n    setIsLoadingForm(true);\r\n    setError('');\r\n    setMessage('');\r\n\r\n    try {\r\n      const payload = {\r\n        id: selectedInvoice?.id,\r\n        invoiceDate,\r\n        shopId: selectedShop.id,\r\n        salesRepId: selectedSalesRep.id,\r\n        discountId: selectedDiscount?.id || null,\r\n        invoiceType: selectedDiscount?.discountName || null,\r\n        invoiceTypePercentage: selectedDiscount?.percentage || null,\r\n        cashDiscountEnabled,\r\n        ...(selectedDiscount && selectedDiscount.discountName.toLowerCase().includes('credit') && dueDate && { dueDate }),\r\n        notes: notes || null,\r\n        items: invoiceItems.map(item => ({\r\n          productId: item.productId,\r\n          quantity: item.quantity,\r\n          sellingPrice: item.sellingPrice,\r\n          discount: item.discount\r\n        }))\r\n      };\r\n\r\n      const response = await fetch('/api/invoices', {\r\n        method: 'PUT',\r\n        headers: getUserHeaders(),\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        // If there's pending payment data and the net total changed, update it\r\n        if (pendingPaymentData && pendingPaymentData.netTotal !== totals.netTotal) {\r\n          await updatePendingPaymentTotal(pendingPaymentData.id, totals.netTotal);\r\n        }\r\n        \r\n        setMessage('Invoice updated successfully!');\r\n        \r\n        // Reload invoice and payment data to reflect changes\r\n        await loadInvoiceDetails(selectedInvoice!.id);\r\n      } else {\r\n        setError(data.error || 'Failed to update invoice');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating invoice:', error);\r\n      setError('Network error. Please try again.');\r\n    } finally {\r\n      setIsLoadingForm(false);\r\n    }\r\n  };\r\n\r\n  // Load pending payment data for selected invoice\r\n  const loadPendingPaymentData = async (invoiceId: number) => {\r\n    setIsLoadingPayment(true);\r\n    try {\r\n      const response = await fetch(`/api/payments?invoiceId=${invoiceId}`, {\r\n        headers: getUserHeaders()\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.success && data.payments && data.payments.length > 0) {\r\n        setPendingPaymentData(data.payments[0]);\r\n      } else {\r\n        setPendingPaymentData(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading pending payment:', error);\r\n      setPendingPaymentData(null);\r\n    } finally {\r\n      setIsLoadingPayment(false);\r\n    }\r\n  };\r\n\r\n  // Update pending payment total when invoice total changes\r\n  const updatePendingPaymentTotal = async (paymentId: number, newNetTotal: number) => {\r\n    try {\r\n      const response = await fetch('/api/payments/update-total', {\r\n        method: 'PUT',\r\n        headers: getUserHeaders(),\r\n        body: JSON.stringify({\r\n          id: paymentId,\r\n          newNetTotal: newNetTotal\r\n        })\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (!data.success) {\r\n        console.error('Failed to update pending payment total:', data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating pending payment total:', error);\r\n    }\r\n  };\r\n\r\n  // Update shop credit limit\r\n  const updateShopCreditLimit = async () => {\r\n    if (!selectedShop || !newCreditLimit) return;\r\n\r\n    const creditLimitValue = parseFloat(newCreditLimit);\r\n    if (creditLimitValue < 0) {\r\n      setError('Credit limit cannot be negative');\r\n      return;\r\n    }\r\n\r\n    setIsUpdatingCreditLimit(true);\r\n    setError('');\r\n\r\n    try {\r\n      const response = await fetch('/api/shops/update-credit-limit', {\r\n        method: 'PUT',\r\n        headers: getUserHeaders(),\r\n        body: JSON.stringify({\r\n          shopId: selectedShop.id,\r\n          creditLimit: creditLimitValue\r\n        })\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        // Update the selected shop's credit limit in the state\r\n        setSelectedShop(prev => prev ? { ...prev, creditLimit: creditLimitValue } : null);\r\n        setMessage(`Credit limit updated successfully to LKR ${creditLimitValue.toLocaleString()}`);\r\n        setIsEditingCreditLimit(false);\r\n        setNewCreditLimit('');\r\n      } else {\r\n        setError(data.error || 'Failed to update credit limit');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating credit limit:', error);\r\n      setError('Network error. Please try again.');\r\n    } finally {\r\n      setIsUpdatingCreditLimit(false);\r\n    }\r\n  };\r\n\r\n  // Cancel credit limit editing\r\n  const cancelCreditLimitEdit = () => {\r\n    setIsEditingCreditLimit(false);\r\n    setNewCreditLimit('');\r\n    setError('');\r\n  };\r\n\r\n  // Check if user can edit credit limits\r\n  const canEditCreditLimit = () => {\r\n    return hasAccess('shops');\r\n  };\r\n\r\n  // Check credit limit validation\r\n  const validateCreditLimit = () => {\r\n    if (!selectedShop || !isCreditInvoice()) return true;\r\n    \r\n    const availableCredit = (selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0);\r\n    return totals.netTotal <= availableCredit;\r\n  };\r\n\r\n  // Check for overdue payments for selected shop\r\n  const checkOverduePayments = async (shopId: number) => {\r\n    try {\r\n      const response = await fetch(`/api/payments?shopId=${shopId}&status=due`);\r\n      const data = await response.json();\r\n      \r\n      if (data.success && data.payments) {\r\n        const overduePmts: OverduePayment[] = data.payments.map((payment: any) => {\r\n          const dueDate = new Date(payment.dueDate);\r\n          const today = new Date();\r\n          const daysPastDue = Math.floor((today.getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24));\r\n          \r\n          return {\r\n            id: payment.id,\r\n            invoiceNumber: payment.invoice.invoiceNumber,\r\n            dueDate: payment.dueDate,\r\n            remainingAmount: payment.remainingAmount,\r\n            daysPastDue: daysPastDue\r\n          };\r\n        }).filter((payment: OverduePayment) => payment.daysPastDue > 0);\r\n\r\n        setOverduePayments(overduePmts);\r\n        setHasOverduePayments(overduePmts.length > 0);\r\n\r\n        if (overduePmts.length > 0) {\r\n          const totalOverdue = overduePmts.reduce((sum, p) => sum + Number(p.remainingAmount), 0);\r\n          setMessage(\r\n            `‚ö†Ô∏è This shop has ${overduePmts.length} overdue payment(s) totaling LKR ${totalOverdue.toLocaleString()}. ` +\r\n            `Creating new credit invoices may be restricted.`\r\n          );\r\n        }\r\n      } else {\r\n        setOverduePayments([]);\r\n        setHasOverduePayments(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking overdue payments:', error);\r\n    }\r\n  };\r\n\r\n  // Start editing credit limit\r\n  const startEditingCreditLimit = () => {\r\n    if (!canEditCreditLimit()) {\r\n      setError('You do not have permission to edit credit limits');\r\n      return;\r\n    }\r\n    \r\n    if (selectedShop) {\r\n      setNewCreditLimit(selectedShop.creditLimit.toString());\r\n      setIsEditingCreditLimit(true);\r\n    }\r\n  };\r\n\r\n  // Load invoice details\r\n  const loadInvoiceDetails = async (invoiceId: number) => {\r\n    setIsLoadingForm(true);\r\n    setError('');\r\n    setMessage('');\r\n\r\n    try {\r\n      const response = await fetch(`/api/invoices/${invoiceId}`, {\r\n        headers: getUserHeaders()\r\n      });\r\n\r\n      const data = await response.json();\r\n      if (data.success && data.invoice) {\r\n        const invoice = data.invoice;\r\n        \r\n        // Set form data from invoice\r\n        setInvoiceDate(invoice.invoiceDate);\r\n        setInvoiceDateDisplay(formatDateForDisplay(invoice.invoiceDate));\r\n        setSelectedShop(invoice.shop);\r\n        setSelectedSalesRep(invoice.salesRep || null);\r\n        setSelectedDiscount(invoice.discount || null);\r\n        setNotes(invoice.notes || '');\r\n        \r\n        // Check for overdue payments when loading invoice\r\n        if (invoice.shop && invoice.shop.id) {\r\n          await checkOverduePayments(invoice.shop.id);\r\n        }\r\n        setCashDiscountEnabled(invoice.cashDiscountEnabled || false);\r\n        setCashDiscountPercentage(invoice.cashDiscountPercentage || 0);\r\n        setInvoiceItems(invoice.invoiceItems || []);\r\n        // Format due date for input field (YYYY-MM-DD)\r\n        if (invoice.dueDate) {\r\n          const dueDateObj = new Date(invoice.dueDate);\r\n          const formattedDueDate = dueDateObj.toISOString().split('T')[0];\r\n          setDueDate(formattedDueDate);\r\n        } else {\r\n          setDueDate('');\r\n        }\r\n        setSelectedInvoice(invoice);\r\n        \r\n        // Load pending payment data\r\n        await loadPendingPaymentData(invoiceId);\r\n        \r\n        setMessage(`Invoice ${invoice.invoiceNumber} loaded successfully!`);\r\n      } else {\r\n        setError(data.error || 'Failed to load invoice details');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading invoice:', error);\r\n      setError('Network error. Please try again.');\r\n    } finally {\r\n      setIsLoadingForm(false);\r\n    }\r\n  };\r\n\r\n  // Load invoice settings\r\n  useEffect(() => {\r\n    const loadInvoiceSettings = async () => {\r\n      try {\r\n        if (user) {\r\n          const response = await fetch('/api/softwareSettings', {\r\n            headers: getUserHeaders()\r\n          });\r\n          const data = await response.json();\r\n          \r\n          if (data.success && data.settings) {\r\n            const newSettings = {\r\n              isSellingPriceReadonly: data.settings.isSellingPriceReadonly === 1 || data.settings.isSellingPriceReadonly === true,\r\n              isDiscountReadonly: data.settings.isDiscountReadonly === 1 || data.settings.isDiscountReadonly === true,\r\n              showTotalDiscountFromItems: !(data.settings.showTotalDiscountFromItems === 1 || data.settings.showTotalDiscountFromItems === true),\r\n              showTotalBalanceDiscount: !(data.settings.showTotalBalanceDiscount === 1 || data.settings.showTotalBalanceDiscount === true),\r\n              totalBalanceDiscountPercent: data.settings.totalBalanceDiscountPercent || 5,\r\n              hideCostProfit: data.settings.hideCostProfit === 1 || data.settings.hideCostProfit === true\r\n            };\r\n            \r\n            setInvoiceSettings(newSettings);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading invoice settings:', error);\r\n      }\r\n    };\r\n\r\n    if (!authLoading && isAuthorized) {\r\n      loadInvoiceSettings();\r\n    }\r\n  }, [user, authLoading, isAuthorized]);\r\n\r\n  if (authLoading || isLoading) {\r\n    return <div className={styles.loading}>Loading...</div>;\r\n  }\r\n\r\n  if (!isAuthorized) {\r\n    return <div className={styles.unauthorized}>You are not authorized to access this page.</div>;\r\n  }\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div className={styles.header}>\r\n        <h1 className={styles.title}>Edit Invoice</h1>\r\n      </div>\r\n\r\n      {/* Invoice Search Section */}\r\n      <div className={styles.searchSection}>\r\n        <h2 className={styles.searchTitle}>Search Invoice to Edit</h2>\r\n        \r\n        <div className={styles.field}>\r\n          <label className={styles.label}>Search by Invoice Number or Shop Name:</label>\r\n          <div className={styles.searchContainer}>\r\n            <input\r\n              type=\"text\"\r\n              value={invoiceSearchTerm}\r\n              onChange={(e) => {\r\n                setInvoiceSearchTerm(e.target.value);\r\n                setShowInvoiceDropdown(true);\r\n              }}\r\n              onFocus={() => setShowInvoiceDropdown(true)}\r\n              placeholder=\"Type invoice number or shop name...\"\r\n              className={styles.input}\r\n              disabled={isLoadingForm}\r\n            />\r\n            \r\n            {showInvoiceDropdown && invoiceSearchResults.length > 0 && (\r\n              <div className={styles.dropdown}>\r\n                {invoiceSearchResults.map((invoice) => (\r\n                  <div\r\n                    key={invoice.id}\r\n                    className={styles.dropdownItem}\r\n                    onClick={() => {\r\n                      loadInvoiceDetails(invoice.id);\r\n                      setInvoiceSearchTerm(`${invoice.invoiceNumber} - ${invoice.shopName}`);\r\n                      setShowInvoiceDropdown(false);\r\n                    }}\r\n                  >\r\n                    <div className={styles.invoiceInfo}>\r\n                      <div className={styles.invoiceNumber}>#{invoice.invoiceNumber}</div>\r\n                      <div className={styles.invoiceShop}>{invoice.shopName} ({invoice.ownerName})</div>\r\n                      <div className={styles.invoiceDetails}>\r\n                        Date: {new Date(invoice.invoiceDate).toLocaleDateString()} | \r\n                        Total: LKR {invoice.netTotal.toLocaleString()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {error && <p className={styles.error}>{error}</p>}\r\n      {message && <p className={styles.success}>{message}</p>}\r\n\r\n      {/* Pending Payment Information - Show when invoice is selected and has pending payment */}\r\n      {selectedInvoice && pendingPaymentData && (\r\n        <div className={styles.paymentInfoSection}>\r\n          <h2 className={styles.paymentInfoTitle}>\r\n            üìã Pending Payment Information\r\n          </h2>\r\n          \r\n          <div className={styles.paymentInfoGrid}>\r\n            <div className={styles.paymentInfoCard}>\r\n              <div className={styles.paymentInfoLabel}>Payment Status:</div>\r\n              <div className={`${styles.paymentStatus} ${styles[pendingPaymentData.paymentStatus]}`}>\r\n                {pendingPaymentData.paymentStatus.toUpperCase()}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className={styles.paymentInfoCard}>\r\n              <div className={styles.paymentInfoLabel}>Net Total:</div>\r\n              <div className={styles.paymentAmount}>\r\n                LKR {pendingPaymentData.netTotal.toLocaleString()}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className={styles.paymentInfoCard}>\r\n              <div className={styles.paymentInfoLabel}>Paid Amount:</div>\r\n              <div className={styles.paymentAmount}>\r\n                LKR {pendingPaymentData.paidAmount.toLocaleString()}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className={styles.paymentInfoCard}>\r\n              <div className={styles.paymentInfoLabel}>Remaining Amount:</div>\r\n              <div className={`${styles.paymentAmount} ${pendingPaymentData.remainingAmount > 0 ? styles.amountDue : styles.amountPaid}`}>\r\n                LKR {pendingPaymentData.remainingAmount.toLocaleString()}\r\n              </div>\r\n            </div>\r\n            \r\n            {pendingPaymentData.dueDate && (\r\n              <div className={styles.paymentInfoCard}>\r\n                <div className={styles.paymentInfoLabel}>Due Date:</div>\r\n                <div className={styles.paymentDueDate}>\r\n                  {new Date(pendingPaymentData.dueDate).toLocaleDateString()}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n          \r\n          <div className={styles.paymentWarning}>\r\n            <strong>‚ö†Ô∏è Note:</strong> Editing this invoice will automatically update the pending payment data. \r\n            If you change the invoice total, the remaining payment amount will be recalculated.\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Invoice Edit Form - Only show when invoice is selected */}\r\n      {selectedInvoice && (\r\n        <div className={styles.editSection}>\r\n          <h2 className={styles.editTitle}>\r\n            Editing Invoice #{selectedInvoice.invoiceNumber}\r\n          </h2>\r\n          \r\n          {/* Invoice Edit Form - Same structure as create invoice */}\r\n          <form onSubmit={handleSubmit} className={styles.form}>\r\n            {/* Date and Sales Rep Selection */}\r\n            <div className={styles.row}>\r\n              <div className={styles.field}>\r\n                <label className={styles.label}>Invoice Date: *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"DD/MM/YYYY\"\r\n                  value={invoiceDateDisplay}\r\n                  onChange={(e) => {\r\n                    const value = e.target.value;\r\n                    setInvoiceDateDisplay(value);\r\n                    \r\n                    // Auto-format as user types\r\n                    let formattedValue = value.replace(/[^\\d]/g, '');\r\n                    if (formattedValue.length >= 3 && formattedValue.length <= 4) {\r\n                      formattedValue = formattedValue.replace(/(\\d{2})(\\d{1,2})/, '$1/$2');\r\n                    } else if (formattedValue.length >= 5) {\r\n                      formattedValue = formattedValue.replace(/(\\d{2})(\\d{2})(\\d{4})/, '$1/$2/$3');\r\n                    }\r\n                    \r\n                    if (formattedValue !== value && formattedValue.length <= 10) {\r\n                      setInvoiceDateDisplay(formattedValue);\r\n                    }\r\n                    \r\n                    // Convert to ISO format if valid\r\n                    if (isValidDate(formattedValue)) {\r\n                      const isoDate = formatDateForInput(formattedValue);\r\n                      if (isoDate) {\r\n                        setInvoiceDate(isoDate);\r\n                      }\r\n                    }\r\n                  }}\r\n                  onBlur={(e) => {\r\n                    const value = e.target.value;\r\n                    if (!isValidDate(value)) {\r\n                      const today = new Date().toISOString().split('T')[0];\r\n                      setInvoiceDate(today);\r\n                      setInvoiceDateDisplay(formatDateForDisplay(today));\r\n                    }\r\n                  }}\r\n                  className={styles.input}\r\n                  disabled={isLoadingForm}\r\n                  required\r\n                  maxLength={10}\r\n                />\r\n              </div>\r\n\r\n              <div className={styles.field}>\r\n                <label className={styles.label}>Select Sales Rep: *</label>\r\n                <div className={styles.searchContainer}>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={selectedSalesRep ? `${selectedSalesRep.name} (${selectedSalesRep.contactNumber})` : salesRepSearchTerm}\r\n                    onChange={(e) => {\r\n                      if (!selectedSalesRep) {\r\n                        setSalesRepSearchTerm(e.target.value);\r\n                        setShowSalesRepDropdown(true);\r\n                      }\r\n                    }}\r\n                    onFocus={() => setShowSalesRepDropdown(true)}\r\n                    placeholder=\"Type to search sales representatives...\"\r\n                    className={styles.input}\r\n                    disabled={isLoadingForm}\r\n                    required\r\n                  />\r\n                  {selectedSalesRep && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => {\r\n                        setSelectedSalesRep(null);\r\n                        setSalesRepSearchTerm('');\r\n                        setShowSalesRepDropdown(false);\r\n                      }}\r\n                      className={styles.clearSelection}\r\n                      disabled={isLoadingForm}\r\n                    >\r\n                      √ó\r\n                    </button>\r\n                  )}\r\n                  {showSalesRepDropdown && salesReps.length > 0 && (\r\n                    <div className={styles.dropdown}>\r\n                      {salesReps.map((rep) => (\r\n                        <div\r\n                          key={rep.id}\r\n                          className={styles.dropdownItem}\r\n                          onClick={() => {\r\n                            setSelectedSalesRep(rep);\r\n                            setSalesRepSearchTerm('');\r\n                            setShowSalesRepDropdown(false);\r\n                          }}\r\n                        >\r\n                          <div className={styles.repName}>{rep.name}</div>\r\n                          <div className={styles.repContact}>{rep.contactNumber}</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className={styles.field}>\r\n                <label className={styles.label}>Select Shop: *</label>\r\n                <div className={styles.searchContainer}>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={selectedShop ? `${selectedShop.shopName} (${selectedShop.ownerName})` : shopSearchTerm}\r\n                    onChange={(e) => {\r\n                      if (!selectedShop) {\r\n                        const value = e.target.value;\r\n                        setShopSearchTerm(value);\r\n                        // Show dropdown only if there's text, hide if empty\r\n                        setShowShopDropdown(value.length > 0);\r\n                      }\r\n                    }}\r\n                    onFocus={() => setShowShopDropdown(true)}\r\n                    onBlur={() => {\r\n                      // Delay hiding to allow clicking on dropdown items\r\n                      setTimeout(() => setShowShopDropdown(false), 150);\r\n                    }}\r\n                    placeholder=\"Type to search shops...\"\r\n                    className={styles.input}\r\n                    disabled={isLoadingForm}\r\n                    required\r\n                  />\r\n                  \r\n                  {selectedShop && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => {\r\n                        setSelectedShop(null);\r\n                        setShopSearchTerm('');\r\n                        setShowShopDropdown(false);\r\n                      }}\r\n                      className={styles.clearSelection}\r\n                    >\r\n                      √ó\r\n                    </button>\r\n                  )}\r\n\r\n                  {showShopDropdown && shops.length > 0 && !selectedShop && (\r\n                    <div className={styles.dropdown}>\r\n                      {shops.map((shop) => (\r\n                        <div\r\n                          key={shop.id}\r\n                          className={styles.dropdownItem}\r\n                          onClick={() => {\r\n                            setSelectedShop(shop);\r\n                            setShopSearchTerm('');\r\n                            setShowShopDropdown(false);\r\n                          }}\r\n                        >\r\n                          <div className={styles.shopInfo}>\r\n                            <div className={styles.shopName}>{shop.shopName}</div>\r\n                            <div className={styles.shopOwner}>Owner: {shop.ownerName} | Contact: {shop.contactNumber}</div>\r\n                            <div className={styles.shopOwner}>\r\n                              Credit Limit: LKR {shop.creditLimit.toLocaleString()} | \r\n                              Balance: LKR {shop.balanceAmount.toLocaleString()}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Selected Shop Details with Credit Limit Management */}\r\n              {selectedShop && (\r\n                <div className={styles.field}>\r\n                  <label className={styles.label}>Selected Shop Details:</label>\r\n                  <div className={styles.selectedShopDetails}>\r\n                    <div className={styles.shopDetailCard}>\r\n                      <div className={styles.shopDetailRow}>\r\n                        <span className={styles.shopDetailLabel}>Shop Name:</span>\r\n                        <span className={styles.shopDetailValue}>{selectedShop.shopName}</span>\r\n                      </div>\r\n                      <div className={styles.shopDetailRow}>\r\n                        <span className={styles.shopDetailLabel}>Owner:</span>\r\n                        <span className={styles.shopDetailValue}>{selectedShop.ownerName}</span>\r\n                      </div>\r\n                      <div className={styles.shopDetailRow}>\r\n                        <span className={styles.shopDetailLabel}>Contact:</span>\r\n                        <span className={styles.shopDetailValue}>{selectedShop.contactNumber}</span>\r\n                      </div>\r\n                      <div className={styles.shopDetailRow}>\r\n                        <span className={styles.shopDetailLabel}>Credit Limit:</span>\r\n                        <div className={styles.creditLimitSection}>\r\n                          {!isEditingCreditLimit ? (\r\n                            <>\r\n                              <span className={styles.shopDetailValue}>\r\n                                LKR {selectedShop.creditLimit.toLocaleString()}\r\n                              </span>\r\n                              {canEditCreditLimit() && (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={startEditingCreditLimit}\r\n                                  className={styles.editCreditLimitBtn}\r\n                                  disabled={isLoadingForm}\r\n                                >\r\n                                  ‚úèÔ∏è Edit\r\n                                </button>\r\n                              )}\r\n                              {!canEditCreditLimit() && (\r\n                                <span className={styles.permissionNote}>\r\n                                  (Edit requires Shop permissions)\r\n                                </span>\r\n                              )}\r\n                            </>\r\n                          ) : (\r\n                            <div className={styles.creditLimitEdit}>\r\n                              <input\r\n                                type=\"number\"\r\n                                value={newCreditLimit}\r\n                                onChange={(e) => setNewCreditLimit(e.target.value)}\r\n                                placeholder=\"Enter new credit limit\"\r\n                                className={styles.creditLimitInput}\r\n                                disabled={isUpdatingCreditLimit}\r\n                                min=\"0\"\r\n                                step=\"0.01\"\r\n                              />\r\n                              <div className={styles.creditLimitActions}>\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={updateShopCreditLimit}\r\n                                  className={styles.saveCredtiLimitBtn}\r\n                                  disabled={isUpdatingCreditLimit}\r\n                                >\r\n                                  {isUpdatingCreditLimit ? 'Saving...' : 'üíæ Save'}\r\n                                </button>\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={cancelCreditLimitEdit}\r\n                                  className={styles.cancelCreditLimitBtn}\r\n                                  disabled={isUpdatingCreditLimit}\r\n                                >\r\n                                  ‚ùå Cancel\r\n                                </button>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div className={styles.shopDetailRow}>\r\n                        <span className={styles.shopDetailLabel}>Balance:</span>\r\n                        <span className={`${styles.shopDetailValue} ${selectedShop.balanceAmount > 0 ? styles.balanceDue : styles.balanceClear}`}>\r\n                          LKR {selectedShop.balanceAmount.toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                      \r\n                      {/* Credit Information for Credit Invoices */}\r\n                      {isCreditInvoice() && (\r\n                        <div className={styles.creditInfoSection}>\r\n                          <div className={styles.shopDetailRow}>\r\n                            <span className={styles.shopDetailLabel}>Available Credit:</span>\r\n                            <span className={`${styles.shopDetailValue} ${((selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0)) <= 0 ? styles.balanceDue : styles.balanceClear}`}>\r\n                              LKR {((selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0)).toLocaleString()}\r\n                            </span>\r\n                          </div>\r\n                          \r\n                          {/* Credit Limit Validation Warning */}\r\n                          {!validateCreditLimit() && (\r\n                            <div className={styles.creditWarning}>\r\n                              <strong>‚ö†Ô∏è Credit Limit Warning:</strong> Invoice total (LKR {totals.netTotal.toLocaleString()}) exceeds available credit \r\n                              (LKR {((selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0)).toLocaleString()}). \r\n                              Update cannot proceed.\r\n                            </div>\r\n                          )}\r\n                          \r\n                          {/* Overdue Payments Warning */}\r\n                          {hasOverduePayments && (\r\n                            <div className={styles.overdueWarning}>\r\n                              <strong>üö® Overdue Payments Alert:</strong> This shop has {overduePayments.length} overdue payment(s) \r\n                              totaling LKR {overduePayments.reduce((sum, p) => sum + Number(p.remainingAmount), 0).toLocaleString()}. \r\n                              Credit invoice updates are restricted.\r\n                              <div className={styles.overdueDetails}>\r\n                                {overduePayments.slice(0, 3).map((payment, index) => (\r\n                                  <div key={payment.id} className={styles.overdueItem}>\r\n                                    #{payment.invoiceNumber}: LKR {payment.remainingAmount.toLocaleString()} \r\n                                    ({payment.daysPastDue} days overdue)\r\n                                  </div>\r\n                                ))}\r\n                                {overduePayments.length > 3 && (\r\n                                  <div className={styles.overdueMore}>\r\n                                    ... and {overduePayments.length - 3} more\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Invoice Type and Notes Row */}\r\n              <div className={styles.invoiceTypeNotesRow}>\r\n                <div className={styles.field}>\r\n                  <label className={styles.label}>Invoice Type: *</label>\r\n                  <select\r\n                    value={selectedDiscount?.id || ''}\r\n                    onChange={(e) => {\r\n                      const discountId = e.target.value;\r\n                      const discount = discounts.find(d => d.id.toString() === discountId);\r\n                      setSelectedDiscount(discount || null);\r\n                    }}\r\n                    className={styles.input}\r\n                    disabled={isLoadingForm}\r\n                    required\r\n                  >\r\n                    <option value=\"\" disabled>Select Invoice Type</option>\r\n                    {discounts.map((discount) => (\r\n                      <option key={discount.id} value={discount.id}>\r\n                        {discount.discountName} Discount ({discount.percentage}%)\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n\r\n                <div className={styles.field}>\r\n                  <label className={styles.label}>Notes:</label>\r\n                  <textarea\r\n                    value={notes}\r\n                    onChange={(e) => setNotes(e.target.value)}\r\n                    placeholder=\"Enter any additional notes for this invoice...\"\r\n                    className={styles.notesInput}\r\n                    disabled={isLoadingForm}\r\n                    rows={1}\r\n                  />\r\n                </div>\r\n\r\n                {/* Payment Terms Field - Third column if credit invoice */}\r\n                {isCreditInvoice() && (\r\n                  <div className={styles.field}>\r\n                    <label className={styles.label}>Payment Terms:</label>\r\n                    <select\r\n                      value={selectedDueDateOption ? `${selectedDueDateOption.label}-${selectedDueDateOption.days}` : ''}\r\n                      onChange={(e) => {\r\n                        const [label, daysStr] = e.target.value.split('-');\r\n                        const days = parseInt(daysStr);\r\n                        const option = dueDateOptions.find(opt => opt.label === label && opt.days === days);\r\n                        if (option) {\r\n                          handleDueDateOptionChange(option);\r\n                        }\r\n                      }}\r\n                      className={styles.select}\r\n                      disabled={isLoadingForm}\r\n                    >\r\n                      <option value=\"\">Select Payment Terms</option>\r\n                      {dueDateOptions.map((option, index) => (\r\n                        <option \r\n                          key={index} \r\n                          value={`${option.label}-${option.days}`}\r\n                        >\r\n                          {option.label} ({option.days} days) {option.isDefault ? '- Default' : ''}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Payment Due Date - Separate Row */}\r\n            {isCreditInvoice() && dueDate && (\r\n              <div className={styles.row}>\r\n                <div className={styles.field}>\r\n                  <label className={styles.label}>Payment Due Date:</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"DD/MM/YYYY\"\r\n                    value={dueDateDisplay}\r\n                    onChange={(e) => {\r\n                      const value = e.target.value;\r\n                      setDueDateDisplay(value);\r\n                      \r\n                      // Auto-format as user types\r\n                      let formattedValue = value.replace(/[^\\d]/g, '');\r\n                      if (formattedValue.length >= 3 && formattedValue.length <= 4) {\r\n                        formattedValue = formattedValue.replace(/(\\d{2})(\\d{1,2})/, '$1/$2');\r\n                      } else if (formattedValue.length >= 5) {\r\n                        formattedValue = formattedValue.replace(/(\\d{2})(\\d{2})(\\d{4})/, '$1/$2/$3');\r\n                      }\r\n                      \r\n                      if (formattedValue !== value && formattedValue.length <= 10) {\r\n                        setDueDateDisplay(formattedValue);\r\n                      }\r\n                      \r\n                      // Convert to ISO format for storage if valid\r\n                      const isoDate = formatDateForInput(formattedValue);\r\n                      if (isoDate) {\r\n                        setDueDate(isoDate);\r\n                      }\r\n                    }}\r\n                    className={styles.input}\r\n                    disabled={isLoadingForm}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n\r\n\r\n            {/* Invoice Items Section */}\r\n            <div className={styles.itemsSection}>\r\n              <h3 className={styles.sectionTitle}>Invoice Items</h3>\r\n              \r\n              {/* Add Product Search */}\r\n              <div className={styles.addProductSection}>\r\n                <div className={styles.field}>\r\n                  <label className={styles.label}>Add Product:</label>\r\n                  <div className={styles.searchContainer}>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={productSearchTerm}\r\n                      onChange={(e) => {\r\n                        const value = e.target.value;\r\n                        setProductSearchTerm(value);\r\n                        // Show dropdown only if there's text, hide if empty\r\n                        setShowProductDropdown(value.length > 0);\r\n                      }}\r\n                      onFocus={() => setShowProductDropdown(true)}\r\n                      onBlur={() => {\r\n                        // Delay hiding to allow clicking on dropdown items\r\n                        setTimeout(() => setShowProductDropdown(false), 150);\r\n                      }}\r\n                      placeholder=\"Type to search products...\"\r\n                      className={styles.input}\r\n                      disabled={isLoadingForm}\r\n                    />\r\n                    \r\n                    {showProductDropdown && products.length > 0 && (\r\n                      <div className={styles.dropdown}>\r\n                        {products.map((product) => {\r\n                          const availableForSale = Math.max(0, product.availableQty - MINIMUM_STOCK_REQUIRED);\r\n                          const canAddProduct = availableForSale > 0;\r\n                          \r\n                          return (\r\n                            <div\r\n                              key={product.id}\r\n                              className={`${styles.dropdownItem} ${!canAddProduct ? styles.productUnavailable : ''}`}\r\n                              onClick={() => canAddProduct ? addProductToInvoice(product) : null}\r\n                              style={{ cursor: canAddProduct ? 'pointer' : 'not-allowed' }}\r\n                            >\r\n                              <div className={styles.productInfo}>\r\n                                <div className={styles.productName}>\r\n                                  {product.itemName} ({product.productCode})\r\n                                  {!canAddProduct && <span className={styles.unavailableTag}> - UNAVAILABLE</span>}\r\n                                </div>\r\n                                <div className={styles.productDetails}>\r\n                                  Price: LKR {product.sellingPrice} | \r\n                                  Available for Sale: {availableForSale} | \r\n                                  Total Stock: {product.availableQty} | \r\n                                  Category: {product.category}\r\n                                  {!canAddProduct && (\r\n                                    <div className={styles.minimumStockNote}>\r\n                                      (Must maintain minimum stock of {MINIMUM_STOCK_REQUIRED})\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Invoice Items Table */}\r\n              <div className={styles.itemsTable}>\r\n                <div className={`${styles.itemsHeader} ${!invoiceSettings.showTotalDiscountFromItems ? styles.itemsHeaderNoDiscount : ''}`}>\r\n                  <div>Product</div>\r\n                  <div>Quantity</div>\r\n                  <div>Selling Price</div>\r\n                  {invoiceSettings.showTotalDiscountFromItems && <div>Discount</div>}\r\n                  <div>Price</div>\r\n                  {!invoiceSettings.hideCostProfit && <div>Cost</div>}\r\n                  {!invoiceSettings.hideCostProfit && <div>Profit</div>}\r\n                  <div>Total Price</div>\r\n                  <div>Action</div>\r\n                </div>\r\n                \r\n                {invoiceItems.length === 0 ? (\r\n                  <div className={styles.noItemsRow}>\r\n                    <div className={styles.noItemsMessage}>\r\n                      No items added yet. Search and add products above.\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  invoiceItems.map((item) => (\r\n                    <div key={item.id} className={`${styles.itemRow} ${!invoiceSettings.showTotalDiscountFromItems ? styles.itemRowNoDiscount : ''}`}>\r\n                      <div className={styles.product}>\r\n                        <div className={styles.productName}>{item.productName}</div>\r\n                        <div className={styles.productCode}>({item.productCode})</div>\r\n                      </div>\r\n                      <div className={styles.quantity}>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"1\"\r\n                          max={Math.max(1, item.availableQty - MINIMUM_STOCK_REQUIRED)}\r\n                          value={item.quantity}\r\n                          onWheel={handleNumberInputWheel}\r\n                          onChange={(e) => updateInvoiceItem(item.id, 'quantity', parseInt(e.target.value) || 1)}\r\n                          className={styles.quantityInput}\r\n                        />\r\n                      </div>\r\n                      <div className={styles.sellingPrice}>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          step=\"0.01\"\r\n                          value={item.sellingPrice}\r\n                          onChange={(e) => updateInvoiceItem(item.id, 'sellingPrice', parseFloat(e.target.value) || 0)}\r\n                          onWheel={handleNumberInputWheel}\r\n                          className={styles.priceInput}\r\n                          readOnly={invoiceSettings.isSellingPriceReadonly}\r\n                          title={invoiceSettings.isSellingPriceReadonly ? 'Selling price is read-only (configured in settings)' : ''}\r\n                        />\r\n                      </div>\r\n                      {invoiceSettings.showTotalDiscountFromItems && (\r\n                        <div className={styles.discount}>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            step=\"0.01\"\r\n                            value={item.discount}\r\n                            onChange={(e) => updateInvoiceItem(item.id, 'discount', parseFloat(e.target.value) || 0)}\r\n                            onWheel={handleNumberInputWheel}\r\n                            className={styles.discountInput}\r\n                            placeholder=\"0.00\"\r\n                            readOnly={invoiceSettings.isDiscountReadonly}\r\n                            title={invoiceSettings.isDiscountReadonly ? 'Discount is read-only (configured in settings)' : ''}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      <div className={styles.price}>\r\n                        LKR {item.price.toLocaleString()}\r\n                      </div>\r\n                      {!invoiceSettings.hideCostProfit && (\r\n                        <div className={styles.cost}>\r\n                          LKR {(item.costPrice * item.quantity).toLocaleString()}\r\n                        </div>\r\n                      )}\r\n                      {!invoiceSettings.hideCostProfit && (\r\n                        <div className={styles.profit}>\r\n                          LKR {(() => {\r\n                            const invoiceTypeDeduction = selectedDiscount ? (item.totalPrice * (parseFloat(selectedDiscount.percentage.toString()) / 100)) : 0;\r\n                            const cashDiscountDeduction = cashDiscountEnabled ? (item.totalPrice * (effectiveCashDiscountPercent / 100)) : 0;\r\n                            const adjustedTotalPrice = item.totalPrice - invoiceTypeDeduction - cashDiscountDeduction;\r\n                            const totalCost = item.costPrice * item.quantity;\r\n                            return (adjustedTotalPrice - totalCost).toLocaleString();\r\n                          })()}\r\n                        </div>\r\n                      )}\r\n                      <div className={styles.totalPrice}>\r\n                        LKR {item.totalPrice.toLocaleString()}\r\n                      </div>\r\n                      <div className={styles.actions}>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeInvoiceItem(item.id)}\r\n                          className={styles.removeButton}\r\n                          disabled={isLoadingForm}\r\n                        >\r\n                          üóëÔ∏è\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Totals Section */}\r\n            <div className={styles.totalsSection}>\r\n              <div className={styles.totalsGrid}>\r\n                <div className={styles.totalRow}>\r\n                  <span>Sub Total{selectedDiscount ? ` - ${selectedDiscount.discountName} Discount (${selectedDiscount.percentage}%)` : ''}:</span>\r\n                  <span>LKR {totals.subTotal.toLocaleString()}</span>\r\n                </div>\r\n                {selectedDiscount && (\r\n                  <div className={styles.totalRow}>\r\n                    <span>Discount Amount ({selectedDiscount.percentage}%):</span>\r\n                    <span>- LKR {totals.invoiceTypeDiscount.toLocaleString()}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceSettings.showTotalDiscountFromItems && (\r\n                  <div className={styles.totalRow}>\r\n                    <span>Total Discount from Items:</span>\r\n                    <span>LKR {totals.totalDiscount.toLocaleString()}</span>\r\n                  </div>\r\n                )}\r\n                {invoiceSettings.showTotalBalanceDiscount && (\r\n                  <div className={styles.totalRow}>\r\n                    <label className={styles.cashDiscountLabel}>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={cashDiscountEnabled}\r\n                        onChange={(e) => setCashDiscountEnabled(e.target.checked)}\r\n                        className={styles.checkbox}\r\n                      />\r\n                      <span>Cash Discount ({effectiveCashDiscountPercent}%):</span>\r\n                    </label>\r\n                    <span>{cashDiscountEnabled && totals.cashDiscount > 0 ? `- LKR ${totals.cashDiscount.toLocaleString()}` : `LKR ${totals.cashDiscount.toLocaleString()}`}</span>\r\n                  </div>\r\n                )}\r\n                <div className={`${styles.totalRow} ${styles.netTotal}`}>\r\n                  <span>Net Total:</span>\r\n                  <span>LKR {totals.netTotal.toLocaleString()}</span>\r\n                </div>\r\n                {!invoiceSettings.hideCostProfit && (\r\n                  <div className={styles.totalRow}>\r\n                    <span>Total Cost:</span>\r\n                    <span>LKR {totals.totalCost.toLocaleString()}</span>\r\n                  </div>\r\n                )}\r\n                {!invoiceSettings.hideCostProfit && (\r\n                  <div className={`${styles.totalRow} ${styles.profitRow}`}>\r\n                    <span>Total Profit:</span>\r\n                    <span style={{color: totals.totalProfit >= 0 ? '#28a745' : '#dc3545', fontWeight: 'bold'}}>\r\n                      LKR {totals.totalProfit.toLocaleString()}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Submit Section */}\r\n            <div className={styles.submitSection}>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={\r\n                  isLoadingForm || \r\n                  invoiceItems.length === 0 || \r\n                  (isCreditInvoice() && hasOverduePayments) ||\r\n                  (isCreditInvoice() && !validateCreditLimit())\r\n                }\r\n                className={styles.submitButton}\r\n              >\r\n                {isLoadingForm ? 'Updating Invoice...' : 'Update Invoice'}\r\n              </button>\r\n              \r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setSelectedInvoice(null)}\r\n                className={styles.cancelButton}\r\n                disabled={isLoadingForm}\r\n              >\r\n                Cancel Edit\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Wrapper component with Suspense for useSearchParams  \r\nconst InvoiceEditPage: React.FC = () => {\r\n  return (\r\n    <Suspense fallback={<div>Loading invoice editor...</div>}>\r\n      <EditInvoicePage />\r\n    </Suspense>\r\n  );\r\n};\r\n\r\nexport default InvoiceEditPage;"],"names":[],"mappings":"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"}