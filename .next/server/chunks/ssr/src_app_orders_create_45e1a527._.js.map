{"version":3,"sources":["turbopack:///[project]/src/app/orders/create/order.module.css [app-ssr] (css module)","turbopack:///[project]/src/app/orders/create/page.tsx"],"sourcesContent":["__turbopack_context__.v({\n  \"actionSection\": \"order-module__97544G__actionSection\",\n  \"addedProducts\": \"order-module__97544G__addedProducts\",\n  \"backButton\": \"order-module__97544G__backButton\",\n  \"container\": \"order-module__97544G__container\",\n  \"creditLimitContainer\": \"order-module__97544G__creditLimitContainer\",\n  \"creditLimitGrid\": \"order-module__97544G__creditLimitGrid\",\n  \"creditLimitItem\": \"order-module__97544G__creditLimitItem\",\n  \"creditLimitLabel\": \"order-module__97544G__creditLimitLabel\",\n  \"creditLimitTitle\": \"order-module__97544G__creditLimitTitle\",\n  \"creditLimitValue\": \"order-module__97544G__creditLimitValue\",\n  \"draftButton\": \"order-module__97544G__draftButton\",\n  \"error\": \"order-module__97544G__error\",\n  \"field\": \"order-module__97544G__field\",\n  \"formGrid\": \"order-module__97544G__formGrid\",\n  \"header\": \"order-module__97544G__header\",\n  \"headerTop\": \"order-module__97544G__headerTop\",\n  \"input\": \"order-module__97544G__input\",\n  \"inputGroup\": \"order-module__97544G__inputGroup\",\n  \"inputLabel\": \"order-module__97544G__inputLabel\",\n  \"label\": \"order-module__97544G__label\",\n  \"loading\": \"order-module__97544G__loading\",\n  \"message\": \"order-module__97544G__message\",\n  \"negativeCredit\": \"order-module__97544G__negativeCredit\",\n  \"orderForm\": \"order-module__97544G__orderForm\",\n  \"overdueAmount\": \"order-module__97544G__overdueAmount\",\n  \"overdueDays\": \"order-module__97544G__overdueDays\",\n  \"overdueDueDate\": \"order-module__97544G__overdueDueDate\",\n  \"overdueInvoiceNumber\": \"order-module__97544G__overdueInvoiceNumber\",\n  \"overduePaymentItem\": \"order-module__97544G__overduePaymentItem\",\n  \"overduePaymentsList\": \"order-module__97544G__overduePaymentsList\",\n  \"overdueTotal\": \"order-module__97544G__overdueTotal\",\n  \"overdueWarning\": \"order-module__97544G__overdueWarning\",\n  \"overdueWarningText\": \"order-module__97544G__overdueWarningText\",\n  \"overdueWarningTitle\": \"order-module__97544G__overdueWarningTitle\",\n  \"positiveCredit\": \"order-module__97544G__positiveCredit\",\n  \"productCode\": \"order-module__97544G__productCode\",\n  \"productHeader\": \"order-module__97544G__productHeader\",\n  \"productInfo\": \"order-module__97544G__productInfo\",\n  \"productInput\": \"order-module__97544G__productInput\",\n  \"productInputs\": \"order-module__97544G__productInputs\",\n  \"productItem\": \"order-module__97544G__productItem\",\n  \"productName\": \"order-module__97544G__productName\",\n  \"productSearch\": \"order-module__97544G__productSearch\",\n  \"productStock\": \"order-module__97544G__productStock\",\n  \"productTotals\": \"order-module__97544G__productTotals\",\n  \"productsSection\": \"order-module__97544G__productsSection\",\n  \"pulseWarning\": \"order-module__97544G__pulseWarning\",\n  \"removeButton\": \"order-module__97544G__removeButton\",\n  \"resultDetails\": \"order-module__97544G__resultDetails\",\n  \"resultName\": \"order-module__97544G__resultName\",\n  \"searchContainer\": \"order-module__97544G__searchContainer\",\n  \"searchIcon\": \"order-module__97544G__searchIcon\",\n  \"searchInput\": \"order-module__97544G__searchInput\",\n  \"searchResult\": \"order-module__97544G__searchResult\",\n  \"searchResults\": \"order-module__97544G__searchResults\",\n  \"section\": \"order-module__97544G__section\",\n  \"sectionTitle\": \"order-module__97544G__sectionTitle\",\n  \"select\": \"order-module__97544G__select\",\n  \"submitButton\": \"order-module__97544G__submitButton\",\n  \"subtitle\": \"order-module__97544G__subtitle\",\n  \"success\": \"order-module__97544G__success\",\n  \"summaryGrid\": \"order-module__97544G__summaryGrid\",\n  \"summaryLabel\": \"order-module__97544G__summaryLabel\",\n  \"summaryRow\": \"order-module__97544G__summaryRow\",\n  \"summarySection\": \"order-module__97544G__summarySection\",\n  \"summaryValue\": \"order-module__97544G__summaryValue\",\n  \"textarea\": \"order-module__97544G__textarea\",\n  \"title\": \"order-module__97544G__title\",\n  \"toggleField\": \"order-module__97544G__toggleField\",\n  \"toggleInput\": \"order-module__97544G__toggleInput\",\n  \"toggleLabel\": \"order-module__97544G__toggleLabel\",\n  \"totalLabel\": \"order-module__97544G__totalLabel\",\n  \"totalPrice\": \"order-module__97544G__totalPrice\",\n  \"totalRow\": \"order-module__97544G__totalRow\",\n  \"totalValue\": \"order-module__97544G__totalValue\",\n});\n","'use client';\r\n\r\nimport React, { useState, useEffect, useCallback, Suspense } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { usePageProtection } from '@/components/ProtectedRoute';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { handleNumberInputWheel } from '@/lib/numberInputUtils';\r\nimport styles from './order.module.css';\r\n\r\ninterface Shop {\r\n  id: number;\r\n  shopName: string;\r\n  ownerName: string;\r\n  contactNumber: string;\r\n  address: string;\r\n  creditLimit: number;\r\n  balanceAmount: number;\r\n}\r\n\r\ninterface OverduePayment {\r\n  id: number;\r\n  invoiceNumber: string;\r\n  dueDate: string;\r\n  remainingAmount: number;\r\n  daysPastDue: number;\r\n}\r\n\r\ninterface SalesRep {\r\n  id: number;\r\n  name: string;\r\n  contactNumber: string;\r\n  status: string;\r\n}\r\n\r\ninterface Discount {\r\n  id: number;\r\n  discountName: string;\r\n  percentage: number;\r\n}\r\n\r\ninterface Product {\r\n  id: number;\r\n  productCode: string;\r\n  itemName: string;\r\n  sellingPrice: number;\r\n  availableQty: number;\r\n  totalCost: number;\r\n  category: {\r\n    id: number;\r\n    category: string;\r\n  };\r\n}\r\n\r\ninterface OrderItem {\r\n  id: string;\r\n  productId: number;\r\n  productCode: string;\r\n  productName: string;\r\n  quantity: number;\r\n  sellingPrice: number;\r\n  discount: number;\r\n  availableQty: number;\r\n  costPrice: number;\r\n}\r\n\r\nconst OrderCreation: React.FC = () => {\r\n  // Navigation\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Edit mode detection\r\n  const editId = searchParams?.get('editId');\r\n  const isEditMode = !!editId;\r\n  \r\n  // Page protection\r\n  const { isAuthorized, isLoading: authLoading } = usePageProtection('orders');\r\n  \r\n  // Theme context\r\n  const { isDarkMode } = useTheme();\r\n  \r\n  // Auth context\r\n  const { user } = useAuth();\r\n\r\n  // Edit mode states\r\n  const [isLoadingOrder, setIsLoadingOrder] = useState(isEditMode);\r\n  const [existingOrder, setExistingOrder] = useState<any>(null);\r\n\r\n  // Form state\r\n  const [orderDate, setOrderDate] = useState(new Date().toISOString().split('T')[0]);\r\n  const [selectedShop, setSelectedShop] = useState<Shop | null>(null);\r\n  const [selectedSalesRep, setSelectedSalesRep] = useState<SalesRep | null>(null);\r\n  const [selectedDiscount, setSelectedDiscount] = useState<Discount | null>(null);\r\n  const [cashDiscountEnabled, setCashDiscountEnabled] = useState(false);\r\n  const [notes, setNotes] = useState('');\r\n  const [orderItems, setOrderItems] = useState<OrderItem[]>([]);\r\n\r\n  // Search states\r\n  const [shopSearch, setShopSearch] = useState('');\r\n  const [shopResults, setShopResults] = useState<Shop[]>([]);\r\n  const [showShopResults, setShowShopResults] = useState(false);\r\n  \r\n  const [salesRepSearch, setSalesRepSearch] = useState('');\r\n  const [salesRepResults, setSalesRepResults] = useState<SalesRep[]>([]);\r\n  const [showSalesRepResults, setShowSalesRepResults] = useState(false);\r\n  \r\n  const [productSearch, setProductSearch] = useState('');\r\n  const [productResults, setProductResults] = useState<Product[]>([]);\r\n  const [showProductResults, setShowProductResults] = useState(false);\r\n\r\n  // Free products states\r\n  const [freeProductSearch, setFreeProductSearch] = useState('');\r\n  const [freeProductResults, setFreeProductResults] = useState<Product[]>([]);\r\n  const [showFreeProductResults, setShowFreeProductResults] = useState(false);\r\n\r\n  // Data states\r\n  const [discounts, setDiscounts] = useState<Discount[]>([]);\r\n  \r\n  // Credit validation state\r\n  const [isCreditExceeded, setIsCreditExceeded] = useState(false);\r\n  \r\n  // Overdue payments state\r\n  const [overduePayments, setOverduePayments] = useState<OverduePayment[]>([]);\r\n  const [hasOverduePayments, setHasOverduePayments] = useState(false);\r\n  \r\n  // UI states\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [message, setMessage] = useState('');\r\n  const [error, setError] = useState('');\r\n\r\n  // Settings state for cash discount percentage and order controls\r\n  const [cashDiscountPercent, setCashDiscountPercent] = useState(5);\r\n  const [orderSettings, setOrderSettings] = useState({\r\n    hideSellingPrice: false,\r\n    hideDiscount: false,\r\n    hideFreeProducts: false,\r\n    hideCashDiscount: false\r\n  });\r\n\r\n  // Get user headers for API requests\r\n  const getUserHeaders = () => {\r\n    return {\r\n      'Content-Type': 'application/json',\r\n      'x-user-data': JSON.stringify(user || {})\r\n    };\r\n  };\r\n\r\n  // Load initial data\r\n  useEffect(() => {\r\n    if (isAuthorized) {\r\n      loadDiscounts();\r\n      loadSettings();\r\n      if (isEditMode && editId) {\r\n        loadExistingOrder();\r\n      }\r\n    }\r\n  }, [isAuthorized, isEditMode, editId]);\r\n\r\n  // Handle click outside to close dropdowns\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as Element;\r\n      \r\n      // Close shop dropdown if click is outside shop search container\r\n      if (showShopResults && !target.closest('.shop-search-container')) {\r\n        setShowShopResults(false);\r\n      }\r\n      \r\n      // Close sales rep dropdown if click is outside sales rep search container\r\n      if (showSalesRepResults && !target.closest('.salesrep-search-container')) {\r\n        setShowSalesRepResults(false);\r\n      }\r\n      \r\n      // Close product dropdown if click is outside product search container\r\n      if (showProductResults && !target.closest('.product-search-container')) {\r\n        setShowProductResults(false);\r\n      }\r\n      \r\n      // Close free product dropdown if click is outside free product search container\r\n      if (showFreeProductResults && !target.closest('.freeproduct-search-container')) {\r\n        setShowFreeProductResults(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [showShopResults, showSalesRepResults, showProductResults, showFreeProductResults]);\r\n\r\n  const loadDiscounts = async () => {\r\n    try {\r\n      const response = await fetch('/api/discounts');\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setDiscounts(data.discounts.filter((d: Discount) => d.percentage > 0));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading discounts:', error);\r\n    }\r\n  };\r\n\r\n  const loadSettings = async () => {\r\n    try {\r\n      const response = await fetch('/api/softwareSettings', {\r\n        headers: getUserHeaders()\r\n      });\r\n      const data = await response.json();\r\n      if (data.success && data.settings) {\r\n        setCashDiscountPercent(data.settings.totalBalanceDiscountPercent || 5);\r\n        setOrderSettings({\r\n          hideSellingPrice: data.settings.hideSellingPrice || false,\r\n          hideDiscount: data.settings.hideDiscount || false,\r\n          hideFreeProducts: data.settings.hideFreeProducts || false,\r\n          hideCashDiscount: data.settings.hideCashDiscount || false\r\n        });\r\n        console.log('‚úÖ Loaded order settings:', {\r\n          hideSellingPrice: data.settings.hideSellingPrice || false,\r\n          hideDiscount: data.settings.hideDiscount || false,\r\n          hideFreeProducts: data.settings.hideFreeProducts || false,\r\n          hideCashDiscount: data.settings.hideCashDiscount || false\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading settings:', error);\r\n    }\r\n  };\r\n\r\n  const loadExistingOrder = async () => {\r\n    try {\r\n      setIsLoadingOrder(true);\r\n      const response = await fetch(`/api/orders/${editId}`);\r\n      const data = await response.json();\r\n      \r\n      if (!data.success) {\r\n        setError(data.error || 'Failed to load order');\r\n        return;\r\n      }\r\n\r\n      const orderData = data.order;\r\n      \r\n      // Check if order is pending\r\n      if (orderData.status.toLowerCase() !== 'pending') {\r\n        setError('Only pending orders can be edited');\r\n        setTimeout(() => router.push('/orders'), 2000);\r\n        return;\r\n      }\r\n\r\n      setExistingOrder(orderData);\r\n      \r\n      // Pre-populate form data\r\n      setOrderDate(new Date(orderData.orderDate).toISOString().split('T')[0]);\r\n      setSelectedShop(orderData.shop);\r\n      setShopSearch(orderData.shop.shopName);\r\n      \r\n      if (orderData.salesRep) {\r\n        setSelectedSalesRep(orderData.salesRep);\r\n        setSalesRepSearch(orderData.salesRep.name);\r\n      }\r\n      \r\n      if (orderData.discount) {\r\n        setSelectedDiscount(orderData.discount);\r\n      }\r\n      \r\n      setNotes(orderData.notes || '');\r\n      \r\n      // Convert order items to form format\r\n      const formattedItems: OrderItem[] = orderData.orderItems.map((item: any, index: number) => ({\r\n        id: `item-${item.id}-${index}`,\r\n        productId: item.product.id,\r\n        productCode: item.product.productCode,\r\n        productName: item.sellingPrice === 0 ? `${item.product.itemName} (FREE)` : item.product.itemName,\r\n        quantity: Number(item.quantity) || 0,\r\n        sellingPrice: Number(item.sellingPrice) || 0,\r\n        discount: Number(item.discount) || 0,\r\n        availableQty: (item.product.availableQty || 0) + (item.quantity || 0),\r\n        costPrice: item.product.availableQty > 0 ? Number(item.product.totalCost) / item.product.availableQty : 0\r\n      }));\r\n      \r\n      setOrderItems(formattedItems);\r\n      \r\n    } catch (error) {\r\n      console.error('Error loading order:', error);\r\n      setError('Failed to load order');\r\n    } finally {\r\n      setIsLoadingOrder(false);\r\n    }\r\n  };\r\n\r\n  // Search functions\r\n  const searchShops = useCallback(async (searchTerm: string) => {\r\n    if (searchTerm.length < 2) {\r\n      setShopResults([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/shops?search=${encodeURIComponent(searchTerm)}&limit=10&activeOnly=true`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setShopResults(data.shops || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching shops:', error);\r\n    }\r\n  }, []);\r\n\r\n  const searchSalesReps = useCallback(async (searchTerm: string) => {\r\n    if (searchTerm.length < 2) {\r\n      setSalesRepResults([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/sales-rep?search=${encodeURIComponent(searchTerm)}&activeOnly=true`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setSalesRepResults(data.salesReps || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching sales reps:', error);\r\n    }\r\n  }, []);\r\n\r\n  const searchProducts = useCallback(async (searchTerm: string) => {\r\n    if (searchTerm.length < 2) {\r\n      setProductResults([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/products/search?search=${encodeURIComponent(searchTerm)}&limit=10`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setProductResults(data.products || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching products:', error);\r\n    }\r\n  }, []);\r\n\r\n  const searchFreeProducts = useCallback(async (searchTerm: string) => {\r\n    if (searchTerm.length < 2) {\r\n      setFreeProductResults([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/products/search?search=${encodeURIComponent(searchTerm)}&limit=10`);\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setFreeProductResults(data.products || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching free products:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Handle search input changes with debouncing\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (shopSearch) {\r\n        searchShops(shopSearch);\r\n        setShowShopResults(true);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [shopSearch, searchShops]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (salesRepSearch) {\r\n        searchSalesReps(salesRepSearch);\r\n        setShowSalesRepResults(true);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [salesRepSearch, searchSalesReps]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (productSearch) {\r\n        searchProducts(productSearch);\r\n        setShowProductResults(true);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [productSearch, searchProducts]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (freeProductSearch) {\r\n        searchFreeProducts(freeProductSearch);\r\n        setShowFreeProductResults(true);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [freeProductSearch, searchFreeProducts]);\r\n\r\n  // Monitor order changes for credit validation\r\n  useEffect(() => {\r\n    checkOrderCanBeSaved();\r\n  }, [orderItems, selectedShop, selectedDiscount, cashDiscountEnabled]);\r\n\r\n  // Selection handlers\r\n  const selectShop = async (shop: Shop) => {\r\n    setSelectedShop(shop);\r\n    setShopSearch(shop.shopName);\r\n    setShowShopResults(false);\r\n    console.log('Shop selected, dropdown should close');\r\n    \r\n    // Clear previous overdue payments\r\n    setOverduePayments([]);\r\n    setHasOverduePayments(false);\r\n    \r\n    // Check for overdue payments for this shop\r\n    await checkOverduePayments(shop.id);\r\n  };\r\n\r\n  const selectSalesRep = (salesRep: SalesRep) => {\r\n    setSelectedSalesRep(salesRep);\r\n    setSalesRepSearch(salesRep.name);\r\n    setShowSalesRepResults(false);\r\n    console.log('Sales rep selected, dropdown should close');\r\n  };\r\n\r\n  // Credit validation function\r\n  const validateCreditLimit = (orderTotal: number): { isValid: boolean; message?: string } => {\r\n    if (!selectedShop) {\r\n      return { isValid: false, message: 'Please select a shop first' };\r\n    }\r\n\r\n    // If discount type is not \"credit\", allow the order\r\n    if (!selectedDiscount || selectedDiscount.discountName.toLowerCase() !== 'credit') {\r\n      return { isValid: true };\r\n    }\r\n\r\n    const creditLimit = selectedShop.creditLimit || 0;\r\n    const currentBalance = selectedShop.balanceAmount || 0;\r\n    const availableCredit = creditLimit - currentBalance;\r\n\r\n    if (orderTotal > availableCredit) {\r\n      return { \r\n        isValid: false, \r\n        message: `Order total (Rs ${orderTotal.toLocaleString()}) exceeds available credit (Rs ${availableCredit.toLocaleString()})` \r\n      };\r\n    }\r\n\r\n    return { isValid: true };\r\n  };\r\n\r\n  // Check if current order can be saved (for button state)\r\n  const checkOrderCanBeSaved = () => {\r\n    if (!selectedShop || orderItems.length === 0) {\r\n      setIsCreditExceeded(false);\r\n      return;\r\n    }\r\n\r\n    // If discount type is not \"credit\", allow the order\r\n    if (!selectedDiscount || selectedDiscount.discountName.toLowerCase() !== 'credit') {\r\n      setIsCreditExceeded(false);\r\n      return;\r\n    }\r\n\r\n    // Calculate current order total\r\n    const orderTotal = orderItems.reduce((total, item) => {\r\n      const itemTotal = (item.quantity * item.sellingPrice) - item.discount;\r\n      return total + itemTotal;\r\n    }, 0);\r\n\r\n    // Apply discount percentage if selected\r\n    let finalOrderTotal = orderTotal;\r\n    if (selectedDiscount) {\r\n      const discountAmount = (orderTotal * selectedDiscount.percentage) / 100;\r\n      finalOrderTotal = orderTotal - discountAmount;\r\n    }\r\n\r\n    // Apply cash discount if enabled\r\n    if (cashDiscountEnabled) {\r\n      const cashDiscountAmount = (finalOrderTotal * cashDiscountPercent) / 100;\r\n      finalOrderTotal = finalOrderTotal - cashDiscountAmount;\r\n    }\r\n\r\n    // Check credit limit\r\n    const creditValidation = validateCreditLimit(finalOrderTotal);\r\n    setIsCreditExceeded(!creditValidation.isValid);\r\n  };\r\n\r\n  // Check for overdue payments for selected shop\r\n  const checkOverduePayments = async (shopId: number) => {\r\n    try {\r\n      const response = await fetch(`/api/payments?shopId=${shopId}&status=due&limit=100`);\r\n      const data = await response.json();\r\n      \r\n      if (data.success) {\r\n        const overduePmts: OverduePayment[] = data.payments.map((payment: any) => {\r\n          const dueDate = new Date(payment.dueDate);\r\n          const today = new Date();\r\n          today.setHours(0, 0, 0, 0);\r\n          dueDate.setHours(0, 0, 0, 0);\r\n          const daysPastDue = Math.ceil((today.getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24));\r\n          \r\n          return {\r\n            id: payment.id,\r\n            invoiceNumber: payment.invoice.invoiceNumber,\r\n            dueDate: payment.dueDate,\r\n            remainingAmount: Number(payment.remainingAmount) || 0,\r\n            daysPastDue: Math.max(0, daysPastDue)\r\n          };\r\n        });\r\n        \r\n        setOverduePayments(overduePmts);\r\n        setHasOverduePayments(overduePmts.length > 0);\r\n        \r\n        if (overduePmts.length > 0) {\r\n          const totalOverdue = overduePmts.reduce((sum, p) => sum + Number(p.remainingAmount), 0);\r\n          setError(\r\n            `‚ö†Ô∏è This shop has ${overduePmts.length} overdue payment(s) totaling Rs ${totalOverdue.toLocaleString()}. ` +\r\n            `Please settle overdue payments before creating new orders.`\r\n          );\r\n        } else {\r\n          // Clear error if no overdue payments\r\n          if (error.includes('overdue payment')) {\r\n            setError('');\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking overdue payments:', error);\r\n    }\r\n  };\r\n\r\n  const addProduct = (product: Product) => {\r\n    // Check if product already exists\r\n    if (orderItems.find(item => item.productId === product.id)) {\r\n      setError('Product already added to order');\r\n      return;\r\n    }\r\n\r\n    const newItem: OrderItem = {\r\n      id: `item-${Date.now()}`,\r\n      productId: product.id,\r\n      productCode: product.productCode,\r\n      productName: product.itemName,\r\n      quantity: 1,\r\n      sellingPrice: Number(product.sellingPrice),\r\n      discount: 0,\r\n      availableQty: product.availableQty,\r\n      costPrice: product.availableQty > 0 ? Number(product.totalCost) / product.availableQty : 0\r\n    };\r\n\r\n    // Calculate new order total with this item\r\n    const currentTotal = orderItems.reduce((total, item) => {\r\n      const itemTotal = (item.quantity * item.sellingPrice) - item.discount;\r\n      return total + itemTotal;\r\n    }, 0);\r\n    const newItemTotal = newItem.quantity * newItem.sellingPrice - newItem.discount;\r\n    const newOrderTotal = currentTotal + newItemTotal;\r\n\r\n    // Apply discount percentage if selected\r\n    let finalOrderTotal = newOrderTotal;\r\n    if (selectedDiscount) {\r\n      const discountAmount = (newOrderTotal * selectedDiscount.percentage) / 100;\r\n      finalOrderTotal = newOrderTotal - discountAmount;\r\n    }\r\n\r\n    // Apply cash discount if enabled\r\n    if (cashDiscountEnabled) {\r\n      const cashDiscountAmount = (finalOrderTotal * cashDiscountPercent) / 100;\r\n      finalOrderTotal = finalOrderTotal - cashDiscountAmount;\r\n    }\r\n\r\n    // Validate credit limit for credit orders\r\n    const creditValidation = validateCreditLimit(finalOrderTotal);\r\n    if (!creditValidation.isValid) {\r\n      setError(creditValidation.message || 'Credit limit exceeded');\r\n      return;\r\n    }\r\n\r\n    setOrderItems(prev => [...prev, newItem]);\r\n    setProductSearch('');\r\n    setShowProductResults(false);\r\n    setError(''); // Clear any previous errors\r\n  };\r\n\r\n  const addFreeProduct = (product: Product) => {\r\n    // Always add as new free item (separate row even if product exists as regular item)\r\n    const newItem: OrderItem = {\r\n      id: `free-item-${Date.now()}-${product.id}-${Math.random()}`, // Unique ID for free items\r\n      productId: product.id,\r\n      productCode: product.productCode,\r\n      productName: `${product.itemName} (FREE)`, // Mark as free in the name\r\n      quantity: 1,\r\n      sellingPrice: 0, // Free product selling price is 0\r\n      discount: 0,\r\n      availableQty: product.availableQty,\r\n      costPrice: product.availableQty > 0 ? Number(product.totalCost) / product.availableQty : 0\r\n    };\r\n\r\n    // Add free items to the end of the list (they will appear at the bottom)\r\n    setOrderItems(prev => [...prev, newItem]);\r\n    setFreeProductSearch('');\r\n    setFreeProductResults([]);\r\n    setShowFreeProductResults(false);\r\n    setError(''); // Clear any previous errors\r\n  };\r\n\r\n  const updateOrderItem = (itemId: string, field: keyof OrderItem, value: number) => {\r\n    // Create updated items array for validation\r\n    const updatedItems = orderItems.map(item => {\r\n      if (item.id === itemId) {\r\n        const updatedItem = { ...item, [field]: value };\r\n        \r\n        // Validate quantity\r\n        if (field === 'quantity' && value > item.availableQty) {\r\n          setError(`Insufficient stock for ${item.productName}. Available: ${item.availableQty}`);\r\n          return item; // Don't update if invalid\r\n        }\r\n        \r\n        return updatedItem;\r\n      }\r\n      return item;\r\n    });\r\n\r\n    // Calculate new order total with updated items\r\n    const newOrderTotal = updatedItems.reduce((total, item) => {\r\n      const itemTotal = (item.quantity * item.sellingPrice) - item.discount;\r\n      return total + itemTotal;\r\n    }, 0);\r\n\r\n    // Apply discount percentage if selected\r\n    let finalOrderTotal = newOrderTotal;\r\n    if (selectedDiscount) {\r\n      const discountAmount = (newOrderTotal * selectedDiscount.percentage) / 100;\r\n      finalOrderTotal = newOrderTotal - discountAmount;\r\n    }\r\n\r\n    // Apply cash discount if enabled\r\n    if (cashDiscountEnabled) {\r\n      const cashDiscountAmount = (finalOrderTotal * cashDiscountPercent) / 100;\r\n      finalOrderTotal = finalOrderTotal - cashDiscountAmount;\r\n    }\r\n\r\n    // Validate credit limit for credit orders (only if order items would change)\r\n    const hasActualChange = updatedItems.some((item, index) => {\r\n      const original = orderItems[index];\r\n      return !original || item.quantity !== original.quantity || item.sellingPrice !== original.sellingPrice || item.discount !== original.discount;\r\n    });\r\n\r\n    if (hasActualChange) {\r\n      const creditValidation = validateCreditLimit(finalOrderTotal);\r\n      if (!creditValidation.isValid) {\r\n        setError(creditValidation.message || 'Credit limit exceeded');\r\n        return; // Don't update if credit validation fails\r\n      }\r\n    }\r\n\r\n    setOrderItems(updatedItems);\r\n    setError(''); // Clear any previous errors\r\n  };\r\n\r\n  const removeOrderItem = (itemId: string) => {\r\n    setOrderItems(prev => prev.filter(item => item.id !== itemId));\r\n  };\r\n\r\n  // Calculate totals\r\n  const calculateTotals = () => {\r\n    let subTotal = 0;\r\n    let totalDiscount = 0;\r\n    let totalCost = 0;\r\n    let totalProfit = 0;\r\n\r\n    orderItems.forEach(item => {\r\n      const itemTotal = item.sellingPrice * item.quantity;\r\n      const itemDiscountAmount = item.discount * item.quantity;\r\n      const itemPrice = itemTotal - itemDiscountAmount;\r\n      const itemCost = item.costPrice * item.quantity;\r\n\r\n      subTotal += itemTotal;\r\n      totalDiscount += itemDiscountAmount;\r\n      totalCost += itemCost;\r\n      totalProfit += (itemPrice - itemCost);\r\n    });\r\n\r\n    // Apply invoice type discount\r\n    let invoiceTypeDiscount = 0;\r\n    if (selectedDiscount) {\r\n      invoiceTypeDiscount = subTotal * (Number(selectedDiscount.percentage) / 100);\r\n    }\r\n\r\n    // Apply cash discount\r\n    let cashDiscount = 0;\r\n    if (cashDiscountEnabled) {\r\n      cashDiscount = (subTotal - invoiceTypeDiscount - totalDiscount) * (cashDiscountPercent / 100);\r\n    }\r\n\r\n    const netTotal = subTotal - invoiceTypeDiscount - totalDiscount - cashDiscount;\r\n    const finalProfit = totalProfit - invoiceTypeDiscount - cashDiscount;\r\n\r\n    return {\r\n      subTotal,\r\n      totalDiscount,\r\n      invoiceTypeDiscount,\r\n      cashDiscount,\r\n      netTotal,\r\n      totalCost,\r\n      totalProfit: finalProfit\r\n    };\r\n  };\r\n\r\n  const totals = calculateTotals();\r\n\r\n  // Form validation\r\n  const isFormValid = () => {\r\n    // Check for at least one regular product (free products are optional)\r\n    const regularProducts = orderItems.filter(item => item.sellingPrice > 0);\r\n    \r\n    return (\r\n      orderDate &&\r\n      selectedShop &&\r\n      selectedSalesRep &&\r\n      selectedDiscount &&\r\n      regularProducts.length > 0 &&\r\n      orderItems.every(item => item.quantity > 0 && item.quantity <= item.availableQty)\r\n    );\r\n  };\r\n\r\n  // Handle form submission\r\n  const handleSubmit = async () => {\r\n    // Debug current form state\r\n    console.log('Form validation debug:', {\r\n      orderDate,\r\n      selectedShop: selectedShop?.shopName || 'null',\r\n      selectedSalesRep: selectedSalesRep?.name || 'null', \r\n      selectedDiscount: selectedDiscount?.discountName || 'null',\r\n      orderItems: orderItems.length,\r\n      regularProducts: orderItems.filter(item => item.sellingPrice > 0).length,\r\n      freeProducts: orderItems.filter(item => item.sellingPrice === 0).length\r\n    });\r\n\r\n    // Check specific missing fields\r\n    const missingFields = [];\r\n    if (!orderDate) missingFields.push('Order Date');\r\n    if (!selectedShop) missingFields.push('Shop');\r\n    if (!selectedSalesRep) missingFields.push('Sales Representative');\r\n    if (!selectedDiscount) missingFields.push('Discount Type');\r\n    \r\n    // Check for at least one regular product (free products are optional)\r\n    const regularProducts = orderItems.filter(item => item.sellingPrice > 0);\r\n    if (regularProducts.length === 0) missingFields.push('At least one regular product');\r\n    \r\n    // Check for invalid quantities (both regular and free products)\r\n    const invalidItems = orderItems.filter(item => item.quantity <= 0 || item.quantity > item.availableQty);\r\n    \r\n    console.log('Validation results:', { missingFields, invalidItems });\r\n    \r\n    if (missingFields.length > 0 || invalidItems.length > 0) {\r\n      let errorMsg = '';\r\n      if (missingFields.length > 0) {\r\n        errorMsg += `Missing required fields: ${missingFields.join(', ')}`;\r\n      }\r\n      if (invalidItems.length > 0) {\r\n        if (errorMsg) errorMsg += '. ';\r\n        errorMsg += `Invalid quantities for: ${invalidItems.map(item => item.productName).join(', ')}`;\r\n      }\r\n      console.log('Setting error:', errorMsg);\r\n      setError(errorMsg);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n    setMessage('');\r\n\r\n    try {\r\n      const orderData = {\r\n        orderDate,\r\n        shopId: selectedShop!.id,\r\n        salesRepId: selectedSalesRep?.id,\r\n        discountId: selectedDiscount?.id,\r\n        invoiceTypePercentage: selectedDiscount ? Number(selectedDiscount.percentage) : 0,\r\n        cashDiscountEnabled,\r\n        notes,\r\n        status: 'PENDING', // Always save as pending\r\n        orderItems: orderItems.map(item => ({\r\n          productId: item.productId,\r\n          quantity: item.quantity,\r\n          sellingPrice: item.sellingPrice,\r\n          discount: item.discount\r\n        }))\r\n      };\r\n\r\n      // Use different API endpoints for create vs update\r\n      const url = isEditMode ? `/api/orders/${editId}` : '/api/orders';\r\n      const method = isEditMode ? 'PUT' : 'POST';\r\n\r\n      console.log('Sending order data:', orderData);\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: getUserHeaders(),\r\n        body: JSON.stringify(orderData)\r\n      });\r\n\r\n      const data = await response.json();\r\n      console.log('API response:', data);\r\n\r\n      if (data.success) {\r\n        setMessage(isEditMode ? 'Order updated successfully!' : 'Order saved successfully!');\r\n        \r\n        // Navigate back to orders list\r\n        setTimeout(() => {\r\n          router.push('/orders');\r\n        }, 2000);\r\n      } else {\r\n        setError(data.error || `Failed to ${isEditMode ? 'update' : 'save'} order`);\r\n      }\r\n    } catch (error) {\r\n      console.error(`Error ${isEditMode ? 'updating' : 'saving'} order:`, error);\r\n      setError(`An error occurred while ${isEditMode ? 'updating' : 'saving'} the order`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Show loading while checking authorization\r\n  if (authLoading) {\r\n    return <div className={styles.loading}>Checking permissions...</div>;\r\n  }\r\n\r\n  // Show loading while loading existing order\r\n  if (isLoadingOrder && isEditMode) {\r\n    return <div className={styles.loading}>Loading order data...</div>;\r\n  }\r\n\r\n  // Show access denied if not authorized\r\n  if (!isAuthorized) {\r\n    return <div className={styles.loading}>Access denied to order management</div>;\r\n  }\r\n\r\n  return (\r\n    <div className={`${styles.container} ${isDarkMode ? 'dark' : 'light'}`}>\r\n      <div className={styles.header}>\r\n        <div className={styles.headerTop}>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => router.push('/orders')}\r\n            className={styles.backButton}\r\n          >\r\n            ‚Üê Back\r\n          </button>\r\n        </div>\r\n        <h1 className={styles.title}>üìã {isEditMode ? `Edit Order ${existingOrder?.orderNumber || ''}` : 'Create New Order'}</h1>\r\n        <p className={styles.subtitle}>{isEditMode ? 'Edit existing order details' : 'Create orders that can be converted to invoices later'}</p>\r\n      </div>\r\n\r\n      <form className={styles.orderForm} onSubmit={(e) => e.preventDefault()}>\r\n        {/* Basic Information */}\r\n        <div className={styles.section}>\r\n          <h2 className={styles.sectionTitle}>üìÖ Order Information</h2>\r\n          <div className={styles.formGrid}>\r\n            <div className={styles.field}>\r\n              <label className={styles.label}>Order Date *</label>\r\n              <input\r\n                type=\"date\"\r\n                value={orderDate}\r\n                onChange={(e) => setOrderDate(e.target.value)}\r\n                className={styles.input}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.field}>\r\n              <label className={styles.label}>Discount Type *</label>\r\n              <select\r\n                value={selectedDiscount?.id || ''}\r\n                onChange={(e) => {\r\n                  const discount = discounts.find(d => d.id === parseInt(e.target.value));\r\n                  setSelectedDiscount(discount || null);\r\n                }}\r\n                className={styles.select}\r\n                required\r\n              >\r\n                <option value=\"\">Select Discount Type</option>\r\n                {discounts.map(discount => (\r\n                  <option key={discount.id} value={discount.id}>\r\n                    {discount.discountName} ({discount.percentage}%)\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={styles.formGrid}>\r\n            {/* Shop Search */}\r\n            <div className={styles.field}>\r\n              <label className={styles.label}>Shop *</label>\r\n              <div className={`${styles.searchContainer} shop-search-container`}>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search shops...\"\r\n                  value={shopSearch}\r\n                  onChange={(e) => setShopSearch(e.target.value)}\r\n                  onFocus={() => setShowShopResults(true)}\r\n                  className={styles.searchInput}\r\n                  required\r\n                />\r\n                <span className={styles.searchIcon}>üîç</span>\r\n                {showShopResults && shopResults.length > 0 && (\r\n                  <div className={styles.searchResults}>\r\n                    {shopResults.map(shop => (\r\n                      <div\r\n                        key={shop.id}\r\n                        className={styles.searchResult}\r\n                        onClick={() => selectShop(shop)}\r\n                      >\r\n                        <div className={styles.resultName}>{shop.shopName}</div>\r\n                        <div className={styles.resultDetails}>\r\n                          {shop.ownerName} ‚Ä¢ {shop.contactNumber}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Credit Limit Display */}\r\n            {selectedShop && (\r\n              <div className={styles.field}>\r\n                <div className={styles.creditLimitContainer}>\r\n                  <h3 className={styles.creditLimitTitle}>üí≥ Credit Information</h3>\r\n                  <div className={styles.creditLimitGrid}>\r\n                    <div className={styles.creditLimitItem}>\r\n                      <span className={styles.creditLimitLabel}>Credit Limit:</span>\r\n                      <span className={styles.creditLimitValue}>\r\n                        Rs {selectedShop.creditLimit?.toLocaleString() || '0'}\r\n                      </span>\r\n                    </div>\r\n                    <div className={styles.creditLimitItem}>\r\n                      <span className={styles.creditLimitLabel}>Current Balance:</span>\r\n                      <span className={styles.creditLimitValue}>\r\n                        Rs {selectedShop.balanceAmount?.toLocaleString() || '0'}\r\n                      </span>\r\n                    </div>\r\n                    <div className={styles.creditLimitItem}>\r\n                      <span className={styles.creditLimitLabel}>Available Credit:</span>\r\n                      <span className={`${styles.creditLimitValue} ${\r\n                        (selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0) > 0 \r\n                          ? styles.positiveCredit \r\n                          : styles.negativeCredit\r\n                      }`}>\r\n                        Rs {((selectedShop.creditLimit || 0) - (selectedShop.balanceAmount || 0)).toLocaleString()}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Overdue Payments Warning */}\r\n            {selectedShop && hasOverduePayments && (\r\n              <div className={styles.field}>\r\n                <div className={styles.overdueWarning}>\r\n                  <h3 className={styles.overdueWarningTitle}>‚ö†Ô∏è Overdue Payments Alert</h3>\r\n                  <p className={styles.overdueWarningText}>\r\n                    This shop has {overduePayments.length} overdue payment(s). No orders can be created until all overdue payments are settled.\r\n                  </p>\r\n                  <div className={styles.overduePaymentsList}>\r\n                    {overduePayments.map((payment) => (\r\n                      <div key={payment.id} className={styles.overduePaymentItem}>\r\n                        <span className={styles.overdueInvoiceNumber}>Invoice: {payment.invoiceNumber}</span>\r\n                        <span className={styles.overdueDueDate}>Due: {new Date(payment.dueDate).toLocaleDateString()}</span>\r\n                        <span className={styles.overdueAmount}>Rs {payment.remainingAmount.toLocaleString()}</span>\r\n                        <span className={styles.overdueDays}>{payment.daysPastDue} days overdue</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                  <div className={styles.overdueTotal}>\r\n                    Total Overdue: Rs {overduePayments.reduce((sum, p) => sum + Number(p.remainingAmount), 0).toLocaleString()}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Sales Rep Search */}\r\n            <div className={styles.field}>\r\n              <label className={styles.label}>Sales Representative *</label>\r\n              <div className={`${styles.searchContainer} salesrep-search-container`}>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search sales reps...\"\r\n                  value={salesRepSearch}\r\n                  onChange={(e) => setSalesRepSearch(e.target.value)}\r\n                  onFocus={() => setShowSalesRepResults(true)}\r\n                  className={styles.searchInput}\r\n                  required\r\n                />\r\n                <span className={styles.searchIcon}>üë§</span>\r\n                {showSalesRepResults && salesRepResults.length > 0 && (\r\n                  <div className={styles.searchResults}>\r\n                    {salesRepResults.map(rep => (\r\n                      <div\r\n                        key={rep.id}\r\n                        className={styles.searchResult}\r\n                        onClick={() => selectSalesRep(rep)}\r\n                      >\r\n                        <div className={styles.resultName}>{rep.name}</div>\r\n                        <div className={styles.resultDetails}>{rep.contactNumber}</div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={styles.field}>\r\n            <label className={styles.label}>Notes</label>\r\n            <textarea\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              placeholder=\"Optional order notes...\"\r\n              className={styles.textarea}\r\n            />\r\n          </div>\r\n\r\n          {/* Cash Discount Toggle - Hidden if setting is enabled */}\r\n          {!orderSettings.hideCashDiscount && (\r\n            <div className={styles.toggleField}>\r\n              <label className={styles.toggleLabel}>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={cashDiscountEnabled}\r\n                  onChange={(e) => setCashDiscountEnabled(e.target.checked)}\r\n                  className={styles.toggleInput}\r\n                />\r\n                <span>Enable Cash Discount ({cashDiscountPercent}%)</span>\r\n              </label>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Products Section */}\r\n        <div className={styles.section}>\r\n          <h2 className={styles.sectionTitle}>üì¶ Order Items</h2>\r\n          \r\n          {/* Product Search */}\r\n          <div className={styles.productSearch}>\r\n            <label className={styles.label}>Add Products</label>\r\n            <div className={`${styles.searchContainer} product-search-container`}>\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Search products to add...\"\r\n                value={productSearch}\r\n                onChange={(e) => setProductSearch(e.target.value)}\r\n                onFocus={() => setShowProductResults(true)}\r\n                className={styles.searchInput}\r\n              />\r\n              <span className={styles.searchIcon}>üì¶</span>\r\n              {showProductResults && productResults.length > 0 && (\r\n                <div className={styles.searchResults}>\r\n                  {productResults.map(product => (\r\n                    <div\r\n                      key={product.id}\r\n                      className={styles.searchResult}\r\n                      onClick={() => addProduct(product)}\r\n                    >\r\n                      <div className={styles.resultName}>{product.itemName}</div>\r\n                      <div className={styles.resultDetails}>\r\n                        {product.productCode} ‚Ä¢ Stock: {product.availableQty} ‚Ä¢ LKR {Number(product.sellingPrice).toLocaleString()}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Free Products Search - Hidden if setting is enabled */}\r\n          {!orderSettings.hideFreeProducts && (\r\n            <div className={styles.productSearch}>\r\n              <label className={styles.label}>Add Free Products</label>\r\n              <div className={`${styles.searchContainer} freeproduct-search-container`}>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search products to add as free items (price = 0)...\"\r\n                  value={freeProductSearch}\r\n                  onChange={(e) => setFreeProductSearch(e.target.value)}\r\n                  onFocus={() => setShowFreeProductResults(true)}\r\n                  className={styles.searchInput}\r\n                />\r\n                <span className={styles.searchIcon}>üÜì</span>\r\n                {showFreeProductResults && freeProductResults.length > 0 && (\r\n                  <div className={styles.searchResults}>\r\n                    {freeProductResults.map(product => (\r\n                      <div\r\n                        key={`free-${product.id}`}\r\n                        className={styles.searchResult}\r\n                        onClick={() => addFreeProduct(product)}\r\n                      >\r\n                        <div className={styles.resultName}>{product.itemName} (FREE)</div>\r\n                        <div className={styles.resultDetails}>\r\n                          {product.productCode} ‚Ä¢ Stock: {product.availableQty} ‚Ä¢ Original: LKR {Number(product.sellingPrice).toLocaleString()} ‚Ä¢ Free: LKR 0\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Added Products */}\r\n          <div className={styles.addedProducts}>\r\n            {orderItems\r\n              .sort((a, b) => {\r\n                // Sort free items (selling price = 0) to the bottom\r\n                if (a.sellingPrice === 0 && b.sellingPrice !== 0) return 1;\r\n                if (a.sellingPrice !== 0 && b.sellingPrice === 0) return -1;\r\n                return 0; // Keep original order for items of same type\r\n              })\r\n              .map(item => (\r\n              <div key={item.id} className={styles.productItem}>\r\n                <div className={styles.productHeader}>\r\n                  <div className={styles.productInfo}>\r\n                    <div className={styles.productName}>{item.productName}</div>\r\n                    <div className={styles.productCode}>Code: {item.productCode}</div>\r\n                    <div className={styles.productStock}>Available: {item.availableQty}</div>\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => removeOrderItem(item.id)}\r\n                    className={styles.removeButton}\r\n                  >\r\n                    üóëÔ∏è\r\n                  </button>\r\n                </div>\r\n\r\n                <div className={styles.productInputs}>\r\n                  <div className={styles.inputGroup}>\r\n                    <label className={styles.inputLabel}>Quantity</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"1\"\r\n                      max={item.availableQty}\r\n                      value={item.quantity}\r\n                      onWheel={handleNumberInputWheel}\r\n                      onChange={(e) => updateOrderItem(item.id, 'quantity', parseInt(e.target.value) || 1)}\r\n                      className={styles.productInput}\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className={styles.inputGroup}>\r\n                    <label className={styles.inputLabel}>Selling Price</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      step=\"0.01\"\r\n                      value={item.sellingPrice}\r\n                      onChange={(e) => updateOrderItem(item.id, 'sellingPrice', parseFloat(e.target.value) || 0)}\r\n                      onWheel={handleNumberInputWheel}\r\n                      className={styles.productInput}\r\n                      readOnly={item.sellingPrice === 0 || orderSettings.hideSellingPrice}\r\n                      title={item.sellingPrice === 0 ? 'Free item - selling price cannot be changed' : \r\n                             orderSettings.hideSellingPrice ? 'Selling price is read-only (configured in settings)' : ''}\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className={styles.inputGroup}>\r\n                    <label className={styles.inputLabel}>Discount</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      step=\"0.01\"\r\n                      value={item.discount}\r\n                      onChange={(e) => updateOrderItem(item.id, 'discount', parseFloat(e.target.value) || 0)}\r\n                      onWheel={handleNumberInputWheel}\r\n                      className={styles.productInput}\r\n                      readOnly={item.sellingPrice === 0 || orderSettings.hideDiscount}\r\n                      title={item.sellingPrice === 0 ? 'Free item - no additional discount can be applied' : \r\n                             orderSettings.hideDiscount ? 'Discount is read-only (configured in settings)' : ''}\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className={styles.inputGroup}>\r\n                    <label className={styles.inputLabel}>Price</label>\r\n                    <div className={styles.productInput} style={{display: 'flex', alignItems: 'center'}}>\r\n                      LKR {((item.sellingPrice - item.discount) * item.quantity).toLocaleString()}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className={styles.inputGroup}>\r\n                    <label className={styles.inputLabel}>Total</label>\r\n                    <div className={styles.productInput} style={{display: 'flex', alignItems: 'center', fontWeight: 'bold'}}>\r\n                      LKR {(item.sellingPrice * item.quantity).toLocaleString()}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {orderItems.length === 0 && (\r\n              <div className={styles.loading}>\r\n                No products added yet. Search and add products above.\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Order Summary */}\r\n        {orderItems.length > 0 && (\r\n          <div className={styles.summarySection}>\r\n            <h2 className={styles.sectionTitle}>üí∞ Order Summary</h2>\r\n            <div className={styles.summaryGrid}>\r\n              <div className={styles.summaryRow}>\r\n                <span className={styles.summaryLabel}>Sub Total:</span>\r\n                <span className={styles.summaryValue}>LKR {totals.subTotal.toLocaleString()}</span>\r\n              </div>\r\n              \r\n              {selectedDiscount && (\r\n                <div className={styles.summaryRow}>\r\n                  <span className={styles.summaryLabel}>\r\n                    {selectedDiscount.discountName} ({selectedDiscount.percentage}%):\r\n                  </span>\r\n                  <span className={styles.summaryValue}>- LKR {totals.invoiceTypeDiscount.toLocaleString()}</span>\r\n                </div>\r\n              )}\r\n              \r\n              {totals.totalDiscount > 0 && (\r\n                <div className={styles.summaryRow}>\r\n                  <span className={styles.summaryLabel}>Item Discounts:</span>\r\n                  <span className={styles.summaryValue}>- LKR {totals.totalDiscount.toLocaleString()}</span>\r\n                </div>\r\n              )}\r\n              \r\n              {cashDiscountEnabled && !orderSettings.hideCashDiscount && (\r\n                <div className={styles.summaryRow}>\r\n                  <span className={styles.summaryLabel}>Cash Discount ({cashDiscountPercent}%):</span>\r\n                  <span className={styles.summaryValue}>- LKR {totals.cashDiscount.toLocaleString()}</span>\r\n                </div>\r\n              )}\r\n              \r\n              <div className={styles.summaryRow}>\r\n                <span className={styles.summaryLabel}>Net Total:</span>\r\n                <span className={styles.summaryValue}>LKR {totals.netTotal.toLocaleString()}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Messages */}\r\n        {error && <div className={`${styles.message} ${styles.error}`}>{error}</div>}\r\n        {message && <div className={`${styles.message} ${styles.success}`}>{message}</div>}\r\n\r\n        {/* Action Buttons */}\r\n        <div className={styles.actionSection}>\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleSubmit}\r\n            disabled={!isFormValid() || isLoading || isCreditExceeded || hasOverduePayments}\r\n            className={styles.submitButton}\r\n          >\r\n            {isLoading \r\n              ? (isEditMode ? 'ÔøΩ Updating...' : 'ÔøΩüíæ Saving...') \r\n              : (isEditMode ? 'üìù Update Order' : 'üíæ Save Order')}\r\n          </button>\r\n          {isCreditExceeded && (\r\n            <div className={`${styles.message} ${styles.error}`}>\r\n              ‚ö†Ô∏è Cannot {isEditMode ? 'update' : 'save'} order: Available credit limit exceeded for credit payment\r\n            </div>\r\n          )}\r\n          {hasOverduePayments && (\r\n            <div className={`${styles.message} ${styles.error}`}>\r\n              ‚ö†Ô∏è Cannot {isEditMode ? 'update' : 'save'} order: Shop has overdue payments that must be settled first\r\n            </div>\r\n          )}\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Wrapper component with Suspense for useSearchParams\r\nconst OrderPage: React.FC = () => {\r\n  return (\r\n    <Suspense fallback={<div>Loading...</div>}>\r\n      <OrderCreation />\r\n    </Suspense>\r\n  );\r\n};\r\n\r\nexport default OrderPage;"],"names":[],"mappings":"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"}