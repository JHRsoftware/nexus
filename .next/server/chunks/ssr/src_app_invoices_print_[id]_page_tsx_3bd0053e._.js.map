{"version":3,"sources":["turbopack:///[project]/src/app/invoices/print/[id]/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport './print-global.css';\r\n\r\n// Company Settings Interface\r\ninterface CompanySettings {\r\n  companyName: string;\r\n  companyAddress: string;\r\n  companyContactNumber: string;\r\n  companyBusinessRegNo: string;\r\n  companyDescription: string;\r\n  companyLogo?: string;\r\n  totalBalanceDiscountPercent?: number;\r\n}\r\n\r\ninterface InvoiceItem {\r\n  id: string;\r\n  productId: number;\r\n  productCode: string;\r\n  productName: string;\r\n  quantity: number;\r\n  sellingPrice: number;\r\n  discount: number;\r\n  price: number;\r\n  totalPrice: number;\r\n  costPrice?: number;\r\n}\r\n\r\ninterface Shop {\r\n  id: number;\r\n  shopName: string;\r\n  ownerName: string;\r\n  contactNumber: string;\r\n  address?: string;\r\n}\r\n\r\ninterface SalesRep {\r\n  id: number;\r\n  name: string;\r\n  contactNumber: string;\r\n}\r\n\r\ninterface Discount {\r\n  id: number;\r\n  discountName: string;\r\n  percentage: number;\r\n}\r\n\r\ninterface Invoice {\r\n  id: number;\r\n  invoiceNumber: string;\r\n  invoiceDate: string;\r\n  dueDate?: string;\r\n  shop: Shop;\r\n  salesRep?: SalesRep;\r\n  discount?: Discount;\r\n  invoiceType?: string;\r\n  invoiceTypePercentage?: number;\r\n  cashDiscountEnabled: boolean;\r\n  cashDiscountPercentage?: number;\r\n  notes?: string;\r\n  subTotal: number;\r\n  discountAmount: number;\r\n  netTotal: number;\r\n  invoiceItems: InvoiceItem[];\r\n}\r\n\r\nconst InvoicePrintTemplate: React.FC = () => {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const invoiceId = params?.id as string;\r\n  const { user } = useAuth();\r\n  \r\n  const [invoice, setInvoice] = useState<Invoice | null>(null);\r\n  const [companySettings, setCompanySettings] = useState<CompanySettings | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  // Get user headers for API requests\r\n  const getUserHeaders = () => {\r\n    return {\r\n      'Content-Type': 'application/json',\r\n      'x-user-data': JSON.stringify(user || {})\r\n    };\r\n  };\r\n\r\n  // Fetch invoice data\r\n  useEffect(() => {\r\n    const fetchInvoice = async () => {\r\n      if (!invoiceId) return;\r\n      \r\n      setIsLoading(true);\r\n      try {\r\n        const response = await fetch(`/api/invoices/${invoiceId}`, {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          }\r\n        });\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (data.success && data.invoice) {\r\n          console.log('üìã Invoice Data:', data.invoice);\r\n          setInvoice(data.invoice);\r\n        } else {\r\n          setError('Invoice not found');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching invoice:', error);\r\n        setError('Failed to load invoice');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchInvoice();\r\n  }, [invoiceId]);\r\n\r\n  // Fetch company settings\r\n  useEffect(() => {\r\n    const fetchCompanySettings = async () => {\r\n      try {\r\n        const response = await fetch('/api/softwareSettings', {\r\n          headers: getUserHeaders()\r\n        });\r\n        \r\n        const data = await response.json();\r\n        console.log('üè¢ Company Settings API Response:', data);\r\n        \r\n        if (data.success && data.settings) {\r\n          const settings = {\r\n            companyName: data.settings.companyName || '',\r\n            companyAddress: data.settings.companyAddress || '',\r\n            companyContactNumber: data.settings.companyContactNumber || '',\r\n            companyBusinessRegNo: data.settings.companyBusinessRegNo || '',\r\n            companyDescription: data.settings.companyDescription || '',\r\n            companyLogo: data.settings.companyLogo || '',\r\n            totalBalanceDiscountPercent: data.settings.totalBalanceDiscountPercent || 0\r\n          };\r\n          console.log('üè¢ Setting company settings:', settings);\r\n          setCompanySettings(settings);\r\n        } else {\r\n          console.log('‚ùå API response not successful or no settings:', data);\r\n        }\r\n      } catch (error) {\r\n        console.error('‚ùå Error fetching company settings:', error);\r\n        // Set default company info if API fails\r\n        setCompanySettings({\r\n          companyName: 'API Error - Company Name',\r\n          companyAddress: 'API Error - Company Address',\r\n          companyContactNumber: 'API Error - Contact Number',\r\n          companyBusinessRegNo: '',\r\n          companyDescription: '',\r\n          companyLogo: '',\r\n          totalBalanceDiscountPercent: 0\r\n        });\r\n      }\r\n    };\r\n\r\n    if (user) {\r\n      fetchCompanySettings();\r\n    }\r\n  }, [user]);\r\n\r\n  // Print function with clean settings\r\n  const handlePrint = () => {\r\n    // Hide browser UI elements before printing\r\n    document.title = ''; // Clear page title\r\n    \r\n    // Trigger print with a slight delay to ensure styles are applied\r\n    setTimeout(() => {\r\n      window.print();\r\n    }, 100);\r\n  };\r\n\r\n  // Go back function\r\n  const handleGoBack = () => {\r\n    router.back();\r\n  };\r\n\r\n  // Use stored totals from database to ensure accuracy\r\n  const calculateTotals = () => {\r\n    if (!invoice) return { \r\n      subTotal: 0, \r\n      creditDiscount: 0,\r\n      discountAmount: 0, \r\n      totalDiscountFromItems: 0,\r\n      netBeforeCashDiscount: 0,\r\n      cashDiscount: 0, \r\n      cashDiscountPercent: 0,\r\n      netTotal: 0, \r\n      totalItems: 0 \r\n    };\r\n    \r\n    // Use the stored values from the database which are already calculated correctly\r\n    const subTotal = Number(invoice.subTotal || 0);\r\n    const storedDiscountAmount = Number(invoice.discountAmount || 0);\r\n    const netTotal = Number(invoice.netTotal || 0);\r\n    \r\n    // Calculate item-level discount total\r\n    const totalDiscountFromItems = Number(\r\n      invoice.invoiceItems.reduce((sum, item) => sum + Number(item.discount || 0), 0).toFixed(2)\r\n    );\r\n    \r\n    // Credit discount calculation - check multiple sources for percentage\r\n    let creditDiscountPercent = 0;\r\n    if (invoice.discount && invoice.discount.percentage) {\r\n      creditDiscountPercent = invoice.discount.percentage;\r\n    } else if (invoice.invoiceTypePercentage) {\r\n      creditDiscountPercent = invoice.invoiceTypePercentage;\r\n    }\r\n    \r\n    // Calculate actual discount amount from percentage if discount exists\r\n    let actualDiscountAmount = 0;\r\n    if (creditDiscountPercent > 0) {\r\n      actualDiscountAmount = Number(((subTotal * creditDiscountPercent) / 100).toFixed(2));\r\n    }\r\n    \r\n    // Prefer stored amount, but use calculated if stored is 0 and we have a percentage\r\n    const discountAmount = storedDiscountAmount > 0 ? storedDiscountAmount : actualDiscountAmount;\r\n    \r\n    // Debug logging\r\n    console.log('üßÆ Print Totals Debug:', {\r\n      subTotal,\r\n      storedDiscountAmount,\r\n      actualDiscountAmount,\r\n      finalDiscountAmount: discountAmount,\r\n      creditDiscountPercent,\r\n      hasDiscount: !!invoice.discount,\r\n      invoiceTypePercentage: invoice.invoiceTypePercentage,\r\n      cashDiscountEnabled: invoice.cashDiscountEnabled,\r\n      cashDiscountFromSettings: companySettings?.totalBalanceDiscountPercent,\r\n      allInvoiceFields: Object.keys(invoice)\r\n    });\r\n    \r\n    // Net amount after credit discount but before cash discount\r\n    const netBeforeCashDiscount = subTotal - discountAmount;\r\n    \r\n    // Calculate cash discount from the difference (if cash discount is enabled)\r\n    let cashDiscountPercent = 0;\r\n    let cashDiscount = 0;\r\n    \r\n    if (invoice.cashDiscountEnabled) {\r\n      // Use stored cash discount percentage if available, otherwise fall back to settings\r\n      cashDiscountPercent = invoice.cashDiscountPercentage || companySettings?.totalBalanceDiscountPercent || 0;\r\n      \r\n      // Calculate actual cash discount amount that was applied\r\n      cashDiscount = Math.max(0, netBeforeCashDiscount - netTotal);\r\n      \r\n      console.log('üí∞ Cash Discount Debug:', {\r\n        enabled: invoice.cashDiscountEnabled,\r\n        storedPercentage: invoice.cashDiscountPercentage,\r\n        settingsPercentage: companySettings?.totalBalanceDiscountPercent,\r\n        effectivePercentage: cashDiscountPercent,\r\n        netBeforeCashDiscount,\r\n        netTotal,\r\n        calculatedCashDiscount: cashDiscount\r\n      });\r\n    }\r\n    \r\n    // Calculate total items quantity\r\n    const totalItems = Number(invoice.invoiceItems.reduce((sum, item) => sum + Number(item.quantity || 0), 0));\r\n    \r\n    return { \r\n      subTotal: Number(subTotal.toFixed(2)), \r\n      creditDiscount: Number(discountAmount.toFixed(2)), // Use calculated discount amount\r\n      creditDiscountPercent: Number(creditDiscountPercent),\r\n      discountAmount: Number(discountAmount.toFixed(2)), \r\n      totalDiscountFromItems: Number(totalDiscountFromItems),\r\n      netBeforeCashDiscount: Number(netBeforeCashDiscount.toFixed(2)),\r\n      cashDiscount: Number(cashDiscount.toFixed(2)),\r\n      cashDiscountPercent: Number(cashDiscountPercent),\r\n      netTotal: Number(netTotal.toFixed(2)), \r\n      totalItems: Number(totalItems)\r\n    };\r\n  };\r\n\r\n  const totals = calculateTotals();\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"loading\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>Loading invoice...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !invoice) {\r\n    return (\r\n      <div className=\"error\">\r\n        <h2>Error</h2>\r\n        <p>{error || 'Invoice not found'}</p>\r\n        <button onClick={handleGoBack} className=\"back-button\">\r\n          Go Back\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"print-container\">\r\n      {/* Print Controls - Hidden in print */}\r\n      <div className=\"print-controls\">\r\n        <button onClick={handleGoBack} className=\"back-button\">\r\n          ‚Üê Back to Invoices\r\n        </button>\r\n        <button onClick={handlePrint} className=\"print-button\">\r\n          üñ®Ô∏è Print Invoice\r\n        </button>\r\n      </div>\r\n\r\n      {/* Invoice Template */}\r\n      <div className=\"invoice\">\r\n        {/* Company Header */}\r\n        <div className=\"header\">\r\n          <div className=\"company-info\">\r\n            {companySettings?.companyLogo && companySettings.companyLogo.trim() !== '' && (\r\n              <div className=\"company-logo\">\r\n                <img \r\n                  src={companySettings.companyLogo} \r\n                  alt=\"Company Logo\" \r\n                  className=\"logo-image\"\r\n                  onError={(e) => {\r\n                    // Hide logo if image fails to load\r\n                    (e.target as HTMLImageElement).style.display = 'none';\r\n                  }}\r\n                />\r\n              </div>\r\n            )}\r\n            <h1 className=\"company-name\">\r\n              {companySettings?.companyName && companySettings.companyName.trim() !== '' \r\n                ? companySettings.companyName \r\n                : 'Company Name Not Set'}\r\n            </h1>\r\n            <p className=\"company-address\">\r\n              {companySettings?.companyAddress && companySettings.companyAddress.trim() !== '' ? (\r\n                <>\r\n                  {companySettings.companyAddress.split('\\n').map((line, index) => (\r\n                    <React.Fragment key={index}>\r\n                      {line}\r\n                      {index < companySettings.companyAddress.split('\\n').length - 1 && <br />}\r\n                    </React.Fragment>\r\n                  ))}\r\n                  <br />\r\n                  Phone: {companySettings.companyContactNumber || 'Contact Number Not Set'}\r\n                  {companySettings.companyBusinessRegNo && companySettings.companyBusinessRegNo.trim() !== '' && (\r\n                    <>\r\n                      <br />\r\n                      Business Reg: {companySettings.companyBusinessRegNo}\r\n                    </>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Company Address Not Set<br />\r\n                  Please update in Settings<br />\r\n                  Phone: Contact Number Not Set<br />\r\n                </>\r\n              )}\r\n            </p>\r\n          </div>\r\n          <div className=\"invoice-header\">\r\n            <h2 className=\"invoice-title\">INVOICE</h2>\r\n            <div className=\"invoice-info\">\r\n              <p><strong>Invoice #:</strong> {invoice.invoiceNumber}</p>\r\n              <p><strong>Date:</strong> {new Date(invoice.invoiceDate).toLocaleDateString('en-GB')}</p>\r\n              {invoice.dueDate && (\r\n                <p><strong>Due Date:</strong> {new Date(invoice.dueDate).toLocaleDateString('en-GB')}</p>\r\n              )}\r\n              {invoice.discount && (\r\n                <p><strong>Invoice Type:</strong> {invoice.discount.discountName} ({invoice.discount.percentage}% discount)</p>\r\n              )}\r\n              {invoice.dueDate && (\r\n                <p><strong>Payment Terms:</strong> Net {Math.ceil((new Date(invoice.dueDate).getTime() - new Date(invoice.invoiceDate).getTime()) / (1000 * 60 * 60 * 24))} days</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Billing Information */}\r\n        <div className=\"billing-info\">\r\n          <div className=\"bill-to\">\r\n            <h3>Bill To:</h3>\r\n            <div className=\"customer-info\">\r\n              <p><strong>{invoice.shop.shopName}</strong></p>\r\n              <p>{invoice.shop.ownerName}</p>\r\n              <p>Phone: {invoice.shop.contactNumber}</p>\r\n              {invoice.shop.address && <p>{invoice.shop.address}</p>}\r\n            </div>\r\n          </div>\r\n          \r\n          {invoice.salesRep && (\r\n            <div className=\"sales-rep\">\r\n              <h3>Sales Representative:</h3>\r\n              <p><strong>{invoice.salesRep.name}</strong></p>\r\n              <p>Phone: {invoice.salesRep.contactNumber}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Items Table */}\r\n        <div className=\"items-section\">\r\n          <table className=\"items-table\">\r\n            <thead>\r\n              <tr>\r\n                <th>Item Code</th>\r\n                <th>Description</th>\r\n                <th>Qty</th>\r\n                <th>Unit Price</th>\r\n                <th>Discount</th>\r\n                <th>Total</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {invoice.invoiceItems.map((item, index) => (\r\n                <tr key={item.id || index}>\r\n                  <td>{item.productCode}</td>\r\n                  <td>{item.productName}</td>\r\n                  <td className=\"center\">{item.quantity}</td>\r\n                  <td className=\"right\">LKR {item.sellingPrice.toLocaleString()}</td>\r\n                  <td className=\"right\">LKR {item.discount.toLocaleString()}</td>\r\n                  <td className=\"right\">LKR {item.totalPrice.toLocaleString()}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Totals Section */}\r\n        <div className=\"totals-section\">\r\n          <div className=\"totals-grid\">\r\n            \r\n            {/* Sub Total - Credit Discount */}\r\n            <div className=\"total-row\">\r\n              <span>Sub Total - Credit Discount ({invoice.discount ? totals.creditDiscountPercent : 0}%):</span>\r\n              <span>LKR {totals.subTotal.toLocaleString()}</span>\r\n            </div>\r\n            \r\n            {/* Discount Amount */}\r\n            <div className=\"total-row\">\r\n              <span>Discount Amount ({invoice.discount ? totals.creditDiscountPercent : 0}%):</span>\r\n              <span>\r\n                {totals.discountAmount > 0 \r\n                  ? `- LKR ${totals.discountAmount.toLocaleString()}` \r\n                  : '- LKR 0'}\r\n              </span>\r\n            </div>\r\n            \r\n            {/* Total Discount from Items */}\r\n            <div className=\"total-row\">\r\n              <span>Total Discount from Items:</span>\r\n              <span>LKR {totals.totalDiscountFromItems.toLocaleString()}</span>\r\n            </div>\r\n            \r\n            {/* Cash Discount */}\r\n            <div className=\"total-row\">\r\n              <span>Cash Discount ({totals.cashDiscountPercent}%):</span>\r\n              <span>\r\n                {totals.cashDiscount > 0 \r\n                  ? `- LKR ${totals.cashDiscount.toLocaleString()}` \r\n                  : 'LKR 0'}\r\n              </span>\r\n            </div>\r\n            \r\n            {/* Net Total */}\r\n            <div className=\"total-row net-total\">\r\n              <span>Net Total:</span>\r\n              <span>LKR {totals.netTotal.toLocaleString()}</span>\r\n            </div>\r\n            \r\n          </div>\r\n        </div>\r\n\r\n        {/* Notes Section */}\r\n        {invoice.notes && (\r\n          <div className=\"notes-section\">\r\n            <h3>Notes:</h3>\r\n            <p>{invoice.notes}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Footer */}\r\n        <div className=\"footer\">\r\n          <div className=\"thank-you\">\r\n            <h3>Thank you for your business!</h3>\r\n          </div>\r\n          {companySettings?.companyDescription && companySettings.companyDescription.trim() !== '' && (\r\n            <div className=\"company-description\">\r\n              <p>{companySettings.companyDescription}</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Print Timestamp */}\r\n        <div className=\"print-info\">\r\n          <p>Printed on: {new Date().toLocaleString()}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InvoicePrintTemplate;"],"names":[],"mappings":"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"}