{"version":3,"sources":["turbopack:///[project]/src/lib/database.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\n// Global database connection with optimization\r\ndeclare global {\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\n// Connection pool configuration\r\nconst createPrismaClient = () => {\r\n  return new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n    datasources: {\r\n      db: {\r\n        url: process.env.DATABASE_URL,\r\n      },\r\n    },\r\n  });\r\n};\r\n\r\n// Singleton pattern for database connection\r\nexport const prisma = globalThis.prisma || createPrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n  globalThis.prisma = prisma;\r\n}\r\n\r\n// Connection health check\r\nexport const checkDatabaseConnection = async (): Promise<boolean> => {\r\n  try {\r\n    // PostgreSQL-specific health check\r\n    await prisma.$queryRaw`SELECT 1 as health_check`;\r\n    return true;\r\n  } catch (error) {\r\n    console.error('PostgreSQL database connection failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Graceful shutdown\r\nexport const closeDatabaseConnection = async (): Promise<void> => {\r\n  await prisma.$disconnect();\r\n};\r\n\r\n// Query optimization helpers\r\nexport const withTransaction = async <T>(\r\n  fn: (tx: any) => Promise<T>\r\n): Promise<T> => {\r\n  return prisma.$transaction(fn, {\r\n    maxWait: 5000, // 5 seconds\r\n    timeout: 10000, // 10 seconds\r\n  });\r\n};\r\n\r\n// Bulk operations helper\r\nexport const batchOperation = async <T>(\r\n  items: T[],\r\n  operation: (item: T) => Promise<any>,\r\n  batchSize: number = 100\r\n): Promise<any[]> => {\r\n  const results = [];\r\n  \r\n  for (let i = 0; i < items.length; i += batchSize) {\r\n    const batch = items.slice(i, i + batchSize);\r\n    const batchResults = await Promise.all(batch.map(operation));\r\n    results.push(...batchResults);\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\nexport default prisma;"],"names":[],"mappings":"ioCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,MAoBO,IAAM,EAAS,WAAW,MAAM,EAX9B,EAWkC,EAX9B,EAAA,YAAY,CAAC,CACtB,IAA2E,CAAtE,AAAuE,QAAQ,CACpF,YAAa,CACX,GAAI,CACF,IAAK,QAAQ,AAH6B,GAG1B,CAAC,YAAY,AAC/B,CACF,CACF"}